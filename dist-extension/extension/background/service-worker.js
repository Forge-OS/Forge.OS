(function(){"use strict";const s="https://api.kaspa.org",a="forgeos-balance-poll",r="forgeos.managed.wallet.v1",i="forgeos.session.agents.v2";async function l(){return new Promise(t=>{chrome.storage.local.get(r,e=>{try{const n=e[r];if(!n)return t(null);const o=typeof n=="string"?JSON.parse(n):n;t(o!=null&&o.address?o:null)}catch{t(null)}})})}async function c(){const t=await l();if(!(t!=null&&t.address)){chrome.action.setBadgeText({text:""});return}try{const e=await fetch(`${s}/addresses/${encodeURIComponent(t.address)}/balance`);if(!e.ok)return;const n=await e.json(),o=((n==null?void 0:n.balance)??0)/1e8,d=o>=1e3?`${(o/1e3).toFixed(1)}K`:o.toFixed(0);chrome.action.setBadgeText({text:d}),chrome.action.setBadgeBackgroundColor({color:"#39DDB6"})}catch{}}chrome.runtime.onInstalled.addListener(()=>{chrome.alarms.create(a,{periodInMinutes:1}),c()}),chrome.runtime.onStartup.addListener(()=>{chrome.alarms.create(a,{periodInMinutes:1}),c()}),chrome.alarms.onAlarm.addListener(t=>{t.name===a&&c()}),chrome.runtime.onMessage.addListener(t=>{if((t==null?void 0:t.type)==="FORGEOS_SYNC"){const e={};t.agents&&(e[i]=t.agents),t.wallet&&(e[r]=t.wallet),Object.keys(e).length>0&&chrome.storage.local.set(e)}})})();
