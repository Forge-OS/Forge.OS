const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PerfChart-CqKOmh2i.js","./react-vendor-D4yGots9.js","./recharts-vendor-DqQ-4nM4.js","./d3-render-vendor-RkpHolfk.js","./d3-scale-vendor-BynLqmir.js","./IntelligencePanel-B_zwsSQP.js","./TreasuryPanel-CyFuHSzs.js","./PortfolioPanel-FWkQx4XR.js","./PnlAttributionPanel-CRLREBh1.js","./AlertsPanel-g0ziAsSX.js"])))=>i.map(i=>d[i]);
var _o=Object.defineProperty;var xo=(e,t,r)=>t in e?_o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Xe=(e,t,r)=>xo(e,typeof t!="symbol"?t+"":t,r);import{j as n,r as p,R as os,a as yo}from"./react-vendor-D4yGots9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();const rt=[{id:"mainnet",label:"Kaspa Mainnet",aliases:["mainnet","kaspa_mainnet","kaspa-mainnet","mainnet-11","mainnet11"],addressPrefixes:["kaspa"]},{id:"testnet-10",label:"Kaspa Testnet 10",aliases:["testnet","testnet10","testnet-10","tn10","kaspa_testnet_10","kaspa-testnet-10"],addressPrefixes:["kaspatest"]},{id:"testnet-11",label:"Kaspa Testnet 11",aliases:["testnet11","testnet-11","tn11","kaspa_testnet_11","kaspa-testnet-11"],addressPrefixes:["kaspatest"]},{id:"testnet-12",label:"Kaspa Testnet 12",aliases:["testnet12","testnet-12","tn12","kaspa_testnet_12","kaspa-testnet-12"],addressPrefixes:["kaspatest"]},{id:"devnet",label:"Kaspa Devnet",aliases:["devnet","kaspadev","kaspa_devnet","kaspa-devnet"],addressPrefixes:["kaspadev"]},{id:"simnet",label:"Kaspa Simnet",aliases:["simnet","kaspasim","kaspa_simnet","kaspa-simnet"],addressPrefixes:["kaspasim"]}],So=rt;function hn(e){return String(e||"").trim().toLowerCase().replace(/_/g,"-")}function Eo(e){const t=hn(String(e??""));if(!t)return null;const r=rt.find(s=>s.aliases.some(i=>hn(i)===t));return r||(["livenet","live","main","0"].includes(t)?rt[0]:["test","testnet","test-net","tn","1"].includes(t)?rt[1]:["2","tn11"].includes(t)?rt[2]:["3","tn12"].includes(t)?rt[3]:null)}function Je(e){return Eo(e||"mainnet")||rt[0]}function ct(e,t){const r=e.indexOf(":");if(r<1)return!1;const s=e.slice(0,r).toLowerCase();return t.addressPrefixes.includes(s)}const Fr=(e,t=4)=>parseFloat(e||0).toFixed(t),is=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Oc=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Oe=e=>e?`${e.slice(0,18)}...${e.slice(-6)}`:"â€”",Pc=(e,t,r)=>Math.min(r,Math.max(t,e)),er=()=>Math.random().toString(36).slice(2,10),Ao=/^[qpzry9x8gf2tvdw0s3jn54khce6mua7l]+$/i,as=["kaspa","kaspatest","kaspadev","kaspasim"],Ze=(e,t=as)=>{const r=String(e||"").trim().toLowerCase(),s=r.indexOf(":");if(s<=0||s===r.length-1)return!1;const i=r.slice(0,s),a=r.slice(s+1);return!t.map(d=>d.toLowerCase()).includes(i)||a.length<61||a.length>63?!1:Ao.test(a)},he=(e,t=as)=>{const r=String(e||"").trim();if(!Ze(r,t))throw new Error(`Invalid Kaspa address for allowed prefixes: ${t.join(", ")}`);const s=r.toLowerCase(),i=s.indexOf(":"),a=s.slice(0,i),d=s.slice(i+1);return`${a}:${d}`},bo={},ee=bo;function ko(){if(typeof window>"u")return"";const e=new URLSearchParams(window.location.search).get("network");if(e)return e;try{window.localStorage.getItem("forgeos.network")&&window.localStorage.removeItem("forgeos.network")}catch{}return""}const cs=ko(),To=cs||ee.VITE_KAS_NETWORK||"mainnet",Rt=Je(To),fe=Rt.id,mt=fe.startsWith("testnet"),xe=cs?Rt.label:ee.VITE_KAS_NETWORK_LABEL||Rt.label,ie=Rt.addressPrefixes;function vo(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function Br(e){return String(e||"").trim().replace(/\/+$/,"")}function cr(e,t,r){return String((mt?t:e)||r||"").trim()}const wo=cr(ee.VITE_KAS_API_MAINNET,ee.VITE_KAS_API_TESTNET,ee.VITE_KAS_API),dr=Br(wo||(mt?"https://api-tn10.kaspa.org":"https://api.kaspa.org")),No=cr(ee.VITE_KAS_API_FALLBACKS_MAINNET,ee.VITE_KAS_API_FALLBACKS_TESTNET,ee.VITE_KAS_API_FALLBACKS),ds=vo(No).map(e=>Br(e)).filter(e=>e&&e!==dr),Io=cr(ee.VITE_KAS_EXPLORER_MAINNET,ee.VITE_KAS_EXPLORER_TESTNET,ee.VITE_KAS_EXPLORER),ut=Br(Io||(mt?"https://explorer-tn10.kaspa.org":"https://explorer.kaspa.org")),Ut=cr(ee.VITE_KAS_WS_URL_MAINNET,ee.VITE_KAS_WS_URL_TESTNET,ee.VITE_KAS_WS_URL),$t=ee.VITE_KASPIUM_DEEP_LINK_SCHEME||"kaspium://",yr=String(ee.VITE_KAS_ENFORCE_WALLET_NETWORK||"true").toLowerCase()!=="false",Ft=String(ee.VITE_ACCUMULATE_ONLY||"true").toLowerCase()!=="false",_n=[dr,...ds].map(e=>String(e||"").trim()).filter(Boolean),Co=new Set(_n).size!==_n.length;if(Co)throw new Error("Duplicate Kaspa API endpoints detected in VITE_KAS_API* configuration.");function gt(e,t,r){try{return he(e,t)}catch{throw new Error(`Invalid ${r}. Expected prefixes: ${t.join(", ")}`)}}const Rr="kaspa:qpv7fcvdlz6th4hqjtm9qkkms2dw0raem963x3hm8glu3kjgj7922vy69hv85",Ro=ee.VITE_TREASURY_ADDRESS_MAINNET||Rr,Lo=ee.VITE_TREASURY_ADDRESS_TESTNET||"kaspatest:qpqz2vxj23kvh0m73ta2jjn2u4cv4tlufqns2eap8mxyyt0rvrxy6ejkful67",lr=gt(Ro,["kaspa"],"VITE_TREASURY_ADDRESS_MAINNET"),zr=gt(Lo,["kaspatest"],"VITE_TREASURY_ADDRESS_TESTNET");if(lr!==Rr)throw new Error(`Mainnet treasury address is pinned and must be ${Rr}.`);const Mo=ee.VITE_ACCUMULATION_ADDRESS_MAINNET||lr,jo=ee.VITE_ACCUMULATION_ADDRESS_TESTNET||zr,Oo=gt(Mo,["kaspa"],"VITE_ACCUMULATION_ADDRESS_MAINNET"),Po=gt(jo,["kaspatest"],"VITE_ACCUMULATION_ADDRESS_TESTNET"),Ko=ee.VITE_DEMO_ADDRESS_MAINNET||lr,Uo=ee.VITE_DEMO_ADDRESS_TESTNET||zr,$o=gt(Ko,["kaspa"],"VITE_DEMO_ADDRESS_MAINNET"),Fo=gt(Uo,["kaspatest"],"VITE_DEMO_ADDRESS_TESTNET"),Bo=mt?Fo:$o,Lr=mt?zr:lr,tr=mt?Po:Oo,Pe=Number(ee.VITE_FEE_RATE||.2),De=Number(ee.VITE_TREASURY_SPLIT||.3),Wr=Number((1-De).toFixed(2)),bt=String(ee.VITE_TREASURY_FEE_ONCHAIN_ENABLED||"true").toLowerCase()!=="false",It=.5,nt=2e-4,xn=.75,ft=Number(ee.VITE_FREE_CYCLES_PER_DAY||30),rr=String(ee.VITE_BILLING_UPGRADE_URL||"").trim(),yn=String(ee.VITE_BILLING_CONTACT||"").trim(),nr=Number(ee.VITE_AUTO_CYCLE_SECONDS||120),Sr=String(ee.VITE_LIVE_EXECUTION_DEFAULT||"false").toLowerCase()==="true";if(!Number.isFinite(Pe)||Pe<0)throw new Error("Invalid VITE_FEE_RATE. Expected a non-negative numeric value.");if(!Number.isFinite(De)||De<0||De>1)throw new Error("Invalid VITE_TREASURY_SPLIT. Expected a value between 0 and 1.");const $e=Number((Pe*De).toFixed(6));if(!Number.isFinite(ft)||ft<1)throw new Error("Invalid VITE_FREE_CYCLES_PER_DAY. Expected an integer >= 1.");if(!Number.isFinite(nr)||nr<15)throw new Error("Invalid VITE_AUTO_CYCLE_SECONDS. Expected a numeric value >= 15.");const o={s1:"#0B1118",s2:"#101923",s3:"#16222F",border:"#213043",muted:"#32435A",accent:"#39DDB6",aLow:"#112C2A",text:"#EAF1F8",dim:"#8FA0B5",danger:"#FF5D7A",dLow:"#311520",warn:"#F7B267",wLow:"#322515",ok:"#4ADE80",oLow:"#11261A",purple:"#8F7BFF",shadow:"0 18px 45px rgba(0,0,0,0.38)"},y={fontFamily:"'IBM Plex Mono','SFMono-Regular',Menlo,Monaco,monospace"};class Gr extends Error{constructor(r){super(r.message);Xe(this,"domain");Xe(this,"code");Xe(this,"retryable");Xe(this,"details");Xe(this,"cause");this.name="ForgeError",this.domain=r.domain,this.code=r.code,this.retryable=!!r.retryable,this.details=r.details,this.cause=r.cause}}function zo(e){return e instanceof Gr}function Vr(e){return new Gr(e)}function Wo(e,t){const r=String(t||"").toLowerCase();if(e==="wallet"){if(/timeout/.test(r))return"WALLET_TIMEOUT";if(/rejected|denied|cancel/.test(r))return"WALLET_USER_REJECTED";if(/network/.test(r)&&/mismatch|expected|switch/.test(r))return"WALLET_NETWORK_MISMATCH";if(/not detected|unavailable|not connected|browser wallet apis unavailable/.test(r))return"WALLET_UNAVAILABLE";if(/provider missing|invalid/.test(r))return"WALLET_PROVIDER_INVALID"}return e==="rpc"?/timeout/.test(r)?"RPC_TIMEOUT":/429|rate/i.test(r)?"RPC_RATE_LIMIT":/invalid/.test(r)?"RPC_RESPONSE_INVALID":"RPC_UNAVAILABLE":e==="ai"?/timeout/.test(r)?"AI_TIMEOUT":"AI_UNAVAILABLE":e==="tx"?/invalid/.test(r)?"TX_INVALID":/rejected|denied|cancel/.test(r)?"TX_REJECTED":"TX_BROADCAST_FAILED":e==="lifecycle"?"LIFECYCLE_INVALID_TRANSITION":"UNKNOWN"}function ur(e,t={}){if(zo(e))return e;const r=String((e==null?void 0:e.message)||e||t.message||"Unknown error"),s=t.domain||"system",i=t.code||Wo(s,r),a=typeof t.retryable=="boolean"?t.retryable:/(timeout|network|unavailable|429|503|502|504)/i.test(r);return new Gr({message:r,domain:s,code:i,retryable:a,details:t.details,cause:e})}function Dr(e){const t=ur(e);return`${t.code}: ${t.message}`}function Bt(e,t){return ur(e,{domain:"wallet",details:t})}function Hr(e,t){return ur(e,{domain:"rpc",details:t})}const Yt=["kaspa","kaspatest","kaspadev","kaspasim"],Ie=15e3,Qe=45e3,Go=350,Er=45e3;var Hn,qn;const Vo=String(((qn=(Hn=import.meta)==null?void 0:Hn.env)==null?void 0:qn.VITE_KASTLE_RAW_TX_ENABLED)||"false").toLowerCase()==="true";var Yn,Xn;const ls=String(((Xn=(Yn=import.meta)==null?void 0:Yn.env)==null?void 0:Xn.VITE_KASTLE_RAW_TX_MANUAL_JSON_PROMPT_ENABLED)||"true").toLowerCase()!=="false";var Qn,Jn;const sr=String(((Jn=(Qn=import.meta)==null?void 0:Qn.env)==null?void 0:Jn.VITE_KASTLE_TX_BUILDER_URL)||"").trim();var Zn,es;const Sn=String(((es=(Zn=import.meta)==null?void 0:Zn.env)==null?void 0:es.VITE_KASTLE_TX_BUILDER_TOKEN)||"").trim();var ts,rs;const Do=Math.max(1e3,Number(((rs=(ts=import.meta)==null?void 0:ts.env)==null?void 0:rs.VITE_KASTLE_TX_BUILDER_TIMEOUT_MS)||12e3));var ns,ss;const Ho=String(((ss=(ns=import.meta)==null?void 0:ns.env)==null?void 0:ss.VITE_KASTLE_TX_BUILDER_STRICT)||"false").toLowerCase()==="true";let Ge=null,zt={ts:0,providers:[]};function En(e){return Math.floor(Number(e||0)*1e8)}function qo(e){const t=Number((e==null?void 0:e.total)??(e==null?void 0:e.confirmed)??(e==null?void 0:e.balance)??0);return Number.isFinite(t)?Fr(t/1e8,4):"0.0000"}function Yo(e){return typeof e=="string"?e:(e==null?void 0:e.txid)||(e==null?void 0:e.hash)||(e==null?void 0:e.transactionId)||""}function et(e){return/^[a-fA-F0-9]{64}$/.test(String(e||"").trim())}function An(e){return Number(e||0).toFixed(8).replace(/\.?0+$/,"")||"0"}function or(){return Je(fe).id==="mainnet"?"mainnet":"testnet-10"}function us(){if(typeof window>"u")return null;const e=window.__FORGEOS_KASTLE_BUILD_TX_JSON__;return typeof e=="function"?e:null}async function Xo(e,t){var d;if(!sr)return"";if(typeof fetch!="function")throw new Error("Kastle tx builder requires fetch()");const r=await Jo(),s=or(),i=typeof AbortController<"u"?new AbortController:null,a=i?setTimeout(()=>i.abort(),Do):null;try{const c=await fetch(sr,{method:"POST",headers:{"Content-Type":"application/json",...Sn?{Authorization:`Bearer ${Sn}`}:{}},body:JSON.stringify({wallet:"kastle",networkId:s,fromAddress:r,outputs:Ct(e).map(A=>({address:A.to,amountKas:Number(A.amount_kas)})),purpose:String(t||"").slice(0,140)}),...i?{signal:i.signal}:{}}),u=await c.text();if(!c.ok)throw new Error(`kastle_tx_builder_${c.status}:${String(u||"").slice(0,180)}`);const f=u?JSON.parse(u):{},x=typeof f=="string"?f.trim():String((f==null?void 0:f.txJson)||((d=f==null?void 0:f.result)==null?void 0:d.txJson)||"").trim();if(!x)throw new Error("Kastle tx builder did not return txJson");return x}finally{a&&clearTimeout(a)}}async function Qo(e,t){const r=Ct(e);if(!r.length)throw new Error("Kastle raw tx requires outputs");let s=null;if(sr)try{const c=await Xo(r,t);if(c)return c}catch(c){if(s=c,Ho)throw c}const i=us();if(i){const c=await i({networkId:or(),outputs:r,purpose:String(t||"").slice(0,140)});if(typeof c!="string"||!c.trim())throw new Error("Kastle raw tx builder bridge returned an empty txJson");return c.trim()}if(!ls||typeof window>"u"||typeof window.prompt!="function"){const c=s?` Backend builder error: ${String((s==null?void 0:s.message)||s).slice(0,180)}`:"";throw new Error(`Kastle raw tx builder unavailable. Provide VITE_KASTLE_TX_BUILDER_URL, window.__FORGEOS_KASTLE_BUILD_TX_JSON__, or enable manual txJson prompt.${c}`)}const a=["KASTLE raw multi-output txJson required","","Forge.OS can call kastle.signAndBroadcastTx(networkId, txJson), but no automatic txJson builder is currently available in this runtime.",...s?[`Builder error: ${String((s==null?void 0:s.message)||s).slice(0,180)}`,""]:[],"Paste a prebuilt txJson (serializeToSafeJSON) matching the outputs below.","",`Network: ${or()}`,`Purpose: ${String(t||"").slice(0,120)||"Forge.OS multi-output"}`,"Outputs:",...r.map((c,u)=>`  ${u+1}. ${c.to}  ${Number(c.amount_kas).toFixed(8)} KAS`)].join(`
`),d=window.prompt(a)||"";if(!d.trim())throw new Error("Kastle raw tx cancelled: no txJson provided");return d.trim()}function Ct(e){return Array.isArray(e)?e.map(t=>({to:he(String((t==null?void 0:t.to)||(t==null?void 0:t.address)||""),ie),amount_kas:Number(Number((t==null?void 0:t.amount_kas)??(t==null?void 0:t.amount)??0).toFixed(8))})).filter(t=>t.to&&t.amount_kas>0):[]}function Xt(e,t=0){var s,i,a,d;if(t>4||e==null)return"";if(typeof e=="string"){const c=e.trim();if(et(c))return c;const u=/"(?:transactionId|transaction_id|txid|hash|id)"\s*:\s*"([a-fA-F0-9]{64})"/.exec(c)||/([a-fA-F0-9]{64})/.exec(c);return(u==null?void 0:u[1])||""}if(typeof e!="object")return"";const r=[e.txid,e.hash,e.transactionId,e.transaction_id,e.id,(s=e==null?void 0:e.transaction)==null?void 0:s.txid,(i=e==null?void 0:e.transaction)==null?void 0:i.hash,(a=e==null?void 0:e.transaction)==null?void 0:a.transactionId,(d=e==null?void 0:e.transaction)==null?void 0:d.id];for(const c of r){const u=Xt(c,t+1);if(u)return u}if(Array.isArray(e)){for(const c of e){const u=Xt(c,t+1);if(u)return u}return""}for(const c of Object.values(e)){const u=Xt(c,t+1);if(u)return u}return""}function Wt(e){return Xt(e)}function le(e,t,r){let s=null;const i=new Promise((a,d)=>{s=setTimeout(()=>d(new Error(`${r}_timeout_${t}ms`)),t)});return Promise.race([e,i]).finally(()=>{s&&clearTimeout(s)})}function je(e,t){const r=String((e==null?void 0:e.message)||e||"wallet_error");return/user rejected|rejected|denied|cancel/i.test(r)?Bt(new Error(`${t}: User rejected wallet request`),{context:t}):/timeout/i.test(r)?Bt(new Error(`${t}: Wallet request timed out`),{context:t}):/not detected|not connected/i.test(r)?Bt(new Error(`${t}: Wallet unavailable`),{context:t}):Bt(new Error(`${t}: ${r}`),{context:t})}function Gt(){if(typeof window>"u")throw new Error("Browser wallet APIs unavailable outside browser environment");const e=window.kasware;if(!e)throw new Error("Kasware extension not detected. Install from kasware.org");return e}function Tt(){if(typeof window>"u")throw new Error("Browser wallet APIs unavailable outside browser environment");const e=window.kastle;if(!e)throw new Error("Kastle extension not detected. Install from kastle.cc");return e}async function Jo(){var r;const e=Tt();let t=null;if(typeof e.getAccount=="function")t=await le(Promise.resolve(e.getAccount()),Ie,"kastle_get_account_for_raw_tx");else if(typeof e.request=="function")t=await le(Promise.resolve(e.request("kas:get_account")),Ie,"kastle_request_get_account_for_raw_tx");else throw new Error("Kastle provider missing getAccount()/request()");return he(String((t==null?void 0:t.address)||((r=t==null?void 0:t.addresses)==null?void 0:r[0])||""),Yt)}function Zo(e){return!!(e&&typeof e.id=="string"&&typeof e.name=="string")}function qr(){if(typeof window>"u")throw new Error("Ghost Wallet is only available in browser environments");return window}function bn(e="ghost_bridge_reset"){if(typeof window<"u"&&Ge)try{window.removeEventListener("kaspa:event",Ge.onEvent),window.removeEventListener("kaspa:disconnect",Ge.onDisconnect),window.dispatchEvent(new CustomEvent("kaspa:disconnect"))}catch{}if(Ge)for(const t of Ge.pending.values())clearTimeout(t.timer),t.reject(new Error(e));Ge=null}async function fs(e=Go){const t=qr();if(Date.now()-zt.ts<1e3&&zt.providers.length)return[...zt.providers];const s=new Map,i=d=>{const c=d.detail;Zo(c)&&s.set(c.id,{id:c.id,name:c.name})};t.addEventListener("kaspa:provider",i);try{t.dispatchEvent(new CustomEvent("kaspa:requestProviders"))}catch{}await new Promise(d=>setTimeout(d,Math.max(50,e))),t.removeEventListener("kaspa:provider",i);const a=[...s.values()];return zt={ts:Date.now(),providers:a},a}function ei(){return Ge}async function ti(){const e=qr(),t=ei();if(t!=null&&t.connected)return t;const r=await fs(),s=r.find(a=>/ghost/i.test(String(a.name||"")))||r[0];if(!s)throw new Error("Ghost Wallet provider bridge not detected");Ge&&bn("ghost_bridge_reconnect");const i={provider:s,nextRequestId:1,connected:!0,pending:new Map,onEvent(a){const d=a.detail;if(!d||typeof d.id!="number")return;const c=i.pending.get(d.id);if(c){if(i.pending.delete(d.id),clearTimeout(c.timer),d.error){c.reject(new Error(String(d.error)));return}if(d.data===!1){c.reject(new Error("Ghost Wallet request was rejected"));return}c.resolve(d.data)}},onDisconnect(){bn("ghost_bridge_disconnected")}};e.addEventListener("kaspa:event",i.onEvent),e.addEventListener("kaspa:disconnect",i.onDisconnect);try{e.dispatchEvent(new CustomEvent("kaspa:connect",{detail:s.id}))}catch(a){throw e.removeEventListener("kaspa:event",i.onEvent),e.removeEventListener("kaspa:disconnect",i.onDisconnect),a}return Ge=i,i}async function Ar(e,t,r){const s=qr(),i=await ti(),a=i.nextRequestId++;return new Promise((d,c)=>{const u=setTimeout(()=>{i.pending.delete(a),c(new Error(`ghost_${String(e)}_timeout_${r}ms`))},r);i.pending.set(a,{timer:u,resolve:d,reject:c});try{s.dispatchEvent(new CustomEvent("kaspa:invoke",{detail:{id:a,method:e,params:t}}))}catch(f){clearTimeout(u),i.pending.delete(a),c(f)}})}async function kn(e,t,r){if(e&&et(e))return e;if(typeof window>"u"||typeof window.prompt!="function")throw new Error(`${t} did not return a transaction id`);const s=String(r||"").slice(0,600),i=window.prompt(`${t} did not return a clear txid. Paste the broadcast txid.

Raw wallet response preview:
${s}`);if(!i)throw new Error("Transaction not confirmed. No txid provided.");if(!et(i.trim()))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return i.trim()}const ne={detect(){let e,t;try{e=typeof window<"u"?window.kasware:void 0,t=typeof window<"u"?window.kastle:void 0}catch{e=void 0,t=void 0}return{kasware:!!e,kastle:!!t,ghost:!1,kaspium:!0,kaswareMethods:e?{requestAccounts:typeof e.requestAccounts=="function",getNetwork:typeof e.getNetwork=="function",getBalance:typeof e.getBalance=="function",signMessage:typeof e.signMessage=="function",sendKaspa:typeof e.sendKaspa=="function"}:null,kastleMethods:t?{connect:typeof t.connect=="function",getAccount:typeof t.getAccount=="function",request:typeof t.request=="function",sendKaspa:typeof t.sendKaspa=="function",signMessage:typeof t.signMessage=="function",signAndBroadcastTx:typeof t.signAndBroadcastTx=="function"}:null}},async probeGhostProviders(e){try{return await fs(e)}catch{return[]}},async connectKasware(){const e=Gt();if(typeof e.requestAccounts!="function")throw new Error("Kasware provider missing requestAccounts()");try{const t=await le(Promise.resolve(e.requestAccounts()),Ie,"kasware_request_accounts");if(!(t!=null&&t.length))throw new Error("No accounts returned from Kasware");const r=Je(fe),s=he(t[0],Yt);let i=r;if(typeof e.getNetwork=="function")try{const a=await le(Promise.resolve(e.getNetwork()),Ie,"kasware_get_network");i=Je(a)}catch{i=r}if(!ct(s,i))throw new Error(`Kasware returned an address prefix that does not match ${i.label}. Check wallet network/account and retry.`);if(yr&&i.id!==r.id)throw new Error(`Kasware is on ${i.label}. Expected ${xe}. Switch network in wallet and retry.`);if(!ct(s,r))throw new Error(`Kasware returned a ${i.label} address, but ForgeOS is using ${xe}. Switch the app profile or wallet network and retry.`);return{address:s,network:i.id,provider:"kasware"}}catch(t){throw je(t,"Kasware connect failed")}},async connectKastle(){var t;const e=Tt();try{typeof e.connect=="function"&&await le(Promise.resolve(e.connect()),Er,"kastle_connect");let r=null;if(typeof e.getAccount=="function")r=await le(Promise.resolve(e.getAccount()),Ie,"kastle_get_account");else if(typeof e.request=="function")r=await le(Promise.resolve(e.request("kas:get_account")),Ie,"kastle_request_get_account");else throw new Error("Kastle provider missing getAccount()/request()");const s=he(String((r==null?void 0:r.address)||((t=r==null?void 0:r.addresses)==null?void 0:t[0])||""),Yt),i=Je(fe);let a=i;if(typeof e.request=="function")try{const d=await le(Promise.resolve(e.request("kas:get_network")),Ie,"kastle_get_network");a=Je((d==null?void 0:d.networkId)||d)}catch{a=i}if(!ct(s,a))throw new Error(`Kastle returned an address prefix that does not match ${a.label}. Check wallet network/account and retry.`);if(yr&&a.id!==i.id)throw new Error(`Kastle is on ${a.label}. Expected ${xe}. Switch network in wallet and retry.`);if(!ct(s,i))throw new Error(`Kastle returned a ${a.label} address, but ForgeOS is using ${xe}. Switch the app profile or wallet network and retry.`);return{address:s,network:a.id,provider:"kastle"}}catch(r){throw je(r,"Kastle connect failed")}},async connectGhost(){try{const e=await le(Ar("account",[],Er),Er+1e3,"ghost_connect_account"),t=Array.isArray(e==null?void 0:e.addresses)?e.addresses:[];if(!t.length)throw new Error("Ghost Wallet did not return any accounts");const r=Je(fe),s=Je((e==null?void 0:e.networkId)||r.id),i=he(t[0],Yt);if(!ct(i,s))throw new Error(`Ghost Wallet returned an address prefix that does not match ${s.label}. Check wallet network/account and retry.`);if(yr&&s.id!==r.id)throw new Error(`Ghost Wallet is on ${s.label}. Expected ${xe}. Switch network in wallet and retry.`);if(!ct(i,r))throw new Error(`Ghost Wallet returned a ${s.label} address, but ForgeOS is using ${xe}. Switch the app profile or wallet network and retry.`);return{address:i,network:s.id,provider:"ghost"}}catch(e){throw je(e,"Ghost Wallet connect failed")}},connectKaspium(e){return{address:he(e,ie),network:fe,provider:"kaspium"}},async getKaswareBalance(){const e=Gt();if(typeof e.getBalance!="function")throw new Error("Kasware provider missing getBalance()");try{const t=await le(Promise.resolve(e.getBalance()),Ie,"kasware_get_balance");return qo(t)}catch(t){throw je(t,"Kasware balance failed")}},async sendKasware(e,t){const r=Gt();if(!(Number(t)>0))throw new Error("Amount must be greater than zero");const s=he(e,ie),i=En(t);let a;try{if(typeof r.sendKaspa=="function")a=await le(Promise.resolve(r.sendKaspa(s,i)),Qe,"kasware_send_kaspa");else if(typeof r.sendKAS=="function")a=await le(Promise.resolve(r.sendKAS(s,i)),Qe,"kasware_send_kas");else throw new Error("Kasware provider missing sendKaspa()/sendKAS()")}catch(c){throw je(c,"Kasware send failed")}const d=Yo(a);if(!d||!et(d))throw new Error("Kasware did not return a transaction id");return d},async sendKastle(e,t){const r=Tt();if(!(Number(t)>0))throw new Error("Amount must be greater than zero");const s=he(e,ie),i=En(t);try{if(typeof r.sendKaspa!="function")throw new Error("Kastle provider missing sendKaspa()");const a=await le(Promise.resolve(r.sendKaspa(s,i)),Qe,"kastle_send_kaspa"),d=Wt(a);if(!d||!et(d))throw new Error("Kastle did not return a transaction id");return d}catch(a){throw je(a,"Kastle send failed")}},canKastleSignAndBroadcastRawTx(){if(!Vo)return!1;try{const e=typeof window<"u"?window.kastle:null;return!!(e&&typeof e.signAndBroadcastTx=="function")}catch{return!1}},canKastleMultiOutputRawTxPath(){return this.canKastleSignAndBroadcastRawTx()?sr||us()?!0:typeof window>"u"?!1:!!(ls&&typeof window.prompt=="function"):!1},async sendKastleRawTx(e,t){const r=Ct(e);if(r.length<=1){const a=r[0];if(!a)throw new Error("Kastle raw tx requires at least one output");return this.sendKastle(a.to,a.amount_kas)}if(!this.canKastleSignAndBroadcastRawTx())throw new Error("Kastle raw multi-output path unavailable (feature disabled or signAndBroadcastTx not detected)");const s=Tt(),i=or();try{const a=await Qo(r,t),d=await le(Promise.resolve(s.signAndBroadcastTx(i,a)),Qe,"kastle_sign_and_broadcast_tx"),c=Wt(d);if(!c||!et(c))throw new Error("Kastle signAndBroadcastTx did not return a transaction id");return c}catch(a){throw je(a,"Kastle raw multi-output send failed")}},async sendGhost(e,t){if(!(Number(t)>0))throw new Error("Amount must be greater than zero");const r=he(e,ie);try{const s=await le(Ar("transact",[[[r,An(t)]]],Qe),Qe+1e3,"ghost_transact"),i=Wt(s);return await kn(i,"Ghost Wallet",typeof s=="string"?s:JSON.stringify(s))}catch(s){throw je(s,"Ghost Wallet send failed")}},async sendGhostOutputs(e,t){const r=Ct(e);if(!r.length)throw new Error("Ghost Wallet outputs are required");if(r.length===1)return this.sendGhost(r[0].to,r[0].amount_kas);try{const s=await le(Ar("transact",[r.map(a=>[a.to,An(a.amount_kas)])],Qe),Qe+1e3,"ghost_transact_multi"),i=Wt(s);return await kn(i,"Ghost Wallet (multi-output)",typeof s=="string"?s:JSON.stringify(s))}catch(s){throw je(s,"Ghost Wallet multi-output send failed")}},async sendKaspium(e,t,r){const s=he(e,ie);if(!(Number(t)>0))throw new Error("Amount must be greater than zero");if(typeof window>"u")throw new Error("Kaspium deep-link is only available in browser environments");const i=encodeURIComponent(String(t)),a=r?encodeURIComponent(r):"",d=`${s}?amount=${i}${r?`&message=${a}`:""}`;let c=d;$t.toLowerCase().startsWith("kaspa")||(c=`${$t.endsWith("://")?$t:`${$t}://`}send?address=${encodeURIComponent(s)}&amount=${i}${r?`&note=${a}`:""}`),window.location.href=c;const u=typeof window.prompt=="function"?window.prompt.bind(window):null;if(!u)throw new Error("Kaspium confirmation prompt unavailable in this browser context");const f=u(`Complete transfer in Kaspium and paste txid.
Deep link:
${c}

Fallback URI:
${d}`);if(!f)throw new Error("Transaction not confirmed. No txid provided.");if(!et(f))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return f.trim()},async signMessageKasware(e){const t=Gt();if(typeof t.signMessage!="function"&&typeof t.signData!="function")throw new Error("Kasware provider missing signMessage/signData");try{return typeof t.signMessage=="function"?le(Promise.resolve(t.signMessage(e)),Ie,"kasware_sign_message"):le(Promise.resolve(t.signData(e)),Ie,"kasware_sign_data")}catch(r){throw je(r,"Kasware sign failed")}},async signMessageKastle(e){const t=Tt();if(typeof t.signMessage!="function"&&typeof t.request!="function")throw new Error("Kastle provider missing signMessage/request");try{return typeof t.signMessage=="function"?le(Promise.resolve(t.signMessage(e)),Ie,"kastle_sign_message"):le(Promise.resolve(t.request("kas:sign_message",e)),Ie,"kastle_request_sign_message")}catch(r){throw je(r,"Kastle sign failed")}},supportsNativeMultiOutput(e){const t=String(e||"").toLowerCase();return t==="ghost"?!0:t==="kastle"?this.canKastleMultiOutputRawTxPath():!1},async connectHardwareBridge(e,t){return{address:he(t,ie),network:fe,provider:e}},async sendHardwareBridge(e,t,r,s,i){const a=he(t,ie),d=Ct(i||[]);if(!(Number(r)>0)&&!d.length)throw new Error("Amount must be greater than zero");if(typeof window>"u"||typeof window.prompt!="function")throw new Error(`${String(e||"Hardware")} bridge flow requires a browser prompt context`);const c=d.length?d.map((f,x)=>`${x+1}. ${f.to}  ${f.amount_kas} KAS`).join(`
`):`1. ${a}  ${Number(r).toFixed(8)} KAS`,u=window.prompt(`${String(e||"Hardware").toUpperCase()} bridge flow

Create and broadcast this transaction in your wallet/device, then paste txid.

Outputs:
${c}

Note: ${String(s||"").slice(0,120)}`);if(!u)throw new Error("Transaction not confirmed. No txid provided.");if(!et(String(u).trim()))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return String(u).trim()}},ri=new URL(""+new URL("kastle-Td3Ch6zZ.svg",import.meta.url).href,import.meta.url).href,ni=new URL("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%20viewBox='0%200%20512%20512'%3e%3cpath%20d='M1835.38%201331.2c-10.65-14.43-25.84-33.39-47.42-58.25-83.91-96.68-206.13-306.46-209.78-392.2-3.65-85.74-69.32-213.43-301-240.79-231.68-27.36-249.91%20240.79-249.91%20240.79s8.21%20249-199.75%20362.1c-207.96%20113.1-67.49%20125.87-9.12%20138.64%2058.37%2012.77-76.61%2089.38-12.77%20127.69s113.1-25.54%20125.87%2063.85c12.77%2089.39%20162.35%2036.48%20182.42%2067.49%2020.07%2031.01%20109.45%20167.83%20231.67%20131.34%20122.22-36.49%2091.21-89.38%20166-91.21%2074.79-1.83%20135-23.71%20120.4-85.73-14.6-62.02%2072-73.88%20114-70.23%2042%203.65%2069.32-34.66%2018.24-78.44-39.16-33.57%206.39-70.35%2053.62-75%2019.36-1.9%2029.07-24.41%2017.53-40.05Zm-595.63-460.52c-10.67%2039.05-39.2%2065.33-63.79%2058.63-24.59-6.7-35.88-43.79-25.21-82.92%2010.67-39.13%2039.18-65.3%2063.74-58.58%2024.56%206.72%2035.91%2043.77%2025.26%2082.87ZM1382%20929.31c-24.56%206.7-53.17-19.58-63.76-58.63-10.59-39.05.64-76.22%2025.18-82.87%2024.54-6.65%2053.15%2019.53%2063.82%2058.58%2010.67%2039.05-.65%2076.22-25.24%2082.92Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='translate(-318.426%20-286.541)%20scale(.449124)'/%3e%3c/svg%3e",import.meta.url).href,ps=[{id:"kasware",name:"Kasware",class:"extension",status:"live",connectMode:"injected",description:"Injected browser wallet for direct Kaspa signing and broadcast.",uiIcon:"ðŸ§©",docsUrl:"https://docs.kasware.xyz/wallet/dev-base/kaspa",websiteUrl:"https://www.kasware.xyz",sourceUrls:["https://docs.kasware.xyz/wallet/dev-base/kaspa","https://github.com/kasware-wallet/extension","https://kaspa.org/directory/kasware/"],tags:["kaspa","browser-extension","dapp"],capabilities:{detect:!0,connect:!0,send:!0,network:!0,signMessage:!0,deeplink:!1,manualTxid:!1,psktSign:!0,nativeMultiOutputSend:"unsupported"},notes:["Kasware docs expose sendKaspa(toAddress, sompi[, options]) single-recipient send.","Kasware exposes signPskt and some KRC20 methods with extra output arrays; a PSKT-based multi-output path may be possible in a future adapter."]},{id:"kaspium",name:"Kaspium",class:"mobile",status:"live",connectMode:"deeplink",description:"Mobile wallet via deep-link handoff with manual txid confirmation in Forge.OS.",uiIcon:"ðŸ“±",docsUrl:"https://github.com/azbuky/kaspium_wallet",websiteUrl:"https://kaspium.io",sourceUrls:["https://github.com/azbuky/kaspium_wallet","https://kaspa.org/kaspium-v1-0-1-release/"],tags:["kaspa","mobile","deeplink"],capabilities:{detect:!1,connect:!0,send:!0,network:!1,signMessage:!1,deeplink:!0,manualTxid:!0,psktSign:!1,nativeMultiOutputSend:"unsupported"},notes:["Current Forge.OS integration is a single-recipient deep-link + pasted txid flow.","No public injected dApp provider API documented in the Kaspium repo."]},{id:"kastle",name:"Kastle",class:"extension",status:"live",connectMode:"injected",description:"Kaspa browser extension wallet with injected dApp API and direct signing/broadcast.",uiIcon:"ðŸ°",logoSrc:ri,docsUrl:"https://github.com/forbole/kastle",websiteUrl:"https://kastle.cc/",sourceUrls:["https://github.com/forbole/kastle"],tags:["kaspa","browser-extension","dapp"],capabilities:{detect:!0,connect:!0,send:!0,network:!0,signMessage:!0,deeplink:!1,manualTxid:!1,psktSign:!1,nativeMultiOutputSend:"pskt_path"},notes:["Injected `window.kastle` API supports connect/getAccount/request/sendKaspa/signMessage.","Native sendKaspa is single-recipient; multi-output may be possible via signAndBroadcastTx(txJson) with a Forge.OS transaction builder path."]},{id:"ghost",name:"Ghost Wallet",class:"extension",status:"live",connectMode:"injected",description:"Kaspa browser extension using a custom provider event bridge for account + transact calls.",uiIcon:"ðŸ‘»",logoSrc:ni,docsUrl:"https://github.com/ghost-wallet/web-extension",websiteUrl:"https://github.com/ghost-wallet/web-extension",sourceUrls:["https://github.com/ghost-wallet/web-extension"],tags:["kaspa","browser-extension","provider-bridge"],capabilities:{detect:!1,connect:!0,send:!0,network:!0,signMessage:!1,deeplink:!1,manualTxid:!1,psktSign:!1,nativeMultiOutputSend:"supported"},notes:["Ghost exposes a `kaspa:*` provider event protocol (account/transact) instead of a global injected object.","Provider transact accepts an outputs array, so multi-output treasury-combined sends are potentially viable in a future adapter path."]},{id:"demo",name:"Demo Mode",class:"web",status:"live",connectMode:"demo",description:"Simulated signer for UI testing, E2E flows, and onboarding.",uiIcon:"ðŸ§ª",tags:["simulation","test"],capabilities:{detect:!1,connect:!0,send:!0,network:!0,signMessage:!1,deeplink:!1,manualTxid:!1,psktSign:!1,nativeMultiOutputSend:"not_applicable"},notes:["No blockchain broadcast. Used for UI/QA only."]},{id:"kasperia",name:"Kasperia",class:"extension",status:"research",connectMode:"injected",description:"Kaspa/Kasplex browser extension wallet with developer docs and SDK messaging.",uiIcon:"ðŸŒ‰",docsUrl:"https://kasperia-doc.github.io/",websiteUrl:"https://kasperia-doc.github.io/",sourceUrls:["https://kasperia-doc.github.io/"],tags:["browser-extension","kasplex","l2"],capabilities:{detect:!1,connect:!1,send:!1,network:!1,signMessage:!1,deeplink:!1,manualTxid:!1,psktSign:!1,nativeMultiOutputSend:"unknown"},notes:["Promising for future dApp integration, but Forge.OS adapter work depends on stable injected provider docs/API shape."]},{id:"tangem",name:"Tangem",class:"hardware",status:"live",connectMode:"bridge",description:"Hardware bridge flow (manual sign/broadcast + txid handoff) for accumulation-focused cold custody operations.",uiIcon:"ðŸ’³",websiteUrl:"https://tangem.com/",sourceUrls:["https://kaspa.org/kaspa-integrated-on-tangem/","https://kaspa.org/directory/tangem-ag/"],tags:["hardware","cold-storage","accumulation"],capabilities:{detect:!1,connect:!0,send:!0,network:!1,signMessage:!1,deeplink:!1,manualTxid:!0,psktSign:!1,nativeMultiOutputSend:"unknown"},notes:["Forge.OS uses a manual hardware bridge flow today (address pairing + external signing/broadcast + pasted txid)."]},{id:"onekey",name:"OneKey",class:"hardware",status:"live",connectMode:"bridge",description:"Hardware bridge flow (manual sign/broadcast + txid handoff) for secure accumulation and large-balance operations.",uiIcon:"ðŸ”",websiteUrl:"https://shop.onekey.so/",sourceUrls:["https://kaspa.org/kaspa-integrated-on-onekey/"],tags:["hardware","cold-storage"],capabilities:{detect:!1,connect:!0,send:!0,network:!1,signMessage:!1,deeplink:!1,manualTxid:!0,psktSign:!1,nativeMultiOutputSend:"unknown"},notes:["Forge.OS uses a manual hardware bridge flow today (address pairing + external signing/broadcast + pasted txid)."]},{id:"zelcore",name:"Zelcore",class:"desktop",status:"research",connectMode:"manual",description:"Multi-asset wallet with Kaspa support; useful for operator holdings and portfolio visibility.",uiIcon:"ðŸ–¥ï¸",sourceUrls:["https://kaspa.org/kaspa-on-zelcore-wallet-and-defi/"],tags:["desktop","multi-asset"],capabilities:{detect:!1,connect:!1,send:!1,network:!1,signMessage:!1,deeplink:!1,manualTxid:!0,psktSign:!1,nativeMultiOutputSend:"unknown"},notes:["No Forge.OS dApp signing path yet; candidate for watch-only/import workflows first."]}],si=ps.filter(e=>e.status==="live"&&e.capabilities.connect),oi=ps.filter(e=>e.status!=="live"&&e.id!=="demo");function ii(e){return e==="live"?"LIVE":e==="planned"?"PLANNED":"RESEARCH"}function Tn(e){return e==="extension"?"EXTENSION":e==="mobile"?"MOBILE":e==="hardware"?"HARDWARE":e==="desktop"?"DESKTOP":"WEB"}function ai(e){return e==="supported"?"MULTI-OUTPUT: YES":e==="unsupported"?"MULTI-OUTPUT: NO (NATIVE SEND)":e==="pskt_path"?"MULTI-OUTPUT: PSKT PATH":e==="not_applicable"?"MULTI-OUTPUT: N/A":"MULTI-OUTPUT: UNKNOWN"}const Z=({children:e,p:t=16,style:r={},...s})=>n.jsx("div",{...s,style:{background:`linear-gradient(165deg, ${o.s2} 0%, #0a1725 52%, ${o.s1} 100%)`,border:`1px solid ${o.border}cc`,borderRadius:14,padding:t,boxShadow:`${o.shadow}, inset 0 1px 0 rgba(255,255,255,0.04)`,backdropFilter:"blur(6px)",transition:"border-color 0.18s ease, box-shadow 0.18s ease, transform 0.18s ease",...r},children:e}),oe=({children:e,color:t})=>n.jsx("div",{style:{fontSize:10,color:t||o.dim,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:6,...y},children:e}),q=({text:e,color:t=o.accent,dot:r,...s})=>n.jsxs("span",{...s,style:{background:t+"18",color:t,border:`1px solid ${t}35`,borderRadius:6,padding:"3px 9px",fontSize:11,letterSpacing:"0.04em",...y,display:"inline-flex",alignItems:"center",gap:5,whiteSpace:"nowrap"},children:[r&&n.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:t,display:"inline-block"}}),e]}),re=({children:e,onClick:t,variant:r="primary",disabled:s,style:i={},size:a="md",...d})=>{const c={primary:{bg:`linear-gradient(90deg, ${o.accent} 0%, #7BE9CF 100%)`,color:"#04110E",border:`1px solid ${o.accent}55`,shadow:"0 10px 24px rgba(57,221,182,0.26)"},ghost:{bg:"transparent",color:o.text,border:`1px solid ${o.border}`,shadow:"none"},danger:{bg:o.dLow,color:o.danger,border:`1px solid ${o.danger}55`,shadow:"none"},warn:{bg:o.wLow,color:o.warn,border:`1px solid ${o.warn}50`,shadow:"none"}}[r];return n.jsx("button",{...d,onClick:t,disabled:s,onMouseEnter:u=>{s||(u.currentTarget.style.transform="translateY(-1px)",u.currentTarget.style.filter="brightness(1.06)")},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.filter="brightness(1)"},onMouseDown:u=>{s||(u.currentTarget.style.transform="translateY(0) scale(0.995)")},onMouseUp:u=>{s||(u.currentTarget.style.transform="translateY(-1px) scale(1)")},style:{background:c.bg,color:c.color,border:c.border,borderRadius:10,padding:a==="sm"?"6px 12px":"10px 18px",fontSize:a==="sm"?11:12,cursor:s?"not-allowed":"pointer",opacity:s?.45:1,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",boxShadow:c.shadow,transition:"all 0.16s ease",...y,...i},children:e})},He=({label:e,value:t,onChange:r,placeholder:s,type:i="text",hint:a,suffix:d})=>n.jsxs("div",{style:{marginBottom:16},children:[e&&n.jsx(oe,{children:e}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{value:t,onChange:c=>r(c.target.value),type:i,placeholder:s,style:{width:"100%",background:o.s3,border:`1px solid ${o.border}`,borderRadius:10,color:o.text,padding:`10px ${d?"40px":"12px"} 10px 12px`,fontSize:12,...y,outline:"none",boxSizing:"border-box",transition:"border-color 0.16s ease, box-shadow 0.16s ease"},onFocus:c=>{c.target.style.borderColor=o.accent,c.target.style.boxShadow=`0 0 0 2px ${o.accent}22`},onBlur:c=>{c.target.style.borderColor=o.border,c.target.style.boxShadow="none"}}),d&&n.jsx("span",{style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",fontSize:11,color:o.dim,...y},children:d})]}),a&&n.jsx("div",{style:{fontSize:11,color:o.dim,marginTop:4},children:a})]}),ms=({m:e=12})=>n.jsx("div",{style:{height:1,background:o.border,margin:`${e}px 0`}}),Fe=({href:e,label:t="â†—"})=>n.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:o.accent,...y,textDecoration:"none",border:`1px solid ${o.accent}25`,padding:"3px 9px",borderRadius:3},children:t});function gs(){return n.jsxs("div",{className:"forge-atmosphere","aria-hidden":"true",children:[n.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--north"}),n.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--east"}),n.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--south"}),n.jsx("div",{className:"forge-atmosphere__grid"}),n.jsxs("div",{className:"forge-atmosphere__rings",children:[n.jsx("span",{className:"forge-ring forge-ring--one"}),n.jsx("span",{className:"forge-ring forge-ring--two"}),n.jsx("span",{className:"forge-ring forge-ring--three"})]}),n.jsxs("div",{className:"forge-atmosphere__blips",children:[n.jsx("span",{className:"forge-blip forge-blip--a"}),n.jsx("span",{className:"forge-blip forge-blip--b"}),n.jsx("span",{className:"forge-blip forge-blip--c"})]})]})}function ci({onConnect:e}){const[t,r]=p.useState(null),[s,i]=p.useState(null),[a,d]=p.useState(""),[c,u]=p.useState(""),[f,x]=p.useState(""),[A,N]=p.useState(""),[w,I]=p.useState(null),v=ne.detect(),L=p.useMemo(()=>`forgeos.kaspium.address.${fe}`,[]),_=p.useMemo(()=>`forgeos.wallet.lastProvider.${fe}`,[]),O=c.trim(),g=Ze(O,ie),l=!!t;p.useEffect(()=>{if(!(typeof window>"u"))try{const T=(window.localStorage.getItem(L)||"").trim();T&&Ze(T,ie)&&x(T);const D=(window.localStorage.getItem(_)||"").trim();D&&N(D)}catch{}},[L,_]),p.useEffect(()=>{let m=!1;if(typeof ne.probeGhostProviders=="function")return ne.probeGhostProviders(250).then(T=>{m||I(Array.isArray(T)?T.length:0)}).catch(()=>{m||I(0)}),()=>{m=!0}},[]);const b=m=>{const T=m.trim();if(!(!T||!Ze(T,ie))&&(x(T),!(typeof window>"u")))try{window.localStorage.setItem(L,T)}catch{}},k=m=>{if(N(m),!(typeof window>"u"))try{window.localStorage.setItem(_,m)}catch{}},j=async()=>{var te;const m=(c.trim()||f.trim()).trim();if(m&&Ze(m,ie))return he(m,ie);if(typeof navigator<"u"&&((te=navigator.clipboard)!=null&&te.readText))try{const K=await navigator.clipboard.readText(),se=String(K||"").trim().split(/\s+/)[0]||"";if(se&&Ze(se,ie)){const h=he(se,ie);return u(h),b(h),h}}catch{}const T=window.prompt(`Paste your ${xe} Kaspium address (${ie.join(", ")}).`)||"",D=he(T,ie);return u(D),b(D),D},$=async m=>{const T=window.prompt(`Paste your ${xe} ${m} receive address (${ie.join(", ")}).`)||"";return he(T,ie)},V=async m=>{r(m),i(null),d("");try{let T;if(m==="kasware")T=await ne.connectKasware(),d("Kasware session ready. Extension signing is armed.");else if(m==="kastle")T=await ne.connectKastle(),d("Kastle session ready. Extension signing is armed.");else if(m==="ghost")T=await ne.connectGhost(),d("Ghost Wallet session ready. Provider bridge is connected.");else if(m==="tangem"||m==="onekey"){const D=await $(m==="tangem"?"Tangem":"OneKey");T=await ne.connectHardwareBridge(m,D),d(`${m==="tangem"?"Tangem":"OneKey"} bridge session ready for ${Oe(T.address)}.`)}else if(m==="kaspium"){const D=await j();T=ne.connectKaspium(D),b(T.address),d(`Kaspium session ready for ${Oe(T.address)}.`)}else T={address:Bo,network:fe,provider:"demo"},d("Demo session ready.");k(m),e(T)}catch(T){i(Dr(T)||(T==null?void 0:T.message)||"Wallet connection failed.")}r(null)},U=si.map(m=>{if(m.id==="kasware")return{...m,statusText:v.kasware?"Detected in this tab":"Not detected in this tab",statusColor:v.kasware?o.ok:o.warn,cta:"Connect Kasware"};if(m.id==="kastle")return{...m,statusText:v.kastle?"Detected in this tab":"Not detected in this tab",statusColor:v.kastle?o.ok:o.warn,cta:"Connect Kastle"};if(m.id==="ghost"){const T=Number(w||0)>0;return{...m,statusText:w==null?"Scanning provider bridge...":T?`Detected ${w} provider${w===1?"":"s"}`:"Provider probes on connect",statusColor:w==null?o.dim:T?o.ok:o.warn,cta:"Connect Ghost"}}return m.id==="kaspium"?{...m,statusText:g?`Address ready Â· ${Oe(O)}`:"Address resolves on connect",statusColor:g?o.ok:o.warn,cta:g?"Connect Kaspium":"Connect + Pair Address"}:m.id==="tangem"||m.id==="onekey"?{...m,statusText:"Manual bridge (address + txid handoff)",statusColor:o.warn,cta:`Connect ${m.name}`}:{...m,statusText:"No blockchain broadcast",statusColor:o.dim,cta:"Enter Demo Mode"}});return n.jsxs("div",{className:"forge-shell",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"clamp(18px, 2vw, 28px)"},children:[n.jsx(gs,{}),n.jsxs("div",{className:"forge-content forge-gate-layout",children:[n.jsxs("section",{className:"forge-gate-hero",children:[n.jsxs("div",{children:[n.jsx("div",{className:"forge-gate-kicker",children:"FORGE.OS // KASPA-NATIVE QUANT STACK"}),n.jsxs("h1",{className:"forge-gate-title",children:[n.jsx("span",{style:{color:o.accent},children:"FORGE"}),".OS TRADING CONTROL SURFACE"]}),n.jsx("p",{className:"forge-gate-copy",children:"Full-screen command center for wallet-native execution, AI-guided quant cycles, and DAG-aware capital routing. Connect a supported wallet to operate the system. Signing remains inside your wallet at all times."}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:16},children:[n.jsx(q,{text:`${xe} SESSION`,color:o.ok,dot:!0}),n.jsx(q,{text:"WALLET-NATIVE AUTHORIZATION",color:o.accent,dot:!0}),n.jsx(q,{text:"SESSION CONTINUITY",color:o.purple,dot:!0})]})]}),n.jsxs("div",{className:"forge-gate-points",children:[n.jsxs("div",{className:"forge-gate-point",children:[n.jsx("div",{className:"forge-gate-point-value",children:"UTXO-Native"}),n.jsx("div",{className:"forge-gate-point-label",children:"Kaspa-first architecture"})]}),n.jsxs("div",{className:"forge-gate-point",children:[n.jsx("div",{className:"forge-gate-point-value",children:"Non-Custodial"}),n.jsx("div",{className:"forge-gate-point-label",children:"Private keys stay in wallet"})]}),n.jsxs("div",{className:"forge-gate-point",children:[n.jsx("div",{className:"forge-gate-point-value",children:xe}),n.jsx("div",{className:"forge-gate-point-label",children:"Active network profile"})]})]})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[n.jsxs("div",{style:{marginBottom:18,textAlign:"center"},children:[n.jsxs("div",{style:{fontSize:"clamp(24px, 4vw, 34px)",fontWeight:700,...y,letterSpacing:"0.12em",marginBottom:6},children:[n.jsx("span",{style:{color:o.accent},children:"FORGE"}),n.jsx("span",{style:{color:o.text},children:".OS"})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,letterSpacing:"0.08em",...y},children:"AI-NATIVE FINANCIAL OPERATING SYSTEM Â· POWERED BY KASPA"})]}),n.jsxs("div",{className:"forge-content",style:{width:"100%",maxWidth:560},children:[n.jsxs(Z,{p:32,style:{width:"100%"},children:[n.jsx("div",{style:{fontSize:14,color:o.text,fontWeight:700,...y,marginBottom:4},children:"Connect Wallet"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:14},children:"All operations are wallet-native. Forge.OS never stores private keys or signs transactions on your behalf."}),n.jsxs("div",{style:{fontSize:11,color:o.dim,...y,marginBottom:14},children:["Runtime network: ",xe," Â· accepted prefixes: ",ie.join(", ")]}),n.jsx("div",{className:"forge-wallet-grid",children:U.map(m=>n.jsxs("div",{className:`forge-wallet-card ${A===m.id?"forge-wallet-card--preferred":""}`,children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[m.logoSrc?n.jsx("div",{style:{width:34,height:34,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.02)",border:`1px solid ${o.border}`,borderRadius:6,overflow:"hidden",flexShrink:0},children:n.jsx("img",{src:m.logoSrc,alt:`${m.name} logo`,style:{width:24,height:24,objectFit:"contain"}})}):n.jsx("div",{style:{fontSize:24,width:34,display:"flex",justifyContent:"center",flexShrink:0},children:m.uiIcon}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y},children:m.name}),A===m.id?n.jsx(q,{text:"LAST USED",color:o.accent}):null,n.jsx(q,{text:Tn(m.class),color:o.dim})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,marginTop:2},children:m.description})]}),n.jsx(q,{text:m.statusText,color:m.statusColor})]}),n.jsxs("div",{style:{display:"flex",gap:8,marginTop:12,flexWrap:"wrap"},children:[n.jsx(re,{onClick:()=>V(m.id),disabled:l&&t!==m.id,variant:m.id==="demo"?"ghost":"primary",size:"sm",style:{minWidth:190},children:t===m.id?"CONNECTING...":m.cta}),m.docsUrl?n.jsx(Fe,{href:m.docsUrl,label:"DOCS â†—"}):null]})]},m.id))}),a?n.jsx("div",{style:{marginTop:12,padding:"10px 14px",background:o.oLow,border:`1px solid ${o.ok}44`,borderRadius:4,fontSize:12,color:o.ok,...y},children:a}):null,s&&n.jsx("div",{style:{marginTop:14,padding:"10px 14px",background:o.dLow,borderRadius:4,fontSize:12,color:o.danger,...y},children:s}),n.jsx(ms,{m:18}),n.jsxs("div",{style:{fontSize:11,color:o.dim,...y,lineHeight:1.6},children:["Forge.OS never requests your private key Â· All transaction signing happens in your wallet Â· ",xe," only"]})]}),n.jsxs(Z,{p:18,style:{width:"100%",marginTop:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,marginBottom:10,flexWrap:"wrap"},children:[n.jsx("div",{style:{fontSize:12,color:o.text,fontWeight:700,...y},children:"Wallet Compatibility Roadmap"}),n.jsx(q,{text:"CAPABILITY REGISTRY",color:o.accent})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,marginBottom:10},children:"Upcoming wallets are grouped by integration class. Cards show likely connection model and current multi-output support status for treasury-combined tx planning."}),n.jsx("div",{style:{display:"grid",gap:8},children:oi.map(m=>{var T;return n.jsx("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"flex-start",flexWrap:"wrap"},children:[n.jsxs("div",{style:{display:"flex",gap:10,alignItems:"flex-start"},children:[m.logoSrc?n.jsx("div",{style:{width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,overflow:"hidden",border:`1px solid ${o.border}`,background:"rgba(255,255,255,0.02)"},children:n.jsx("img",{src:m.logoSrc,alt:`${m.name} logo`,style:{width:16,height:16,objectFit:"contain"}})}):n.jsx("div",{style:{fontSize:18,lineHeight:1},children:m.uiIcon}),n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[n.jsx("span",{style:{fontSize:12,color:o.text,fontWeight:700,...y},children:m.name}),n.jsx(q,{text:ii(m.status),color:m.status==="planned"?o.warn:o.dim}),n.jsx(q,{text:Tn(m.class),color:o.dim}),n.jsx(q,{text:ai(m.capabilities.nativeMultiOutputSend),color:o.text})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,marginTop:3},children:m.description}),(T=m.notes)!=null&&T[0]?n.jsx("div",{style:{fontSize:10,color:o.dim,marginTop:6,...y},children:m.notes[0]}):null]})]}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[n.jsx(q,{text:`MODE ${String(m.connectMode).toUpperCase()}`,color:o.purple}),m.docsUrl?n.jsx(Fe,{href:m.docsUrl,label:"DOCS â†—"}):null,!m.docsUrl&&m.websiteUrl?n.jsx(Fe,{href:m.websiteUrl,label:"SITE â†—"}):null]})]})},m.id)})})]})]})]})]})]})}function Yr({tx:e,wallet:t,onSign:r,onReject:s}){const[i,a]=p.useState(!1),[d,c]=p.useState(null),u=async()=>{a(!0),c(null);try{let f;(t==null?void 0:t.provider)==="kasware"?f=await ne.sendKasware(e.to,e.amount_kas):(t==null?void 0:t.provider)==="kastle"?f=await ne.sendKastle(e.to,e.amount_kas):(t==null?void 0:t.provider)==="ghost"?f=await ne.sendGhost(e.to,e.amount_kas):(t==null?void 0:t.provider)==="tangem"||(t==null?void 0:t.provider)==="onekey"?f=await ne.sendHardwareBridge(t.provider,e.to,e.amount_kas,e.purpose,e.outputs):(t==null?void 0:t.provider)==="kaspium"?f=await ne.sendKaspium(e.to,e.amount_kas,e.purpose):(await new Promise(x=>setTimeout(x,1200)),f=Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join("")),r({...e,txid:f,signed_at:Date.now()})}catch(f){c(Dr(f))}a(!1)};return n.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},children:n.jsxs(Z,{p:28,style:{maxWidth:480,width:"100%",border:`1px solid ${o.warn}40`},children:[n.jsx("div",{style:{fontSize:14,color:o.warn,fontWeight:700,...y,marginBottom:4},children:"âš  TRANSACTION SIGNING REQUIRED"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:18},children:(t==null?void 0:t.provider)==="kasware"?"Kasware will prompt you to sign.":(t==null?void 0:t.provider)==="kastle"?"Kastle will prompt you to sign.":(t==null?void 0:t.provider)==="ghost"?"Ghost Wallet will prompt you to approve the provider transaction.":(t==null?void 0:t.provider)==="tangem"||(t==null?void 0:t.provider)==="onekey"?`${String((t==null?void 0:t.provider)||"hardware").toUpperCase()} bridge flow will prompt for txid after external wallet/device broadcast.`:(t==null?void 0:t.provider)==="kaspium"?"Kaspium deep-link will open; paste txid after broadcast.":"Confirm this transaction to proceed."}),Array.isArray(e==null?void 0:e.outputs)&&e.outputs.length>1&&n.jsxs("div",{style:{fontSize:11,color:o.accent,marginBottom:12,...y},children:["Multi-output transaction Â· ",e.outputs.length," recipients (treasury-combined path)"]}),(e==null?void 0:e.metaKind)==="treasury_fee"&&n.jsx("div",{style:{fontSize:12,color:o.warn,marginBottom:12,...y},children:"Protocol treasury fee payout transfer (separate on-chain micro-transaction)"}),n.jsx(Z,{p:0,style:{marginBottom:16},children:[["Type",e.type],["From",Oe(e.from)],["To",Oe(e.to)],["Amount",`${e.amount_kas} KAS`],["Fee",`${nt} KAS`],["Purpose",e.purpose]].map(([f,x],A,N)=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"9px 14px",borderBottom:A<N.length-1?`1px solid ${o.border}`:"none"},children:[n.jsx("span",{style:{fontSize:12,color:o.dim,...y},children:f}),n.jsx("span",{style:{fontSize:12,color:o.text,...y},children:x})]},f))}),d&&n.jsxs("div",{style:{fontSize:12,color:o.danger,...y,marginBottom:12,padding:"8px 12px",background:o.dLow,borderRadius:4},children:["Error: ",d]}),n.jsxs("div",{style:{display:"flex",gap:10},children:[n.jsx(re,{onClick:s,variant:"ghost",style:{flex:1,padding:"10px 0"},children:"REJECT"}),n.jsx(re,{onClick:u,disabled:i,style:{flex:2,padding:"10px 0"},children:i?"SIGNING...":"SIGN & BROADCAST"})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,marginTop:10,textAlign:"center",...y},children:"Signing occurs client-side Â· Private key never leaves your wallet"})]})})}const di={name:"",kpiTarget:"12",capitalLimit:"5000",risk:"medium",execMode:"manual",autoApproveThreshold:"50",kpiMetric:"ROI %",horizon:30,revenueSource:"momentum",dataSources:["KAS On-Chain","Kaspa DAG"],frequency:"1h",strategyTemplate:"dca_accumulator",strategyLabel:"DCA Accumulator",strategyClass:"accumulation",riskBudgetWeight:"1.0",portfolioAllocationPct:"25"},li=[{id:"dca_accumulator",name:"DCA Accumulator",class:"accumulation",desc:"Accumulation-first sizing, frequent small entries, strict downside control.",defaults:{risk:"low",kpiTarget:"10",horizon:90,frequency:"4h",revenueSource:"accumulation",execMode:"manual",autoApproveThreshold:"25"}},{id:"trend",name:"Trend",class:"accumulation",desc:"Ride persistent trend regimes with scaling entries and tighter risk on reversals.",defaults:{risk:"medium",kpiTarget:"18",horizon:45,frequency:"1h",revenueSource:"trend",execMode:"manual",autoApproveThreshold:"40"}},{id:"mean_reversion",name:"Mean Reversion",class:"accumulation",desc:"Accumulate on weakness with quant-regime gating and reduced chase behavior.",defaults:{risk:"low",kpiTarget:"14",horizon:30,frequency:"30m",revenueSource:"mean-reversion",execMode:"manual",autoApproveThreshold:"20"}},{id:"vol_breakout",name:"Volatility Breakout",class:"accumulation",desc:"Respond to volatility expansion but keep accumulation-only execution discipline.",defaults:{risk:"medium",kpiTarget:"22",horizon:21,frequency:"15m",revenueSource:"breakout",execMode:"notify",autoApproveThreshold:"15"}}],ui=[{v:"low",l:"Low",desc:"Tight stops. Max 5% exposure per action."},{v:"medium",l:"Medium",desc:"Balanced Kelly sizing. 10% max exposure."},{v:"high",l:"High",desc:"Aggressive. 20% max. Wide targets."}],Mr=[{v:"autonomous",l:"Fully Autonomous",desc:"Auto-signs under threshold. Manual above."},{v:"manual",l:"Manual Approval",desc:"Every action requires wallet signature."},{v:"notify",l:"Notify Only",desc:"Decisions generated, no execution."}],fi=({d:e,set:t,wallet:r})=>n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:17,color:o.text,fontWeight:700,marginBottom:3,...y},children:"Configure Agent"}),n.jsxs("div",{style:{fontSize:12,color:o.dim,marginBottom:20},children:["Connected: ",n.jsx("span",{style:{color:o.accent,...y},children:Oe(r==null?void 0:r.address)})]}),n.jsx(oe,{children:"Strategy Template (Accumulation-First)"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:8,marginBottom:16},children:li.map(s=>{const i=e.strategyTemplate===s.id;return n.jsxs("div",{onClick:()=>{t("strategyTemplate",s.id),t("strategyLabel",s.name),t("strategyClass",s.class),Object.entries(s.defaults).forEach(([a,d])=>t(a,d))},style:{padding:"10px 12px",borderRadius:8,cursor:"pointer",border:`1px solid ${i?o.accent:o.border}`,background:i?o.aLow:o.s2,transition:"all 0.15s"},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center",marginBottom:4},children:[n.jsx("div",{style:{fontSize:12,color:i?o.accent:o.text,fontWeight:700,...y},children:s.name}),n.jsx(q,{text:s.class.toUpperCase(),color:s.class==="accumulation"?o.ok:o.warn})]}),n.jsx("div",{style:{fontSize:11,color:o.dim},children:s.desc})]},s.id)})}),n.jsx(He,{label:"Agent Name",value:e.name,onChange:s=>t("name",s),placeholder:"KAS-Alpha-01"}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[n.jsx(He,{label:"ROI Target",value:e.kpiTarget,onChange:s=>t("kpiTarget",s),type:"number",placeholder:"12",suffix:"%"}),n.jsx(He,{label:"Capital / Cycle",value:e.capitalLimit,onChange:s=>t("capitalLimit",s),type:"number",placeholder:"5000",suffix:"KAS"})]}),n.jsx(oe,{children:"Risk Tolerance"}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8},children:ui.map(s=>{const i=e.risk===s.v;return n.jsxs("div",{onClick:()=>t("risk",s.v),style:{padding:"12px 10px",borderRadius:4,cursor:"pointer",border:`1px solid ${i?o.accent:o.border}`,background:i?o.aLow:o.s2,textAlign:"center",transition:"all 0.15s"},children:[n.jsx("div",{style:{fontSize:13,color:i?o.accent:o.text,fontWeight:700,...y,marginBottom:3},children:s.l}),n.jsx("div",{style:{fontSize:11,color:o.dim},children:s.desc})]},s.v)})})]}),pi=({d:e,set:t})=>n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:17,color:o.text,fontWeight:700,marginBottom:3,...y},children:"Execution & Signing"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:20},children:"Configure how the agent acts and when your wallet signs."}),Mr.map(r=>{const s=e.execMode===r.v;return n.jsxs("div",{onClick:()=>t("execMode",r.v),style:{padding:14,borderRadius:6,marginBottom:10,cursor:"pointer",border:`1px solid ${s?o.accent:o.border}`,background:s?o.aLow:o.s2,transition:"all 0.15s"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:4},children:[n.jsx("div",{style:{width:11,height:11,borderRadius:"50%",border:`2px solid ${s?o.accent:o.muted}`,background:s?o.accent:"transparent",flexShrink:0}}),n.jsx("span",{style:{fontSize:13,color:s?o.accent:o.text,fontWeight:700,...y},children:r.l})]}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginLeft:21},children:r.desc})]},r.v)}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[n.jsx(He,{label:"Portfolio Allocation %",value:e.portfolioAllocationPct,onChange:r=>t("portfolioAllocationPct",r),type:"number",suffix:"%",hint:"Default allocation share inside shared portfolio budget."}),n.jsx(He,{label:"Risk Budget Weight",value:e.riskBudgetWeight,onChange:r=>t("riskBudgetWeight",r),type:"number",hint:"Relative weight for shared risk allocator (e.g. 0.5, 1.0, 2.0)."})]}),n.jsx(ms,{}),n.jsx(He,{label:"Auto-Approve Threshold",value:e.autoApproveThreshold,onChange:r=>t("autoApproveThreshold",r),type:"number",suffix:"KAS",hint:"Transactions under this amount sign automatically in autonomous mode. Above threshold always requires manual wallet signing."})]}),mi=({d:e,wallet:t,onDeploy:r})=>{const s=e.name&&e.capitalLimit&&e.kpiTarget;return n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:17,color:o.text,fontWeight:700,marginBottom:3,...y},children:"Review & Deploy"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:18},children:"Agent vault will be provisioned. Initial funding requires a wallet signature."}),n.jsx(Z,{p:0,style:{marginBottom:14},children:[["Agent",e.name||"â€”"],["Strategy Template",e.strategyLabel||e.strategyTemplate||"Custom"],["Wallet",Oe(t==null?void 0:t.address)],["Network",(t==null?void 0:t.network)||fe],["ROI Target",`${e.kpiTarget}%`],["Capital / Cycle",`${e.capitalLimit} KAS`],["Portfolio Target",`${e.portfolioAllocationPct||"â€”"}%`],["Risk Budget Weight",String(e.riskBudgetWeight||"1.0")],["Risk",e.risk.toUpperCase()],["Exec Mode",e.execMode.replace(/_/g," ").toUpperCase()],["Auto-Approve Under",`${e.autoApproveThreshold} KAS`]].map(([i,a],d,c)=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"9px 16px",borderBottom:d<c.length-1?`1px solid ${o.border}`:"none"},children:[n.jsx("span",{style:{fontSize:12,color:o.dim,...y},children:i}),n.jsx("span",{style:{fontSize:12,color:o.text,...y},children:a})]},i))}),n.jsxs("div",{style:{background:o.wLow,border:`1px solid ${o.warn}30`,borderRadius:4,padding:"10px 14px",marginBottom:16,fontSize:12,color:o.dim},children:["Deployment triggers a wallet signature to provision the agent vault. Vault address: ",n.jsx("span",{style:{color:o.accent,...y},children:Oe(tr)})]}),n.jsx(re,{onClick:r,disabled:!s,style:{width:"100%",padding:"11px 0"},children:"DEPLOY AGENT â€” SIGN WITH WALLET"}),!s&&n.jsx("div",{style:{fontSize:11,color:o.warn,marginTop:6,textAlign:"center",...y},children:"Name, capital, and target required."})]})};function ge(e,t=0){const r=Number(e);return Number.isFinite(r)?r:t}function gi(e){if(!Array.isArray(e==null?void 0:e.outputs))return;const t=e.outputs.map(r=>({to:he(String((r==null?void 0:r.to)||(r==null?void 0:r.address)||""),ie),amount_kas:Number(ge((r==null?void 0:r.amount_kas)??(r==null?void 0:r.amount),0).toFixed(6)),tag:r!=null&&r.tag?String(r.tag).slice(0,40):void 0})).filter(r=>r.to&&r.amount_kas>0);if(t.length)return t}function hi(e,t,r){if(!(e!=null&&e.length))return{to:t,amount_kas:r};const s=e.find(i=>String(i.tag||"").toLowerCase()==="primary")||e[0];return{to:s.to,amount_kas:s.amount_kas}}function Xr(e){var A,N;const t=gi(e),r=String((e==null?void 0:e.to)||"").trim(),s=Number(ge(e==null?void 0:e.amount_kas,0).toFixed(6)),i=r?he(r,ie):((A=t==null?void 0:t[0])==null?void 0:A.to)||"",a=s>0?s:Number(((N=t==null?void 0:t[0])==null?void 0:N.amount_kas)||0),d=hi(t,i,a),c=d.to,u=Number(ge(d.amount_kas,0).toFixed(6));if(!(u>0)||!c)throw new Error("Invalid tx amount_kas/to; must be > 0 and valid address");const f=String((e==null?void 0:e.status)||"pending").toLowerCase(),x=f==="pending"||f==="signing"||f==="signed"||f==="rejected"||f==="failed"?f:"pending";return{...e,id:String((e==null?void 0:e.id)||"").trim(),type:String((e==null?void 0:e.type)||"TX").trim()||"TX",from:e!=null&&e.from?String(e.from).trim():void 0,to:c,amount_kas:u,outputs:t,purpose:String((e==null?void 0:e.purpose)||"ForgeOS transaction").trim().slice(0,140),status:x,ts:Math.max(0,Math.round(ge(e==null?void 0:e.ts,Date.now()))),receipt_lifecycle:(e==null?void 0:e.receipt_lifecycle)==="broadcasted"||(e==null?void 0:e.receipt_lifecycle)==="pending_confirm"||(e==null?void 0:e.receipt_lifecycle)==="confirmed"||(e==null?void 0:e.receipt_lifecycle)==="failed"||(e==null?void 0:e.receipt_lifecycle)==="timeout"?e.receipt_lifecycle:"submitted",submitted_ts:Math.max(0,Math.round(ge(e==null?void 0:e.submitted_ts,(e==null?void 0:e.ts)??Date.now()))),broadcast_ts:ge(e==null?void 0:e.broadcast_ts,NaN)>0?Math.round(ge(e==null?void 0:e.broadcast_ts,0)):void 0,confirm_ts:ge(e==null?void 0:e.confirm_ts,NaN)>0?Math.round(ge(e==null?void 0:e.confirm_ts,0)):void 0,receipt_last_checked_ts:ge(e==null?void 0:e.receipt_last_checked_ts,NaN)>0?Math.round(ge(e==null?void 0:e.receipt_last_checked_ts,0)):void 0,receipt_next_check_at:ge(e==null?void 0:e.receipt_next_check_at,NaN)>0?Math.round(ge(e==null?void 0:e.receipt_next_check_at,0)):void 0,receipt_attempts:Math.max(0,Math.round(ge(e==null?void 0:e.receipt_attempts,0))),confirmations:Math.max(0,Math.round(ge(e==null?void 0:e.confirmations,0))),failure_reason:(e==null?void 0:e.failure_reason)==null?null:String(e.failure_reason).slice(0,240),broadcast_price_usd:Number.isFinite(ge(e==null?void 0:e.broadcast_price_usd,NaN))?ge(e==null?void 0:e.broadcast_price_usd,0):void 0,confirm_price_usd:Number.isFinite(ge(e==null?void 0:e.confirm_price_usd,NaN))?ge(e==null?void 0:e.confirm_price_usd,0):void 0,metaKind:(e==null?void 0:e.metaKind)==="treasury_fee"?"treasury_fee":(e==null?void 0:e.metaKind)==="deploy"?"deploy":"action"}}function ir(e){const t={id:String((e==null?void 0:e.id)||"").trim(),status:"pending",ts:Date.now(),submitted_ts:Date.now(),receipt_lifecycle:"submitted",receipt_attempts:0,confirmations:0,failure_reason:null,...e};if(!t.id)throw new Error("Queue tx requires id");return Xr(t)}async function _i(e,t){const r=Xr(t),s=Array.isArray(r.outputs)?r.outputs:[],i=s.length>1;if(i&&!ne.supportsNativeMultiOutput(String((e==null?void 0:e.provider)||"")))throw new Error(`Wallet ${String((e==null?void 0:e.provider)||"unknown")} does not support native multi-output send`);return(e==null?void 0:e.provider)==="kasware"?ne.sendKasware(r.to,r.amount_kas):(e==null?void 0:e.provider)==="kastle"?i&&ne.canKastleSignAndBroadcastRawTx()?ne.sendKastleRawTx(s,r.purpose):ne.sendKastle(r.to,r.amount_kas):(e==null?void 0:e.provider)==="ghost"?s.length?ne.sendGhostOutputs(s,r.purpose):ne.sendGhost(r.to,r.amount_kas):(e==null?void 0:e.provider)==="kaspium"?ne.sendKaspium(r.to,r.amount_kas,r.purpose):(e==null?void 0:e.provider)==="tangem"||(e==null?void 0:e.provider)==="onekey"?ne.sendHardwareBridge(String((e==null?void 0:e.provider)||"hardware"),r.to,r.amount_kas,r.purpose,s):(await new Promise(a=>setTimeout(a,300)),Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join(""))}function xi({wallet:e,onComplete:t}){var N;const[r,s]=p.useState(0),[i,a]=p.useState({...di}),d=(w,I)=>a(v=>({...v,[w]:I})),[c,u]=p.useState(!1),f=()=>{u(!0)},x=w=>{u(!1),t({...i,wallet:e,deployTx:w,deployedAt:Date.now(),agentId:`forge_${er()}`})},A=ir({id:`deploy_${er()}`,type:"AGENT_DEPLOY",metaKind:"deploy",from:e==null?void 0:e.address,to:tr,amount_kas:parseFloat(i.capitalLimit)||5e3,purpose:"Agent vault provisioning + initial capital"});return n.jsxs("div",{style:{maxWidth:1040,margin:"0 auto",padding:"clamp(18px, 2.2vw, 34px)"},children:[c&&n.jsx(Yr,{tx:A,wallet:e,onSign:x,onReject:()=>u(!1)}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:22},children:[n.jsx("span",{style:{fontSize:10,color:o.dim,letterSpacing:"0.12em",...y},children:"FORGE.OS / NEW AGENT"}),n.jsx("span",{style:{width:1,height:12,background:o.border,display:"inline-block"}}),n.jsx(q,{text:((N=e==null?void 0:e.provider)==null?void 0:N.toUpperCase())||"CONNECTED",color:o.ok,dot:!0})]}),n.jsxs(Z,{p:28,style:{maxWidth:680,margin:"0 auto"},children:[n.jsx("div",{style:{display:"flex",gap:5,marginBottom:26},children:[0,1,2].map(w=>n.jsx("div",{style:{height:3,flex:1,borderRadius:2,background:w<=r?o.accent:o.muted,transition:"background 0.3s"}},w))}),r===0&&n.jsx(fi,{d:i,set:d,wallet:e}),r===1&&n.jsx(pi,{d:i,set:d}),r===2&&n.jsx(mi,{d:i,wallet:e,onDeploy:f}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:22,paddingTop:16,borderTop:`1px solid ${o.border}`},children:[n.jsx(re,{onClick:()=>s(w=>w-1),variant:"ghost",disabled:r===0,children:"BACK"}),n.jsxs("span",{style:{fontSize:11,color:o.dim,alignSelf:"center",...y},children:["STEP ",r+1," / 3"]}),r<2&&n.jsx(re,{onClick:()=>s(w=>w+1),children:"NEXT"}),r===2&&n.jsx("div",{})]})]})]})}const yi="modulepreload",Si=function(e,t){return new URL(e,t).href},vn={},ht=function(t,r,s){let i=Promise.resolve();if(r&&r.length>0){const d=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));i=Promise.allSettled(r.map(f=>{if(f=Si(f,s),f in vn)return;vn[f]=!0;const x=f.endsWith(".css"),A=x?'[rel="stylesheet"]':"";if(!!s)for(let I=d.length-1;I>=0;I--){const v=d[I];if(v.href===f&&(!x||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${A}`))return;const w=document.createElement("link");if(w.rel=x?"stylesheet":yi,x||(w.as="script"),w.crossOrigin="",w.href=f,u&&w.setAttribute("nonce",u),document.head.appendChild(w),x)return new Promise((I,v)=>{w.addEventListener("load",I),w.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return i.then(d=>{for(const c of d||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})};function R(e,t=0){const r=Number(e);return Number.isFinite(r)?r:t}function H(e,t,r){return Math.min(r,Math.max(t,e))}function hs(e){return e.length?e.reduce((t,r)=>t+r,0)/e.length:0}function Ei(e){if(e.length<2)return 0;const t=hs(e);return e.reduce((r,s)=>r+(s-t)**2,0)/(e.length-1)}function _s(e){return Math.sqrt(Math.max(0,Ei(e)))}function vt(e){return e[e.length-1]}function Ai(e){if(e.length<2)return[];const t=[];for(let r=1;r<e.length;r+=1)t.push(e[r]-e[r-1]);return t}function br(e,t=1){if(e.length<=t)return 0;const r=vt(e),s=e[e.length-1-t];return!(s>0)||!Number.isFinite(r)?0:(r-s)/s}function bi(e){const t=[];for(let r=1;r<e.length;r+=1){const s=e[r-1],i=e[r];s>0&&i>0&&t.push(Math.log(i/s))}return t}function ki(e,t=.94){if(!e.length)return 0;let r=e[0]**2;for(let s=1;s<e.length;s+=1)r=t*r+(1-t)*e[s]**2;return Math.sqrt(Math.max(0,r))}function Ti(e){if(e.length<2)return 0;const t=e.length;let r=0,s=0,i=0,a=0;for(let c=0;c<t;c+=1)r+=c,s+=e[c],i+=c*e[c],a+=c*c;const d=t*a-r*r;return d===0?0:(t*i-r*s)/d}function vi(e,t){if(!t.length)return 0;const r=_s(t);return r===0?0:(e-hs(t))/r}function wi(e){if(!e.length)return 0;let t=e[0],r=0;for(const s of e)s>t&&(t=s),t>0&&(r=Math.max(r,(t-s)/t));return r}function Ni(e){return e>30?1:e<-30?0:1/(1+Math.exp(-e))}function G(e,t=4){const r=10**t;return Math.round(e*r)/r}function Vt(e,t){return t<=0?[]:e.slice(Math.max(0,e.length-t))}function Ii(e){const t=String((e==null?void 0:e.risk)||"medium").toLowerCase(),r=String((e==null?void 0:e.strategyTemplate)||"").toLowerCase();if(t==="low"){const i={label:"low",kellyCap:.08,riskCeiling:.42,exposureCapPct:.12,drawdownPenaltyStart:.03};return r==="dca_accumulator"?{...i,kellyCap:.06,exposureCapPct:.1,drawdownPenaltyStart:.025}:r==="mean_reversion"?{...i,riskCeiling:.38,exposureCapPct:.1}:i}if(t==="high"){const i={label:"high",kellyCap:.22,riskCeiling:.82,exposureCapPct:.35,drawdownPenaltyStart:.1};return r==="vol_breakout"?{...i,kellyCap:.2,exposureCapPct:.28,riskCeiling:.76}:i}const s={label:"medium",kellyCap:.14,riskCeiling:.65,exposureCapPct:.22,drawdownPenaltyStart:.06};return r==="trend"?{...s,kellyCap:.16,exposureCapPct:.24}:r==="dca_accumulator"?{...s,kellyCap:.1,riskCeiling:.58,exposureCapPct:.16,drawdownPenaltyStart:.045}:r==="mean_reversion"?{...s,riskCeiling:.56,exposureCapPct:.18}:r==="vol_breakout"?{...s,kellyCap:.12,riskCeiling:.6,drawdownPenaltyStart:.05}:s}function wn(e){var a,d,c,u,f,x,A,N;if(!e)return null;const t=R(e.ts??e.fetched??((a=e==null?void 0:e.kasData)==null?void 0:a.fetched)??((d=e==null?void 0:e.kasData)==null?void 0:d.ts),NaN),r=R(e.priceUsd??e.price??((c=e==null?void 0:e.kasData)==null?void 0:c.priceUsd),0),s=R(e.daaScore??((u=e==null?void 0:e.dag)==null?void 0:u.daaScore)??((f=e==null?void 0:e.kasData)==null?void 0:f.daaScore)??((A=(x=e==null?void 0:e.kasData)==null?void 0:x.dag)==null?void 0:A.daaScore),0),i=R(e.walletKas??((N=e==null?void 0:e.kasData)==null?void 0:N.walletKas),0);return!Number.isFinite(t)||t<=0?null:{ts:t,priceUsd:Math.max(0,r),daaScore:Math.max(0,s),walletKas:Math.max(0,i)}}function Ci(e,t){const r=[];for(const a of Array.isArray(t==null?void 0:t.history)?t.history:[]){const d=wn(a);d&&r.push(d)}const s=wn(e);s&&r.push(s),r.sort((a,d)=>a.ts-d.ts);const i=[];for(const a of r){const d=i[i.length-1];d&&a.ts===d.ts&&a.priceUsd===d.priceUsd&&a.daaScore===d.daaScore&&a.walletKas===d.walletKas||i.push(a)}return i.slice(-240)}function Ri(e){return e<.008?"LOW":e<.02?"MEDIUM":"HIGH"}function Li(e,t){return!(t>0)||e<=t*.06?"MINIMAL":e<=t*.2?"MODERATE":"SIGNIFICANT"}function Mi(e,t,r,s){return e<-.45||r>.12&&t>.02?"RISK_OFF":e>.4&&t<.03&&s>=0?"TREND_UP":Math.abs(e)<.15&&t>.015?"RANGE_VOL":s>.25&&e>=0?"FLOW_ACCUMULATION":"NEUTRAL"}function ji(e){const t=[];return e.dataQualityScore<.55&&t.push("Limited local sample history"),e.volatilityEstimate==="HIGH"&&t.push("Elevated short-horizon volatility"),e.drawdownPct>.08&&t.push("Recent drawdown pressure"),e.liquidityImpact!=="MINIMAL"&&t.push("Position size may impact wallet liquidity"),e.regime==="RISK_OFF"&&t.push("Risk-off regime detected"),t.length===0&&t.push("Normal market conditions"),t.slice(0,5)}function Oi(e){const t=e.momentumScore>.2?"positive momentum":e.momentumScore<-.2?"negative momentum":"mixed momentum",r=e.regime.toLowerCase().replace(/_/g," ");return[`${e.action} because the local quant core detects ${r} with ${t}, EWMA volatility ${(e.ewmaVol*100).toFixed(2)}%, and DAA velocity ${G(e.daaVelocity,2)}.`,`Model win probability is ${(e.winProbability*100).toFixed(1)}% with expected value ${G(e.expectedValuePct,2)}%; sizing is capped by risk profile and data-quality score ${G(e.dataQualityScore,2)}.`].join(" ")}function Pi(e,t,r){const s=Ci(t,r),i=Ii(e),a=Math.max(0,R(e==null?void 0:e.capitalLimit,0)),d=s[s.length-1],c=R(r==null?void 0:r.now,Date.now()),u=s.map(Ee=>Ee.priceUsd).filter(Ee=>Ee>0),f=s.map(Ee=>Ee.daaScore).filter(Ee=>Ee>0),x=s.map(Ee=>Ee.walletKas).filter(Ee=>Ee>=0),A=bi(u),N=Vt(A,24),w=A.length?vt(A):0,I=ki(N,.92),v=Ri(I),L=br(u,1),_=br(u,5),O=br(u,20),g=L*1.4+_*.9+O*.6,l=H(g*12,-2,2),b=H(vi(w,N),-4,4),k=Ai(f),j=k.length?vt(k):0,$=Ti(Vt(f,16)),V=_s(Vt(k,16)),U=H($/Math.max(1,Math.abs(j)||1)*.25+(j>0?.15:-.1),-1,1),m=wi(Vt(u,48)),T=H(u.length/32,0,1),D=H(f.length/32,0,1),te=H(s.length/48,0,1),K=H(.15+te*.45+T*.3+D*.1,.15,1),se=H(I/.03,0,2),h=H((m-i.drawdownPenaltyStart)/Math.max(.01,.2-i.drawdownPenaltyStart),0,1.2),F=1-K,B=H(l/2,-1,1),X=Ni(.1+B*1.25+U*.55-se*.55-h*.6),M=H(.5+(X-.5)*(.4+K*.6),.35,.82),ae=G(M*100,2),P=l>.35?2.1:l<-.35?1.1:v==="HIGH"?1.3:1.7,S=G(H(I*100*2.2+1.4,1.2,12),2),z=G(H(S*P,2.2,22),2),Y=G(M*z-(1-M)*S,2),ce=Math.max(.01,P),pe=Math.max(0,M-(1-M)/ce),Ae=H(i.kellyCap*(.55+.45*K),.02,i.kellyCap),Be=G(H(pe,0,Ae),4),we=G(H(.18+se*.26+h*.28+(l<-.35?.16:0)+(v==="HIGH"&&V>15?.1:0)+F*.18-(l>.35?.06:0),.04,.98),4),ye=Mi(l,I,m,U),W=G(Y/Math.max(1,S),4),Se=Math.max(0,R((d==null?void 0:d.walletKas)??(t==null?void 0:t.walletKas),0)),Ke=Se>0?Se:Math.max(0,vt(x)||0);let me="HOLD";we>i.riskCeiling+.08&&l<-.2&&Ke>.5?me="REDUCE":Y>.35&&Be>.01&&we<=i.riskCeiling?me="ACCUMULATE":Math.abs(l)<.12&&v==="HIGH"&&(me="REBALANCE");const be=a*Be*(1+H(Y/6,0,.65)),Ce=a*i.exposureCapPct,_t=Ke>0?Ke*Math.max(.08,i.exposureCapPct):a;let Re=Math.min(a,Math.max(0,be),Ce,_t);me==="HOLD"&&(Re=0),me==="REDUCE"&&(Re=Math.min(Math.max(a*.05,be),Ke*.25||a)),me==="REBALANCE"&&(Re=Math.min(Math.max(a*.03,be*.7),_t)),Re=G(Math.max(0,Re),6);const jt=a>0?G(H(Re/a*100,0,100),2):0,Q=Li(Re,Ke||a||1),ze=me==="ACCUMULATE"?ye==="TREND_UP"?"ENTRY":"SCALING":me==="REDUCE"?"EXIT":"HOLDING",xt=G(H(.52+H(Math.abs(Y)/5,0,.2)+K*.15-we*.12+(me==="HOLD"?.02:0),.45,.97),4),tt=ji({dataQualityScore:K,volatilityEstimate:v,drawdownPct:m,liquidityImpact:Q,regime:ye}),_e=Oi({action:me,regime:ye,momentumScore:l,ewmaVol:I,winProbability:M,expectedValuePct:Y,dataQualityScore:K,daaVelocity:j}),it=H(Math.round(45+we*120+(v==="HIGH"?45:0)),45,240),pr=new Date(c+it*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),yt={regime:ye,sample_count:s.length,data_quality_score:G(K,4),price_usd:G(R(vt(u),R(t==null?void 0:t.priceUsd,0)),6),price_return_1_pct:G(L*100,4),price_return_5_pct:G(_*100,4),price_return_20_pct:G(O*100,4),momentum_z:G(b,4),ewma_volatility:G(I,6),daa_velocity:G(j,4),daa_slope:G($,4),drawdown_pct:G(m*100,4),win_probability_model:G(M,4),edge_score:G(W,4),kelly_raw:G(pe,4),kelly_cap:G(Ae,4),risk_ceiling:G(i.riskCeiling,4),risk_profile:i.label,exposure_cap_pct:G(i.exposureCapPct*100,4),strategy_template:String((e==null?void 0:e.strategyTemplate)||"custom")};return{action:me,confidence_score:xt,risk_score:we,kelly_fraction:Be,capital_allocation_kas:Re,capital_allocation_pct:jt,expected_value_pct:Y,stop_loss_pct:S,take_profit_pct:z,monte_carlo_win_pct:ae,volatility_estimate:v,liquidity_impact:Q,strategy_phase:ze,rationale:_e,risk_factors:tt,next_review_trigger:`Re-evaluate in ~${it}s (around ${pr}) or on >${G(S/2,2)}% price move / regime change.`,decision_source:"quant-core",decision_source_detail:`regime:${ye};samples:${s.length}`,quant_metrics:yt}}const Ki={},qe=Ki,Lt=qe.VITE_AI_API_URL||"https://api.anthropic.com/v1/messages",Ui=qe.VITE_AI_MODEL||"claude-sonnet-4-20250514",jr=qe.VITE_ANTHROPIC_API_KEY||"",Or=Math.max(800,Number(qe.VITE_AI_SOFT_TIMEOUT_MS||2200)),Nn=String(qe.VITE_AI_FALLBACK_ENABLED||"true").toLowerCase()!=="false",In=String(qe.VITE_AI_OVERLAY_MODE||"always").trim().toLowerCase(),Qt=["off","always","adaptive"].includes(In)?In:"adaptive",xs=Math.max(0,Number(qe.VITE_AI_OVERLAY_MIN_INTERVAL_MS||15e3)),ys=Math.max(xs,Number(qe.VITE_AI_OVERLAY_CACHE_TTL_MS||45e3)),$i=512,Fi=!!Lt&&(!Lt.includes("api.anthropic.com")||!!jr),kr=Math.max(1,Math.min(3,Number(qe.VITE_AI_MAX_ATTEMPTS||2))),Bi=new Set([408,425,429,500,502,503,504]),wt=new Map;function Cn(e){return new Promise(t=>setTimeout(t,e))}function Rn(e){const t=Math.floor(Math.random()*90);return 160*(e+1)+t}function zi(){const e={"Content-Type":"application/json"};if(Lt.includes("api.anthropic.com")){if(!jr)throw new Error("Anthropic API key missing. Set VITE_ANTHROPIC_API_KEY or configure VITE_AI_API_URL to your secure backend endpoint.");e["x-api-key"]=jr,e["anthropic-version"]="2023-06-01"}return e}function Wi(e){try{return JSON.parse(e)}catch{throw new Error("AI response was not valid JSON")}}function Gi(e){if(!e||typeof e!="object"||Array.isArray(e))return;const t={};for(const[r,s]of Object.entries(e))if(r){if(typeof s=="number"){if(!Number.isFinite(s))continue;t[r]=Math.abs(s)>=1e3?Math.round(s):G(s,6);continue}if(typeof s=="string"){t[r]=s.slice(0,80);continue}typeof s=="boolean"&&(t[r]=s)}return Object.keys(t).length>0?t:void 0}function ot(e,t){const r=String((e==null?void 0:e.action)||"HOLD").toUpperCase(),s=["ACCUMULATE","REDUCE","HOLD","REBALANCE"].includes(r)?r:"HOLD",i=Math.max(0,R(t==null?void 0:t.capitalLimit,0)),a=H(R(e==null?void 0:e.capital_allocation_kas,0),0,i),d=i>0?H(a/i*100,0,100):H(R(e==null?void 0:e.capital_allocation_pct,0),0,100),c=H(R(e==null?void 0:e.confidence_score,0),0,1),u=H(R(e==null?void 0:e.risk_score,1),0,1),f=String((e==null?void 0:e.volatility_estimate)||"MEDIUM").toUpperCase(),x=["LOW","MEDIUM","HIGH"].includes(f)?f:"MEDIUM",A=String((e==null?void 0:e.liquidity_impact)||"MODERATE").toUpperCase(),N=["MINIMAL","MODERATE","SIGNIFICANT"].includes(A)?A:"MODERATE",w=String((e==null?void 0:e.strategy_phase)||"HOLDING").toUpperCase(),I=["ENTRY","SCALING","HOLDING","EXIT"].includes(w)?w:"HOLDING",v=Array.isArray(e==null?void 0:e.risk_factors)?e.risk_factors.map(b=>String(b)).filter(Boolean).slice(0,6):[],L=String((e==null?void 0:e.decision_source)||"ai").toLowerCase(),_=["ai","fallback","quant-core","hybrid-ai"].includes(L)?L:"ai",O=String((e==null?void 0:e.decision_source_detail)||"").slice(0,220),g=Gi(e==null?void 0:e.quant_metrics),l=Math.max(0,Math.round(R(e==null?void 0:e.engine_latency_ms,0)));return{action:s,confidence_score:G(c,4),risk_score:G(u,4),kelly_fraction:H(R(e==null?void 0:e.kelly_fraction,0),0,1),capital_allocation_kas:Number(a.toFixed(6)),capital_allocation_pct:Number(d.toFixed(2)),expected_value_pct:Number(R(e==null?void 0:e.expected_value_pct,0).toFixed(2)),stop_loss_pct:Number(Math.max(0,R(e==null?void 0:e.stop_loss_pct,0)).toFixed(2)),take_profit_pct:Number(Math.max(0,R(e==null?void 0:e.take_profit_pct,0)).toFixed(2)),monte_carlo_win_pct:Number(H(R(e==null?void 0:e.monte_carlo_win_pct,0),0,100).toFixed(2)),volatility_estimate:x,liquidity_impact:N,strategy_phase:I,rationale:String((e==null?void 0:e.rationale)||"No rationale returned by engine."),risk_factors:v,next_review_trigger:String((e==null?void 0:e.next_review_trigger)||"On next cycle or major DAA/price movement."),decision_source:_,decision_source_detail:O,quant_metrics:g,engine_latency_ms:l}}function Vi(e){return{...e||{},risk_factors:Array.isArray(e==null?void 0:e.risk_factors)?[...e.risk_factors]:[],quant_metrics:e!=null&&e.quant_metrics&&typeof e.quant_metrics=="object"?{...e.quant_metrics}:void 0}}function Di(e,t){const r=String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"default").trim().toLowerCase(),s=String((e==null?void 0:e.risk)||"medium").trim().toLowerCase(),i=G(Math.max(0,R(e==null?void 0:e.capitalLimit,0)),6),a=G(Math.max(0,R(e==null?void 0:e.kpiTarget,0)),4),d=Math.max(0,Math.round(R(e==null?void 0:e.horizon,0))),c=G(Math.max(0,R(e==null?void 0:e.autoApproveThreshold,0)),6),u=String((t==null?void 0:t.address)||"").trim().toLowerCase();return`${r}|${s}|${i}|kpi:${a}|hz:${d}|aa:${c}|addr:${u}`}function Hi(e){const t=(e==null?void 0:e.quant_metrics)||{},r=String(t.regime||"NA"),s=String((e==null?void 0:e.volatility_estimate)||"NA"),i=String((e==null?void 0:e.action)||"HOLD"),a=Math.round(H(R(e==null?void 0:e.confidence_score,0)*10,0,10)),d=Math.round(H(R(e==null?void 0:e.risk_score,1)*10,0,10)),c=Math.round(H(R(t.edge_score,0)*10,-20,20)),u=Math.round(H(R(e==null?void 0:e.kelly_fraction,0)*100,0,100)),f=Math.round(H(R(t.data_quality_score,0)*10,0,10)),x=Math.round(H(R(t.sample_count,0),0,999));return[r,s,i,`c${a}`,`r${d}`,`e${c}`,`k${u}`,`d${f}`,`s${x}`].join("|")}function Qr(e,t){return[String(e||"").trim(),t].filter(Boolean).join(";").slice(0,220)}function Ln(e,t,r,s){return ot({...t,decision_source:"quant-core",decision_source_detail:Qr(t==null?void 0:t.decision_source_detail,`fallback_reason:${r}`),engine_latency_ms:Date.now()-s},e)}function qi(e){return wt.get(e)||null}function Yi(e,t,r){for(wt.set(e,{ts:Date.now(),signature:t,decision:Vi(r)});wt.size>$i;){const s=wt.keys().next().value;if(!s)break;wt.delete(s)}}function Mn(e,t,r,s){var i;return ot({...t.decision||{},decision_source:"hybrid-ai",decision_source_detail:Qr((i=t==null?void 0:t.decision)==null?void 0:i.decision_source_detail,s),engine_latency_ms:Date.now()-r},e)}function Xi(e,t){const r=Date.now(),s=Hi(e),i=(e==null?void 0:e.quant_metrics)||{};if(!Fi)return{kind:"skip",reason:"ai_transport_not_configured",signature:s};if(Qt==="off")return{kind:"skip",reason:"ai_overlay_mode_off",signature:s};if(Qt==="always")return{kind:"call",reason:"ai_overlay_mode_always",signature:s};if(t&&t.signature===s){const O=Math.max(0,r-t.ts);if(O<=xs)return{kind:"reuse",reason:`cache_hit_min_interval_${O}ms`,signature:s};if(Qt==="adaptive"&&O<=ys){const g=R(e==null?void 0:e.confidence_score,0),l=R(e==null?void 0:e.risk_score,1),b=R(i.risk_ceiling,.65),k=String(i.regime||"NEUTRAL"),j=Math.abs(R(i.edge_score,0)),$=g<.88&&g>.56,V=Math.abs(l-b)<.06;if(!$&&!V&&!(k==="RISK_OFF"||k==="RANGE_VOL")&&j>.2)return{kind:"reuse",reason:`cache_hit_stable_state_${O}ms`,signature:s}}}const a=R(i.data_quality_score,0),d=R(e==null?void 0:e.confidence_score,0),c=R(e==null?void 0:e.risk_score,1),u=R(i.risk_ceiling,.65),f=String(i.regime||"NEUTRAL"),x=Math.abs(R(i.edge_score,0)),A=R(i.sample_count,0),N=R(e==null?void 0:e.kelly_fraction,0);if(a<.4||A<6)return{kind:"skip",reason:"low_data_quality",signature:s};const w=f==="RISK_OFF"||f==="RANGE_VOL",I=Math.abs(c-u)<.08,v=d<.9&&d>.58,L=x<.12;return a>=.72&&d>=.88&&!w&&!I&&x>=.25&&(N===0||N>=.02)?{kind:"skip",reason:"quant_core_high_conviction",signature:s}:w||I||v||L?{kind:"call",reason:"adaptive_uncertain_or_sensitive",signature:s}:{kind:"skip",reason:"adaptive_cost_control",signature:s}}function Qi(e,t,r){const s=[...Array.isArray(e)?e:[],...Array.isArray(t)?t:[]];return r&&s.push(r),Array.from(new Set(s.map(i=>String(i).trim()).filter(Boolean))).slice(0,6)}function Ji(e,t,r,s,i){var b,k,j;const a=String(((b=t==null?void 0:t.quant_metrics)==null?void 0:b.regime)||"NEUTRAL"),d=R((k=t==null?void 0:t.quant_metrics)==null?void 0:k.risk_ceiling,.65),c=String((r==null?void 0:r.action)||"HOLD");let u=c,f=!1;a==="RISK_OFF"&&c==="ACCUMULATE"&&(u=t.action==="REDUCE"?"REDUCE":"HOLD",f=!0),R(t==null?void 0:t.risk_score,0)>d&&c==="ACCUMULATE"&&(u=t.action==="REDUCE"?"REDUCE":"HOLD",f=!0);const x=G(Math.max(R(t==null?void 0:t.risk_score,1),R(r==null?void 0:r.risk_score,1)),4);let A=G(H(R(t==null?void 0:t.confidence_score,.5)*.58+R(r==null?void 0:r.confidence_score,.5)*.42-(f?.08:0),0,1),4);u==="HOLD"&&(A=Math.min(A,.86));const N=R((j=t==null?void 0:t.quant_metrics)==null?void 0:j.kelly_cap,R(t==null?void 0:t.kelly_fraction,0)),w=G(H(Math.min(Math.max(R(t==null?void 0:t.kelly_fraction,0)*.8,R(r==null?void 0:r.kelly_fraction,0)*.6),N||1),0,1),4);let I=0;const v=R(t==null?void 0:t.capital_allocation_kas,0),L=R(r==null?void 0:r.capital_allocation_kas,0);u==="ACCUMULATE"?I=Math.min(L||v,v*1.25||L||0):(u==="REDUCE"||u==="REBALANCE")&&(I=Math.min(Math.max(v,L*.75),Math.max(v*1.5,L)));const _=Qi(t==null?void 0:t.risk_factors,r==null?void 0:r.risk_factors,f?"AI signal conflict; core risk override applied":void 0),O=String((r==null?void 0:r.rationale)||"AI overlay unavailable.").trim(),l=`${String((t==null?void 0:t.rationale)||"").trim()} AI overlay: ${O}`.slice(0,900);return ot({...r,action:u,confidence_score:A,risk_score:x,kelly_fraction:w,capital_allocation_kas:u==="HOLD"?0:I,expected_value_pct:G(R(t==null?void 0:t.expected_value_pct,0)*.6+R(r==null?void 0:r.expected_value_pct,0)*.4,2),stop_loss_pct:G(Math.max(R(t==null?void 0:t.stop_loss_pct,0),R(r==null?void 0:r.stop_loss_pct,0)),2),take_profit_pct:G(R(t==null?void 0:t.take_profit_pct,0)*.6+R(r==null?void 0:r.take_profit_pct,0)*.4,2),monte_carlo_win_pct:G(R(t==null?void 0:t.monte_carlo_win_pct,0)*.65+R(r==null?void 0:r.monte_carlo_win_pct,0)*.35,2),volatility_estimate:(t==null?void 0:t.volatility_estimate)||(r==null?void 0:r.volatility_estimate),liquidity_impact:(t==null?void 0:t.liquidity_impact)||(r==null?void 0:r.liquidity_impact),strategy_phase:u==="ACCUMULATE"?(t==null?void 0:t.strategy_phase)||(r==null?void 0:r.strategy_phase):(r==null?void 0:r.strategy_phase)||(t==null?void 0:t.strategy_phase),rationale:l,risk_factors:_,next_review_trigger:(t==null?void 0:t.next_review_trigger)||(r==null?void 0:r.next_review_trigger),decision_source:"hybrid-ai",decision_source_detail:`regime:${a};ai_latency_ms:${s};mode:quant_core_guarded`,quant_metrics:{...(t==null?void 0:t.quant_metrics)||{},ai_overlay_applied:!0,ai_action_raw:c,ai_confidence_raw:R(r==null?void 0:r.confidence_score,0)},engine_latency_ms:Date.now()-i},e)}function Zi(e,t,r){var a,d,c,u,f,x,A;const s={fetched:R(t==null?void 0:t.fetched,0),address:String((t==null?void 0:t.address)||""),walletKas:G(R(t==null?void 0:t.walletKas,0),6),priceUsd:G(R(t==null?void 0:t.priceUsd,0),8),dag:{daaScore:R((a=t==null?void 0:t.dag)==null?void 0:a.daaScore,0),difficulty:R(((d=t==null?void 0:t.dag)==null?void 0:d.difficulty)??((c=t==null?void 0:t.dag)==null?void 0:c.virtualDaaScore),0),networkName:String(((u=t==null?void 0:t.dag)==null?void 0:u.networkName)||((f=t==null?void 0:t.dag)==null?void 0:f.network)||""),pastMedianTime:R(((x=t==null?void 0:t.dag)==null?void 0:x.pastMedianTime)??((A=t==null?void 0:t.dag)==null?void 0:A.virtualPastMedianTime),0)}},i=(r==null?void 0:r.quant_metrics)||{};return`You are a quant-grade AI risk overlay for a Kaspa-native autonomous trading engine. The local quant core (deterministic math) has already computed features, regime, Kelly cap, and risk limits. Your job is to refine the decision WITHOUT violating the local risk envelope.

Respond ONLY with a valid JSON object â€” no markdown, no prose, no code fences.

AGENT PROFILE:
Name: ${e.name}
Strategy: momentum / on-chain flow / risk-controlled execution
Risk Tolerance: ${e.risk} (low=conservative, high=aggressive)
KPI Target: ${e.kpiTarget}% ROI
Capital per Cycle: ${e.capitalLimit} KAS
Auto-Approve Threshold: ${e.autoApproveThreshold} KAS

KASPA SNAPSHOT:
${JSON.stringify(s)}

LOCAL QUANT CORE PRIOR (trust this as the primary signal unless you have a strong reason):
${JSON.stringify({action:r.action,confidence_score:r.confidence_score,risk_score:r.risk_score,kelly_fraction:r.kelly_fraction,capital_allocation_kas:r.capital_allocation_kas,expected_value_pct:r.expected_value_pct,stop_loss_pct:r.stop_loss_pct,take_profit_pct:r.take_profit_pct,monte_carlo_win_pct:r.monte_carlo_win_pct,quant_metrics:i,rationale:r.rationale,risk_factors:r.risk_factors})}

RULES:
1. Do not exceed quant_metrics.kelly_cap in kelly_fraction.
2. Do not exceed local quant capital_allocation_kas by more than 25%.
3. If quant_metrics.regime is RISK_OFF, avoid ACCUMULATE unless confidence_score >= 0.9 and risk_score <= quant_metrics.risk_ceiling.
4. Preserve strict risk discipline; prefer HOLD over low-quality conviction.
5. Keep rationale concise and reference actual metrics from the snapshot/core prior.

OUTPUT (strict JSON, all fields required):
{
  "action": "ACCUMULATE or REDUCE or HOLD or REBALANCE",
  "confidence_score": 0.00,
  "risk_score": 0.00,
  "kelly_fraction": 0.00,
  "capital_allocation_kas": 0.00,
  "capital_allocation_pct": 0,
  "expected_value_pct": 0.00,
  "stop_loss_pct": 0.00,
  "take_profit_pct": 0.00,
  "monte_carlo_win_pct": 0,
  "volatility_estimate": "LOW or MEDIUM or HIGH",
  "liquidity_impact": "MINIMAL or MODERATE or SIGNIFICANT",
  "strategy_phase": "ENTRY or SCALING or HOLDING or EXIT",
  "rationale": "Two concise sentences citing specific metrics and why this refines the quant-core prior.",
  "risk_factors": ["factor1", "factor2", "factor3"],
  "next_review_trigger": "Describe the specific condition that should trigger next decision cycle"
}`}async function ea(e,t,r){var d;const s=Zi(e,t,r),i=Lt.includes("api.anthropic.com")?{model:Ui,max_tokens:900,messages:[{role:"user",content:s}]}:{prompt:s,agent:e,kasData:t,quantCore:r};let a;for(let c=0;c<kr;c+=1){const u=new AbortController,f=setTimeout(()=>u.abort(),Or);try{const x=await fetch(Lt,{method:"POST",headers:zi(),body:JSON.stringify(i),signal:u.signal});if(!x.ok){const A=Number(x.status||0);if(Bi.has(A)&&c+1<kr){await Cn(Rn(c));continue}throw new Error(`AI endpoint ${A||"request_failed"}`)}a=await x.json();break}catch(x){const A=(x==null?void 0:x.name)==="AbortError",N=String((x==null?void 0:x.message)||""),w=(x==null?void 0:x.name)==="TypeError"||/failed to fetch|network|load failed/i.test(N);if(!A&&w&&c+1<kr){await Cn(Rn(c));continue}throw x}finally{clearTimeout(f)}}if((d=a==null?void 0:a.error)!=null&&d.message)throw new Error(a.error.message);if(Array.isArray(a==null?void 0:a.content)){const c=a.content.map(f=>f.text||"").join(""),u=Wi(c.replace(/```json|```/g,"").trim());return ot({...u,decision_source:"ai"},e)}return a!=null&&a.decision?ot({...a.decision,decision_source:"ai"},e):ot({...a,decision_source:"ai"},e)}async function jn(e,t,r){const s=Date.now(),i=ot({...Pi(e,t,r),engine_latency_ms:Date.now()-s},e),a=Di(e,t),d=qi(a),c=Xi(i,d);if(c.kind==="skip"&&c.reason==="ai_transport_not_configured"&&!Nn&&Qt!=="off")throw new Error("Real AI overlay is required but AI transport is not configured (set VITE_AI_API_URL and credentials/proxy).");if(c.kind==="skip")return Ln(e,i,c.reason,s);if(c.kind==="reuse"&&d)return Mn(e,d,s,c.reason);const u=Date.now();try{const f=await ea(e,t,i),x=Date.now()-u,A=Ji(e,i,f,x,s);return A.decision_source_detail=Qr(A==null?void 0:A.decision_source_detail,`overlay_plan:${c.reason}`),Yi(a,c.signature,A),A}catch(f){if(d){const x=Math.max(0,Date.now()-d.ts);if(x<=ys)return Mn(e,d,s,`ai_error_cache_reuse_${x}ms`)}if(Nn){const x=(f==null?void 0:f.name)==="AbortError"?`ai_timeout_${Or}ms`:(f==null?void 0:f.message)||"request failure";return Ln(e,i,x,s)}throw(f==null?void 0:f.name)==="AbortError"?new Error(`AI request timeout (${Or}ms)`):f}}const Ss="true".toLowerCase()!=="false",On=Math.max(1e3,8e3),ta=[/^Quant worker timeout/i,/^Quant worker crashed/i,/^Worker postMessage/i];let Ve=null,Jt=!1,Pn=!1,ra=1;const st=new Map;function ar(){if(Ve)try{Ve.terminate()}catch{}Ve=null,Jt=!1}function Es(){if(!Ss||typeof window>"u"||typeof Worker>"u")return null;if(Ve&&Jt)return Ve;if(Pn&&!Jt)return null;Pn=!0;try{return Ve=new Worker(new URL(""+new URL("quantEngine.worker-xGtjWKpe.js",import.meta.url).href,import.meta.url),{type:"module"}),Ve.onmessage=e=>{const t=e.data,r=st.get(Number(t==null?void 0:t.id));r&&(st.delete(Number(t.id)),clearTimeout(r.timeoutId),t!=null&&t.ok?r.resolve(t.decision):r.reject(new Error(String((t==null?void 0:t.error)||"Quant worker error"))))},Ve.onerror=()=>{for(const[e,t]of st.entries())clearTimeout(t.timeoutId),t.reject(new Error("Quant worker crashed")),st.delete(e);ar()},Jt=!0,Ve}catch{return ar(),null}}async function na(e,t,r){const s=Es();if(!s)return jn(e,t,r);const i=ra++;return new Promise((a,d)=>{const c=setTimeout(()=>{st.delete(i),ar(),d(new Error(`Quant worker timeout (${On}ms)`))},On);st.set(i,{resolve:a,reject:d,timeoutId:c});try{s.postMessage({id:i,agent:e,kasData:t,context:r})}catch(u){clearTimeout(c),st.delete(i),ar(),d(new Error(`Worker postMessage failed: ${String((u==null?void 0:u.message)||u||"unknown_error")}`))}}).catch(a=>{const d=String((a==null?void 0:a.message)||"");if(!ta.some(u=>u.test(d)))throw a;return jn(e,t,r).catch(u=>{throw u||a})})}function sa(){return Ss&&Es()?"worker":"main-thread"}const oa={SYSTEM:o.dim,DATA:"#6BA3FF",AI:o.accent,VALID:o.warn,EXEC:o.ok,ERROR:o.danger,SIGN:o.purple,TREASURY:o.warn},Tr=e=>{const t=Date.now();return[{ts:t-72e5,type:"SYSTEM",msg:`Agent ${e} provisioned. Vault address mapped to session.`,fee:null},{ts:t-714e4,type:"SIGN",msg:"Deploy transaction signed via Kasware. Vault funded.",fee:null},{ts:t-71e5,type:"TREASURY",msg:"Protocol fee: 0.20 KAS â†’ Treasury 0.06 KAS / Pool 0.14 KAS",fee:.2},{ts:t-36e5,type:"DATA",msg:"Kaspa DAG snapshot ingested. DAA score, hashrate, UTXO set analysed.",fee:null},{ts:t-354e4,type:"AI",msg:"Quant engine invoked. Kelly criterion + Monte Carlo computed.",fee:.12},{ts:t-35e5,type:"VALID",msg:"Risk gate PASSED Â· Conf 0.82 Â· Kelly 0.08 Â· Phase: ENTRY",fee:null},{ts:t-349e4,type:"EXEC",msg:"ACCUMULATE â€” 400 KAS Â· Auto-approved (below threshold)",fee:.08},{ts:t-18e5,type:"AI",msg:"Quant engine invoked.",fee:.12},{ts:t-178e4,type:"VALID",msg:"Conf 0.71 < 0.75 threshold â€” HOLD enforced.",fee:null},{ts:t-177e4,type:"EXEC",msg:"HOLD â€” confidence gate. Position maintained.",fee:.08}]},ia="forgeos.usage.v2",aa="forgeos.usage.v1";function ca(e){return String(e||"global").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,128)||"global"}function As(e){return`${ia}:${ca(e)}`}function da(e=new Date){return e.toISOString().slice(0,10)}function la(e){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(As(e));if(!t)return null;const r=JSON.parse(t);return!r||typeof r.day!="string"||!Number.isFinite(r.used)?null:{day:r.day,used:Math.max(0,Math.floor(r.used))}}catch{return null}}function Pr(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(As(t),JSON.stringify(e))}catch{}}function ua(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(aa);if(!e)return null;const t=JSON.parse(e);return!t||typeof t.day!="string"||!Number.isFinite(t.used)?null:{day:t.day,used:Math.max(0,Math.floor(t.used))}}catch{return null}}function bs(e,t){const r=da(),s=la(t)||(t?null:ua());if(!s||s.day!==r){const a={day:r,used:0};return Pr(a,t),a}const i={day:r,used:Math.min(s.used,Math.max(0,Math.floor(e)))};return(i.day!==s.day||i.used!==s.used)&&Pr(i,t),i}function Kr(e,t){const r=Math.max(1,Math.floor(t)),s=Math.min(e.used,r),i=Math.max(0,r-s);return{day:e.day,used:s,limit:r,remaining:i,locked:i<=0}}function fa(e,t){return Kr(bs(e,t),e)}function pa(e,t){const r=bs(e,t),s=Math.max(1,Math.floor(e));if(r.used>=s)return Kr(r,s);const i={...r,used:r.used+1};return Pr(i,t),Kr(i,s)}function Kn(e,t){return fa(e,t)}const ma="forgeos.dashboard.v1",ga=160,ha=320,_a=120,xa=240;function ya(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function ks(e){const t=ya(e);return`${ma}:${t||"default"}`}function vr(e,t){return Array.isArray(e)?e.slice(0,t):[]}function Sa(e,t){return Array.isArray(e)?e.slice(Math.max(0,e.length-t)):[]}function Ts(e){return{version:1,updatedAt:Date.now(),status:e.status==="RUNNING"||e.status==="PAUSED"||e.status==="SUSPENDED"?e.status:"RUNNING",execMode:e.execMode==="autonomous"||e.execMode==="manual"||e.execMode==="notify"?e.execMode:"manual",liveExecutionArmed:!!e.liveExecutionArmed,nextAutoCycleAt:Number.isFinite(e.nextAutoCycleAt)&&Number(e.nextAutoCycleAt)>0?Number(e.nextAutoCycleAt):void 0,queue:vr(e.queue,ga),log:vr(e.log,ha),decisions:vr(e.decisions,_a),marketHistory:Sa(e.marketHistory,xa)}}function vs(e){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(ks(e));if(!t)return null;const r=JSON.parse(t);return Ts(r)}catch{return null}}function Ea(e,t){if(!(typeof window>"u"))try{const r=Ts(t);window.localStorage.setItem(ks(e),JSON.stringify(r))}catch{}}const ue=(e,t=0)=>{const r=Number(e);return Number.isFinite(r)?r:t},wr=(e,t,r)=>Math.min(r,Math.max(t,e));function Aa(e){var t,r;for(let s=1;s<e.length;s+=1)if(ue((t=e[s-1])==null?void 0:t.ts,0)>ue((r=e[s])==null?void 0:r.ts,0))return!1;return!0}function ba(e,t){var u,f,x;if(!Array.isArray(e)||e.length===0||!Number.isFinite(t))return-1;let r=0,s=e.length-1;for(;r<=s;){const A=r+s>>1,N=ue((u=e[A])==null?void 0:u.ts,0);if(N===t)return A;N<t?r=A+1:s=A-1}const i=Math.max(0,s),a=Math.min(e.length-1,r),d=Math.abs(ue((f=e[i])==null?void 0:f.ts,0)-t),c=Math.abs(ue((x=e[a])==null?void 0:x.ts,0)-t);return d<=c?i:a}function ka(e,t,r=3){var c,u;const s=ba(e,t);if(s<0)return null;const i=ue((c=e[s])==null?void 0:c.priceUsd,0);if(!(i>0))return null;const a=Math.min(e.length-1,s+Math.max(1,r)),d=ue((u=e[a])==null?void 0:u.priceUsd,0);return d>0?(d-i)/i*100:null}function Un(e){const t=String(e||"MODERATE").toUpperCase();return t==="MINIMAL"?6:t==="SIGNIFICANT"?45:18}function Ta(e){var ae,P;const t=Array.isArray(e.decisions)?e.decisions:[],s=(Array.isArray(e.queue)?e.queue:[]).filter(S=>(S==null?void 0:S.metaKind)!=="treasury_fee"),i=Array.isArray(e.log)?e.log:[],a=Array.isArray(e.marketHistory)?Aa(e.marketHistory)?e.marketHistory:[...e.marketHistory].sort((S,z)=>ue(S==null?void 0:S.ts,0)-ue(z==null?void 0:z.ts,0)):[],d=t.filter(S=>{var Y;return String(((Y=S==null?void 0:S.dec)==null?void 0:Y.action)||"HOLD").toUpperCase()!=="HOLD"}),c=s.filter(S=>(S==null?void 0:S.status)==="signed"),u=s.filter(S=>(S==null?void 0:S.status)==="pending"),f=s.filter(S=>(S==null?void 0:S.status)==="rejected"),x=i.reduce((S,z)=>S+Math.max(0,ue(z==null?void 0:z.fee,0)),0);let A=0,N=0,w=0,I=0,v=0,L=0,_=0,O=0,g=0;for(const S of t){const z=(S==null?void 0:S.dec)||{},Y=String((z==null?void 0:z.action)||"HOLD").toUpperCase(),ce=Math.max(0,ue(z==null?void 0:z.capital_allocation_kas,0)),pe=ue(z==null?void 0:z.expected_value_pct,0),Ae=wr(ue(z==null?void 0:z.confidence_score,0),0,1),Be=String((z==null?void 0:z.liquidity_impact)||"MODERATE"),we=String((z==null?void 0:z.decision_source)||(S==null?void 0:S.source)||"ai");w+=Ae,I+=pe,Y!=="HOLD"&&(A+=ce*(pe/100),N+=ce*(Un(Be)/1e4));const ye=ka(a,ue(S==null?void 0:S.ts,0),3);if(ye!=null){L+=1;let W=0;Y==="ACCUMULATE"?W=ye:Y==="REDUCE"?W=-ye:W=-Math.abs(ye)*.1,v+=W,W>0&&(_+=1);const Se=(z==null?void 0:z.quant_metrics)||{},Ke=wr(ue(Se==null?void 0:Se.win_probability_model,ue(z==null?void 0:z.monte_carlo_win_pct,50)/100),0,1),me=W>0?1:0,be=1-Math.abs(Ke-me);O+=wr(be-(we==="quant-core"||we==="fallback"?.03:0),0,1),g+=1}}let l=0,b=0,k=0;for(const S of c){if(String((S==null?void 0:S.receipt_lifecycle)||"")!=="confirmed")continue;l+=1;const Y=Math.max(0,ue(S==null?void 0:S.amount_kas,0)),ce=String(((ae=S==null?void 0:S.dec)==null?void 0:ae.liquidity_impact)||"MODERATE");b+=Y*(Un(ce)/1e4);const pe=ue(S==null?void 0:S.broadcast_price_usd,0),Ae=ue(S==null?void 0:S.confirm_price_usd,0);if(pe>0&&Ae>0&&Y>0){const we=String((S==null?void 0:S.type)||((P=S==null?void 0:S.dec)==null?void 0:P.action)||"").toUpperCase()==="REDUCE"?-1:1,ye=(Ae-pe)/pe;k+=Y*Math.abs(ye)*Math.abs(we)}}const j=Math.max(0,N-b+k),$=c.length,V=d.length,U=u.length,m=f.length,T=V>0?$/V*100:0,D=$>0?l/$*100:0,te=[...u,...f].reduce((S,z)=>S+Math.max(0,ue(z==null?void 0:z.amount_kas,0)),0),K=t.length>0?w/t.length:0,se=t.length>0?I/t.length:0,h=L>0?v/L:0,F=g>0?O/g:0,B=A-x-N,X=l>0?"hybrid":"estimated",M=A-x-j;return{grossEdgeKas:Number(A.toFixed(6)),netPnlKas:Number(M.toFixed(6)),netPnlMode:X,feesKas:Number(x.toFixed(6)),slippageKas:Number(j.toFixed(6)),estimatedSlippageKas:Number(N.toFixed(6)),estimatedNetPnlKas:Number(B.toFixed(6)),realizedExecutionDriftKas:Number(k.toFixed(6)),actionableSignals:V,executedSignals:$,confirmedSignals:l,pendingSignals:U,rejectedSignals:m,fillRatePct:Number(T.toFixed(2)),receiptCoveragePct:Number(D.toFixed(2)),missedFillKas:Number(te.toFixed(6)),avgSignalConfidence:Number(K.toFixed(4)),avgExpectedValuePct:Number(se.toFixed(4)),signalQualityScore:Number(F.toFixed(4)),timingAlphaPct:Number(h.toFixed(4)),timingWins:_,timingSamples:L,rows:[{label:"Gross Edge",value:Number(A.toFixed(6)),hint:"Expected-value weighted edge from actionable signals"},{label:"Fees",value:Number((-x).toFixed(6)),hint:"Protocol + execution fees from runtime logs"},{label:l>0?"Slippage (hybrid)":"Slippage (est)",value:Number((-j).toFixed(6)),hint:l>0?"Confirmed receipts use realized execution drift; remaining fills use estimated liquidity impact":"Liquidity-impact estimate from decision liquidity bucket"},{label:(l>0,"Realized Drift (receipts)"),value:Number((-k).toFixed(6)),hint:"Observed price drift between broadcast and confirmation timestamps for confirmed executions"},{label:l>0?"Net PnL (hybrid)":"Net PnL (est)",value:Number((l>0?M:B).toFixed(6)),hint:l>0?"Gross edge - fees - hybrid slippage (realized where receipts are confirmed)":"Gross edge - fees - estimated slippage"},{label:"Timing Alpha %",value:Number(h.toFixed(6)),hint:"Directionally signed follow-through after signals"},{label:"Missed Fill KAS",value:Number((-te).toFixed(6)),hint:"Pending + rejected queued execution notional"}]}}function va(e,t){switch(e){case"RUNNING":return t.type==="PAUSE"?"PAUSED":t.type==="KILL"?"SUSPENDED":t.type==="FAIL"?"ERROR":e;case"PAUSED":return t.type==="RESUME"?"RUNNING":t.type==="KILL"?"SUSPENDED":t.type==="FAIL"?"ERROR":e;case"SUSPENDED":return t.type==="RESUME"?"RUNNING":e;case"ERROR":return t.type==="RESET_ERROR"||t.type==="RESUME"?"RUNNING":t.type==="KILL"?"SUSPENDED":e;default:throw Vr({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown agent state: ${String(e)}`})}}function $n(e,t){switch(e){case"pending":return t.type==="BEGIN_SIGN"?"signing":t.type==="SIGN_SUCCESS"?"signed":t.type==="SIGN_REJECT"?"rejected":t.type==="FAIL"?"failed":e;case"signing":return t.type==="SIGN_SUCCESS"?"signed":t.type==="SIGN_REJECT"?"rejected":t.type==="FAIL"?"failed":e;case"failed":return t.type==="REQUEUE"?"pending":t.type==="BEGIN_SIGN"?"signing":e;case"rejected":return t.type==="REQUEUE"?"pending":e;case"signed":return e;default:throw Vr({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown tx lifecycle state: ${String(e)}`})}}function wa(e,t){switch(e){case"submitted":return t.type==="BROADCASTED"?"broadcasted":t.type==="POLL_PENDING"?"pending_confirm":t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"broadcasted":return t.type==="POLL_PENDING"?"pending_confirm":t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"pending_confirm":return t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"failed":case"timeout":case"confirmed":return t.type==="RESET"?"submitted":e;default:throw Vr({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown tx receipt lifecycle state: ${String(e)}`})}}function Na(e="RUNNING"){const[t,r]=p.useState(e),s=p.useCallback(i=>{r(a=>va(String(a||"RUNNING"),i))},[]);return{status:t,setStatus:r,transitionAgentStatus:s}}const Ia="forgeos.alerts.v1",Ca="forgeos.alerts.dedupe.v1",Ra=1200,dt=new Map,Fn=1024,Ur={enabled:!1,minIntervalSec:90,discordWebhookUrl:"",telegramBotApiUrl:"",telegramChatId:"",emailWebhookUrl:"",eventToggles:{risk_event:!0,queue_pending:!0,ai_outage:!0,regime_shift:!0,system:!1}};function Jr(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function ws(e){return`${Ia}:${Jr(e)||"default"}`}function Bn(e,t){return`${Ca}:${Jr(e)||"default"}:${String(t||"event").slice(0,120)}`}function La(e,t){const r=Number(e);return Number.isFinite(r)?r:t}function Ma(e,t,r){return Math.min(r,Math.max(t,e))}function Nr(e){return String(e||"").trim().slice(0,500)}function fr(e){var r;const t={...Ur.eventToggles};for(const s of Object.keys(t))typeof((r=e==null?void 0:e.eventToggles)==null?void 0:r[s])=="boolean"&&(t[s]=e.eventToggles[s]);return{version:1,updatedAt:Date.now(),enabled:!!(e!=null&&e.enabled),minIntervalSec:Ma(La(e==null?void 0:e.minIntervalSec,Ur.minIntervalSec),15,3600),discordWebhookUrl:Nr(e==null?void 0:e.discordWebhookUrl),telegramBotApiUrl:Nr(e==null?void 0:e.telegramBotApiUrl),telegramChatId:String((e==null?void 0:e.telegramChatId)||"").trim().slice(0,120),emailWebhookUrl:Nr(e==null?void 0:e.emailWebhookUrl),eventToggles:t}}function pt(){return fr(Ur)}function $r(e){if(typeof window>"u")return pt();try{const t=window.localStorage.getItem(ws(e));return t?fr(JSON.parse(t)):pt()}catch{return pt()}}function ja(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(ws(e),JSON.stringify(fr(t)))}catch{}}function Oa(e,t,r){const s=r.key||`${r.type}:${r.title}`,i=Math.max(15,t.minIntervalSec)*1e3,a=Date.now(),d=`${Jr(e)}:${s}`,c=dt.get(d)||0;if(a-c<i)return!0;if(typeof window<"u")try{const u=window.localStorage.getItem(Bn(e,s)),f=u?Number(u):0;if(Number.isFinite(f)&&a-f<i)return!0}catch{}if(dt.set(d,a),dt.size>Fn){const u=a-i*4;for(const[f,x]of dt.entries())if(x<u&&dt.delete(f),dt.size<=Fn)break}if(typeof window<"u")try{window.localStorage.setItem(Bn(e,s),String(a))}catch{}return!1}function Zr(e){const t=String(e.severity||"info").toUpperCase(),r=new Date(e.ts||Date.now()).toISOString(),s=`[ForgeOS][${t}] ${e.title}`,i=`${e.message}${e.meta?`
meta: ${JSON.stringify(e.meta)}`:""}`;return`${s}
${i}
${r}`.slice(0,Ra)}async function en(e,t){const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`alert_webhook_${r.status}`);return!0}async function Pa(e,t){return e?(await en(e,{content:Zr(t)}),!0):!1}async function Ka(e,t,r){return!e||!t?!1:(await en(e,{chat_id:t,text:Zr(r),disable_web_page_preview:!0}),!0)}async function Ua(e,t){return e?(await en(e,{subject:`[ForgeOS] ${t.title}`,message:Zr(t),event:t}),!0):!1}async function $a(e,t,r){const s=fr(r||$r(e));if(!s.enabled)return{sent:!1,reason:"disabled"};if(!s.eventToggles[t.type])return{sent:!1,reason:"event_disabled"};if(!(!!s.discordWebhookUrl||!!s.telegramBotApiUrl&&!!s.telegramChatId||!!s.emailWebhookUrl))return{sent:!1,reason:"no_routes_configured"};if(Oa(e,s,t))return{sent:!1,reason:"throttled"};const a=[];let d=0;try{await Pa(s.discordWebhookUrl,t)&&(d+=1)}catch(c){a.push(`discord:${(c==null?void 0:c.message)||"send_failed"}`)}try{await Ka(s.telegramBotApiUrl,s.telegramChatId,t)&&(d+=1)}catch(c){a.push(`telegram:${(c==null?void 0:c.message)||"send_failed"}`)}try{await Ua(s.emailWebhookUrl,t)&&(d+=1)}catch(c){a.push(`email:${(c==null?void 0:c.message)||"send_failed"}`)}return d===0&&a.length?{sent:!1,reason:"delivery_failed",failures:a}:{sent:d>0,sentCount:d,failures:a}}function Fa(e){const{alertScope:t,agentName:r,agentId:s,activeStrategyLabel:i}=e,[a,d]=p.useState(()=>$r(t)),[c,u]=p.useState(!1),[f,x]=p.useState(null);p.useEffect(()=>{d($r(t))},[t]);const A=p.useCallback(async L=>{try{const _=await $a(t,L,a);return(_!=null&&_.sent||_!=null&&_.reason)&&x(_),_}catch(_){const O={sent:!1,reason:(_==null?void 0:_.message)||"alert_error"};return x(O),O}},[a,t]),N=p.useCallback(L=>{d(_=>({..._||pt(),...L,updatedAt:Date.now()}))},[]),w=p.useCallback((L,_)=>{d(O=>({...O||pt(),eventToggles:{...(O||pt()).eventToggles||{},[L]:_},updatedAt:Date.now()}))},[]),I=p.useCallback(async()=>{u(!0);try{ja(t,a),x({sent:!0,reason:"saved",sentCount:0})}catch(L){x({sent:!1,reason:(L==null?void 0:L.message)||"save_failed"})}finally{u(!1)}},[a,t]),v=p.useCallback(async()=>{const L=await A({type:"system",key:`test_alert:${String(s||r||"agent")}`,title:`${r||"Agent"} test alert`,message:`Test alert from Forge.OS (${fe}) Â· strategy=${String(i||"Custom")}`,severity:"info",meta:{network:fe,strategy:i}});x(L)},[i,s,r,A]);return{alertConfig:a,setAlertConfig:d,alertSaveBusy:c,lastAlertResult:f,setLastAlertResult:x,sendAlertEvent:A,patchAlertConfig:N,toggleAlertType:w,saveAlertConfig:I,sendTestAlert:v}}const Ba=String(dr||"").replace(/\/+$/,""),Zt=Array.from(new Set([Ba,...ds.map(e=>String(e||"").replace(/\/+$/,""))])).filter(Boolean),zn=12e3,Dt=2,za=250,Wn=new Set([408,425,429,500,502,503,504]),Wa=2e4;let Ht=null,kt=null;const Ga=fe.startsWith("testnet")?"testnet":"mainnet",Va=[e=>`/transactions/${e}`,e=>`/txs/${e}`,e=>`/transaction/${e}`];function Da(e,t){return`${e}${t}`}function Gn(e){return new Promise(t=>setTimeout(t,e))}function Vn(e){const t=Math.floor(Math.random()*120);return za*(e+1)+t}function Ha(e){const t=String(e||"").toLowerCase();return t.includes("tn10")||t.includes("tn11")||t.includes("tn12")||t.includes("testnet")?"testnet":t.includes("api.kaspa.org")||t.includes("mainnet")?"mainnet":"unknown"}function qa(e){const t=String(e||"").toLowerCase();if(t.includes("/addresses/kaspatest:")||t.includes("/addresses/kaspatest%3a"))return"testnet";if(t.includes("/addresses/kaspa:")||t.includes("/addresses/kaspa%3a"))return"mainnet";try{const r=decodeURIComponent(t);if(r.includes("/addresses/kaspatest:"))return"testnet";if(r.includes("/addresses/kaspa:"))return"mainnet"}catch{}return"unknown"}function Ya(e){const t=qa(e),r=t==="unknown"?Ga:t;if(r==="unknown")return Zt;const s=Zt.filter(i=>{const a=Ha(i);return a===r||a==="unknown"});return s.length>0?s:Zt}async function Mt(e){if(Zt.length===0)throw new Error("No Kaspa API endpoints configured");const t=Ya(e),r=[];for(const s of t)for(let i=0;i<Dt;i+=1){const a=new AbortController,d=setTimeout(()=>a.abort(),zn),c=`${i+1}/${Dt}`;try{const u=await fetch(Da(s,e),{method:"GET",headers:{Accept:"application/json"},signal:a.signal});if(!u.ok){const f=Number(u.status||0);if(Wn.has(f)&&i+1<Dt){await Gn(Vn(i));continue}throw new Error(`${f||"request_failed"}`)}return await u.json()}catch(u){const f=(u==null?void 0:u.name)==="AbortError",x=String((u==null?void 0:u.message)||""),A=Number(x||0),N=Wn.has(A),w=(u==null?void 0:u.name)==="TypeError"||/failed to fetch|network|load failed/i.test(x);if(i+1<Dt&&(f||N||w)){await Gn(Vn(i));continue}f?r.push(`${s} timeout (${zn}ms, attempt ${c})`):w?r.push(`${s} network_error (${x||"request_failed"}, attempt ${c})`):r.push(`${s} ${x||"request_failed"} (attempt ${c})`);break}finally{clearTimeout(d)}}throw Hr(new Error(`Kaspa API unavailable for ${e}: ${r.join(" | ")}`),{path:e,roots:t})}function Ns(e){const t=String(e||"").trim();if(!t)throw new Error("Missing Kaspa address");return encodeURIComponent(t)}function Xa(e){const t=String(e||"").trim();if(!/^[a-fA-F0-9]{64}$/.test(t))throw new Error("Invalid txid format");return t.toLowerCase()}function Qa(e){var s;const t=(e==null?void 0:e.balance)??(e==null?void 0:e.totalBalance)??(e==null?void 0:e.availableSompi)??(e==null?void 0:e.balanceSompi)??((s=e==null?void 0:e.balances)==null?void 0:s.total)??0,r=Number(t);return Number.isFinite(r)?Math.max(0,r):0}function Ja(e,t){var s;const r=(e==null?void 0:e.balanceKas)??(e==null?void 0:e.kas)??(e==null?void 0:e.balance_kas)??((s=e==null?void 0:e.balances)==null?void 0:s.kas);if(r!=null){const i=Number(r);if(Number.isFinite(i))return Math.max(0,i)}return t/1e8}function Za(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.utxos)?e.utxos:Array.isArray(e==null?void 0:e.entries)?e.entries:[]}function Ir(...e){for(const t of e){const r=Number(t);if(Number.isFinite(r))return r}return NaN}function ec(...e){for(const t of e)if(typeof t=="boolean")return t}function tc(e,t,r){var x,A,N,w,I,v,L,_;const s=(t==null?void 0:t.transaction)??(t==null?void 0:t.tx)??t,i=String((s==null?void 0:s.status)??(s==null?void 0:s.transactionStatus)??((x=s==null?void 0:s.verboseData)==null?void 0:x.status)??(s==null?void 0:s.state)??"").toLowerCase(),a=Math.max(0,Math.round(Ir(s==null?void 0:s.confirmations,s==null?void 0:s.numConfirmations,s==null?void 0:s.confirmationCount,(A=s==null?void 0:s.verboseData)==null?void 0:A.confirmations,s!=null&&s.acceptingBlockBlueScore&&(s!=null&&s.blockDaaScore)?Number(s.blockDaaScore)-Number(s.acceptingBlockBlueScore):NaN)||0)),d=ec(s==null?void 0:s.isAccepted,s==null?void 0:s.accepted,(N=s==null?void 0:s.verboseData)==null?void 0:N.isAccepted,(w=s==null?void 0:s.verboseData)==null?void 0:w.accepted),c=Ir(s==null?void 0:s.blockDaaScore,s==null?void 0:s.acceptingBlockBlueScore,(I=s==null?void 0:s.verboseData)==null?void 0:I.blockDaaScore,(v=s==null?void 0:s.verboseData)==null?void 0:v.acceptingBlockBlueScore),u=Ir(s==null?void 0:s.blockTime,s==null?void 0:s.blockTimestamp,s==null?void 0:s.acceptedTime,(L=s==null?void 0:s.verboseData)==null?void 0:L.blockTime,(_=s==null?void 0:s.verboseData)==null?void 0:_.blockTimestamp);let f="pending";return i.includes("confirm")||i.includes("accept")||a>0||Number.isFinite(c)?f="confirmed":(i.includes("reject")||i.includes("invalid")||i.includes("orphan")||d===!1)&&(f="failed"),{txid:e,found:!!t,status:f,confirmations:a,accepted:d,blockDaaScore:Number.isFinite(c)?Number(c):void 0,blockTime:Number.isFinite(u)?Number(u):void 0,sourcePath:r,raw:t}}async function rc(e){try{return await Mt(e)}catch(t){const r=String((t==null?void 0:t.message)||"");if(/(^|\s)404(\s|$)|\b404\b/.test(r))return null;throw t}}async function Is(){const e=Date.now();return Ht&&e-Ht.ts<Wa?Ht.value:kt||(kt=(async()=>{const t=await Mt("/info/price"),r=Number((t==null?void 0:t.price)??0);if(!Number.isFinite(r))throw Hr(new Error("Invalid price payload from Kaspa API"),{endpoint:"/info/price"});return Ht={value:r,ts:Date.now()},r})().finally(()=>{kt=null}),kt)}async function Cs(e){const t=await Mt(`/addresses/${Ns(e)}/balance`),r=Qa(t),s=Ja(t,r);return{kas:Fr(s,4),raw:r}}async function nc(e){const t=await Mt(`/addresses/${Ns(e)}/utxos`);return Za(t)}async function sc(){const e=await Mt("/info/blockdag");return(e==null?void 0:e.blockdag)??(e==null?void 0:e.blockDag)??e}async function oc(e){const t=Xa(e),r=[];for(const s of Va){const i=s(t);try{const a=await rc(i);if(!a)continue;return tc(t,a,i)}catch(a){r.push(String((a==null?void 0:a.message)||a||"request_failed"))}}if(r.length===0)return{txid:t,found:!1,status:"pending",confirmations:0};throw Hr(new Error(`Kaspa tx receipt lookup failed for ${t}: ${r.join(" | ")}`),{txid:t})}function ic(e){const{wallet:t,maxQueueEntries:r,addLog:s,kasPriceUsd:i=0,setTab:a,onSignedAction:d,receiptRetryBaseMs:c=2e3,receiptRetryMaxMs:u=3e4,receiptTimeoutMs:f=8*60*1e3,receiptMaxAttempts:x=18,receiptPollIntervalMs:A=1200,receiptPollBatchSize:N=2}=e,[w,I]=p.useState([]),[v,L]=p.useState(null),_=p.useRef(new Set),O=p.useCallback((h,F,B={})=>{I(X=>X.map(M=>{if((M==null?void 0:M.id)!==h)return M;const ae=$n(String((M==null?void 0:M.status)||"pending"),F);return{...M,status:ae,...B}}))},[]),g=p.useCallback((h,F,B={})=>{I(X=>X.map(M=>{if((M==null?void 0:M.id)!==h)return M;const ae=wa(String((M==null?void 0:M.receipt_lifecycle)||"submitted"),F);return{...M,receipt_lifecycle:ae,...B}}))},[]),l=p.useCallback(h=>{const F=Math.max(0,Math.min(6,Number(h||0))),B=Math.floor(Math.random()*250);return Math.min(u,c*2**F+B)},[c,u]),b=p.useCallback((h,F,B={})=>{const X=Date.now(),M=Number(i||0);return{...h,status:"signed",txid:F,receipt_lifecycle:"broadcasted",broadcast_ts:X,receipt_attempts:0,confirmations:0,receipt_next_check_at:X+l(0),receipt_last_checked_ts:void 0,failure_reason:null,...M>0?{broadcast_price_usd:M}:{},...B}},[i,l]),k=p.useCallback((h,F,B={})=>{const X=Date.now(),M=Number(i||0);g(h,{type:"BROADCASTED"},{txid:F,broadcast_ts:X,receipt_last_checked_ts:void 0,receipt_next_check_at:X+l(0),receipt_attempts:0,confirmations:0,failure_reason:null,...M>0?{broadcast_price_usd:M}:{},...B})},[i,l,g]),j=p.useCallback(async h=>{const F=String((h==null?void 0:h.id)||""),B=String((h==null?void 0:h.txid)||"");if(!F||!B)return;const X=Date.now(),M=Math.max(0,Number((h==null?void 0:h.receipt_attempts)||0)),ae=Math.max(0,Number((h==null?void 0:h.broadcast_ts)||(h==null?void 0:h.submitted_ts)||(h==null?void 0:h.ts)||X));if(M>=x||X-ae>=f){g(F,{type:"TIMEOUT"},{receipt_last_checked_ts:X,receipt_next_check_at:void 0,receipt_attempts:M,failure_reason:"confirmation_timeout"}),s({type:(h==null?void 0:h.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(h==null?void 0:h.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmation timeout Â· txid: ${B.slice(0,16)}...`,fee:null});return}let P;try{P=await oc(B)}catch(ce){const pe=M+1;g(F,{type:"POLL_PENDING"},{receipt_last_checked_ts:Date.now(),receipt_next_check_at:Date.now()+l(pe),receipt_attempts:pe,failure_reason:String((ce==null?void 0:ce.message)||"receipt_lookup_failed").slice(0,240)});return}const S=Date.now();if(!(P!=null&&P.found)||P.status==="pending"){const ce=M+1;ce>=x||S-ae>=f?(g(F,{type:"TIMEOUT"},{receipt_last_checked_ts:S,receipt_next_check_at:void 0,receipt_attempts:ce,confirmations:Math.max(0,Number((P==null?void 0:P.confirmations)||0)),failure_reason:"confirmation_timeout"}),s({type:(h==null?void 0:h.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(h==null?void 0:h.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmation timeout Â· txid: ${B.slice(0,16)}...`,fee:null})):g(F,{type:"POLL_PENDING"},{receipt_last_checked_ts:S,receipt_next_check_at:S+l(ce),receipt_attempts:ce,confirmations:Math.max(0,Number((P==null?void 0:P.confirmations)||0)),failure_reason:null});return}if(P.status==="failed"){g(F,{type:"FAILED"},{receipt_last_checked_ts:S,receipt_next_check_at:void 0,receipt_attempts:M+1,confirmations:Math.max(0,Number((P==null?void 0:P.confirmations)||0)),failure_reason:"chain_rejected"}),s({type:(h==null?void 0:h.metaKind)==="treasury_fee"?"TREASURY":"ERROR",msg:`${(h==null?void 0:h.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} failed on-chain Â· txid: ${B.slice(0,16)}...`,fee:null});return}const z=Number(i||0),Y=z>0?z:Number(await Is().catch(()=>0))||void 0;g(F,{type:"CONFIRMED"},{receipt_last_checked_ts:S,receipt_next_check_at:void 0,receipt_attempts:M+1,confirmations:Math.max(0,Number((P==null?void 0:P.confirmations)||0)),confirm_ts:S,failure_reason:null,...Y?{confirm_price_usd:Y}:{}}),s({type:(h==null?void 0:h.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(h==null?void 0:h.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmed Â· ${Math.max(0,Number((P==null?void 0:P.confirmations)||0))} conf Â· txid: ${B.slice(0,16)}...`,fee:null})},[s,i,l,x,f,g]),$=p.useCallback(async h=>_i(t,Xr(h)),[t]),V=p.useCallback(h=>{I(F=>[h,...F].slice(0,r))},[r]),U=p.useCallback((h,F)=>{const B=b(h,F);return I(X=>[B,...X].slice(0,r)),B},[b,r]),m=p.useCallback(h=>{h!=null&&h.id&&O(h.id,{type:"BEGIN_SIGN"}),L(h)},[O]),T=p.useCallback(h=>{const F=w.find(B=>B.id===h);if(O(h,{type:"SIGN_REJECT"}),(F==null?void 0:F.metaKind)==="treasury_fee"){s({type:"TREASURY",msg:`Treasury fee payout rejected by operator: ${h}`,fee:null});return}s({type:"SIGN",msg:`Transaction rejected by operator: ${h}`,fee:null})},[s,w,O]),D=p.useCallback(()=>{v!=null&&v.id&&T(v.id),L(null)},[T,v]),te=p.useCallback(async h=>{var B,X;const F=v?{...v,status:"signed",txid:h.txid}:h;if(v!=null&&v.id&&(O(v.id,{type:"SIGN_SUCCESS",txid:h.txid},{txid:h.txid}),k(v.id,h.txid)),(v==null?void 0:v.metaKind)==="treasury_fee"){s({type:"TREASURY",msg:`Treasury fee payout signed: ${v==null?void 0:v.amount_kas} KAS Â· txid: ${(B=h.txid)==null?void 0:B.slice(0,16)}...`,fee:null}),L(null);return}s({type:"EXEC",msg:`SIGNED: ${v==null?void 0:v.type} Â· ${v==null?void 0:v.amount_kas} KAS Â· txid: ${(X=h.txid)==null?void 0:X.slice(0,16)}...`,fee:.08}),s({type:"TREASURY",msg:`Fee split â†’ Pool: ${(Pe*Wr).toFixed(4)} KAS / Treasury: ${(Pe*De).toFixed(4)} KAS`,fee:Pe}),L(null),typeof d=="function"&&await d(F)},[s,k,d,v,O]),K=p.useCallback(()=>{I(h=>h.map(F=>F.status==="pending"?{...F,status:$n("pending",{type:"SIGN_REJECT"})}:F)),L(null)},[]);p.useEffect(()=>{let h=!1;const F=()=>{if(h)return;const X=Date.now(),M=_.current,ae=(Array.isArray(w)?w:[]).filter(P=>(P==null?void 0:P.status)==="signed"&&/^[a-f0-9]{64}$/i.test(String((P==null?void 0:P.txid)||""))).filter(P=>{const S=String((P==null?void 0:P.receipt_lifecycle)||"submitted");return S!=="confirmed"&&S!=="failed"&&S!=="timeout"}).filter(P=>{const S=Number((P==null?void 0:P.receipt_next_check_at)||0);return!(S>0)||S<=X}).filter(P=>!M.has(String((P==null?void 0:P.id)||""))).slice(0,N);for(const P of ae){const S=String((P==null?void 0:P.id)||"");S&&(M.add(S),j(P).finally(()=>{M.delete(S)}))}};F();const B=setInterval(F,A);return()=>{h=!0,clearInterval(B)}},[j,w,N,A]),p.useEffect(()=>{},[r,w,a,t==null?void 0:t.address]);const se=w.filter(h=>h.status==="pending").length;return{queue:w,setQueue:I,signingItem:v,setSigningItem:L,pendingCount:se,sendWalletTransfer:$,updateQueueItemLifecycle:O,updateQueueItemReceiptLifecycle:g,receiptBackoffMs:l,decorateBroadcastedSignedItem:b,markQueueItemBroadcasted:k,prependQueueItem:V,prependSignedBroadcastedQueueItem:U,handleQueueSign:m,handleQueueReject:T,handleSigningReject:D,handleSigned:te,rejectAllPending:K}}function ac(e){const t=e.walletAddress,r=e.wsUrl||"",s=Math.max(1e3,Number(e.livePollMs)),i=Math.max(2e3,Number(e.streamReconnectMaxDelayMs)),a=Math.max(32,Number(e.maxMarketSnapshots)),d=p.useRef(!1),[c,u]=p.useState(null),[f,x]=p.useState([]),[A,N]=p.useState(!0),[w,I]=p.useState(null),[v,L]=p.useState(!1),[_,O]=p.useState(!1),[g,l]=p.useState(0),b=p.useCallback(async()=>{if(t&&!d.current){d.current=!0,N(!0),I(null);try{const[k,j,$]=await Promise.all([sc(),Cs(t),Is().catch(()=>null)]),V=Date.now(),U={dag:k,priceUsd:Number($||0),walletKas:Number(j.kas||0),address:t,fetched:V};u(U),x(m=>{var K;const T=m[m.length-1],D={ts:V,priceUsd:Number(U.priceUsd||0),daaScore:Number(((K=U==null?void 0:U.dag)==null?void 0:K.daaScore)||0),walletKas:Number(U.walletKas||0)};return T&&T.priceUsd===D.priceUsd&&T.daaScore===D.daaScore&&T.walletKas===D.walletKas?m:[...m,D].slice(-a)}),L(!0)}catch(k){L(!1),I((k==null?void 0:k.message)||"Kaspa live feed disconnected")}finally{N(!1),d.current=!1}}},[a,t]);return p.useEffect(()=>{if(!t)return;b();const k=setInterval(b,s);let j=null,$=null,V=null,U=!1,m=0;const T=()=>{if(U||!r)return;const te=Math.min(i,1200*2**m);m+=1,l(m),V=setTimeout(()=>{V=null,D()},te)},D=()=>{!r||U||(j=new WebSocket(r),j.onopen=()=>{m=0,l(0),O(!0)},j.onmessage=()=>{$||($=setTimeout(()=>{$=null,b()},1200))},j.onerror=()=>{U||O(!1)},j.onclose=()=>{O(!1),U||T()})};return r&&D(),()=>{U=!0,clearInterval(k),$&&clearTimeout($),V&&clearTimeout(V),j&&j.close()}},[s,b,i,t,r]),{kasData:c,setKasData:u,marketHistory:f,setMarketHistory:x,kasDataLoading:A,setKasDataLoading:N,kasDataError:w,setKasDataError:I,liveConnected:v,setLiveConnected:L,streamConnected:_,streamRetryCount:g,refreshKasData:b}}const Te=(e,t,r)=>Math.min(r,Math.max(t,e)),ve=(e,t=0)=>{const r=Number(e);return Number.isFinite(r)?r:t};function cc(e){const t=String(e||"HOLD").toUpperCase();return t==="ACCUMULATE"?1:t==="REBALANCE"?.75:t==="REDUCE"?.35:.5}function dc(e){const t=String(e||"NEUTRAL").toUpperCase();return t==="RISK_OFF"?.2:t==="RANGE_VOL"?.6:t==="TREND_UP"||t==="FLOW_ACCUMULATION"?1.1:.85}function lc(e){const t=[];return e.enabled||t.push("disabled in allocator"),e.regime==="RISK_OFF"&&t.push("risk-off regime throttle"),e.queuePressurePct>20&&t.push("queue pressure high"),e.risk>.7&&t.push("elevated risk score"),e.confidence<.7&&t.push("low confidence"),e.dataQuality<.5&&t.push("limited data quality"),e.action==="REDUCE"&&t.push("reduce signal active"),t.length||t.push("within shared budget guardrails"),t.slice(0,4)}function uc(e){var L,_,O,g;const t=Math.max(0,ve(e.walletKas,0)),r=Math.max(0,ve((L=e.config)==null?void 0:L.reserveKas,5)),s=Math.max(0,t-r),i=Te(ve((_=e.config)==null?void 0:_.totalBudgetPct,.85),.05,1),a=Te(ve((O=e.config)==null?void 0:O.maxAgentAllocationPct,.5),.05,1),d=Te(ve((g=e.config)==null?void 0:g.rebalanceThresholdPct,.08),.01,.5),c=s*i,f=(Array.isArray(e.agents)?e.agents:[]).map(l=>{const b=(l==null?void 0:l.lastDecision)||{},k=(b==null?void 0:b.quant_metrics)||{},j=Te(ve(b==null?void 0:b.risk_score,.75),0,1),$=Te(ve(b==null?void 0:b.confidence_score,.55),0,1),V=Te(ve(k==null?void 0:k.data_quality_score,.45),0,1),U=String((b==null?void 0:b.action)||"HOLD").toUpperCase(),m=String((k==null?void 0:k.regime)||"NEUTRAL").toUpperCase(),T=Math.max(.1,ve(k==null?void 0:k.risk_ceiling,.65)),D=Te((T-j)/T,-1,1),te=Math.max(0,ve(l==null?void 0:l.pendingKas,0)),K=Math.max(0,ve(l==null?void 0:l.capitalLimitKas,0)),se=Te(ve(l==null?void 0:l.targetAllocationPct,0),0,100),h=Te(ve(l==null?void 0:l.riskBudgetWeight,1),0,10),F=(l==null?void 0:l.enabled)!==!1,B=K>0?Te(te/K*100,0,500):0,X=se>0?se/100:0,M=Te(.25+$*.45+Math.max(0,D)*.2+V*.1,.05,1.1),ae=Te(1-B/160,.2,1),P=F?Math.max(0,(X>0?X:h*.2)*M*cc(U)*dc(m)*ae):0;return{agentId:String((l==null?void 0:l.agentId)||(l==null?void 0:l.name)||"agent"),name:String((l==null?void 0:l.name)||(l==null?void 0:l.agentId)||"Agent"),enabled:F,targetPct:se,riskWeight:h,capitalLimitKas:K,pendingKas:te,action:U,regime:m,confidence:$,risk:j,dataQuality:V,score:P,queuePressurePct:B}}),x=f.reduce((l,b)=>l+b.score,0),A=f.reduce((l,b)=>l+(b.enabled?Math.max(.1,b.riskWeight):0),0),N=f.map(l=>{const b=x>0?l.score/x:l.enabled?Math.max(.1,l.riskWeight)/Math.max(.1,A):0,k=c*b,j=Math.min(k,c*a),$=c>0?Te(j/c*100,0,100):0,V=Math.min(j,l.capitalLimitKas>0?l.capitalLimitKas:j,Math.max(0,c*a)),U=j-l.pendingKas;return{agentId:l.agentId,name:l.name,enabled:l.enabled,targetPct:l.targetPct,riskWeight:l.riskWeight,score:Number(l.score.toFixed(6)),budgetPct:Number($.toFixed(2)),budgetKas:Number(j.toFixed(6)),cycleCapKas:Number(Math.max(0,V).toFixed(6)),queuePressurePct:Number(l.queuePressurePct.toFixed(2)),regime:l.regime,action:l.action,confidence:Number(l.confidence.toFixed(4)),risk:Number(l.risk.toFixed(4)),dataQuality:Number(l.dataQuality.toFixed(4)),rebalanceDeltaKas:Math.abs(U)>=c*d?Number(U.toFixed(6)):0,notes:lc({enabled:l.enabled,action:l.action,regime:l.regime,queuePressurePct:l.queuePressurePct,risk:l.risk,confidence:l.confidence,dataQuality:l.dataQuality})}}),w=N.reduce((l,b)=>l+b.budgetKas,0),I=N.length?Math.max(...N.map(l=>c>0?l.budgetKas/c*100:0)):0,v=N.length?N.reduce((l,b)=>l+b.budgetPct*b.risk,0)/100:0;return N.sort((l,b)=>b.budgetKas-l.budgetKas||l.name.localeCompare(b.name)),{walletKas:Number(t.toFixed(6)),reserveKas:Number(r.toFixed(6)),allocatableKas:Number(s.toFixed(6)),targetBudgetKas:Number(c.toFixed(6)),allocatedKas:Number(w.toFixed(6)),utilizationPct:Number((c>0?w/c*100:0).toFixed(2)),concentrationPct:Number(I.toFixed(2)),riskWeightedExposurePct:Number(v.toFixed(4)),rows:N}}const fc="forgeos.portfolio.v1",Nt={version:1,updatedAt:0,totalBudgetPct:.85,reserveKas:5,maxAgentAllocationPct:.5,rebalanceThresholdPct:.08,agentOverrides:{}};function pc(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function Rs(e){return`${fc}:${pc(e)||"default"}`}function lt(e,t,r){return Math.min(r,Math.max(t,e))}function qt(e,t){const r=Number(e);return Number.isFinite(r)?r:t}function mc(e){if(!e||typeof e!="object")return{};const t={};return typeof e.enabled=="boolean"&&(t.enabled=e.enabled),Number.isFinite(Number(e.targetAllocationPct))&&(t.targetAllocationPct=lt(Number(e.targetAllocationPct),0,100)),Number.isFinite(Number(e.riskWeight))&&(t.riskWeight=lt(Number(e.riskWeight),0,10)),t}function Ls(e){const t={};if(e!=null&&e.agentOverrides&&typeof e.agentOverrides=="object")for(const[r,s]of Object.entries(e.agentOverrides)){const i=String(r||"").trim().toLowerCase().slice(0,120);i&&(t[i]=mc(s))}return{version:1,updatedAt:Date.now(),totalBudgetPct:lt(qt(e==null?void 0:e.totalBudgetPct,Nt.totalBudgetPct),.05,1),reserveKas:lt(qt(e==null?void 0:e.reserveKas,Nt.reserveKas),0,1e6),maxAgentAllocationPct:lt(qt(e==null?void 0:e.maxAgentAllocationPct,Nt.maxAgentAllocationPct),.05,1),rebalanceThresholdPct:lt(qt(e==null?void 0:e.rebalanceThresholdPct,Nt.rebalanceThresholdPct),.01,.5),agentOverrides:t}}function Cr(){return{...Nt,updatedAt:Date.now(),agentOverrides:{}}}function Dn(e){if(typeof window>"u")return Cr();try{const t=window.localStorage.getItem(Rs(e));return t?Ls(JSON.parse(t)):Cr()}catch{return Cr()}}function gc(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(Rs(e),JSON.stringify(Ls(t)))}catch{}}function hc(e){const{portfolioScope:t,allAgents:r,activeAgentId:s,walletAddress:i,walletKas:a,activeDecisions:d,activeQueue:c}=e,[u,f]=p.useState(()=>Dn(t)),[x,A]=p.useState(0),[N,w]=p.useState(()=>({}));p.useEffect(()=>{f(Dn(t))},[t]),p.useEffect(()=>{const g=setTimeout(()=>{gc(t,u)},200);return()=>clearTimeout(g)},[u,t]),p.useEffect(()=>{const g=String(s||""),l=()=>{const k={};for(const j of r){const $=String((j==null?void 0:j.agentId)||(j==null?void 0:j.name)||"");if(!$||$===g)continue;const V=`${fe}:${String(i||"unknown").toLowerCase()}:${$.toLowerCase()}`;k[$]=vs(V)||{}}w(k)};l();const b=setInterval(l,4e3);return()=>clearInterval(b)},[s,r,x,i]);const I=p.useMemo(()=>{const g=r.map(l=>{var T;const b=String((l==null?void 0:l.agentId)||(l==null?void 0:l.name)||""),j=b===String(s||"")?{queue:c,decisions:d}:N[b]||{},$=Array.isArray(j.decisions)?(T=j.decisions[0])==null?void 0:T.dec:void 0,V=Array.isArray(j.queue)?j.queue.filter(D=>(D==null?void 0:D.status)==="pending"&&(D==null?void 0:D.metaKind)!=="treasury_fee").reduce((D,te)=>D+Number((te==null?void 0:te.amount_kas)||0),0):0,U=b.toLowerCase(),m=((u==null?void 0:u.agentOverrides)||{})[U]||{};return{agentId:b,name:String((l==null?void 0:l.name)||b),enabled:m.enabled!==!1,capitalLimitKas:Number((l==null?void 0:l.capitalLimit)||0),targetAllocationPct:Number(m.targetAllocationPct??(l==null?void 0:l.portfolioAllocationPct)??Math.round(100/Math.max(1,r.length))),riskBudgetWeight:Number(m.riskWeight??(l==null?void 0:l.riskBudgetWeight)??1),pendingKas:V,lastDecision:$}});return uc({walletKas:Number(a||0),agents:g,config:u})},[s,d,c,r,N,u,a]),v=p.useMemo(()=>{var g;return((g=I==null?void 0:I.rows)==null?void 0:g.find(l=>String(l==null?void 0:l.agentId)===String(s)))||null},[s,I]);return{portfolioConfig:u,setPortfolioConfig:f,peerRuntimeCache:N,portfolioSummary:I,activePortfolioRow:v,patchPortfolioConfig:g=>{f(l=>({...l,...g,updatedAt:Date.now()}))},patchPortfolioAgentOverride:(g,l)=>{const b=String(g||"").toLowerCase();b&&(f(k=>({...k,updatedAt:Date.now(),agentOverrides:{...(k==null?void 0:k.agentOverrides)||{},[b]:{...((k==null?void 0:k.agentOverrides)||{})[b]||{},...l}}})),A(k=>k+1))},refreshPortfolioPeers:()=>{A(g=>g+1)}}}function _c(e){const{enabled:t,treasuryFeeKas:r,treasuryAddress:s,walletAddress:i,walletProvider:a,kasPriceUsd:d=0,maxQueueEntries:c,addLog:u,setQueue:f,sendWalletTransfer:x,receiptBackoffMs:A}=e,N=p.useCallback(_=>ir({id:er(),type:"TREASURY_FEE",metaKind:"treasury_fee",from:i,to:s,amount_kas:Number(Number(r||0).toFixed(6)),purpose:`Protocol treasury fee${_!=null&&_.txid?` Â· parent ${String(_.txid).slice(0,12)}`:""}`,status:"pending",ts:Date.now(),parentActionId:(_==null?void 0:_.id)||null,parentTxid:(_==null?void 0:_.txid)||null}),[s,r,i]),w=p.useCallback(_=>!t||!(r>0)||!_||(_==null?void 0:_.metaKind)==="treasury_fee"||String((_==null?void 0:_.type)||"").toUpperCase()!=="ACCUMULATE"?!1:ne.supportsNativeMultiOutput(String(a||"")),[t,r,a]),I=p.useCallback(_=>{if(!w(_))return _;const g=[...(Array.isArray(_==null?void 0:_.outputs)&&_.outputs.length?_.outputs:[{to:_.to,amount_kas:_.amount_kas,tag:"primary"}]).filter(l=>String((l==null?void 0:l.tag)||"").toLowerCase()!=="treasury"),{to:s,amount_kas:Number(Number(r||0).toFixed(6)),tag:"treasury"}];return ir({..._,outputs:g,treasuryCombined:!0,treasuryCombinedWalletProvider:a||null,treasuryCombinedFeeKas:Number(Number(r||0).toFixed(6)),treasuryCombinedAddress:s})},[w,s,r,a]),v=p.useCallback((_,O)=>{if(!t||!(r>0))return null;const g=N(_);return f(l=>l.some(k=>(k==null?void 0:k.metaKind)==="treasury_fee"&&(k==null?void 0:k.parentActionId)&&k.parentActionId===g.parentActionId&&(k.status==="pending"||k.status==="signed"||k.status==="signing"))?l:[g,...l].slice(0,c)),u({type:"TREASURY",msg:`Treasury fee payout queued${O?` (${O})`:""}: ${g.amount_kas} KAS â†’ ${s.slice(0,18)}...`,fee:null}),g},[u,N,t,c,f,s,r]),L=p.useCallback(async(_,O)=>{if(!t||!(r>0)||!_||_.metaKind==="treasury_fee")return null;if(_!=null&&_.treasuryCombined)return u({type:"TREASURY",msg:`Treasury fee combined in primary transaction (${String((_==null?void 0:_.treasuryCombinedWalletProvider)||"wallet")}) Â· ${Number((_==null?void 0:_.treasuryCombinedFeeKas)||r).toFixed(6)} KAS`,fee:null}),(_==null?void 0:_.txid)||null;const g=N(_);try{const l=await x(g),b=Date.now(),k=Number(d||0);return f(j=>{const $=j.filter(V=>!((V==null?void 0:V.metaKind)==="treasury_fee"&&(V!=null&&V.parentActionId)&&V.parentActionId===g.parentActionId));return[{...g,status:"signed",txid:l,receipt_lifecycle:"broadcasted",broadcast_ts:b,receipt_attempts:0,confirmations:0,receipt_next_check_at:b+A(0),receipt_last_checked_ts:void 0,failure_reason:null,...k>0?{broadcast_price_usd:k}:{}},...$].slice(0,c)}),u({type:"TREASURY",msg:`Treasury fee payout sent (${O}): ${g.amount_kas} KAS â†’ ${s.slice(0,18)}... Â· txid: ${String(l).slice(0,16)}...`,fee:null}),l}catch(l){return v(_,(l==null?void 0:l.message)||"wallet rejected"),null}},[u,N,t,v,d,c,A,x,f,s,r]);return{canCombineTreasuryWithAction:w,attachCombinedTreasuryOutput:I,enqueueTreasuryFeeTx:v,settleTreasuryFeePayout:L}}function xc({queue:e,wallet:t,onSign:r,onReject:s}){const i=a=>a==="confirmed"?o.ok:a==="failed"||a==="timeout"?o.danger:a==="pending_confirm"||a==="broadcasted"?o.warn:o.dim;return n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y,marginBottom:4},children:"Action Queue"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:16},children:"Transactions pending wallet signature. Auto-approved items processed immediately."}),e.length===0&&n.jsxs(Z,{p:32,style:{textAlign:"center"},children:[n.jsx("div",{style:{fontSize:13,color:o.dim,...y,marginBottom:4},children:"Queue empty"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Pending transactions will appear here awaiting your wallet signature."})]}),e.map(a=>n.jsxs(Z,{p:18,"data-testid":`queue-item-${String(a.id)}`,style:{marginBottom:10,border:`1px solid ${a.status==="pending"?o.warn:a.status==="signed"?o.ok:o.border}25`},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[n.jsx(q,{"data-testid":`queue-item-type-${String(a.id)}`,text:a.type,color:o.purple}),n.jsx(q,{"data-testid":`queue-item-status-${String(a.id)}`,text:a.status.toUpperCase(),color:a.status==="pending"?o.warn:a.status==="signed"?o.ok:o.dim,dot:!0}),a.status==="signed"&&n.jsx(q,{"data-testid":`queue-item-receipt-${String(a.id)}`,text:String(a.receipt_lifecycle||"submitted").toUpperCase().replace(/_/g," "),color:i(String(a.receipt_lifecycle||"submitted")),dot:!0})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,...y},children:is(a.ts)})]}),n.jsxs("div",{style:{fontSize:18,color:a.amount_kas>0?o.accent:o.danger,fontWeight:700,...y},children:[a.amount_kas," KAS"]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:a.status==="pending"?12:0,fontSize:12,color:o.dim,...y},children:[n.jsxs("div",{children:["To: ",n.jsx("span",{style:{color:o.text},children:Oe(a.to)})]}),n.jsx("div",{children:a.metaKind==="treasury_fee"?n.jsxs(n.Fragment,{children:["Routing: ",n.jsx("span",{style:{color:o.warn},children:"Treasury payout transfer"})]}):a!=null&&a.treasuryCombined?n.jsxs(n.Fragment,{children:["Routing: ",n.jsxs("span",{style:{color:o.ok},children:["Combined treasury output (",Array.isArray(a==null?void 0:a.outputs)?a.outputs.length:2," outputs)"]})]}):n.jsxs(n.Fragment,{children:["Fee split: ",n.jsxs("span",{style:{color:o.text},children:["Pool ",(Pe*Wr).toFixed(4)," / Treasury ",(Pe*De).toFixed(4)]})]})})]}),a.status==="pending"&&n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx(re,{onClick:()=>s(a.id),variant:"danger",size:"sm",children:"REJECT"}),n.jsx(re,{"data-testid":`queue-item-sign-${String(a.id)}`,onClick:()=>r(a),size:"sm",children:"SIGN & BROADCAST"})]}),a.status==="signed"&&a.txid&&n.jsxs("div",{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[n.jsxs("span",{style:{fontSize:11,color:o.ok,...y},children:["âœ“ ",a.txid.slice(0,32),"..."]}),typeof a.confirmations=="number"&&n.jsxs("span",{style:{fontSize:11,color:o.dim,...y},children:["conf: ",Math.max(0,Number(a.confirmations||0))]}),n.jsx(Fe,{href:`${ut}/txs/${a.txid}`,label:"EXPLORER â†—"})]}),(a.receipt_lifecycle==="failed"||a.receipt_lifecycle==="timeout")&&a.failure_reason&&n.jsxs("div",{style:{fontSize:11,color:o.danger,...y,marginTop:6},children:["receipt: ",String(a.failure_reason)]})]})]},a.id))]})}function yc({usage:e}){const t=p.useMemo(()=>Math.min(100,Math.round(e.used/Math.max(1,e.limit)*100)),[e.limit,e.used]);return n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y,marginBottom:4},children:"Billing & Usage"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:16},children:"Usage-based monetization: free daily quant cycles with upgrade path after quota is reached."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:10,marginBottom:14},children:[n.jsxs(Z,{p:14,children:[n.jsx(oe,{children:"Plan"}),n.jsx("div",{style:{fontSize:18,color:o.text,fontWeight:700,...y},children:"FREE"}),n.jsxs("div",{style:{fontSize:11,color:o.dim},children:["Up to ",ft," cycles/day"]})]}),n.jsxs(Z,{p:14,children:[n.jsx(oe,{children:"Cycles Used Today"}),n.jsx("div",{style:{fontSize:18,color:o.warn,fontWeight:700,...y},children:e.used}),n.jsxs("div",{style:{fontSize:11,color:o.dim},children:["of ",e.limit]})]}),n.jsxs(Z,{p:14,children:[n.jsx(oe,{children:"Cycles Remaining"}),n.jsx("div",{style:{fontSize:18,color:e.locked?o.danger:o.ok,fontWeight:700,...y},children:e.remaining}),n.jsx("div",{style:{fontSize:11,color:o.dim},children:"resets daily (UTC)"})]})]}),n.jsxs(Z,{p:16,style:{marginBottom:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[n.jsx(oe,{children:"Daily Quota Progress"}),n.jsx(q,{text:e.locked?"LOCKED":"ACTIVE",color:e.locked?o.danger:o.ok,dot:!0})]}),n.jsx("div",{style:{height:8,borderRadius:999,background:o.s2,border:`1px solid ${o.border}`,overflow:"hidden"},children:n.jsx("div",{style:{width:`${t}%`,height:"100%",background:e.locked?o.danger:o.accent,transition:"width 180ms ease"}})}),n.jsxs("div",{style:{marginTop:8,fontSize:11,color:o.dim,...y},children:[t,"% of daily free quota consumed"]})]}),n.jsxs(Z,{p:16,children:[n.jsx(oe,{children:"Upgrade / Payments"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:10},children:"Set `VITE_BILLING_UPGRADE_URL` for hosted checkout, or accept direct KAS payments at treasury."}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:10},children:[rr?n.jsx(Fe,{href:rr,label:"OPEN CHECKOUT â†—"}):n.jsx(q,{text:"NO CHECKOUT URL SET",color:o.warn}),yn&&n.jsx(q,{text:`CONTACT ${yn}`,color:o.dim})]}),n.jsx("div",{style:{fontSize:11,color:o.accent,...y,wordBreak:"break-all",marginBottom:8},children:Lr}),n.jsx(re,{onClick:()=>{var r;return(r=navigator.clipboard)==null?void 0:r.writeText(Lr)},variant:"ghost",size:"sm",children:"COPY TREASURY ADDRESS"})]})]})}function Sc({agent:e,wallet:t}){var D,te;const[r,s]=p.useState(null),[i,a]=p.useState([]),[d,c]=p.useState(!1),[u,f]=p.useState(null),[x,A]=p.useState(null),[N,w]=p.useState(null),[I,v]=p.useState(""),[L,_]=p.useState(""),[O,g]=p.useState(""),[l,b]=p.useState(typeof window<"u"?window.innerWidth:1200),k=p.useCallback(async()=>{c(!0),f(null);try{let K;(t==null?void 0:t.provider)==="kasware"?K=await ne.getKaswareBalance():K=(await Cs((t==null?void 0:t.address)||e.wallet)).kas;const se=await nc((t==null?void 0:t.address)||e.wallet);s(K),a(Array.isArray(se)?se.slice(0,10):[]),A(new Date)}catch(K){f(K.message)}c(!1)},[t,e]);p.useEffect(()=>{k()},[k]),p.useEffect(()=>{if(typeof window>"u")return;const K=()=>b(window.innerWidth);return window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[]);const j=parseFloat(r??e.capitalLimit??0),$=Math.max(0,j-It-nt),V=$.toFixed(4),U=l<760,m=()=>{const K=Number(L);!Ze(I,ie)||!(K>0)||K>$||w({type:"WITHDRAW",from:t==null?void 0:t.address,to:I,amount_kas:Number(K.toFixed(6)),purpose:O||"Withdrawal"})},T=()=>{w(null),v(""),_(""),g("")};return n.jsxs("div",{children:[N&&n.jsx(Yr,{tx:N,wallet:t,onSign:T,onReject:()=>w(null)}),n.jsxs(Z,{p:20,style:{marginBottom:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:14},children:[n.jsxs("div",{style:{flex:1,minWidth:0},children:[n.jsxs(oe,{children:["Connected Wallet â€” ",xe]}),n.jsx("div",{style:{fontSize:12,color:o.accent,...y,wordBreak:"break-all",marginBottom:10},children:(t==null?void 0:t.address)||"â€”"}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx(re,{onClick:()=>{var K;return(K=navigator.clipboard)==null?void 0:K.writeText((t==null?void 0:t.address)||"")},variant:"ghost",size:"sm",children:"COPY"}),n.jsx(Fe,{href:`${ut}/addresses/${t==null?void 0:t.address}`,label:"EXPLORER â†—"})]})]}),n.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexShrink:0,marginLeft:14},children:[n.jsx(q,{text:(t==null?void 0:t.provider)==="demo"?"DEMO":((D=t==null?void 0:t.provider)==null?void 0:D.toUpperCase())||"â€”",color:["kasware","kastle","ghost"].includes(String((t==null?void 0:t.provider)||""))?o.ok:o.warn,dot:!0}),n.jsx(re,{onClick:k,disabled:d,size:"sm",variant:"ghost",children:d?"...":"REFRESH"})]})]}),u&&n.jsxs("div",{style:{background:o.dLow,border:`1px solid ${o.danger}30`,borderRadius:4,padding:"8px 12px",marginBottom:12,fontSize:12,color:o.danger,...y},children:["RPC: ",u]}),n.jsx("div",{style:{display:"grid",gridTemplateColumns:U?"1fr":"repeat(3,1fr)",gap:12},children:[["Balance",`${r??e.capitalLimit} KAS`,r?o.accent:o.warn],["UTXOs",r?String(i.length):"â€”",o.text],["Network",(t==null?void 0:t.network)||fe,o.dim]].map(([K,se,h])=>n.jsxs("div",{children:[n.jsx(oe,{children:K}),n.jsx("div",{style:{fontSize:18,color:h,fontWeight:700,...y},children:se})]},K))}),x&&n.jsxs("div",{style:{fontSize:11,color:o.dim,marginTop:8,...y},children:["Fetched ",x.toLocaleTimeString()," via ",dr]})]}),n.jsxs(Z,{p:20,style:{marginBottom:12},children:[n.jsx(oe,{children:"Withdraw KAS"}),n.jsxs("div",{style:{background:o.s2,borderRadius:4,padding:"9px 13px",marginBottom:12,display:"flex",justifyContent:"space-between"},children:[n.jsxs("span",{style:{fontSize:11,color:o.dim,...y},children:["Available (after ",It," KAS reserve)"]}),n.jsxs("span",{style:{fontSize:14,color:o.accent,fontWeight:700,...y},children:[V," KAS"]})]}),n.jsx(He,{label:"Recipient Address",value:I,onChange:v,placeholder:"kaspa:... or kaspatest:..."}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:U?"1fr":"1fr auto",gap:8,alignItems:"flex-end",marginBottom:12},children:[n.jsx(He,{label:`Amount (max ${V} KAS)`,value:L,onChange:_,type:"number",suffix:"KAS",placeholder:"0.0000"}),n.jsx(re,{onClick:()=>_(V),variant:"ghost",size:"sm",style:{marginBottom:1},children:"MAX"})]}),n.jsx(He,{label:"Note (optional)",value:O,onChange:g,placeholder:"e.g. Profit extraction"}),n.jsxs(re,{onClick:m,disabled:!Ze(I,ie)||!(Number(L)>0)||Number(L)>$,style:{width:"100%",padding:"10px 0"},children:["INITIATE WITHDRAWAL â€” SIGN WITH ",((te=t==null?void 0:t.provider)==null?void 0:te.toUpperCase())||"WALLET"]}),Number(L||0)>$&&n.jsx("div",{style:{fontSize:11,color:o.warn,marginTop:6,...y},children:"Requested withdrawal exceeds available amount after reserve and network fee."})]}),n.jsxs(Z,{p:20,style:{marginBottom:12},children:[n.jsx(oe,{children:"Deposit KAS"}),n.jsx("div",{style:{fontSize:12,color:o.dim,marginBottom:12},children:"Send KAS directly to your connected wallet address. Funds are available after DAG confirmation (~1â€“2s)."}),n.jsxs("div",{style:{background:o.s2,borderRadius:4,padding:14,border:`1px solid ${o.accent}25`},children:[n.jsx("div",{style:{fontSize:12,color:o.accent,...y,wordBreak:"break-all",marginBottom:10},children:(t==null?void 0:t.address)||"â€”"}),n.jsx(Fe,{href:`${ut}/addresses/${t==null?void 0:t.address}`,label:"VIEW ON KASPA EXPLORER â†—"})]})]}),i.length>0&&n.jsxs(Z,{p:0,children:[n.jsx("div",{style:{padding:"11px 16px",borderBottom:`1px solid ${o.border}`,display:"flex",justifyContent:"space-between"},children:n.jsxs("span",{style:{fontSize:11,color:o.dim,...y},children:["UTXO SET â€” ",i.length," outputs"]})}),i.map((K,se)=>{var X,M,ae;const h=Fr((((X=K.utxoEntry)==null?void 0:X.amount)||0)/1e8,4),F=(M=K.utxoEntry)==null?void 0:M.blockDaaScore,B=(ae=K.outpoint)==null?void 0:ae.transactionId;return n.jsxs("div",{style:{display:"grid",gridTemplateColumns:U?"1fr":"1fr 100px 120px 60px",gap:8,padding:"8px 16px",borderBottom:`1px solid ${o.border}`,alignItems:"center"},children:[n.jsxs("span",{style:{fontSize:11,color:o.dim,...y,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[B==null?void 0:B.slice(0,34),"..."]}),n.jsxs("span",{style:{fontSize:12,color:o.ok,fontWeight:700,...y,textAlign:U?"left":"right"},children:[h," KAS"]}),n.jsxs("span",{style:{fontSize:11,color:o.dim,...y,textAlign:U?"left":"right"},children:["DAA ",F]}),n.jsx("div",{style:{textAlign:U?"left":"right"},children:n.jsx(Fe,{href:`${ut}/txs/${B}`,label:"â†—"})})]},se)})]})]})}const Ec=p.lazy(()=>ht(()=>import("./PerfChart-CqKOmh2i.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>({default:e.PerfChart}))),Ac=p.lazy(()=>ht(()=>import("./IntelligencePanel-B_zwsSQP.js"),__vite__mapDeps([5,1]),import.meta.url).then(e=>({default:e.IntelligencePanel}))),bc=p.lazy(()=>ht(()=>import("./TreasuryPanel-CyFuHSzs.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url).then(e=>({default:e.TreasuryPanel}))),kc=p.lazy(()=>ht(()=>import("./PortfolioPanel-FWkQx4XR.js"),__vite__mapDeps([7,1]),import.meta.url).then(e=>({default:e.PortfolioPanel}))),Tc=p.lazy(()=>ht(()=>import("./PnlAttributionPanel-CRLREBh1.js"),__vite__mapDeps([8,1]),import.meta.url).then(e=>({default:e.PnlAttributionPanel}))),vc=p.lazy(()=>ht(()=>import("./AlertsPanel-g0ziAsSX.js"),__vite__mapDeps([9,1]),import.meta.url).then(e=>({default:e.AlertsPanel})));function wc({agent:e,wallet:t,agents:r=[],activeAgentId:s,onSelectAgent:i}){var cn,dn,ln,un,fn,pn;const _=nr*1e3,O=`${fe}:${String((t==null?void 0:t.address)||"unknown").toLowerCase()}`,g=O,l=O,b=`${fe}:${String((t==null?void 0:t.address)||"unknown").toLowerCase()}:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"default").toLowerCase()}`,k=p.useRef(!1),j=p.useRef(""),[$,V]=p.useState(!1),[U,m]=p.useState("overview"),{status:T,setStatus:D,transitionAgentStatus:te}=Na("RUNNING"),[K,se]=p.useState(()=>Tr(e.name)),[h,F]=p.useState([]),[B,X]=p.useState(!1),[M,ae]=p.useState(e.execMode||"manual"),[P]=p.useState(parseFloat(e.autoApproveThreshold)||50),[S,z]=p.useState(()=>Kn(ft,O)),[Y,ce]=p.useState(Sr),[pe,Ae]=p.useState(()=>Date.now()+_),[Be,we]=p.useState(typeof window<"u"?window.innerWidth:1200),ye=p.useMemo(()=>sa(),[]),{kasData:W,marketHistory:Se,setMarketHistory:Ke,kasDataLoading:me,kasDataError:be,liveConnected:Ce,streamConnected:_t,streamRetryCount:Re,refreshKasData:jt}=ac({walletAddress:t==null?void 0:t.address,wsUrl:Ut,livePollMs:5e3,streamReconnectMaxDelayMs:12e3,maxMarketSnapshots:240}),Q=p.useCallback(E=>se(J=>[{ts:Date.now(),...E},...J].slice(0,320)),[320]),{queue:ze,setQueue:xt,signingItem:tt,pendingCount:_e,sendWalletTransfer:it,receiptBackoffMs:pr,prependQueueItem:yt,prependSignedBroadcastedQueueItem:Ee,handleQueueSign:Ms,handleQueueReject:js,handleSigningReject:Os,handleSigned:tn,rejectAllPending:Ps}=ic({wallet:t,maxQueueEntries:160,addLog:Q,kasPriceUsd:Number((W==null?void 0:W.priceUsd)||0),setTab:m,receiptRetryBaseMs:2e3,receiptRetryMaxMs:3e4,receiptTimeoutMs:48e4,receiptMaxAttempts:18,receiptPollIntervalMs:1200,receiptPollBatchSize:2}),{settleTreasuryFeePayout:Ot,attachCombinedTreasuryOutput:Ks}=_c({enabled:bt,treasuryFeeKas:$e,treasuryAddress:Lr,walletAddress:t==null?void 0:t.address,walletProvider:t==null?void 0:t.provider,kasPriceUsd:Number((W==null?void 0:W.priceUsd)||0),maxQueueEntries:160,addLog:Q,setQueue:xt,sendWalletTransfer:it,receiptBackoffMs:pr});p.useEffect(()=>{z(Kn(ft,O))},[O]),p.useEffect(()=>{V(!1);const E=vs(b);E?(E.status&&D(E.status),E.execMode&&Mr.some(J=>J.v===E.execMode)?ae(E.execMode):ae(e.execMode||"manual"),typeof E.liveExecutionArmed=="boolean"?ce(E.liveExecutionArmed):ce(Sr),xt(Array.isArray(E.queue)?E.queue.slice(0,160):[]),se(Array.isArray(E.log)&&E.log.length>0?E.log.slice(0,320):Tr(e.name)),F(Array.isArray(E.decisions)?E.decisions.slice(0,120):[]),Ke(Array.isArray(E.marketHistory)?E.marketHistory.slice(-240):[]),Ae(Number.isFinite(E.nextAutoCycleAt)?Math.max(Date.now()+1e3,Number(E.nextAutoCycleAt)):Date.now()+_)):(D("RUNNING"),ae(e.execMode||"manual"),ce(Sr),xt([]),F([]),Ke([]),se(Tr(e.name)),Ae(Date.now()+_)),V(!0)},[e.execMode,e.name,_,b,120,320,160]),p.useEffect(()=>{if(!$)return;const E=setTimeout(()=>{Ea(b,{status:T,execMode:M,liveExecutionArmed:Y,queue:ze,log:K,decisions:h,marketHistory:Se,nextAutoCycleAt:pe})},250);return()=>clearTimeout(E)},[h,M,Y,K,Se,pe,ze,$,b,T]),p.useEffect(()=>{if(typeof window>"u")return;const E=()=>we(window.innerWidth);return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),p.useEffect(()=>{T==="RUNNING"&&Ae(Date.now()+_)},[T,_]);const Ne=Be<760,St=Be<1024,Us=p.useMemo(()=>Ne?"1fr":St?"repeat(2,1fr)":"repeat(4,1fr)",[Ne,St]),$s=St?"1fr":"2fr 1fr",Fs=St?"1fr":"1fr 1fr",Et=e.risk==="low"?.4:e.risk==="medium"?.65:.85,rn=p.useMemo(()=>{const E=Array.isArray(r)&&r.length>0?r:[e],J=new Map;for(const de of E){const C=String((de==null?void 0:de.agentId)||(de==null?void 0:de.name)||"").trim();C&&J.set(C,de)}return Array.from(J.values())},[e,r]),{portfolioConfig:Bs,portfolioSummary:zs,activePortfolioRow:Le,patchPortfolioConfig:Ws,patchPortfolioAgentOverride:Gs,refreshPortfolioPeers:Vs}=hc({portfolioScope:g,allAgents:rn,activeAgentId:e==null?void 0:e.agentId,walletAddress:t==null?void 0:t.address,walletKas:Number((W==null?void 0:W.walletKas)||0),activeDecisions:h,activeQueue:ze}),Ds=p.useMemo(()=>Ta({decisions:h,queue:ze,log:K,marketHistory:Se}),[h,ze,K,Se]),mr=String((e==null?void 0:e.strategyLabel)||(e==null?void 0:e.strategyTemplate)||"Custom"),{alertConfig:Hs,alertSaveBusy:qs,lastAlertResult:Ys,sendAlertEvent:Ye,patchAlertConfig:Xs,toggleAlertType:Qs,saveAlertConfig:Js,sendTestAlert:Zs}=Fa({alertScope:l,agentName:e==null?void 0:e.name,agentId:e==null?void 0:e.agentId,activeStrategyLabel:mr}),At=p.useCallback(async()=>{var E,J;if(!(k.current||T!=="RUNNING"||!$)){k.current=!0,X(!0);try{if(!W){Q({type:"ERROR",msg:"No live Kaspa data available. Reconnect feed before running cycle.",fee:null});return}Ae(Date.now()+_),Q({type:"DATA",msg:`Kaspa DAG snapshot: DAA ${((E=W==null?void 0:W.dag)==null?void 0:E.daaScore)||"â€”"} Â· Wallet ${(W==null?void 0:W.walletKas)||"â€”"} KAS`,fee:null});const de=pa(ft,O);if(z(de),de.locked){m("billing"),Q({type:"SYSTEM",msg:`Daily free cycle quota reached (${de.used}/${de.limit}). Upgrade required for additional runs.`,fee:null});return}const C=await na(e,W||{},{history:Se}),Ue=String((C==null?void 0:C.decision_source)||"ai"),Pt=String(((J=C==null?void 0:C.quant_metrics)==null?void 0:J.regime)||"NA");Ft&&!["ACCUMULATE","HOLD"].includes(C.action)&&(C.action="HOLD",C.rationale=`${String(C.rationale||"")} Execution constrained by accumulate-only mode.`.trim());const co=Date.now();F(Me=>[{ts:co,dec:C,kasData:W,source:Ue},...Me].slice(0,120)),Q({type:"AI",msg:`${C.action} Â· Conf ${C.confidence_score} Â· Kelly ${(C.kelly_fraction*100).toFixed(1)}% Â· Monte Carlo ${C.monte_carlo_win_pct}% win Â· regime:${Pt} Â· source:${Ue} Â· ${(C==null?void 0:C.engine_latency_ms)||0}ms`,fee:.12}),C!=null&&C.quant_metrics&&Q({type:"DATA",msg:`Quant core â†’ samples ${C.quant_metrics.sample_count??"â€”"} Â· edge ${C.quant_metrics.edge_score??"â€”"} Â· vol ${C.quant_metrics.ewma_volatility??"â€”"} Â· dataQ ${C.quant_metrics.data_quality_score??"â€”"}`,fee:null}),(Ue==="fallback"||Ue==="quant-core")&&(Q({type:"SYSTEM",msg:`Local quant decision active (${(C==null?void 0:C.decision_source_detail)||"ai endpoint unavailable"}). Auto-approve uses same guardrails; AI overlay unavailable or bypassed.`,fee:null}),/ai_|timeout|endpoint|transport|request/i.test(String((C==null?void 0:C.decision_source_detail)||""))&&Ye({type:"ai_outage",key:`ai_outage:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} AI overlay unavailable`,message:`Quant core fallback active. detail=${String((C==null?void 0:C.decision_source_detail)||"n/a")}`,severity:"warn",meta:{decision_source:Ue,regime:Pt}}));const lo=C.confidence_score>=xn,uo=C.risk_score<=Et,fo=Number((W==null?void 0:W.walletKas)||0),po=bt&&(t==null?void 0:t.provider)!=="demo"&&$e>0&&ne.supportsNativeMultiOutput(String((t==null?void 0:t.provider)||"")),mn=bt&&(t==null?void 0:t.provider)!=="demo"&&$e>0?po?$e:$e+nt:0,gn=Math.max(0,fo-It-nt-mn),mo=Ce&&!be&&(t==null?void 0:t.provider)!=="demo";if(!uo)Q({type:"VALID",msg:`Risk gate FAILED â€” score ${C.risk_score} > ${Et} ceiling`,fee:null}),Q({type:"EXEC",msg:"BLOCKED by risk gate",fee:.03}),Ye({type:"risk_event",key:`risk_gate:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} risk gate blocked cycle`,message:`Risk score ${C.risk_score} exceeded ceiling ${Et}. action=${C.action} regime=${Pt}`,severity:"warn",meta:{risk_score:C.risk_score,risk_ceiling:Et,regime:Pt}});else if(!lo)Q({type:"VALID",msg:`Confidence ${C.confidence_score} < ${xn} threshold`,fee:null}),Q({type:"EXEC",msg:"HOLD â€” confidence gate enforced",fee:.08});else if(C.action==="ACCUMULATE"&&gn<=0)Q({type:"VALID",msg:`Insufficient spendable balance after reserve (${It} KAS), network fee (${nt} KAS), and treasury payout reserve (${mn.toFixed(4)} KAS).`,fee:null}),Q({type:"EXEC",msg:"HOLD â€” waiting for available balance",fee:.03});else if(Q({type:"VALID",msg:`Risk OK (${C.risk_score}) Â· Conf OK (${C.confidence_score}) Â· Kelly ${(C.kelly_fraction*100).toFixed(1)}%`,fee:null}),M==="notify")Q({type:"EXEC",msg:`NOTIFY mode active â€” ${C.action} signal recorded, no transaction broadcast.`,fee:.01});else if(!Y||!mo){const Me=Y?"network feed or wallet provider is not execution-ready":"live execution is disarmed";Q({type:"EXEC",msg:`Signal generated (${C.action}) but no transaction broadcast because ${Me}.`,fee:.01})}else if(C.action!=="HOLD"){const Me=Number(C.capital_allocation_kas||0),_r=Number((Le==null?void 0:Le.cycleCapKas)||0),xr=C.action==="ACCUMULATE"&&_r>0?Math.min(Me,_r):Me,Kt=C.action==="ACCUMULATE"?Math.min(xr,gn):Me;if(C.action==="ACCUMULATE"&&_r>0&&Me>xr&&Q({type:"SYSTEM",msg:`Shared portfolio allocator capped ${e.name} cycle from ${Me} to ${xr.toFixed(4)} KAS.`,fee:null}),Me>Kt&&Q({type:"SYSTEM",msg:`Clamped execution amount from ${Me} to ${Kt.toFixed(4)} KAS (available balance guardrail).`,fee:null}),!(Kt>0)){Q({type:"EXEC",msg:"HOLD â€” computed execution amount is zero",fee:.03});return}const go=ir({id:er(),type:C.action,metaKind:"action",from:t==null?void 0:t.address,to:tr,amount_kas:Number(Kt.toFixed(6)),purpose:C.rationale.slice(0,60),status:"pending",ts:Date.now(),dec:C}),ke=Ks(go);if(ke!=null&&ke.treasuryCombined&&Q({type:"TREASURY",msg:`Using combined treasury routing in primary transaction (${String((t==null?void 0:t.provider)||"wallet")}) Â· treasury ${Number((ke==null?void 0:ke.treasuryCombinedFeeKas)||$e).toFixed(6)} KAS`,fee:null}),M==="autonomous"&&ke.amount_kas<=P&&(Ue==="ai"||Ue==="hybrid-ai"))try{const at=await it(ke);Q({type:"EXEC",msg:`AUTO-APPROVED: ${C.action} Â· ${ke.amount_kas} KAS Â· txid: ${at.slice(0,16)}...`,fee:.08}),Q({type:"TREASURY",msg:`Fee split â†’ Pool: ${(Pe*Wr).toFixed(4)} KAS / Treasury: ${(Pe*De).toFixed(4)} KAS`,fee:Pe});const ho=Ee(ke,at);await Ot(ho,"auto")}catch(at){yt(ke),Q({type:"SIGN",msg:`Auto-approve fallback to manual queue: ${(at==null?void 0:at.message)||"wallet broadcast failed"}`,fee:null})}else Q({type:"SIGN",msg:`Action queued for wallet signature: ${C.action} Â· ${ke.amount_kas} KAS`,fee:null}),yt(ke)}else Q({type:"EXEC",msg:"HOLD â€” no action taken",fee:.08})}catch(de){const C=ur(de,{domain:"system"});Q({type:"ERROR",msg:Dr(C),fee:null}),C.domain==="tx"&&C.code==="TX_BROADCAST_FAILED"&&te({type:"FAIL",reason:C.message})}finally{X(!1),k.current=!1}}},[Ft,120,Le,Q,e,P,_,M,W,Y,Ce,Se,be,yt,Ee,Et,$,it,Ot,Ye,T,te,O,t]);p.useEffect(()=>{if(T!=="RUNNING"||!$)return;const E=setInterval(()=>{k.current||B||!Ce||be||Date.now()<pe||(Ae(Date.now()+_),At())},1e3);return()=>clearInterval(E)},[T,B,Ce,be,pe,_,At,$]),p.useEffect(()=>{var de,C,Ue;const E=String(((Ue=(C=(de=h[0])==null?void 0:de.dec)==null?void 0:C.quant_metrics)==null?void 0:Ue.regime)||"");if(!E)return;if(!j.current){j.current=E;return}if(j.current===E)return;const J=j.current;j.current=E,Ye({type:"regime_shift",key:`regime_shift:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${J}->${E}`,title:`${(e==null?void 0:e.name)||"Agent"} regime shift`,message:`Regime changed from ${J} to ${E}.`,severity:E==="RISK_OFF"?"warn":"info",meta:{previous_regime:J,regime:E}})},[e==null?void 0:e.agentId,e==null?void 0:e.name,h,Ye]);const eo=p.useCallback(async E=>{const J=tt?{...tt}:null;if(await tn(E),!J||(J==null?void 0:J.metaKind)==="treasury_fee")return;const de={...J,status:"signed",txid:E==null?void 0:E.txid};await Ot(de,"post-sign")},[tn,Ot,tt]),nn=()=>{te({type:"KILL"}),Q({type:"SYSTEM",msg:"KILL-SWITCH activated â€” agent suspended. All pending actions cancelled.",fee:null}),Ye({type:"risk_event",key:`kill_switch:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} kill-switch activated`,message:"Agent suspended and pending queue rejected.",severity:"danger",meta:{pending_rejected:ze.filter(E=>E.status==="pending").length}}),Ps()},gr=parseFloat(K.filter(E=>E.fee).reduce((E,J)=>E+(J.fee||0),0).toFixed(4)),to=Number((W==null?void 0:W.walletKas)||0),ro=bt&&(t==null?void 0:t.provider)!=="demo"&&$e>0&&ne.supportsNativeMultiOutput(String((t==null?void 0:t.provider)||"")),no=bt&&(t==null?void 0:t.provider)!=="demo"&&$e>0?ro?$e:$e+nt:0,so=Math.max(0,to-It-nt-no),hr=Ce&&!be&&(t==null?void 0:t.provider)!=="demo",sn=Math.max(0,Math.ceil((pe-Date.now())/1e3)),on=`${Math.floor(sn/60).toString().padStart(2,"0")}:${(sn%60).toString().padStart(2,"0")}`,We=(cn=h[0])==null?void 0:cn.dec,an=String((We==null?void 0:We.decision_source)||((dn=h[0])==null?void 0:dn.source)||"ai"),oo=Ut?_t?"STREAM LIVE":Re>0?`STREAM RETRY ${Re}`:"STREAM DOWN":"STREAM OFF",io=Ut?_t?o.ok:o.warn:o.dim,ao=[{k:"overview",l:"OVERVIEW"},{k:"portfolio",l:"PORTFOLIO"},{k:"intelligence",l:"INTELLIGENCE"},{k:"attribution",l:"ATTRIBUTION"},{k:"alerts",l:"ALERTS"},{k:"queue",l:`QUEUE${_e>0?` (${_e})`:""}`},{k:"treasury",l:"TREASURY"},{k:"wallet",l:"WALLET"},{k:"billing",l:"BILLING"},{k:"log",l:"LOG"},{k:"controls",l:"CONTROLS"}];return p.useEffect(()=>{_e<=0||Ye({type:"queue_pending",key:`queue_pending_count:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} has pending signatures`,message:`${_e} transaction${_e>1?"s":""} awaiting wallet approval.`,severity:_e>=3?"warn":"info",meta:{pending_count:_e}})},[e==null?void 0:e.agentId,e==null?void 0:e.name,_e,Ye]),n.jsxs("div",{style:{maxWidth:1460,margin:"0 auto",padding:Ne?"14px 14px 22px":"22px 24px 34px"},children:[tt&&n.jsx(Yr,{tx:tt,wallet:t,onSign:eo,onReject:Os}),n.jsxs("div",{style:{display:"flex",flexDirection:Ne?"column":"row",justifyContent:"space-between",alignItems:Ne?"stretch":"flex-start",marginBottom:16,gap:Ne?10:0},children:[n.jsxs("div",{children:[n.jsxs("div",{style:{fontSize:11,color:o.dim,letterSpacing:"0.1em",...y,marginBottom:2},children:["FORGE.OS / AGENT / ",e.name]}),n.jsx("div",{style:{fontSize:18,color:o.text,fontWeight:700,...y},children:e.name})]}),n.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:Ne?"flex-start":"flex-end"},children:[n.jsx(q,{text:T,color:T==="RUNNING"?o.ok:T==="PAUSED"?o.warn:o.danger,dot:!0}),n.jsx(q,{text:M.toUpperCase(),color:o.accent}),n.jsx(q,{text:String(mr).toUpperCase(),color:o.text}),n.jsx(q,{text:Y?"LIVE EXEC ON":"LIVE EXEC OFF",color:Y?o.ok:o.warn,dot:!0}),n.jsx(q,{text:Ft?"ACCUMULATE-ONLY":"MULTI-ACTION",color:Ft?o.ok:o.warn}),n.jsx(q,{text:((ln=t==null?void 0:t.provider)==null?void 0:ln.toUpperCase())||"WALLET",color:o.purple,dot:!0}),n.jsx(q,{text:`ENGINE ${String(ye).toUpperCase()}`,color:ye==="worker"?o.ok:o.warn}),n.jsx(q,{text:Ce?"DAG LIVE":"DAG OFFLINE",color:Ce?o.ok:o.danger,dot:!0}),n.jsx(q,{text:oo,color:io,dot:!0})]})]}),!!be&&n.jsxs("div",{style:{background:o.dLow,border:`1px solid ${o.danger}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[n.jsxs("span",{style:{fontSize:12,color:o.danger,...y},children:["Kaspa live feed error (poll fallback): ",be]}),n.jsx(re,{onClick:jt,disabled:me,size:"sm",variant:"ghost",children:me?"RECONNECTING...":"RECONNECT FEED"})]}),Y&&!hr&&n.jsx("div",{style:{background:o.wLow,border:`1px solid ${o.warn}40`,borderRadius:6,padding:"11px 16px",marginBottom:14},children:n.jsx("span",{style:{fontSize:12,color:o.warn,...y},children:"Live execution is armed but not ready. Require DAG live feed and a real wallet provider session (Kasware, Kaspium, Kastle, Ghost, Tangem bridge, or OneKey bridge)."})}),_e>0&&n.jsxs("div",{style:{background:o.wLow,border:`1px solid ${o.warn}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",alignItems:Ne?"flex-start":"center",justifyContent:"space-between",flexDirection:Ne?"column":"row",gap:Ne?8:0},children:[n.jsxs("span",{style:{fontSize:12,color:o.warn,...y},children:["âš  ",_e," transaction",_e>1?"s":""," awaiting wallet signature"]}),n.jsx(re,{onClick:()=>m("queue"),size:"sm",variant:"warn",children:"VIEW QUEUE"})]}),n.jsx("div",{style:{display:"flex",borderBottom:`1px solid ${o.border}`,marginBottom:18,overflowX:"auto"},children:ao.map(E=>n.jsx("button",{"data-testid":`dashboard-tab-${E.k}`,onClick:()=>m(E.k),style:{background:"none",border:"none",borderBottom:`2px solid ${U===E.k?o.accent:"transparent"}`,color:U===E.k?o.accent:o.dim,padding:"7px 14px",fontSize:11,cursor:"pointer",letterSpacing:"0.08em",...y,marginBottom:-1,whiteSpace:"nowrap",transition:"color 0.15s"},children:E.l},E.k))}),U==="overview"&&n.jsxs("div",{children:[n.jsx("div",{style:{display:"grid",gridTemplateColumns:Us,gap:10,marginBottom:12},children:[{l:"Wallet Balance",v:`${(W==null?void 0:W.walletKas)||e.capitalLimit} KAS`,s:Oe(t==null?void 0:t.address),c:o.accent},{l:"DAA Score",v:((fn=(un=W==null?void 0:W.dag)==null?void 0:un.daaScore)==null?void 0:fn.toLocaleString())||"â€”",s:"Kaspa DAG height",c:o.text},{l:"Pending Signatures",v:_e,s:"In action queue",c:_e>0?o.warn:o.dim},{l:"Total Protocol Fees",v:`${gr} KAS`,s:`${(gr*De).toFixed(4)} KAS â†’ treasury`,c:o.text}].map(E=>n.jsxs(Z,{p:14,children:[n.jsx(oe,{children:E.l}),n.jsx("div",{style:{fontSize:18,color:E.c,fontWeight:700,...y,marginBottom:2},children:E.v}),n.jsx("div",{style:{fontSize:11,color:o.dim},children:E.s})]},E.l))}),n.jsxs(Z,{p:16,style:{marginBottom:12},children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,flexWrap:"wrap",marginBottom:8},children:[n.jsx(oe,{children:"Mission Control"}),n.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[n.jsx(q,{text:xe.toUpperCase(),color:Nc(xe)}),n.jsx(q,{text:T,color:T==="RUNNING"?o.ok:o.warn,dot:!0}),n.jsx(q,{text:M.toUpperCase(),color:o.accent}),n.jsx(q,{text:Y?"EXEC ARMED":"EXEC SAFE",color:Y?o.ok:o.warn,dot:!0}),n.jsx(q,{text:`AUTO ${on}`,color:T==="RUNNING"?o.ok:o.dim}),n.jsx(q,{text:`SOURCE ${an.toUpperCase()}`,color:Ic(an)}),n.jsx(q,{text:`QUOTA ${S.used}/${S.limit}`,color:S.locked?o.danger:o.dim})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:St?"1fr":"1fr 1fr 1fr 1fr",gap:8,marginBottom:10},children:[n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Spendable Balance"}),n.jsxs("div",{style:{fontSize:13,color:o.ok,fontWeight:700,...y},children:[so.toFixed(4)," KAS"]})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Last Decision"}),n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y},children:(We==null?void 0:We.action)||"â€”"})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Capital / Cycle"}),n.jsxs("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y},children:[e.capitalLimit," KAS"]})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Portfolio Cycle Cap"}),n.jsx("div",{style:{fontSize:13,color:Le!=null&&Le.cycleCapKas?o.ok:o.dim,fontWeight:700,...y},children:Le!=null&&Le.cycleCapKas?`${Le.cycleCapKas} KAS`:"â€”"})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Execution Readiness"}),n.jsx("div",{style:{fontSize:13,color:hr?o.ok:o.warn,fontWeight:700,...y},children:hr?"READY":"NOT READY"})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"KAS Price (USD)"}),n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y},children:Number((W==null?void 0:W.priceUsd)||0)>0?`$${Number(W.priceUsd).toFixed(6)}`:"â€”"})]}),n.jsxs("div",{style:{background:o.s2,border:`1px solid ${o.border}`,borderRadius:6,padding:"10px 12px"},children:[n.jsx("div",{style:{fontSize:10,color:o.dim,...y,marginBottom:4},children:"Quant Samples"}),n.jsx("div",{style:{fontSize:13,color:o.text,fontWeight:700,...y},children:((pn=We==null?void 0:We.quant_metrics)==null?void 0:pn.sample_count)??Se.length??0})]})]}),n.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx(Fe,{href:`${ut}/addresses/${t==null?void 0:t.address}`,label:"WALLET EXPLORER â†—"}),n.jsx(Fe,{href:`${ut}/addresses/${tr}`,label:"VAULT EXPLORER â†—"})]})]}),n.jsx("div",{style:{marginBottom:12},children:n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Performance"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading performance chart..."})]}),children:n.jsx(Ec,{decisions:h,kpiTarget:e.kpiTarget})})}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:$s,gap:12},children:[n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Agent Configuration"}),[["Strategy",mr],["Strategy Class",String((e==null?void 0:e.strategyClass)||"custom").toUpperCase()],["Risk",e.risk.toUpperCase()],["Capital / Cycle",`${e.capitalLimit} KAS`],["Portfolio Target",`${(e==null?void 0:e.portfolioAllocationPct)||"â€”"}%`],["Risk Budget Weight",String((e==null?void 0:e.riskBudgetWeight)||"1.0")],["Exec Mode",M.toUpperCase()],["Auto-Approve â‰¤",`${P} KAS`],["Horizon",`${e.horizon} days`],["KPI Target",`${e.kpiTarget}% ROI`]].map(([E,J])=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${o.border}`},children:[n.jsx("span",{style:{fontSize:12,color:o.dim,...y},children:E}),n.jsx("span",{style:{fontSize:12,color:o.text,...y},children:J})]},E))]}),n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Actions"}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[n.jsx(re,{onClick:At,disabled:B||T!=="RUNNING",style:{padding:"10px 0"},children:B?"PROCESSING...":"RUN QUANT CYCLE"}),n.jsx(re,{onClick:jt,disabled:me,variant:"ghost",style:{padding:"9px 0"},children:me?"FETCHING DAG...":Ce?"REFRESH KASPA DATA":Ut?"RECONNECT STREAM/DATA":"RECONNECT KASPA FEED"}),n.jsx(re,{onClick:()=>ce(E=>!E),variant:Y?"warn":"primary",style:{padding:"9px 0"},children:Y?"DISARM LIVE EXECUTION":"ARM LIVE EXECUTION"}),n.jsxs(re,{onClick:()=>m("queue"),variant:"ghost",style:{padding:"9px 0"},children:["ACTION QUEUE ",_e>0?`(${_e})`:""]}),S.locked&&n.jsx(re,{onClick:()=>{rr?window.open(rr,"_blank","noopener,noreferrer"):m("billing")},variant:"warn",style:{padding:"9px 0"},children:"UPGRADE TO CONTINUE"}),n.jsx(re,{onClick:()=>te({type:T==="RUNNING"?"PAUSE":"RESUME"}),variant:"ghost",style:{padding:"9px 0"},children:T==="RUNNING"?"PAUSE":"RESUME"}),n.jsx(re,{onClick:nn,variant:"danger",style:{padding:"9px 0"},children:"KILL-SWITCH"})]})]})]})]}),U==="portfolio"&&n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Portfolio"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading portfolio allocator..."})]}),children:n.jsx(kc,{agents:rn,activeAgentId:s||(e==null?void 0:e.agentId),walletKas:(W==null?void 0:W.walletKas)||0,summary:zs,config:Bs,onConfigPatch:Ws,onAgentOverridePatch:Gs,onSelectAgent:i,onRefresh:Vs})}),U==="intelligence"&&n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Intelligence"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading intelligence panel..."})]}),children:n.jsx(Ac,{decisions:h,loading:B,onRun:At})}),U==="attribution"&&n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Attribution"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading attribution panel..."})]}),children:n.jsx(Tc,{summary:Ds})}),U==="alerts"&&n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Alerts"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading alerts panel..."})]}),children:n.jsx(vc,{config:Hs,onPatch:Xs,onToggleType:Qs,onSave:Js,onTest:Zs,saving:qs,lastResult:Ys})}),U==="queue"&&n.jsx(xc,{queue:ze,wallet:t,onSign:Ms,onReject:js}),U==="treasury"&&n.jsx(p.Suspense,{fallback:n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Treasury"}),n.jsx("div",{style:{fontSize:12,color:o.dim},children:"Loading treasury panel..."})]}),children:n.jsx(bc,{log:K,agentCapital:e.capitalLimit})}),U==="wallet"&&n.jsx(Sc,{agent:e,wallet:t}),U==="billing"&&n.jsx(yc,{usage:S}),U==="log"&&n.jsxs(Z,{p:0,children:[n.jsxs("div",{style:{padding:"12px 18px",borderBottom:`1px solid ${o.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs("span",{style:{fontSize:11,color:o.dim,...y},children:[K.length," entries Â· ",gr," KAS fees"]}),n.jsx(re,{onClick:At,disabled:B||T!=="RUNNING",size:"sm",children:B?"...":"RUN CYCLE"})]}),n.jsx("div",{style:{maxHeight:520,overflowY:"auto"},children:K.map((E,J)=>n.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ne?"74px 58px 1fr":"92px 72px 1fr 80px",gap:10,padding:"8px 18px",borderBottom:`1px solid ${o.border}`,alignItems:"center"},children:[n.jsx("span",{style:{fontSize:11,color:o.dim,...y},children:is(E.ts)}),n.jsx("span",{style:{fontSize:11,color:oa[E.type]||o.dim,fontWeight:700,...y},children:E.type}),n.jsx("span",{style:{fontSize:12,color:o.text,...y,lineHeight:1.4},children:E.msg}),!Ne&&n.jsx("span",{style:{fontSize:11,color:o.dim,textAlign:"right",...y},children:E.fee!=null?`${E.fee} KAS`:"â€”"})]},J))})]}),U==="controls"&&n.jsxs("div",{style:{display:"grid",gridTemplateColumns:Fs,gap:14},children:[n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Execution Mode"}),Mr.map(E=>{const J=M===E.v;return n.jsxs("div",{onClick:()=>ae(E.v),style:{padding:"12px 14px",borderRadius:4,marginBottom:8,cursor:"pointer",border:`1px solid ${J?o.accent:o.border}`,background:J?o.aLow:o.s2,transition:"all 0.15s"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:3},children:[n.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:J?o.accent:o.muted,flexShrink:0}}),n.jsx("span",{style:{fontSize:12,color:J?o.accent:o.text,fontWeight:700,...y},children:E.l})]}),n.jsx("div",{style:{fontSize:11,color:o.dim,marginLeft:20},children:E.desc})]},E.v)})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[n.jsxs(Z,{p:18,children:[n.jsx(oe,{children:"Agent Controls"}),n.jsxs("div",{style:{fontSize:11,color:o.dim,...y,marginBottom:10},children:["Auto cycle cadence: every ",nr,"s Â· Next cycle in ",on]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[n.jsx(re,{onClick:()=>te({type:T==="RUNNING"?"PAUSE":"RESUME"}),variant:"ghost",style:{padding:"10px 0"},children:T==="RUNNING"?"PAUSE AGENT":"RESUME AGENT"}),n.jsx(re,{onClick:()=>ce(E=>!E),variant:Y?"warn":"primary",style:{padding:"10px 0"},children:Y?"DISARM LIVE EXECUTION":"ARM LIVE EXECUTION"}),n.jsx(re,{onClick:()=>m("wallet"),variant:"ghost",style:{padding:"10px 0"},children:"MANAGE WALLET"}),n.jsx(re,{onClick:nn,variant:"danger",style:{padding:"10px 0"},children:"ACTIVATE KILL-SWITCH"})]})]}),n.jsxs(Z,{p:18,children:[n.jsxs(oe,{children:["Active Risk Limits â€” ",e.risk.toUpperCase()]}),[["Max Single Exposure",e.risk==="low"?"5%":e.risk==="medium"?"10%":"20%",o.warn],["Drawdown Halt",e.risk==="low"?"-8%":e.risk==="medium"?"-15%":"-25%",o.danger],["Confidence Floor","0.75",o.dim],["Kelly Cap",e.risk==="low"?"10%":e.risk==="medium"?"20%":"40%",o.warn],["Auto-Approve â‰¤",`${P} KAS`,o.accent]].map(([E,J,de])=>n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${o.border}`},children:[n.jsx("span",{style:{fontSize:12,color:o.dim,...y},children:E}),n.jsx("span",{style:{fontSize:12,color:de,fontWeight:700,...y},children:J})]},E))]})]})]})]})}function Nc(e){return String(e||"").toLowerCase().includes("mainnet")?o.warn:o.ok}function Ic(e){const t=String(e||"").toLowerCase();return t==="hybrid-ai"?o.accent:t==="quant-core"?o.text:t==="fallback"?o.warn:o.ok}function Cc(){const[e,t]=p.useState(null),[r,s]=p.useState("create"),[i,a]=p.useState([]),[d,c]=p.useState(""),[u,f]=p.useState(!1),[x,A]=p.useState(typeof window<"u"?window.innerWidth:1280),N=g=>{t(g)},w=g=>{a(l=>[...l.filter(k=>(k==null?void 0:k.agentId)!==(g==null?void 0:g.agentId)),g].slice(-24)),c(String((g==null?void 0:g.agentId)||"")),s("dashboard")},I=p.useMemo(()=>i.find(g=>String(g==null?void 0:g.agentId)===String(d))||i[i.length-1]||null,[d,i]),v=fe==="mainnet",L=p.useMemo(()=>So.filter(g=>g.id==="mainnet"||g.id.startsWith("testnet")),[]),_=x<860,O=g=>{if(!(typeof window>"u"||u||g===fe||(e||i.length>0)&&!window.confirm("Switching networks will reset the current wallet session and agent state. Continue?"))){f(!0);try{window.localStorage.setItem("forgeos.network",g);const b=new URL(window.location.href);b.searchParams.set("network",g),window.location.assign(b.toString())}catch{f(!1)}}};return p.useEffect(()=>{if(typeof window>"u")return;const g=()=>A(window.innerWidth);return window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),e?n.jsxs("div",{className:"forge-shell",style:{color:o.text},children:[n.jsx(gs,{}),n.jsxs("div",{className:"forge-content",style:{minHeight:"100vh"},children:[n.jsxs("div",{className:"forge-topbar",style:{borderBottom:`1px solid ${o.border}`,padding:"12px clamp(14px, 2vw, 24px)",display:"flex",flexDirection:_?"column":"row",alignItems:_?"stretch":"center",justifyContent:"space-between",gap:_?10:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:14,justifyContent:_?"space-between":"flex-start"},children:[n.jsxs("div",{style:{fontSize:14,fontWeight:700,letterSpacing:"0.14em",...y},children:[n.jsx("span",{style:{color:o.accent},children:"FORGE"}),n.jsx("span",{style:{color:o.text},children:".OS"})]}),n.jsx("div",{style:{width:1,height:14,background:o.border}}),n.jsx("div",{style:{fontSize:10,color:o.dim,letterSpacing:"0.08em",...y},children:"AI-NATIVE FINANCIAL OS Â· KASPA"})]}),n.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:_?"flex-start":"flex-end"},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,border:`1px solid ${v?o.warn:o.ok}50`,background:v?o.wLow:o.oLow,borderRadius:6,padding:"4px 6px"},children:[n.jsx("span",{style:{fontSize:10,color:v?o.warn:o.ok,letterSpacing:"0.08em",...y},children:xe.toUpperCase()}),n.jsx("select",{"data-testid":"network-select",value:Rt.id,onChange:g=>O(g.target.value),disabled:u,style:{background:"transparent",color:o.text,border:`1px solid ${o.border}`,borderRadius:4,padding:"4px 8px",fontSize:10,letterSpacing:"0.05em",...y},title:"Switch runtime Kaspa network profile",children:L.map(g=>n.jsx("option",{value:g.id,style:{background:o.s1,color:o.text},children:g.label},g.id))})]}),n.jsx("button",{onClick:()=>s("create"),style:{background:r==="create"?o.s2:"none",border:`1px solid ${r==="create"?o.border:"transparent"}`,color:r==="create"?o.text:o.dim,padding:"5px 14px",borderRadius:4,fontSize:11,cursor:"pointer",...y},children:"NEW AGENT"}),i.map(g=>{const l=String((I==null?void 0:I.agentId)||"")===String((g==null?void 0:g.agentId)||"");return n.jsx("button",{onClick:()=>{c(String((g==null?void 0:g.agentId)||"")),s("dashboard")},style:{background:l&&r==="dashboard"?o.s2:"none",border:`1px solid ${l&&r==="dashboard"?o.accent:"transparent"}`,color:l?o.accent:o.dim,padding:"5px 10px",borderRadius:4,fontSize:11,cursor:"pointer",maxWidth:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",...y},title:String((g==null?void 0:g.name)||"Agent"),children:String((g==null?void 0:g.name)||"AGENT")},String((g==null?void 0:g.agentId)||(g==null?void 0:g.name)||Math.random()))}),n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"5px 12px",border:`1px solid ${o.border}`,borderRadius:4},children:[n.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:(e==null?void 0:e.provider)==="demo"?o.warn:o.ok}}),n.jsx("span",{style:{fontSize:10,color:o.dim,letterSpacing:"0.08em",...y},children:Oe(e==null?void 0:e.address)})]}),n.jsx(re,{onClick:()=>{t(null),a([]),c(""),s("create")},variant:"ghost",size:"sm",children:"DISCONNECT"})]})]}),r==="create"||!I?n.jsx(xi,{wallet:e,onComplete:w}):n.jsx(wc,{agent:I,agents:i,activeAgentId:d,onSelectAgent:g=>{c(g),s("dashboard")},wallet:e})]})]}):n.jsx(ci,{onConnect:N})}class Rc extends os.Component{constructor(r){super(r);Xe(this,"resetApp",()=>{if(typeof window>"u")return;const r=new URL(window.location.href);r.searchParams.set("_recover",Date.now().toString()),window.location.replace(r.toString())});Xe(this,"clearLocalStateAndReload",()=>{if(!(typeof window>"u")){try{const r=Object.keys(window.localStorage);for(const s of r)s.startsWith("forgeos.")&&window.localStorage.removeItem(s)}catch{}this.resetApp()}});this.state={hasError:!1,message:""}}static getDerivedStateFromError(r){return{hasError:!0,message:(r==null?void 0:r.message)||"Unknown runtime error"}}componentDidCatch(r){console.error("ForgeOS runtime crash:",r)}render(){return this.state.hasError?n.jsxs("div",{style:{minHeight:"100vh",background:"#0a0a0a",color:"#f5f5f5",padding:24,fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace"},children:[n.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:8},children:"ForgeOS runtime error"}),n.jsx("div",{style:{fontSize:12,opacity:.8,marginBottom:12},children:"The app encountered an unexpected error. Reload, then check console/network config if this continues."}),n.jsx("pre",{style:{whiteSpace:"pre-wrap",background:"#111",border:"1px solid #222",padding:12,borderRadius:6},children:this.state.message}),n.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,flexWrap:"wrap"},children:[n.jsx("button",{type:"button",onClick:this.resetApp,style:{border:"1px solid #3a4e66",background:"#111826",color:"#d7e4f7",borderRadius:8,padding:"8px 12px",cursor:"pointer"},children:"Retry App"}),n.jsx("button",{type:"button",onClick:this.clearLocalStateAndReload,style:{border:"1px solid #5a3340",background:"#241018",color:"#ffd5dc",borderRadius:8,padding:"8px 12px",cursor:"pointer"},children:"Clear ForgeOS Session"})]})]}):this.props.children}}window.__FORGEOS_BOOTED__=!0;document.documentElement.setAttribute("data-forgeos-booted","1");window.__FORGEOS_RENDERED__||(window.__FORGEOS_RENDERED__=!0,yo.createRoot(document.getElementById("root")).render(n.jsx(os.StrictMode,{children:n.jsx(Rc,{children:n.jsx(Cc,{})})})));export{Wr as A,q as B,Z as C,Fe as E,He as I,oe as L,De as T,o as a,re as b,Pc as c,is as d,Lr as e,Oc as f,$e as g,bt as h,ut as i,oa as j,y as m};
