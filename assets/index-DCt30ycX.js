const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kaspa_wasm-DT2JbAhf.js","assets/react-vendor-D4yGots9.js","assets/PerfChart-Cilx-QcO.js","assets/recharts-vendor-DS4t48dv.js","assets/d3-render-vendor-RkpHolfk.js","assets/d3-scale-vendor-BynLqmir.js","assets/AgentOverviewPanel--lUCogPt.js","assets/IntelligencePanel-B4h2_Z87.js","assets/PortfolioPanel-DN_uDEIu.js","assets/PnlAttributionPanel-CgGgsQt2.js","assets/AlertsPanel-6uGSHxG5.js","assets/QuantAnalyticsPanel-ETxmzSwJ.js"])))=>i.map(i=>d[i]);
var oc=Object.defineProperty;var ac=(e,t,s)=>t in e?oc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var kt=(e,t,s)=>ac(e,typeof t!="symbol"?t+"":t,s);import{j as r,r as g,R as To,a as cc}from"./react-vendor-D4yGots9.js";import{R as ci,L as li,a as di,T as ui,b as lc}from"./recharts-vendor-DS4t48dv.js";import"./d3-render-vendor-RkpHolfk.js";import"./d3-scale-vendor-BynLqmir.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const Ot=[{id:"mainnet",label:"Kaspa Mainnet",aliases:["mainnet","kaspa_mainnet","kaspa-mainnet","mainnet-11","mainnet11"],addressPrefixes:["kaspa"]},{id:"testnet-10",label:"Kaspa Testnet 10",aliases:["testnet","testnet10","testnet-10","tn10","kaspa_testnet_10","kaspa-testnet-10"],addressPrefixes:["kaspatest"]},{id:"testnet-11",label:"Kaspa Testnet 11",aliases:["testnet11","testnet-11","tn11","kaspa_testnet_11","kaspa-testnet-11"],addressPrefixes:["kaspatest"]},{id:"testnet-12",label:"Kaspa Testnet 12",aliases:["testnet12","testnet-12","tn12","kaspa_testnet_12","kaspa-testnet-12"],addressPrefixes:["kaspatest"]},{id:"devnet",label:"Kaspa Devnet",aliases:["devnet","kaspadev","kaspa_devnet","kaspa-devnet"],addressPrefixes:["kaspadev"]},{id:"simnet",label:"Kaspa Simnet",aliases:["simnet","kaspasim","kaspa_simnet","kaspa-simnet"],addressPrefixes:["kaspasim"]}],dc=Ot;function fi(e){return String(e||"").trim().toLowerCase().replace(/_/g,"-")}function uc(e){const t=fi(String(e??""));if(!t)return null;const s=Ot.find(i=>i.aliases.some(o=>fi(o)===t));return s||(["livenet","live","main","0"].includes(t)?Ot[0]:["test","testnet","test-net","tn","1"].includes(t)?Ot[1]:["2","tn11"].includes(t)?Ot[2]:["3","tn12"].includes(t)?Ot[3]:null)}function Cr(e){return uc(e||"mainnet")||Ot[0]}function ns(e,t){const s=e.indexOf(":");if(s<1)return!1;const i=e.slice(0,s).toLowerCase();return t.addressPrefixes.includes(i)}const Xt=(e,t=4)=>parseFloat(e||0).toFixed(t),Co=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Op=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ht=e=>e?`${e.slice(0,18)}...${e.slice(-6)}`:"â€”",Kp=(e,t,s)=>Math.min(s,Math.max(t,e)),Jr=()=>Math.random().toString(36).slice(2,10),fc=/^[qpzry9x8gf2tvdw0s3jn54khce6mua7l]+$/i,wo=["kaspa","kaspatest","kaspadev","kaspasim"],er=(e,t=wo)=>{const s=String(e||"").trim().toLowerCase(),i=s.indexOf(":");if(i<=0||i===s.length-1)return!1;const o=s.slice(0,i),a=s.slice(i+1);return!t.map(l=>l.toLowerCase()).includes(o)||a.length<61||a.length>63?!1:fc.test(a)},ut=(e,t=wo)=>{const s=String(e||"").trim();if(!er(s,t))throw new Error(`Invalid Kaspa address for allowed prefixes: ${t.join(", ")}`);const i=s.toLowerCase(),o=i.indexOf(":"),a=i.slice(0,o),l=i.slice(o+1);return`${a}:${l}`},pc={VITE_KAS_API:"https://api-tn10.kaspa.org",VITE_KAS_API_FALLBACKS:"https://api.kaspa.org",VITE_KAS_ENFORCE_WALLET_NETWORK:"true",VITE_KAS_EXPLORER:"https://explorer-tn10.kaspa.org",VITE_KAS_NETWORK:"kaspa_testnet_10",VITE_KAS_NETWORK_LABEL:"Kaspa Testnet 10",VITE_KAS_WS_URL:""},de=pc;function mc(){if(typeof window>"u")return"";const e=new URLSearchParams(window.location.search).get("network");if(e)return e;try{window.localStorage.getItem("forgeos.network")&&window.localStorage.removeItem("forgeos.network")}catch{}return""}const ko=mc(),gc=ko||de.VITE_KAS_NETWORK,Ar=Cr(gc),Ie=Ar.id,nr=Ie.startsWith("testnet"),Ct=ko?Ar.label:de.VITE_KAS_NETWORK_LABEL,et=Ar.addressPrefixes;function hc(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function ss(e){return String(e||"").trim().replace(/\/+$/,"")}function fn(e,t,s){return String((nr?t:e)||s||"").trim()}const xc=fn(de.VITE_KAS_API_MAINNET,de.VITE_KAS_API_TESTNET,de.VITE_KAS_API),pn=ss(xc||(nr?"https://api-tn10.kaspa.org":"https://api.kaspa.org")),yc=fn(de.VITE_KAS_API_FALLBACKS_MAINNET,de.VITE_KAS_API_FALLBACKS_TESTNET,de.VITE_KAS_API_FALLBACKS),Zr=hc(yc).map(e=>ss(e)).filter(e=>e&&e!==pn),_c=fn(de.VITE_KAS_EXPLORER_MAINNET,de.VITE_KAS_EXPLORER_TESTNET,de.VITE_KAS_EXPLORER),en=ss(_c||(nr?"https://explorer-tn10.kaspa.org":"https://explorer.kaspa.org")),En=fn(de.VITE_KAS_WS_URL_MAINNET,de.VITE_KAS_WS_URL_TESTNET,de.VITE_KAS_WS_URL),Sc=de.VITE_KASPIUM_DEEP_LINK_SCHEME||"kaspium://",vr=String(de.VITE_KAS_ENFORCE_WALLET_NETWORK).toLowerCase()!=="false",An=String(de.VITE_ACCUMULATE_ONLY||"true").toLowerCase()!=="false",pi=[pn,...Zr].map(e=>String(e||"").trim()).filter(Boolean),bc=new Set(pi).size!==pi.length;if(bc)throw new Error("Duplicate Kaspa API endpoints detected in VITE_KAS_API* configuration.");function sr(e,t,s){try{return ut(e,t)}catch{throw new Error(`Invalid ${s}. Expected prefixes: ${t.join(", ")}`)}}const Un="kaspa:qpv7fcvdlz6th4hqjtm9qkkms2dw0raem963x3hm8glu3kjgj7922vy69hv85",Ec=de.VITE_TREASURY_ADDRESS_MAINNET||Un,Ac=de.VITE_TREASURY_ADDRESS_TESTNET||"kaspatest:qpqz2vxj23kvh0m73ta2jjn2u4cv4tlufqns2eap8mxyyt0rvrxy6ejkful67",mn=sr(Ec,["kaspa"],"VITE_TREASURY_ADDRESS_MAINNET"),is=sr(Ac,["kaspatest"],"VITE_TREASURY_ADDRESS_TESTNET");if(mn!==Un)throw new Error(`Mainnet treasury address is pinned and must be ${Un}.`);const vc=de.VITE_ACCUMULATION_ADDRESS_MAINNET||mn,Tc=de.VITE_ACCUMULATION_ADDRESS_TESTNET||is,Cc=sr(vc,["kaspa"],"VITE_ACCUMULATION_ADDRESS_MAINNET"),wc=sr(Tc,["kaspatest"],"VITE_ACCUMULATION_ADDRESS_TESTNET"),kc=de.VITE_DEMO_ADDRESS_MAINNET||mn,Nc=de.VITE_DEMO_ADDRESS_TESTNET||is,Ic=sr(kc,["kaspa"],"VITE_DEMO_ADDRESS_MAINNET"),jc=sr(Nc,["kaspatest"],"VITE_DEMO_ADDRESS_TESTNET"),Rc=nr?jc:Ic,No=nr?is:mn,Io=nr?wc:Cc,dt=Number(de.VITE_FEE_RATE||.2),It=Number(de.VITE_TREASURY_SPLIT||.3),os=Number((1-It).toFixed(2)),ur=String(de.VITE_TREASURY_FEE_ONCHAIN_ENABLED||"true").toLowerCase()!=="false",xr=.5,Tt=.001,mi=.75,br=Number(de.VITE_FREE_CYCLES_PER_DAY||9999);String(de.VITE_BILLING_UPGRADE_URL||"").trim();String(de.VITE_BILLING_CONTACT||"").trim();const Er=Number(de.VITE_AUTO_CYCLE_SECONDS||120),gi=String(de.VITE_LIVE_EXECUTION_DEFAULT||"false").toLowerCase()==="true",gt=Math.max(1,Math.round(Number(de.VITE_PNL_REALIZED_MIN_CONFIRMATIONS||1)));function Mc(e,t){const s=String(e||"").trim();if(!s)return null;try{const i=JSON.parse(s);if(!i||typeof i!="object"||Array.isArray(i))throw new Error("Expected a JSON object.");return i}catch(i){throw new Error(`Invalid ${t}: ${String((i==null?void 0:i.message)||i||"json_parse_error")}`)}}const fr={base:gt,byAction:{REDUCE:Math.max(gt,gt+1),REBALANCE:Math.max(gt,gt+1)},byRisk:{HIGH:Math.max(gt,gt+1)},amountTiersKas:[]},pt=Mc(de.VITE_PNL_REALIZED_CONFIRMATION_POLICY_JSON,"VITE_PNL_REALIZED_CONFIRMATION_POLICY_JSON"),Lc=pt?{...fr,...pt,byAction:{...fr.byAction,...typeof pt.byAction=="object"&&!Array.isArray(pt.byAction)?pt.byAction:{}},byRisk:{...fr.byRisk,...typeof pt.byRisk=="object"&&!Array.isArray(pt.byRisk)?pt.byRisk:{}},amountTiersKas:Array.isArray(pt.amountTiersKas)?pt.amountTiersKas:fr.amountTiersKas}:fr,Pc=Math.max(0,Number(de.VITE_RECEIPT_CONSISTENCY_CONFIRM_TS_TOLERANCE_MS||15e3)),Oc=Math.max(0,Number(de.VITE_RECEIPT_CONSISTENCY_FEE_KAS_TOLERANCE||.001)),Kc=Math.max(0,Number(de.VITE_RECEIPT_CONSISTENCY_SLIPPAGE_KAS_TOLERANCE||.02)),vn=Math.max(2,Math.round(Number(de.VITE_RECEIPT_CONSISTENCY_REPEAT_ALERT_THRESHOLD||3))),Fc=Math.max(1,Math.round(Number(de.VITE_RECEIPT_CONSISTENCY_DEGRADE_MIN_CHECKS||6))),hi=Math.max(0,Math.min(100,Number(de.VITE_RECEIPT_CONSISTENCY_DEGRADE_MISMATCH_RATE_PCT||20))),$c=String(de.VITE_RECEIPT_CONSISTENCY_BLOCK_AUTO_APPROVE_ON_DEGRADED||"true").toLowerCase()!=="false",Vt=String(de.VITE_CALIBRATION_GUARDRAILS_ENABLED||"true").toLowerCase()!=="false",xi=Math.max(1,Math.round(Number(de.VITE_CALIBRATION_MIN_SAMPLES||12))),Wn=Math.max(0,Number(de.VITE_CALIBRATION_BRIER_WARN||.24)),yi=Math.max(Wn,Number(de.VITE_CALIBRATION_BRIER_CRITICAL||.34)),Hn=Math.max(0,Number(de.VITE_CALIBRATION_EV_CAL_ERROR_WARN_PCT||2)),_i=Math.max(Hn,Number(de.VITE_CALIBRATION_EV_CAL_ERROR_CRITICAL_PCT||5)),Vn=Math.max(0,Math.min(100,Number(de.VITE_CALIBRATION_REGIME_HIT_MIN_PCT||55))),Si=Math.max(0,Math.min(Vn,Number(de.VITE_CALIBRATION_REGIME_HIT_CRITICAL_PCT||46))),jo=Math.max(0,Math.min(1,Number(de.VITE_CALIBRATION_SIZE_MULTIPLIER_WARN||.85))),Ro=Math.max(0,Math.min(jo,Number(de.VITE_CALIBRATION_SIZE_MULTIPLIER_DEGRADED||.6))),Dc=Math.max(0,Math.min(Ro,Number(de.VITE_CALIBRATION_SIZE_MULTIPLIER_CRITICAL||.35))),bi=Math.max(0,Math.min(1,Number(de.VITE_CALIBRATION_AUTO_APPROVE_DISABLE_HEALTH_BELOW||.4))),Bc=Math.max(0,Math.min(.95,Number(de.VITE_CALIBRATION_AUTO_APPROVE_DISABLE_MIN_SIZE_REDUCTION_PCT||.1)));if(!Number.isFinite(dt)||dt<0)throw new Error("Invalid VITE_FEE_RATE. Expected a non-negative numeric value.");if(!Number.isFinite(It)||It<0||It>1)throw new Error("Invalid VITE_TREASURY_SPLIT. Expected a value between 0 and 1.");const mt=Number((dt*It).toFixed(6));String(de.VITE_HF_MODE||"false").toLowerCase();const Ei=15;if(!Number.isFinite(br)||br<1)throw new Error("Invalid VITE_FREE_CYCLES_PER_DAY. Expected an integer >= 1.");if(!Number.isFinite(Er)||Er<Ei)throw new Error(`Invalid VITE_AUTO_CYCLE_SECONDS. Expected a numeric value >= ${Ei}.`);if(!Number.isFinite(gt)||gt<1)throw new Error("Invalid VITE_PNL_REALIZED_MIN_CONFIRMATIONS. Expected an integer >= 1.");const n={bg:"#05070A",s1:"#0B1118",s2:"#101923",s3:"#16222F",border:"#213043",muted:"#32435A",accent:"#39DDB6",aLow:"#112C2A",text:"#EAF1F8",dim:"#8FA0B5",danger:"#FF5D7A",dLow:"#311520",warn:"#F7B267",wLow:"#322515",ok:"#39DDB6",oLow:"#112C2A",purple:"#8F7BFF"},f={fontFamily:"'IBM Plex Mono','SFMono-Regular',Menlo,Monaco,monospace"},ye=({children:e,p:t=16,style:s={},...i})=>r.jsx("div",{...i,style:{background:"linear-gradient(165deg, rgba(16,25,35,0.52) 0%, rgba(10,17,28,0.34) 52%, rgba(16,25,35,0.52) 100%)",border:"1px solid rgba(57,221,182,0.1)",borderRadius:14,padding:t,boxShadow:"0 18px 45px rgba(0,0,0,0.32), inset 0 1px 0 rgba(255,255,255,0.06)",backdropFilter:"blur(22px)",WebkitBackdropFilter:"blur(22px)",transition:"border-color 0.18s ease, box-shadow 0.18s ease, transform 0.18s ease",...s},children:e}),Ge=({children:e,color:t})=>r.jsx("div",{style:{fontSize:10,color:t||n.dim,letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:6,...f},children:e}),J=({text:e,color:t=n.accent,dot:s,...i})=>r.jsxs("span",{...i,style:{background:t+"18",color:t,border:`1px solid ${t}35`,borderRadius:6,padding:"3px 9px",fontSize:11,letterSpacing:"0.04em",...f,display:"inline-flex",alignItems:"center",gap:5,whiteSpace:"nowrap"},children:[s&&r.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:t,display:"inline-block"}}),e]}),_e=({children:e,onClick:t,variant:s="primary",disabled:i,style:o={},size:a="md",...l})=>{const c={primary:{bg:`linear-gradient(90deg, ${n.accent} 0%, #7BE9CF 100%)`,color:"#04110E",border:`1px solid ${n.accent}55`,shadow:"0 10px 24px rgba(57,221,182,0.26)"},ghost:{bg:"transparent",color:n.text,border:`1px solid ${n.border}`,shadow:"none"},danger:{bg:n.dLow,color:n.danger,border:`1px solid ${n.danger}55`,shadow:"none"},warn:{bg:n.wLow,color:n.warn,border:`1px solid ${n.warn}50`,shadow:"none"}}[s];return r.jsx("button",{...l,onClick:t,disabled:i,onMouseEnter:d=>{i||(d.currentTarget.style.transform="translateY(-1px)",d.currentTarget.style.filter="brightness(1.06)")},onMouseLeave:d=>{d.currentTarget.style.transform="translateY(0)",d.currentTarget.style.filter="brightness(1)"},onMouseDown:d=>{i||(d.currentTarget.style.transform="translateY(0) scale(0.995)")},onMouseUp:d=>{i||(d.currentTarget.style.transform="translateY(-1px) scale(1)")},style:{background:c.bg,color:c.color,border:c.border,borderRadius:10,padding:a==="sm"?"6px 12px":"10px 18px",fontSize:a==="sm"?11:12,cursor:i?"not-allowed":"pointer",opacity:i?.45:1,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",boxShadow:c.shadow,transition:"all 0.16s ease",...f,...o},children:e})},Be=({label:e,value:t,onChange:s,placeholder:i,type:o="text",hint:a,suffix:l})=>r.jsxs("div",{style:{marginBottom:16},children:[e&&r.jsx(Ge,{children:e}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{value:t,onChange:c=>s(c.target.value),type:o,placeholder:i,style:{width:"100%",background:n.s3,border:`1px solid ${n.border}`,borderRadius:10,color:n.text,padding:`10px ${l?"40px":"12px"} 10px 12px`,fontSize:12,...f,outline:"none",boxSizing:"border-box",transition:"border-color 0.16s ease, box-shadow 0.16s ease"},onFocus:c=>{c.target.style.borderColor=n.accent,c.target.style.boxShadow=`0 0 0 2px ${n.accent}22`},onBlur:c=>{c.target.style.borderColor=n.border,c.target.style.boxShadow="none"}}),l&&r.jsx("span",{style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",fontSize:11,color:n.dim,...f},children:l})]}),a&&r.jsx("div",{style:{fontSize:11,color:n.dim,marginTop:4},children:a})]}),Gn=({m:e=12})=>r.jsx("div",{style:{height:1,background:n.border,margin:`${e}px 0`}}),as=({href:e,label:t="â†—"})=>r.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:n.accent,...f,textDecoration:"none",border:`1px solid ${n.accent}25`,padding:"3px 9px",borderRadius:3},children:t});function Mo(){return r.jsxs("div",{className:"forge-atmosphere","aria-hidden":"true",children:[r.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--north"}),r.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--east"}),r.jsx("div",{className:"forge-atmosphere__aura forge-atmosphere__aura--south"}),r.jsx("div",{className:"forge-atmosphere__grid"}),r.jsxs("div",{className:"forge-atmosphere__rings",children:[r.jsx("span",{className:"forge-ring forge-ring--one"}),r.jsx("span",{className:"forge-ring forge-ring--two"}),r.jsx("span",{className:"forge-ring forge-ring--three"})]}),r.jsxs("div",{className:"forge-atmosphere__blips",children:[r.jsx("span",{className:"forge-blip forge-blip--a"}),r.jsx("span",{className:"forge-blip forge-blip--b"}),r.jsx("span",{className:"forge-blip forge-blip--c"})]})]})}const tn=Object.freeze({path:"m/44'/111'",account:0,chain:0,index:0});function Ai(e,t){const s=typeof e=="number"?e:Number(e);return!Number.isFinite(s)||s<0?t:Math.floor(s)}function zc(e){const t=String(e??"").trim();return t?t.startsWith("m")?t:`m/${t}`:tn.path}function Lo(e){return{path:zc(e==null?void 0:e.path),account:Ai(e==null?void 0:e.account,tn.account),chain:(e==null?void 0:e.chain)===1?1:0,index:Ai(e==null?void 0:e.index,tn.index)}}const Uc="modulepreload",Wc=function(e){return"/"+e},vi={},jt=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(s.map(d=>{if(d=Wc(d),d in vi)return;vi[d]=!0;const u=d.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Uc,u||(h.as="script"),h.crossOrigin="",h.href=d,c&&h.setAttribute("nonce",c),document.head.appendChild(h),u)return new Promise((v,A)=>{h.addEventListener("load",v),h.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return o.then(l=>{for(const c of l||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})},Hc="/assets/kaspa_wasm_bg-CtmpV7Oa.wasm";let Or=null,Kr=null;function Vc(e){var t,s,i,o;return e!=null&&e.Mnemonic?e:(t=e==null?void 0:e.default)!=null&&t.Mnemonic?e.default:(s=e==null?void 0:e.k)!=null&&s.Mnemonic?e.k:(o=(i=e==null?void 0:e.k)==null?void 0:i.default)!=null&&o.Mnemonic?e.k.default:e}async function Gc(){globalThis.__forgeosKaspaWasmBytes||(Kr||(Kr=(async()=>{const e=await fetch(Hc);if(!e.ok)throw new Error(`WASM_FETCH_FAILED: ${e.status} ${e.statusText}`);const t=await e.arrayBuffer();globalThis.__forgeosKaspaWasmBytes=new Uint8Array(t)})().catch(e=>{throw Kr=null,e})),await Kr)}async function qc(){return Or||(Or=(async()=>{try{await Gc();const e=await jt(()=>import("./kaspa_wasm-DT2JbAhf.js").then(i=>i.k),__vite__mapDeps([0,1])),t=Vc(e),s=t.default||t.init;if(typeof s=="function")try{await s()}catch{}return t}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`KASPA_WASM_INIT_FAILED: ${t}`)}})().catch(e=>{throw Or=null,e})),Or}const Po="forgeos.managed.wallet.v1",Yc=new Set([12,15,18,21,24]),Oo=qc;function Ko(e){return e.trim().toLowerCase().split(/\s+/).join(" ")}function Fo(e){const t=e.trim().split(/\s+/).filter(Boolean);if(!Yc.has(t.length))throw new Error(`Seed phrase must be a valid BIP39 length (12/15/18/21/24 words; got ${t.length}).`)}async function $o(e,t){const s=await Oo(),{Mnemonic:i,XPrv:o}=s,l=new i(e).toSeed(t.mnemonicPassphrase||void 0),c=new o(l);return{kaspa:s,masterXPrv:c}}function Xc(e,t){try{return e.derivePath(t)}catch(s){if(t.startsWith("m/"))try{return e.derivePath(t.slice(2))}catch{}const i=s instanceof Error?s.message:String(s);throw new Error(`DERIVATION_PATH_INVALID: ${t} (${i})`)}}function Do(e,t){const s=Lo(t),{XPrivateKey:i}=e.kaspa,a=Xc(e.masterXPrv,s.path).intoString("kprv"),l=new i(a,!1,BigInt(s.account));return{privKey:s.chain===1?l.changeKey(s.index):l.receiveKey(s.index),derivation:s}}function Qc(e,t){return e.toKeypair().toAddress(t).toString()}async function Bo(e,t,s={}){const i=await $o(e,s),{privKey:o,derivation:a}=Do(i,s.derivation);return{address:Qc(o,t),derivation:a}}async function Jc(e,t=24){const{Mnemonic:s}=await Oo();let i;try{i=s.random(t)}catch{i=s.random()}const o=i.phrase,{address:a,derivation:l}=await Bo(o,e,{derivation:tn});return{phrase:o,address:a,network:e,derivation:l}}async function Zc(e,t,s={}){Fo(e);const i=Ko(e),o=s.mnemonicPassphrase||void 0,{address:a,derivation:l}=await Bo(i,t,s);return{phrase:i,address:a,network:t,mnemonicPassphrase:o,derivation:l}}function el(e){try{window.localStorage.setItem(Po,JSON.stringify(e))}catch{}}function Tn(){try{const e=window.localStorage.getItem(Po);if(!e)return null;const t=JSON.parse(e);if(t!=null&&t.phrase&&(t!=null&&t.address)&&(t!=null&&t.network)&&((t==null?void 0:t.mnemonicPassphrase)===void 0||typeof t.mnemonicPassphrase=="string"))return{...t,derivation:Lo(t==null?void 0:t.derivation)}}catch{}return null}async function tl(e,t,s={}){var h;Fo(e);const i=Ko(e),o=await $o(i,s),{privKey:a}=Do(o,s.derivation),l=new TextEncoder().encode(t),{PrivateKey:c}=o.kaspa,d=a.toKeypair();let u;try{const v=d.privateKey??((h=d.toPrivateKey)==null?void 0:h.call(d));u=new c(v)}catch{u=a}const m=u.sign(l);return Array.from(m,v=>v.toString(16).padStart(2,"0")).join("")}const Ti=new Set([12,15,18,21,24]);function rl(e){const t=Array.from({length:e},(i,o)=>o+1),s=[];for(;s.length<3;){const i=Math.floor(Math.random()*t.length);s.push(t[i]),t.splice(i,1)}return s.sort((i,o)=>i-o)}function zo({onConnect:e,onClose:t}){var ie;const[s,i]=g.useState("choose"),[o,a]=g.useState(!1),[l,c]=g.useState(""),[d,u]=g.useState(null),[m,h]=g.useState(12),[v,A]=g.useState(!1),[_,k]=g.useState(""),[j,C]=g.useState(""),[R,I]=g.useState(!1),[p,x]=g.useState([]),[E,w]=g.useState({}),[K,F]=g.useState({}),H=((ie=d==null?void 0:d.phrase)==null?void 0:ie.split(" "))??[],G=async()=>{a(!0),c("");try{const D=await Jc(Ie,m),Y=rl(D.phrase.split(" ").length);u(D),x(Y),w({}),F({}),A(!1),i("backup")}catch(D){c((D==null?void 0:D.message)||"Wallet generation failed.")}a(!1)},B=g.useMemo(()=>p.every(D=>(E[D]??"").trim().length>0),[p,E]),P=()=>{if(!d)return;const D=d.phrase.split(" "),Y={};let ae=!0;p.forEach(fe=>{const Ae=D[fe-1].toLowerCase();(E[fe]??"").trim().toLowerCase()!==Ae&&(Y[fe]=!0,ae=!1)}),F(Y),ae&&i("ready")},Z=async()=>{a(!0),c("");try{const D=await Zc(_,Ie,{mnemonicPassphrase:j||void 0});u(D),C(""),i("ready")}catch(D){c((D==null?void 0:D.message)||"Invalid seed phrase.")}a(!1)},re=()=>{d&&(el(d),e({address:d.address,network:d.network,provider:"managed"}))},b=async()=>{if(d)try{await navigator.clipboard.writeText(d.address),I(!0),setTimeout(()=>I(!1),2e3)}catch{}},M={background:"rgba(8,13,20,0.7)",border:`1px solid ${n.border}`,borderRadius:6,padding:"7px 10px",color:n.text,fontSize:10,...f,outline:"none",width:"100%",boxSizing:"border-box"};return r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.88)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20,overflowY:"auto"},children:r.jsxs(ye,{p:28,style:{maxWidth:560,width:"100%",position:"relative"},children:[r.jsx("button",{onClick:t,style:{position:"absolute",top:14,right:16,background:"none",border:"none",color:n.dim,fontSize:18,cursor:"pointer",lineHeight:1},children:"Ã—"}),s==="choose"&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:4},children:"Kaspa Wallet Setup"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"Create a new wallet or import one using your seed phrase."})]}),r.jsx(Gn,{m:4}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[r.jsxs("button",{onClick:()=>i("seed_length"),style:{background:`linear-gradient(145deg, ${n.accent}18 0%, rgba(8,13,20,0.6) 100%)`,border:`1px solid ${n.accent}40`,borderRadius:10,padding:"18px 14px",cursor:"pointer",textAlign:"left",color:n.text,transition:"border-color 0.15s"},children:[r.jsx("div",{style:{fontSize:22,marginBottom:8},children:"âœ¦"}),r.jsx("div",{style:{fontSize:11,fontWeight:700,color:n.accent,...f,marginBottom:4},children:"GENERATE NEW"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.5},children:"Create a fresh Kaspa wallet. Choose 12 or 24-word seed phrase."})]}),r.jsxs("button",{onClick:()=>i("import"),style:{background:"linear-gradient(145deg, rgba(16,25,35,0.7) 0%, rgba(8,13,20,0.5) 100%)",border:"1px solid rgba(33,48,67,0.7)",borderRadius:10,padding:"18px 14px",cursor:"pointer",textAlign:"left",color:n.text,transition:"border-color 0.15s"},children:[r.jsx("div",{style:{fontSize:22,marginBottom:8},children:"â†“"}),r.jsx("div",{style:{fontSize:11,fontWeight:700,color:n.text,...f,marginBottom:4},children:"IMPORT EXISTING"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.5},children:"Paste your 12 or 24-word seed phrase to restore a wallet."})]})]}),l&&r.jsx(Cn,{message:l})]}),s==="seed_length"&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:4},children:"Choose Seed Phrase Length"}),r.jsxs("div",{style:{fontSize:10,color:n.dim,lineHeight:1.5},children:["Both lengths use BIP39 standard and are compatible with all Kaspa wallets (Kasware, Kastle, Kaspium) via derivation path"," ",r.jsx("span",{style:{color:n.accent,...f},children:"m/44'/111'/0'/0/0"}),"."]})]}),r.jsx(Gn,{m:4}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[{count:12,label:"12 Words",sub:"128-bit entropy",note:"Standard security. Easier to write down. Good for most users.",color:n.accent,recommended:!0},{count:24,label:"24 Words",sub:"256-bit entropy",note:"Maximum security. Recommended for large holdings.",color:n.purple}].map(({count:D,label:Y,sub:ae,note:fe,color:Ae,recommended:ce})=>r.jsxs("button",{onClick:()=>h(D),style:{background:m===D?`linear-gradient(145deg, ${Ae}18 0%, rgba(8,13,20,0.6) 100%)`:"rgba(11,17,24,0.6)",border:`1px solid ${m===D?Ae+"60":n.border}`,borderRadius:10,padding:"16px 14px",cursor:"pointer",textAlign:"left",color:n.text,transition:"all 0.15s"},children:[r.jsx("div",{style:{fontSize:14,fontWeight:700,color:m===D?Ae:n.dim,...f,marginBottom:3},children:Y}),r.jsx("div",{style:{fontSize:8,color:n.muted,...f,marginBottom:8},children:ae}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.4},children:fe}),ce&&r.jsx("div",{style:{marginTop:8,fontSize:7,color:n.purple,border:`1px solid ${n.purple}40`,borderRadius:3,padding:"2px 6px",display:"inline-block",letterSpacing:"0.08em",...f},children:"RECOMMENDED"})]},D))}),l&&r.jsx(Cn,{message:l}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(_e,{onClick:()=>{C(""),i("choose")},variant:"ghost",size:"sm",style:{flex:1},children:"â† BACK"}),r.jsx(_e,{onClick:G,disabled:o,variant:"primary",size:"sm",style:{flex:2},children:o?"GENERATINGâ€¦":`GENERATE ${m}-WORD WALLET â†’`})]})]}),s==="backup"&&d&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:4},children:"Back Up Your Seed Phrase"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"This is your wallet recovery key. Forge-OS cannot recover it for you."})]}),r.jsxs("div",{style:{background:`${n.warn}12`,border:`1px solid ${n.warn}40`,borderRadius:8,padding:"10px 14px"},children:[r.jsx("div",{style:{fontSize:10,color:n.warn,fontWeight:700,...f,marginBottom:3},children:"âš  WRITE THESE WORDS DOWN OFFLINE"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.5},children:"Anyone with this phrase controls your wallet. Never share it. Do not take a screenshot. Store it somewhere safe and offline."})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:5},children:H.map((D,Y)=>r.jsxs("div",{style:{background:"rgba(8,13,20,0.7)",border:`1px solid ${n.border}`,borderRadius:6,padding:"6px 8px",display:"flex",alignItems:"center",gap:5},children:[r.jsxs("span",{style:{fontSize:7,color:n.muted,...f,minWidth:14},children:[Y+1,"."]}),r.jsx("span",{style:{fontSize:10,color:n.text,...f,fontWeight:600},children:D})]},Y))}),r.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:8,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:v,onChange:D=>A(D.target.checked),style:{marginTop:2,accentColor:n.accent}}),r.jsxs("span",{style:{fontSize:10,color:n.dim,lineHeight:1.5},children:["I have written down all ",H.length," words in order and stored them securely offline. I understand Forge-OS cannot recover this phrase."]})]}),r.jsx(_e,{onClick:()=>i("verify"),disabled:!v,variant:"primary",size:"sm",children:"I'VE SAVED MY PHRASE â€” CONTINUE â†’"})]}),s==="verify"&&d&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:4},children:"Verify Your Backup"}),r.jsx("div",{style:{fontSize:10,color:n.dim,lineHeight:1.5},children:"Enter the words at the positions below to confirm you've saved your phrase correctly."})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:p.map(D=>r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:8,color:n.dim,...f,letterSpacing:"0.1em",marginBottom:4},children:["WORD #",D]}),r.jsx("input",{type:"text",value:E[D]??"",onChange:Y=>{w(ae=>({...ae,[D]:Y.target.value})),F(ae=>({...ae,[D]:!1}))},placeholder:`Enter word #${D}`,autoComplete:"off",autoCorrect:"off",spellCheck:!1,style:{...M,borderColor:K[D]?n.danger:n.border}}),K[D]&&r.jsx("div",{style:{fontSize:8,color:n.danger,marginTop:4},children:"Incorrect â€” check your written phrase and try again."})]},D))}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(_e,{onClick:()=>{i("backup"),F({}),w({})},variant:"ghost",size:"sm",style:{flex:1},children:"â† SHOW PHRASE"}),r.jsx(_e,{onClick:P,disabled:!B,variant:"primary",size:"sm",style:{flex:2},children:"VERIFY â†’"})]})]}),s==="import"&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:4},children:"Import Seed Phrase"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"Paste a BIP39 seed phrase (12/15/18/21/24 words) to derive your address."})]}),r.jsx("textarea",{value:_,onChange:D=>{k(D.target.value),c("")},placeholder:"word1 word2 word3 â€¦ word24",rows:4,style:{background:"rgba(8,13,20,0.8)",border:`1px solid ${n.border}`,borderRadius:8,padding:"10px 12px",color:n.text,fontSize:11,...f,resize:"vertical",lineHeight:1.6,outline:"none",width:"100%",boxSizing:"border-box"}}),r.jsx("input",{type:"password",value:j,onChange:D=>{C(D.target.value),c("")},placeholder:"Optional BIP39 passphrase / 25th word",style:M}),_.trim()&&(()=>{const D=_.trim().split(/\s+/).length,Y=Ti.has(D);return r.jsxs("div",{style:{fontSize:9,color:Y?n.ok:n.warn,...f},children:[D," words ",Y?"âœ“":"(need 12/15/18/21/24)"]})})(),l&&r.jsx(Cn,{message:l}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(_e,{onClick:()=>i("choose"),variant:"ghost",size:"sm",style:{flex:1},children:"â† BACK"}),r.jsx(_e,{onClick:Z,disabled:o||!Ti.has(_.trim().split(/\s+/).length),variant:"primary",size:"sm",style:{flex:2},children:o?"IMPORTINGâ€¦":"IMPORT WALLET â†’"})]})]}),s==="ready"&&d&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.accent,...f,marginBottom:4},children:"âœ“ Wallet Ready"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"Your Kaspa address is ready. Send KAS here to fund your agent."})]}),r.jsxs("div",{style:{background:"rgba(8,13,20,0.8)",border:`1px solid ${n.accent}30`,borderRadius:10,padding:"14px 16px"},children:[r.jsxs("div",{style:{fontSize:8,color:n.dim,...f,letterSpacing:"0.1em",marginBottom:6},children:["DEPOSIT ADDRESS Â· KASPA ",d.network.toUpperCase()]}),r.jsx("div",{style:{fontSize:10,color:n.text,...f,wordBreak:"break-all",lineHeight:1.6,marginBottom:10},children:d.address}),r.jsx("button",{onClick:b,style:{background:R?`${n.ok}20`:"rgba(33,48,67,0.5)",border:`1px solid ${R?n.ok:n.border}`,borderRadius:6,padding:"5px 14px",color:R?n.ok:n.dim,fontSize:10,cursor:"pointer",...f,transition:"all 0.15s"},children:R?"âœ“ COPIED":"COPY ADDRESS"})]}),r.jsxs("div",{style:{background:`${n.purple}0D`,border:`1px solid ${n.purple}28`,borderRadius:8,padding:"10px 14px"},children:[r.jsx("div",{style:{fontSize:9,color:n.purple,fontWeight:700,...f,marginBottom:4},children:"HOW TO DEPOSIT"}),r.jsxs("div",{style:{fontSize:9,color:n.dim,lineHeight:1.6},children:["1. Copy the address above.",r.jsx("br",{}),"2. Open Kasware, Kastle, Kaspium, or any Kaspa wallet.",r.jsx("br",{}),"3. Send KAS to this address.",r.jsx("br",{}),"4. Click Connect â€” your balance will appear once confirmed."]})]}),r.jsx("div",{style:{background:`${n.accent}08`,border:`1px solid ${n.accent}20`,borderRadius:8,padding:"8px 12px"},children:r.jsxs("div",{style:{fontSize:8,color:n.dim,lineHeight:1.5},children:[r.jsx("span",{style:{color:n.accent,fontWeight:700},children:"Fully interoperable: "}),"This wallet uses BIP39 + derivation path"," ",r.jsx("span",{style:{...f,color:n.accent},children:"m/44'/111'/0'/0/0"}),". Import your seed phrase into Kasware, Kastle, or Kaspium to sign transactions directly from those wallets."]})}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:9,color:n.dim,...f},children:[r.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:n.ok,flexShrink:0}}),ht(d.address)," Â· ",d.network," Â· ",H.length," words"]}),r.jsx(_e,{onClick:re,variant:"primary",size:"sm",children:"CONNECT WALLET â†’"}),r.jsx("div",{style:{fontSize:8,color:n.dim,lineHeight:1.5},children:"This wallet connects in read-only mode. To sign transactions, import your seed phrase into Kasware or Kastle, or use the Forge-OS extension."})]})]})})}function Cn({message:e}){return r.jsx("div",{style:{fontSize:10,color:n.danger,padding:"8px 12px",background:`${n.danger}12`,border:`1px solid ${n.danger}30`,borderRadius:6,lineHeight:1.5},children:e})}function nl({networkLabel:e,onSignInClick:t,onEnterDemoMode:s,onOpenCreator:i}){return r.jsxs("div",{"data-testid":"web-wallet-setup",style:{display:"flex",flexDirection:"column",gap:10},children:[r.jsxs(ye,{p:20,style:{border:"1px solid rgba(57,221,182,0.14)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[r.jsx("div",{style:{fontSize:16,color:n.text,fontWeight:700,...f},children:"Connect Wallet"}),r.jsx(J,{text:e,color:n.ok,dot:!0})]}),r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:16},children:"All operations are wallet-native. Forge-OS never stores private keys or signs on your behalf."}),r.jsx("button",{"data-testid":"wallet-gate-connect-wallet",onClick:t,style:{width:"100%",background:`linear-gradient(90deg, ${n.accent}, #7BE9CF)`,border:"none",borderRadius:10,cursor:"pointer",color:"#04110E",fontSize:14,...f,fontWeight:700,letterSpacing:"0.08em",padding:"16px 0",boxShadow:"0 4px 20px rgba(57,221,182,0.28)",marginBottom:10,transition:"box-shadow 0.15s"},onMouseEnter:o=>{o.currentTarget.style.boxShadow="0 6px 28px rgba(57,221,182,0.44)"},onMouseLeave:o=>{o.currentTarget.style.boxShadow="0 4px 20px rgba(57,221,182,0.28)"},children:"CONNECT WALLET â†’"}),r.jsx("div",{style:{marginBottom:10},children:r.jsx("button",{"data-testid":"wallet-gate-enter-demo-mode",onClick:s,style:{width:"100%",background:"rgba(11,17,24,0.85)",border:`1px solid ${n.border}`,borderRadius:8,cursor:"pointer",color:n.text,fontSize:10,...f,fontWeight:700,letterSpacing:"0.08em",padding:"10px 0"},children:"ENTER DEMO MODE"})}),r.jsxs("button",{"data-testid":"wallet-gate-open-wallet-creator",onClick:i,style:{width:"100%",background:"linear-gradient(135deg, rgba(57,221,182,0.06) 0%, rgba(8,13,20,0.55) 100%)",border:`1px solid ${n.accent}28`,borderRadius:10,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",marginBottom:16,transition:"border-color 0.15s"},onMouseEnter:o=>{o.currentTarget.style.borderColor=`${n.accent}55`},onMouseLeave:o=>{o.currentTarget.style.borderColor=`${n.accent}28`},children:[r.jsxs("div",{style:{textAlign:"left"},children:[r.jsx("div",{style:{fontSize:11,color:n.text,...f,fontWeight:700,marginBottom:2},children:"New to Kaspa?"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"Create or import a wallet"})]}),r.jsx("span",{style:{fontSize:11,color:n.accent,...f,fontWeight:700,letterSpacing:"0.06em",flexShrink:0,marginLeft:8},children:"CREATE â€º"})]}),r.jsx(Gn,{m:14}),r.jsxs("div",{style:{fontSize:10,color:n.dim,...f,lineHeight:1.5},children:["Forge-OS never requests your private key Â· All signing happens inside your wallet Â· ",e]})]}),r.jsxs("div",{style:{background:`linear-gradient(135deg, ${n.purple}10 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${n.purple}28`,borderRadius:10,padding:"14px 18px"},children:[r.jsx("div",{style:{fontSize:10,color:n.purple,fontWeight:700,...f,letterSpacing:"0.12em",marginBottom:6},children:"KASPA STABLECOIN UPGRADE Â· READY"}),r.jsx("div",{style:{fontSize:11,color:n.dim,lineHeight:1.5},children:"Agents accumulate KAS now. When Kaspa stablecoins launch at L1, agents automatically switch to active buy/sell â€” buying dips, selling strength, and booking profit in USD. KRC-20 tokens and Kaspa 0x swaps are already in the engine. No migration, no downtime."})]})]})}const sl=[{status:"LIVE",statusColor:"#39DDB6",title:"KAS Accumulation",desc:"AI agents accumulate KAS now â€” Kelly-sized entries, regime-aware execution on the BlockDAG.",icon:"â—†",iconColor:"#39DDB6"},{status:"LIVE",statusColor:"#39DDB6",title:"DAG-Speed Settlement",desc:"Transactions confirm at Kaspa BlockDAG speed â€” parallel block lattice, sub-second finality.",icon:"âš¡",iconColor:"#39DDB6"},{status:"LIVE",statusColor:"#39DDB6",title:"Stable PnL Tracking",desc:"All agent P&L tracked in USD equivalent. KAS/USDC rate computed on every cycle.",icon:"$",iconColor:"#39DDB6"},{status:"READY",statusColor:"#8F7BFF",title:"KAS / USDC Profit Trading",desc:"When Kaspa stablecoins launch, agents flip from accumulation to active buy/sell â€” profiting on KAS price swings.",icon:"â‡„",iconColor:"#8F7BFF"},{status:"READY",statusColor:"#F7B267",title:"KRC-20 Token Support",desc:"Engine ready for KRC-20 tokens on Kaspa. Buy the dip, sell the strength â€” across any KRC-20/KAS pair.",icon:"â¬¡",iconColor:"#F7B267"},{status:"READY",statusColor:"#F7B267",title:"Kaspa 0x Swaps",desc:"Built for Kaspa's 0x-style DEX layer. Agents route capital across pools â€” KAS, kUSD, kBTC and beyond.",icon:"âŠ•",iconColor:"#F7B267"}];function il({onConnect:e,onSignInClick:t}){const[s,i]=g.useState(!1),o=()=>{e({address:Rc,network:Ie,provider:"demo"})};return r.jsxs("div",{className:"forge-shell forge-wallet-gate-root",style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",padding:"clamp(8px, 2vw, 12px)",backgroundColor:n.bg},children:[r.jsx(Mo,{}),r.jsx("div",{className:"forge-wallet-gate-top-row",style:{width:"100%",maxWidth:1600,display:"flex",alignItems:"center",padding:"4px clamp(16px, 3vw, 36px) 0"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("img",{src:"/forge-os-icon3.png",alt:"Forge-OS",style:{width:44,height:44,objectFit:"contain",filter:"drop-shadow(0 0 8px rgba(57,221,182,0.5))"}}),r.jsxs("span",{style:{fontSize:12,fontWeight:700,letterSpacing:"0.12em",...f},children:[r.jsx("span",{style:{color:n.accent},children:"FORGE"}),r.jsx("span",{style:{color:n.text},children:"-OS"})]})]})}),r.jsxs("div",{"data-testid":"wallet-gate-hero",className:"forge-wallet-gate-hero",style:{width:"100%",maxWidth:1100,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:12,padding:"clamp(28px,5vw,56px) clamp(16px,3vw,32px) clamp(20px,3vw,36px)"},children:[r.jsx("div",{"aria-hidden":!0,style:{height:12}}),r.jsxs("h1",{className:"forge-wallet-gate-hero-title",style:{font:"700 clamp(32px,5.5vw,64px)/1.1 'IBM Plex Mono',monospace",letterSpacing:"0.03em",margin:0,color:n.text,textWrap:"balance"},children:[r.jsx("span",{style:{color:n.accent,textShadow:"0 0 30px rgba(57,221,182,0.55)"},children:"KAS / USDC"}),r.jsx("span",{style:{color:n.text,fontWeight:800},children:" AI TRADING"}),r.jsx("br",{}),r.jsx("span",{style:{color:n.dim,fontWeight:500,fontSize:"0.65em",letterSpacing:"0.06em"},children:"âš¡ BLOCKDAG SPEED"})]}),r.jsx("p",{className:"forge-wallet-gate-hero-copy",style:{font:"500 15px/1.6 'Space Grotesk','Segoe UI',sans-serif",color:"#9db0c6",maxWidth:"64ch",margin:0},children:"Full-stack DeFi for Kaspa. Agents accumulate KAS today â€” and flip to active profit trading the moment stablecoins, KRC-20, and Kaspa 0x swaps go live."}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",justifyContent:"center"},children:[r.jsx(J,{text:`${Ct}`,color:n.ok,dot:!0}),r.jsx(J,{text:"KRC-20 READY",color:n.purple,dot:!0}),r.jsx(J,{text:"NON-CUSTODIAL",color:n.warn,dot:!0}),r.jsx(J,{text:"DAG-SPEED EXECUTION",color:n.accent,dot:!0})]})]}),r.jsxs("div",{"data-testid":"wallet-gate-content",className:"forge-content forge-gate-responsive",style:{width:"100%",maxWidth:1600,display:"grid",gridTemplateColumns:"minmax(0,1fr) minmax(360px,520px)",gap:"clamp(20px, 3vw, 40px)",alignItems:"flex-start",padding:"0 clamp(12px,2vw,24px)"},children:[r.jsxs("section",{style:{display:"flex",flexDirection:"column",gap:6,justifySelf:"center",width:"100%",maxWidth:910,textAlign:"center"},children:[r.jsxs("div",{style:{width:"100%"},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,letterSpacing:"0.16em",marginBottom:8,textAlign:"center"},children:"PROTOCOL CAPABILITIES"}),r.jsx("div",{className:"forge-wallet-gate-protocol-grid",style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:sl.map(a=>r.jsxs("div",{style:{background:`linear-gradient(145deg, ${a.iconColor}10 0%, rgba(8,13,20,0.55) 100%)`,border:`1px solid ${a.iconColor}22`,borderRadius:8,padding:"12px 14px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6},children:[r.jsx("span",{style:{fontSize:18,color:a.iconColor,lineHeight:1},children:a.icon}),r.jsx("span",{style:{fontSize:8,color:a.statusColor,fontWeight:700,...f,background:`${a.statusColor}15`,padding:"2px 6px",borderRadius:3,border:`1px solid ${a.statusColor}30`},children:a.status})]}),r.jsx("div",{style:{fontSize:11,color:n.text,fontWeight:700,...f,marginBottom:4},children:a.title}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.4},children:a.desc})]},a.title))})]}),r.jsx("div",{className:"forge-wallet-gate-arch-grid",style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,width:"100%"},children:[["EXECUTION","Wallet-native signing + queue lifecycle management"],["TRUTH","Receipt-aware P&L attribution + consistency checks"],["ROUTING","DAG-aware capital allocation + Kelly-fraction sizing"]].map(([a,l])=>r.jsxs("div",{style:{border:"1px solid rgba(33,48,67,0.72)",borderRadius:10,background:"linear-gradient(180deg, rgba(11,20,30,0.78) 0%, rgba(9,15,23,0.7) 100%)",padding:"12px 14px"},children:[r.jsx("div",{style:{font:"700 11px/1.2 'IBM Plex Mono',monospace",color:n.accent,letterSpacing:"0.1em",marginBottom:4},children:a}),r.jsx("div",{style:{font:"500 9px/1.4 'IBM Plex Mono',monospace",color:n.dim},children:l})]},a))}),r.jsx("div",{className:"forge-wallet-gate-key-grid",style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,width:"100%"},children:[{v:"BlockDAG",l:"Settlement speed"},{v:"Non-Custodial",l:"Keys stay in wallet"},{v:"KAS/USDC",l:"Pair architecture"}].map(a=>r.jsxs("div",{style:{border:"1px solid rgba(33,48,67,0.82)",borderRadius:10,background:"rgba(10,17,24,0.72)",padding:"12px"},children:[r.jsx("div",{style:{font:"700 18px/1.2 'IBM Plex Mono',monospace",color:n.accent,marginBottom:4},children:a.v}),r.jsx("div",{style:{font:"500 10px/1.3 'IBM Plex Mono',monospace",letterSpacing:"0.08em",color:n.dim},children:a.l})]},a.v))}),r.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap",justifyContent:"center"},children:[{href:"https://x.com/ForgeOSxyz",icon:"ð•",label:"@ForgeOSxyz",c:n.text},{href:"https://github.com/Forge-OS",icon:"âŒ˜",label:"GitHub",c:n.dim},{href:"https://t.me/ForgeOSDefi",icon:"âœˆ",label:"Telegram",c:n.dim}].map(a=>r.jsxs("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:5,padding:"6px 10px",borderRadius:6,background:"rgba(16,25,35,0.5)",border:"1px solid rgba(33,48,67,0.7)",color:a.c,textDecoration:"none",fontSize:10,fontWeight:600,...f},children:[r.jsx("span",{style:{fontSize:12},children:a.icon}),r.jsx("span",{children:a.label})]},a.label))})]}),r.jsxs("div",{className:"forge-connect-column",style:{display:"flex",flexDirection:"column",gap:10,marginTop:"clamp(-35px,-3vw,-18px)"},children:[r.jsx("div",{"aria-hidden":!0,style:{height:"clamp(34px, 5vw, 52px)"}}),r.jsx(nl,{networkLabel:Ct,onSignInClick:t,onEnterDemoMode:o,onOpenCreator:()=>i(!0)})]})]}),r.jsx("style",{children:`
        @media (max-width: 1200px) {
          .forge-gate-responsive { grid-template-columns: 1fr !important; max-width: 800px; }
          .forge-connect-column { margin-top: 10px !important; }
        }

        @media (max-width: 900px) {
          .forge-wallet-gate-root {
            padding: 8px 6px 18px !important;
          }

          .forge-wallet-gate-top-row {
            justify-content: center !important;
            padding: 2px 8px 0 !important;
          }

          .forge-wallet-gate-hero {
            max-width: 100% !important;
            padding: 20px 10px 14px !important;
            gap: 10px !important;
          }

          .forge-wallet-gate-hero-title {
            font-size: clamp(26px, 9vw, 38px) !important;
            line-height: 1.15 !important;
          }

          .forge-wallet-gate-hero-copy {
            font-size: 13px !important;
            max-width: 100% !important;
          }

          .forge-gate-responsive {
            padding: 0 8px !important;
            gap: 12px !important;
          }

          .forge-connect-column {
            margin-top: 0 !important;
          }

          .forge-wallet-gate-protocol-grid,
          .forge-wallet-gate-arch-grid,
          .forge-wallet-gate-key-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
          }
        }

        @media (max-width: 640px) {
          .forge-wallet-gate-protocol-grid,
          .forge-wallet-gate-arch-grid,
          .forge-wallet-gate-key-grid {
            grid-template-columns: 1fr !important;
          }
        }

        @media (max-width: 430px) {
          .forge-wallet-gate-root {
            padding: 6px 4px 14px !important;
          }

          .forge-wallet-gate-hero {
            padding: 16px 8px 12px !important;
          }

          .forge-wallet-gate-hero-title {
            font-size: clamp(23px, 8.8vw, 30px) !important;
          }

          .forge-wallet-gate-hero-copy {
            font-size: 12px !important;
            line-height: 1.5 !important;
          }

          .forge-wallet-gate-protocol-grid > div,
          .forge-wallet-gate-arch-grid > div,
          .forge-wallet-gate-key-grid > div {
            padding: 10px !important;
          }
        }
      `}),s&&r.jsx(zo,{onConnect:a=>{i(!1),e(a)},onClose:()=>i(!1)})]})}function ol({networkLabel:e,networkProfileId:t,networkOptions:s,isMainnet:i,isCompactMobile:o,switchingNetwork:a,view:l,activeAgent:c,agents:d,wallet:u,onSwitchNetwork:m,onOpenCreate:h,onSelectAgent:v,onDisconnect:A}){return r.jsxs("div",{className:"forge-topbar",style:{borderBottom:`1px solid ${n.border}`,padding:o?"8px 10px":"10px clamp(12px, 2vw, 20px)",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"space-between",gap:10},children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:12,justifyContent:"space-between"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,flexShrink:0},children:[r.jsx("img",{src:"/forge-os-icon3.png",alt:"Forge-OS",style:{width:22,height:22,objectFit:"contain",filter:"drop-shadow(0 0 8px rgba(57,221,182,0.5))"}}),r.jsxs("div",{style:{fontSize:12,fontWeight:700,letterSpacing:"0.12em",...f},children:[r.jsx("span",{style:{color:n.accent},children:"FORGE"}),r.jsx("span",{style:{color:n.text},children:"-OS"})]})]})}),r.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-start",maxWidth:"100%",overflowX:"auto",paddingBottom:2,WebkitOverflowScrolling:"touch"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,border:`1px solid ${i?n.warn:n.ok}50`,background:i?n.wLow:n.oLow,borderRadius:6,padding:"4px 6px"},children:[r.jsx("span",{style:{fontSize:10,color:i?n.warn:n.ok,letterSpacing:"0.08em",...f},children:e.toUpperCase()}),r.jsx("select",{"data-testid":"network-select",value:t,onChange:_=>m(_.target.value),disabled:a,style:{background:"transparent",color:n.text,border:`1px solid ${n.border}`,borderRadius:4,padding:o?"3px 6px":"4px 8px",fontSize:o?9:10,letterSpacing:"0.05em",...f},title:"Switch runtime Kaspa network profile",children:s.map(_=>r.jsx("option",{value:_.id,style:{background:n.s1,color:n.text},children:_.label},_.id))})]}),r.jsx("button",{onClick:h,style:{background:l==="create"?n.s2:"none",border:`1px solid ${l==="create"?n.border:"transparent"}`,color:l==="create"?n.text:n.dim,padding:o?"4px 10px":"5px 14px",borderRadius:4,fontSize:o?10:11,cursor:"pointer",...f},children:"NEW AGENT"}),d.map(_=>{const k=String((c==null?void 0:c.agentId)||"")===String((_==null?void 0:_.agentId)||"");return r.jsx("button",{onClick:()=>v(String((_==null?void 0:_.agentId)||"")),style:{background:k&&l==="dashboard"?n.s2:"none",border:`1px solid ${k&&l==="dashboard"?n.accent:"transparent"}`,color:k?n.accent:n.dim,padding:o?"4px 8px":"5px 10px",borderRadius:4,fontSize:o?10:11,cursor:"pointer",maxWidth:o?112:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",...f},title:String((_==null?void 0:_.name)||"Agent"),children:String((_==null?void 0:_.name)||"AGENT")},String((_==null?void 0:_.agentId)||(_==null?void 0:_.name)||Math.random()))}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:o?"4px 10px":"5px 12px",border:`1px solid ${n.border}`,borderRadius:4},children:[r.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:(u==null?void 0:u.provider)==="demo"?n.warn:n.ok}}),r.jsx("span",{style:{fontSize:o?9:10,color:n.dim,letterSpacing:"0.08em",...f},children:ht(u==null?void 0:u.address)})]}),r.jsx(_e,{onClick:A,variant:"ghost",size:"sm",children:"DISCONNECT"})]})]})}function al(e){const{normalizeKaspaAddress:t,ALLOWED_ADDRESS_PREFIXES:s,DEFAULT_NETWORK:i,normalizeOutputList:o,isLikelyTxid:a}=e;return{connect(l,c){return{address:t(c,s),network:i,provider:l}},async send(l,c,d,u,m){const h=t(c,s),v=o(m||[]);if(!(Number(d)>0)&&!v.length)throw new Error("Amount must be greater than zero");if(typeof window>"u"||typeof window.prompt!="function")throw new Error(`${String(l||"Hardware")} bridge flow requires a browser prompt context`);const A=v.length?v.map(k=>`${k.to}  ${k.amount_kas} KAS`).join(`
`):`${h}  ${Number(d).toFixed(8)} KAS`,_=window.prompt(`${String(l||"Hardware").toUpperCase()} bridge flow

Create and broadcast this transaction in your wallet/device, then paste txid.

Outputs:
${A}

Note: ${String(u||"").slice(0,120)}`);if(!_)throw new Error("Transaction not confirmed. No txid provided.");if(!a(String(_).trim()))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return String(_).trim()}}}function cl(e){const{normalizeKaspaAddress:t,ALLOWED_ADDRESS_PREFIXES:s,DEFAULT_NETWORK:i,KASPIUM_DEEP_LINK_SCHEME:o,isLikelyTxid:a}=e;return{connect(l){return{address:t(l,s),network:i,provider:"kaspium"}},async send(l,c,d){const u=t(l,s);if(!(Number(c)>0))throw new Error("Amount must be greater than zero");if(typeof window>"u")throw new Error("Kaspium deep-link is only available in browser environments");const m=encodeURIComponent(String(c)),h=d?encodeURIComponent(d):"",v=`${u}?amount=${m}${d?`&message=${h}`:""}`;let A=v;o&&!o.toLowerCase().startsWith("kaspa")&&(A=`${o.endsWith("://")?o:`${o}://`}send?address=${encodeURIComponent(u)}&amount=${m}${d?`&note=${h}`:""}`),window.location.href=A;const _=typeof window.prompt=="function"?window.prompt.bind(window):null;if(!_)throw new Error("Kaspium confirmation prompt unavailable in this browser context");const k=_(`Complete transfer in Kaspium and paste txid.
Deep link:
${A}

Fallback URI:
${v}`);if(!k)throw new Error("Transaction not confirmed. No txid provided.");if(!a(k))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return k.trim()}}}function ll(e){const{getKastleProvider:t,withTimeout:s,WALLET_CALL_TIMEOUT_MS:i,WALLET_SEND_TIMEOUT_MS:o,KASTLE_CONNECT_TIMEOUT_MS:a,resolveKaspaNetwork:l,DEFAULT_NETWORK:c,normalizeKaspaAddress:d,ALL_KASPA_ADDRESS_PREFIXES:u,ALLOWED_ADDRESS_PREFIXES:m,ENFORCE_WALLET_NETWORK:h,NETWORK_LABEL:v,isAddressPrefixCompatible:A,normalizeWalletError:_,toSompi:k,parseAnyTxid:j,isLikelyTxid:C,KASTLE_RAW_TX_ENABLED:R,KASTLE_TX_BUILDER_URL:I,KASTLE_RAW_TX_MANUAL_JSON_PROMPT_ENABLED:p,getKastleRawTxJsonBuilderBridge:x,buildKastleRawTxJson:E,normalizeOutputList:w,kastleNetworkIdForCurrentProfile:K,setKastleAccountCacheAddress:F,getKastleCachedAccountAddress:H}=e;return{async connect(){var B;const G=t();try{typeof G.connect=="function"&&await s(Promise.resolve(G.connect()),a,"kastle_connect");let P=null;if(typeof G.getAccount=="function")P=await s(Promise.resolve(G.getAccount()),i,"kastle_get_account");else if(typeof G.request=="function")P=await s(Promise.resolve(G.request("kas:get_account")),i,"kastle_request_get_account");else throw new Error("Kastle provider missing getAccount()/request()");const Z=d(String((P==null?void 0:P.address)||((B=P==null?void 0:P.addresses)==null?void 0:B[0])||""),u);F(Z);const re=l(c);let b=re;if(typeof G.request=="function")try{const M=await s(Promise.resolve(G.request("kas:get_network")),i,"kastle_get_network");b=l((M==null?void 0:M.networkId)||M)}catch{b=re}if(!A(Z,b))throw new Error(`Kastle returned an address prefix that does not match ${b.label}. Check wallet network/account and retry.`);if(h&&b.id!==re.id)throw new Error(`Kastle is on ${b.label}. Expected ${v}. Switch network in wallet and retry.`);if(!A(Z,re))throw new Error(`Kastle returned a ${b.label} address, but ForgeOS is using ${v}. Switch the app profile or wallet network and retry.`);return{address:Z,network:b.id,provider:"kastle"}}catch(P){throw _(P,"Kastle connect failed")}},async send(G,B){const P=t();if(!(Number(B)>0))throw new Error("Amount must be greater than zero");const Z=d(G,m),re=k(B);try{if(typeof P.sendKaspa!="function")throw new Error("Kastle provider missing sendKaspa()");const b=await s(Promise.resolve(P.sendKaspa(Z,re)),o,"kastle_send_kaspa"),M=j(b);if(!M||!C(M))throw new Error("Kastle did not return a transaction id");return M}catch(b){throw _(b,"Kastle send failed")}},canSignAndBroadcastRawTx(){if(!R)return!1;try{const G=typeof window<"u"?window.kastle:null;return!!(G&&typeof G.signAndBroadcastTx=="function")}catch{return!1}},canMultiOutputRawTxPath(){return this.canSignAndBroadcastRawTx()?I||x()?!0:typeof window>"u"?!1:!!(p&&typeof window.prompt=="function"):!1},async sendRawTx(G,B){const P=w(G);if(P.length<=1){const b=P[0];if(!b)throw new Error("Kastle raw tx requires at least one output");return this.send(b.to,b.amount_kas)}if(!this.canSignAndBroadcastRawTx())throw new Error("Kastle raw multi-output path unavailable (feature disabled or signAndBroadcastTx not detected)");const Z=t(),re=K();try{const b=await E(P,B,H()),M=await s(Promise.resolve(Z.signAndBroadcastTx(re,b)),o,"kastle_sign_and_broadcast_tx"),ie=j(M);if(!ie||!C(ie))throw new Error("Kastle signAndBroadcastTx did not return a transaction id");return ie}catch(b){throw _(b,"Kastle raw multi-output send failed")}},async signMessage(G){const B=t();if(typeof B.signMessage!="function"&&typeof B.request!="function")throw new Error("Kastle provider missing signMessage/request");try{return typeof B.signMessage=="function"?s(Promise.resolve(B.signMessage(G)),i,"kastle_sign_message"):s(Promise.resolve(B.request("kas:sign_message",G)),i,"kastle_request_sign_message")}catch(P){throw _(P,"Kastle sign failed")}}}}function dl(e){const{resolveKaspaNetwork:t,DEFAULT_NETWORK:s,normalizeKaspaAddress:i,ALL_KASPA_ADDRESS_PREFIXES:o,ALLOWED_ADDRESS_PREFIXES:a,ENFORCE_WALLET_NETWORK:l,NETWORK_LABEL:c,isAddressPrefixCompatible:d,normalizeWalletError:u,withTimeout:m,GHOST_CONNECT_TIMEOUT_MS:h,WALLET_SEND_TIMEOUT_MS:v,ghostInvoke:A,probeGhostProviders:_,formatKasAmountString:k,parseAnyTxid:j,promptForTxidIfNeeded:C,normalizeOutputList:R}=e;return{async probeProviders(I){try{return await _(I)}catch{return[]}},async connect(){try{const I=await m(A("account",[],h),h+1e3,"ghost_connect_account"),p=Array.isArray(I==null?void 0:I.addresses)?I.addresses:[];if(!p.length)throw new Error("Ghost Wallet did not return any accounts");const x=t(s),E=t((I==null?void 0:I.networkId)||x.id),w=i(p[0],o);if(!d(w,E))throw new Error(`Ghost Wallet returned an address prefix that does not match ${E.label}. Check wallet network/account and retry.`);if(l&&E.id!==x.id)throw new Error(`Ghost Wallet is on ${E.label}. Expected ${c}. Switch network in wallet and retry.`);if(!d(w,x))throw new Error(`Ghost Wallet returned a ${E.label} address, but ForgeOS is using ${c}. Switch the app profile or wallet network and retry.`);return{address:w,network:E.id,provider:"ghost"}}catch(I){throw u(I,"Ghost Wallet connect failed")}},async send(I,p){if(!(Number(p)>0))throw new Error("Amount must be greater than zero");const x=i(I,a);try{const E=await m(A("transact",[[[x,k(p)]]],v),v+1e3,"ghost_transact"),w=j(E);return await C(w,"Ghost Wallet",typeof E=="string"?E:JSON.stringify(E))}catch(E){throw u(E,"Ghost Wallet send failed")}},async sendOutputs(I,p){const x=R(I);if(!x.length)throw new Error("Ghost Wallet outputs are required");if(x.length===1)return this.send(x[0].to,x[0].amount_kas);try{const E=await m(A("transact",[x.map(K=>[K.to,k(K.amount_kas)])],v),v+1e3,"ghost_transact_multi"),w=j(E);return await C(w,"Ghost Wallet (multi-output)",typeof E=="string"?E:JSON.stringify(E))}catch(E){throw u(E,"Ghost Wallet multi-output send failed")}}}}function ul(e){const{getKaswareProvider:t,withTimeout:s,WALLET_CALL_TIMEOUT_MS:i,WALLET_SEND_TIMEOUT_MS:o,resolveKaspaNetwork:a,DEFAULT_NETWORK:l,normalizeKaspaAddress:c,ALL_KASPA_ADDRESS_PREFIXES:d,ALLOWED_ADDRESS_PREFIXES:u,ENFORCE_WALLET_NETWORK:m,NETWORK_LABEL:h,isAddressPrefixCompatible:v,normalizeWalletError:A,parseKaswareBalance:_,parseKaswareTxid:k,isLikelyTxid:j,toSompi:C}=e;return{async connect(){const R=t();if(typeof R.requestAccounts!="function")throw new Error("Kasware provider missing requestAccounts()");try{const I=await s(Promise.resolve(R.requestAccounts()),i,"kasware_request_accounts");if(!(I!=null&&I.length))throw new Error("No accounts returned from Kasware");const p=a(l),x=c(I[0],d);let E=p;if(typeof R.getNetwork=="function")try{const w=await s(Promise.resolve(R.getNetwork()),i,"kasware_get_network");E=a(w)}catch{E=p}if(!v(x,E))throw new Error(`Kasware returned an address prefix that does not match ${E.label}. Check wallet network/account and retry.`);if(m&&E.id!==p.id)throw new Error(`Kasware is on ${E.label}. Expected ${h}. Switch network in wallet and retry.`);if(!v(x,p))throw new Error(`Kasware returned a ${E.label} address, but ForgeOS is using ${h}. Switch the app profile or wallet network and retry.`);return{address:x,network:E.id,provider:"kasware"}}catch(I){throw A(I,"Kasware connect failed")}},async getBalance(){const R=t();if(typeof R.getBalance!="function")throw new Error("Kasware provider missing getBalance()");try{const I=await s(Promise.resolve(R.getBalance()),i,"kasware_get_balance");return _(I)}catch(I){throw A(I,"Kasware balance failed")}},async send(R,I){const p=t();if(!(Number(I)>0))throw new Error("Amount must be greater than zero");const x=c(R,u),E=C(I),w=1e4;let K;try{if(typeof p.sendKaspa=="function")try{K=await s(Promise.resolve(p.sendKaspa(x,E,{priorityFee:w})),o,"kasware_send_kaspa_prio")}catch{K=await s(Promise.resolve(p.sendKaspa(x,E)),o,"kasware_send_kaspa")}else if(typeof p.sendKAS=="function")K=await s(Promise.resolve(p.sendKAS(x,E)),o,"kasware_send_kas");else throw new Error("Kasware provider missing sendKaspa()/sendKAS()")}catch(H){throw A(H,"Kasware send failed")}const F=k(K);if(!F||!j(F))throw new Error("Kasware did not return a transaction id");return F},async signMessage(R){const I=t();if(typeof I.signMessage!="function"&&typeof I.signData!="function")throw new Error("Kasware provider missing signMessage/signData");try{return typeof I.signMessage=="function"?s(Promise.resolve(I.signMessage(R)),i,"kasware_sign_message"):s(Promise.resolve(I.signData(R)),i,"kasware_sign_data")}catch(p){throw A(p,"Kasware sign failed")}}}}class cs extends Error{constructor(s){super(s.message);kt(this,"domain");kt(this,"code");kt(this,"retryable");kt(this,"details");kt(this,"cause");this.name="ForgeError",this.domain=s.domain,this.code=s.code,this.retryable=!!s.retryable,this.details=s.details,this.cause=s.cause}}function fl(e){return e instanceof cs}const pl=/timeout/,ml=/rejected|denied|cancel/,gl=/network/,hl=/mismatch|expected|switch/,xl=/not detected|unavailable|not connected|browser wallet apis unavailable|wallet bridge/,yl=/provider missing|invalid/,_l=/429|rate/i,Sl=/invalid/,Ci=/timeout/,bl=/invalid/,El=/rejected|denied|cancel/,Al=/(timeout|network|unavailable|429|503|502|504)/i;function ls(e){return new cs(e)}function vl(e,t){const s=String(t||"").toLowerCase();if(e==="wallet"){if(pl.test(s))return"WALLET_TIMEOUT";if(ml.test(s))return"WALLET_USER_REJECTED";if(gl.test(s)&&hl.test(s))return"WALLET_NETWORK_MISMATCH";if(xl.test(s))return"WALLET_UNAVAILABLE";if(yl.test(s))return"WALLET_PROVIDER_INVALID"}return e==="rpc"?Ci.test(s)?"RPC_TIMEOUT":_l.test(s)?"RPC_RATE_LIMIT":Sl.test(s)?"RPC_RESPONSE_INVALID":"RPC_UNAVAILABLE":e==="ai"?Ci.test(s)?"AI_TIMEOUT":"AI_UNAVAILABLE":e==="tx"?bl.test(s)?"TX_INVALID":El.test(s)?"TX_REJECTED":"TX_BROADCAST_FAILED":e==="lifecycle"?"LIFECYCLE_INVALID_TRANSITION":"UNKNOWN"}function gn(e,t={}){if(fl(e))return e;const s=String((e==null?void 0:e.message)||e||t.message||"Unknown error"),i=t.domain||"system",o=t.code||vl(i,s),a=typeof t.retryable=="boolean"?t.retryable:Al.test(s);return new cs({message:s,domain:i,code:o,retryable:a,details:t.details,cause:e})}function Uo(e){const t=gn(e);return`${t.code}: ${t.message}`}function Fr(e,t){return gn(e,{domain:"wallet",details:t})}function rn(e,t){return gn(e,{domain:"rpc",details:t})}const wr=["kaspa","kaspatest","kaspadev","kaspasim"],nn=1e4,ds=3e4,Tl=250,Cl=3e4;var uo,fo;const wl=String(((fo=(uo=import.meta)==null?void 0:uo.env)==null?void 0:fo.VITE_KASTLE_RAW_TX_ENABLED)||"false").toLowerCase()==="true";var po,mo;const Wo=String(((mo=(po=import.meta)==null?void 0:po.env)==null?void 0:mo.VITE_KASTLE_RAW_TX_MANUAL_JSON_PROMPT_ENABLED)||"true").toLowerCase()!=="false";var go,ho;const sn=String(((ho=(go=import.meta)==null?void 0:go.env)==null?void 0:ho.VITE_KASTLE_TX_BUILDER_URL)||"").trim();var xo,yo;const wi=String(((yo=(xo=import.meta)==null?void 0:xo.env)==null?void 0:yo.VITE_KASTLE_TX_BUILDER_TOKEN)||"").trim();var _o,So;const kl=Math.max(1e3,Number(((So=(_o=import.meta)==null?void 0:_o.env)==null?void 0:So.VITE_KASTLE_TX_BUILDER_TIMEOUT_MS)||12e3));var bo,Eo;const Nl=String(((Eo=(bo=import.meta)==null?void 0:bo.env)==null?void 0:Eo.VITE_KASTLE_TX_BUILDER_STRICT)||"false").toLowerCase()==="true",Il=6e4;let At=null,$r={ts:0,providers:[]},Qt={address:"",ts:0};function Ho(e){return Math.floor(Number(e||0)*1e8)}function jl(e){const t=Number((e==null?void 0:e.total)??(e==null?void 0:e.confirmed)??(e==null?void 0:e.balance)??0);return Number.isFinite(t)?Xt(t/1e8,4):"0.0000"}function Rl(e){return typeof e=="string"?e:(e==null?void 0:e.txid)||(e==null?void 0:e.hash)||(e==null?void 0:e.transactionId)||""}function Ft(e){return/^[a-fA-F0-9]{64}$/.test(String(e||"").trim())}function Ml(e){return Number(e||0).toFixed(8).replace(/\.?0+$/,"")||"0"}function on(){return Cr(Ie).id==="mainnet"?"mainnet":"testnet-10"}function Vo(){if(typeof window>"u")return null;const e=window.__FORGEOS_KASTLE_BUILD_TX_JSON__;return typeof e=="function"?e:null}function kr(e){return Array.isArray(e)?e.map(t=>({to:ut(String((t==null?void 0:t.to)||(t==null?void 0:t.address)||""),et),amount_kas:Number(Number((t==null?void 0:t.amount_kas)??(t==null?void 0:t.amount)??0).toFixed(8))})).filter(t=>t.to&&t.amount_kas>0):[]}function qr(e,t=0){var i,o,a,l;if(t>4||e==null)return"";if(typeof e=="string"){const c=e.trim();if(Ft(c))return c;const d=/"(?:transactionId|transaction_id|txid|hash|id)"\s*:\s*"([a-fA-F0-9]{64})"/.exec(c)||/([a-fA-F0-9]{64})/.exec(c);return(d==null?void 0:d[1])||""}if(typeof e!="object")return"";const s=[e.txid,e.hash,e.transactionId,e.transaction_id,e.id,(i=e==null?void 0:e.transaction)==null?void 0:i.txid,(o=e==null?void 0:e.transaction)==null?void 0:o.hash,(a=e==null?void 0:e.transaction)==null?void 0:a.transactionId,(l=e==null?void 0:e.transaction)==null?void 0:l.id];for(const c of s){const d=qr(c,t+1);if(d)return d}if(Array.isArray(e)){for(const c of e){const d=qr(c,t+1);if(d)return d}return""}for(const c of Object.values(e)){const d=qr(c,t+1);if(d)return d}return""}function Go(e){return qr(e)}function Tr(e,t,s){let i=null;const o=new Promise((a,l)=>{i=setTimeout(()=>l(new Error(`${s}_timeout_${t}ms`)),t)});return Promise.race([e,o]).finally(()=>{i&&clearTimeout(i)})}function us(e,t){const s=String((e==null?void 0:e.message)||e||"wallet_error");return/user rejected|rejected|denied|cancel/i.test(s)?Fr(new Error(`${t}: User rejected wallet request`),{context:t}):/timeout/i.test(s)?Fr(new Error(`${t}: Wallet request timed out`),{context:t}):/not detected|not connected/i.test(s)?Fr(new Error(`${t}: Wallet unavailable`),{context:t}):Fr(new Error(`${t}: ${s}`),{context:t})}function Ll(){if(typeof window>"u")throw new Error("Browser wallet APIs unavailable outside browser environment");const e=window.kasware;if(!e)throw new Error("Kasware extension not detected. Install from kasware.org");return e}function qo(){if(typeof window>"u")throw new Error("Browser wallet APIs unavailable outside browser environment");const e=window.kastle;if(!e)throw new Error("Kastle extension not detected. Install from kastle.cc");return e}async function Pl(){var i;if(Qt.address&&Date.now()-Qt.ts<=Il)return Qt.address;const e=qo();let t=null;if(typeof e.getAccount=="function")t=await Tr(Promise.resolve(e.getAccount()),nn,"kastle_get_account_for_raw_tx");else if(typeof e.request=="function")t=await Tr(Promise.resolve(e.request("kas:get_account")),nn,"kastle_request_get_account_for_raw_tx");else throw new Error("Kastle provider missing getAccount()/request()");const s=ut(String((t==null?void 0:t.address)||((i=t==null?void 0:t.addresses)==null?void 0:i[0])||""),wr);return Qt={address:s,ts:Date.now()},s}function Ol(e){Qt={address:e,ts:Date.now()}}function Kl(){return Qt.address}async function Fl(e,t,s){var d;if(!sn)return"";if(typeof fetch!="function")throw new Error("Kastle tx builder requires fetch()");const i=String(s||"").trim(),o=i?ut(i,wr):await Pl(),a=on(),l=typeof AbortController<"u"?new AbortController:null,c=l?setTimeout(()=>l.abort(),kl):null;try{const u=await fetch(sn,{method:"POST",headers:{"Content-Type":"application/json",...wi?{Authorization:`Bearer ${wi}`}:{}},body:JSON.stringify({wallet:"kastle",networkId:a,fromAddress:o,outputs:kr(e).map(A=>({address:A.to,amountKas:Number(A.amount_kas)})),purpose:String(t||"").slice(0,140)}),...l?{signal:l.signal}:{}}),m=await u.text();if(!u.ok)throw new Error(`kastle_tx_builder_${u.status}:${String(m||"").slice(0,180)}`);const h=m?JSON.parse(m):{},v=typeof h=="string"?h.trim():String((h==null?void 0:h.txJson)||((d=h==null?void 0:h.result)==null?void 0:d.txJson)||"").trim();if(!v)throw new Error("Kastle tx builder did not return txJson");return v}finally{c&&clearTimeout(c)}}async function $l(e,t,s){const i=kr(e);if(!i.length)throw new Error("Kastle raw tx requires outputs");let o=null;if(sn)try{const d=await Fl(i,t,s);if(d)return d}catch(d){if(o=d,Nl)throw d}const a=Vo();if(a){const d=await a({networkId:on(),outputs:i,purpose:String(t||"").slice(0,140)});if(typeof d!="string"||!d.trim())throw new Error("Kastle raw tx builder bridge returned an empty txJson");return d.trim()}if(!Wo||typeof window>"u"||typeof window.prompt!="function"){const d=o?` Backend builder error: ${String((o==null?void 0:o.message)||o).slice(0,180)}`:"";throw new Error(`Kastle raw tx builder unavailable. Provide VITE_KASTLE_TX_BUILDER_URL, window.__FORGEOS_KASTLE_BUILD_TX_JSON__, or enable manual txJson prompt.${d}`)}const l=["KASTLE raw multi-output txJson required","","Forge-OS can call kastle.signAndBroadcastTx(networkId, txJson), but no automatic txJson builder is currently available in this runtime.",...o?[`Builder error: ${String((o==null?void 0:o.message)||o).slice(0,180)}`,""]:[],"Paste a prebuilt txJson (serializeToSafeJSON) matching the outputs below.","",`Network: ${on()}`,`Purpose: ${String(t||"").slice(0,120)||"Forge-OS multi-output"}`,"Outputs:",...i.map((d,u)=>`  ${u+1}. ${d.to}  ${Number(d.amount_kas).toFixed(8)} KAS`)].join(`
`),c=window.prompt(l)||"";if(!c.trim())throw new Error("Kastle raw tx cancelled: no txJson provided");return c.trim()}function Dl(e){return!!(e&&typeof e.id=="string"&&typeof e.name=="string")}function fs(){if(typeof window>"u")throw new Error("Ghost Wallet is only available in browser environments");return window}function ki(e="ghost_bridge_reset"){if(typeof window<"u"&&At)try{window.removeEventListener("kaspa:event",At.onEvent),window.removeEventListener("kaspa:disconnect",At.onDisconnect),window.dispatchEvent(new CustomEvent("kaspa:disconnect"))}catch{}if(At)for(const t of At.pending.values())clearTimeout(t.timer),t.reject(new Error(e));At=null}async function Yo(e=Tl){const t=fs();if(Date.now()-$r.ts<1e3&&$r.providers.length)return[...$r.providers];const i=new Map,o=l=>{const c=l.detail;Dl(c)&&i.set(c.id,{id:c.id,name:c.name})};t.addEventListener("kaspa:provider",o);try{t.dispatchEvent(new CustomEvent("kaspa:requestProviders"))}catch{}await new Promise(l=>setTimeout(l,Math.max(50,e))),t.removeEventListener("kaspa:provider",o);const a=[...i.values()];return $r={ts:Date.now(),providers:a},a}function Bl(){return At}async function zl(){const e=fs(),t=Bl();if(t!=null&&t.connected)return t;const s=await Yo(),i=s.find(a=>/ghost/i.test(String(a.name||"")))||s[0];if(!i)throw new Error("Ghost Wallet provider bridge not detected");At&&ki("ghost_bridge_reconnect");const o={provider:i,nextRequestId:1,connected:!0,pending:new Map,onEvent(a){const l=a.detail;if(!l||typeof l.id!="number")return;const c=o.pending.get(l.id);if(c){if(o.pending.delete(l.id),clearTimeout(c.timer),l.error){c.reject(new Error(String(l.error)));return}if(l.data===!1){c.reject(new Error("Ghost Wallet request was rejected"));return}c.resolve(l.data)}},onDisconnect(){ki("ghost_bridge_disconnected")}};e.addEventListener("kaspa:event",o.onEvent),e.addEventListener("kaspa:disconnect",o.onDisconnect);try{e.dispatchEvent(new CustomEvent("kaspa:connect",{detail:i.id}))}catch(a){throw e.removeEventListener("kaspa:event",o.onEvent),e.removeEventListener("kaspa:disconnect",o.onDisconnect),a}return At=o,o}async function Ul(e,t,s){const i=fs(),o=await zl(),a=o.nextRequestId++;return new Promise((l,c)=>{const d=setTimeout(()=>{o.pending.delete(a),c(new Error(`ghost_${String(e)}_timeout_${s}ms`))},s);o.pending.set(a,{timer:d,resolve:l,reject:c});try{i.dispatchEvent(new CustomEvent("kaspa:invoke",{detail:{id:a,method:e,params:t}}))}catch(u){clearTimeout(d),o.pending.delete(a),c(u)}})}async function Wl(e,t,s){if(e&&Ft(e))return e;if(typeof window>"u"||typeof window.prompt!="function")throw new Error(`${t} did not return a transaction id`);const i=String(s||"").slice(0,600),o=window.prompt(`${t} did not return a clear txid. Paste the broadcast txid.

Raw wallet response preview:
${i}`);if(!o)throw new Error("Transaction not confirmed. No txid provided.");if(!Ft(o.trim()))throw new Error("Invalid txid format. Expected a 64-char hex transaction id.");return o.trim()}const Dr=ul({getKaswareProvider:Ll,withTimeout:Tr,WALLET_CALL_TIMEOUT_MS:nn,WALLET_SEND_TIMEOUT_MS:ds,resolveKaspaNetwork:Cr,DEFAULT_NETWORK:Ie,normalizeKaspaAddress:ut,ALL_KASPA_ADDRESS_PREFIXES:wr,ALLOWED_ADDRESS_PREFIXES:et,ENFORCE_WALLET_NETWORK:vr,NETWORK_LABEL:Ct,isAddressPrefixCompatible:ns,normalizeWalletError:us,parseKaswareBalance:jl,parseKaswareTxid:Rl,isLikelyTxid:Ft,toSompi:Ho}),Pt=ll({getKastleProvider:qo,withTimeout:Tr,WALLET_CALL_TIMEOUT_MS:nn,WALLET_SEND_TIMEOUT_MS:ds,resolveKaspaNetwork:Cr,DEFAULT_NETWORK:Ie,normalizeKaspaAddress:ut,ALL_KASPA_ADDRESS_PREFIXES:wr,ALLOWED_ADDRESS_PREFIXES:et,ENFORCE_WALLET_NETWORK:vr,NETWORK_LABEL:Ct,isAddressPrefixCompatible:ns,normalizeWalletError:us,toSompi:Ho,parseAnyTxid:Go,isLikelyTxid:Ft,KASTLE_RAW_TX_ENABLED:wl,KASTLE_TX_BUILDER_URL:sn,KASTLE_RAW_TX_MANUAL_JSON_PROMPT_ENABLED:Wo,getKastleRawTxJsonBuilderBridge:Vo,buildKastleRawTxJson:$l,normalizeOutputList:kr,kastleNetworkIdForCurrentProfile:on,setKastleAccountCacheAddress:Ol,getKastleCachedAccountAddress:Kl}),Ni=cl({normalizeKaspaAddress:ut,ALLOWED_ADDRESS_PREFIXES:et,DEFAULT_NETWORK:Ie,KASPIUM_DEEP_LINK_SCHEME:Sc,isLikelyTxid:Ft}),Ii=al({normalizeKaspaAddress:ut,ALLOWED_ADDRESS_PREFIXES:et,DEFAULT_NETWORK:Ie,normalizeOutputList:kr,isLikelyTxid:Ft}),ji=dl({resolveKaspaNetwork:Cr,DEFAULT_NETWORK:Ie,normalizeKaspaAddress:ut,ALL_KASPA_ADDRESS_PREFIXES:wr,ALLOWED_ADDRESS_PREFIXES:et,ENFORCE_WALLET_NETWORK:vr,NETWORK_LABEL:Ct,isAddressPrefixCompatible:ns,normalizeWalletError:us,withTimeout:Tr,GHOST_CONNECT_TIMEOUT_MS:Cl,WALLET_SEND_TIMEOUT_MS:ds,ghostInvoke:Ul,probeGhostProviders:Yo,formatKasAmountString:Ml,parseAnyTxid:Go,promptForTxidIfNeeded:Wl,normalizeOutputList:kr});function Jt(){try{const e=typeof window<"u"?window.forgeos:void 0;return e!=null&&e.isForgeOS?e:null}catch{return null}}const ps="__forgeos__",Hl=12e4;var Ao;const wn=((Ao=import.meta)==null?void 0:Ao.env)??{};function Vl(e,t){const s=wn==null?void 0:wn[e];if(typeof s!="string")return t;const i=s.trim().toLowerCase();return i==="true"?!0:i==="false"?!1:t}const Gl=Vl("VITE_FORGEOS_STRICT_EXTENSION_AUTH_CONNECT",!0),an=new Map;let Ri=!1,pr=null;function ql(){Ri||typeof window>"u"||(window.addEventListener("message",e=>{if((e==null?void 0:e.source)!==window)return;const t=e==null?void 0:e.data;if(!(t!=null&&t[ps]))return;const s=typeof t.requestId=="string"?t.requestId:"";if(!s||!("result"in t)&&!("error"in t))return;const i=an.get(s);if(i){if(clearTimeout(i.timer),an.delete(s),t.error){i.reject(new Error(String(t.error)));return}i.resolve(t.result)}}),Ri=!0)}function qn(e,t,s=Hl){return typeof window>"u"?Promise.reject(new Error("Forge-OS bridge unavailable outside browser context.")):(ql(),new Promise((i,o)=>{const a=`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,l=setTimeout(()=>{an.delete(a),o(new Error("Forge-OS: bridge request timed out"))},Math.max(250,s));an.set(a,{resolve:i,reject:o,timer:l}),window.postMessage({[ps]:!0,type:e,requestId:a,...t??{}},"*")}))}async function Yn(e=2500){if(typeof window>"u")return!1;const t=Date.now()+Math.max(250,e);for(;Date.now()<t;){const s=t-Date.now();try{const i=await qn("FORGEOS_BRIDGE_PING",void 0,Math.min(700,Math.max(250,s)));if(i!=null&&i.bridgeReady)return!0}catch{}if(s<=300)break;await new Promise(i=>setTimeout(i,120))}return!1}function Mi(){return{isForgeOS:!0,version:"1.0.0-bridge",async connect(){return qn("FORGEOS_CONNECT")},async signMessage(e){return qn("FORGEOS_SIGN",{message:e})},openExtension(){typeof window>"u"||window.postMessage({[ps]:!0,type:"FORGEOS_OPEN_POPUP"},"*")},disconnect(){}}}async function Li(e,t){const s=Jt();if(s!=null&&s.isForgeOS)return s;if(await Yn(t))return Mi();const i=await Yl(e);return i!=null&&i.isForgeOS?i:await Yn(Math.min(1200,t))?Mi():null}async function Yl(e=2500){const t=Jt();return t||(typeof window>"u"?null:new Promise(s=>{let i=!1;const o=d=>{i||(i=!0,clearInterval(l),clearTimeout(c),window.removeEventListener("forgeos#initialized",a),s(d))},a=()=>o(Jt());window.addEventListener("forgeos#initialized",a);const l=window.setInterval(()=>{const d=Jt();d&&o(d)},75),c=window.setTimeout(()=>{o(Jt())},Math.max(250,e))}))}const ve={detect(){let e,t,s;try{e=typeof window<"u"?window.kasware:void 0,t=typeof window<"u"?window.kastle:void 0,s=typeof window<"u"?window.forgeos:void 0}catch{e=void 0,t=void 0,s=void 0}return{kasware:!!e,kastle:!!t,forgeos:!!(s!=null&&s.isForgeOS),ghost:!1,kaspium:!0,kaswareMethods:e?{requestAccounts:typeof e.requestAccounts=="function",getNetwork:typeof e.getNetwork=="function",getBalance:typeof e.getBalance=="function",signMessage:typeof e.signMessage=="function",sendKaspa:typeof e.sendKaspa=="function"}:null,kastleMethods:t?{connect:typeof t.connect=="function",getAccount:typeof t.getAccount=="function",request:typeof t.request=="function",sendKaspa:typeof t.sendKaspa=="function",signMessage:typeof t.signMessage=="function",signAndBroadcastTx:typeof t.signAndBroadcastTx=="function"}:null}},async probeForgeOSBridgeStatus(e=900){var a;const t=!!Jt(),s=!!((a=Tn())!=null&&a.address),i=await Yn(e).catch(()=>!1);return{providerInjected:t,bridgeReachable:i,managedWalletPresent:s,transport:t?"provider":i?"bridge":s?"managed":"none"}},async connectKasware(){return Dr.connect()},async connectKastle(){return Pt.connect()},async connectForgeOS(){if(pr)return pr;const e=(async()=>{const t=await Li(3e3,1500);if(t!=null&&t.isForgeOS){const i=await t.connect();if(i!=null&&i.address)return{address:i.address,network:i.network,provider:"forgeos"}}if(Gl)throw new Error("Forge-OS extension-auth connect is required in this environment. Reload Forge-OS extension, refresh forge-os.xyz, and set extension Site access to allow this domain.");const s=Tn();if(s!=null&&s.address)return{address:s.address,network:s.network,provider:"forgeos"};throw new Error("No Forge-OS wallet bridge detected on this tab. Reload Forge-OS extension, refresh forge-os.xyz, and set extension Site access to allow this domain.")})();pr=e;try{return await e}finally{pr===e&&(pr=null)}},connectKaspium(e){return Ni.connect(e)},async getKaswareBalance(){return Dr.getBalance()},async sendKasware(e,t){return Dr.send(e,t)},async sendKastle(e,t){return Pt.send(e,t)},canKastleSignAndBroadcastRawTx(){return Pt.canSignAndBroadcastRawTx()},canKastleMultiOutputRawTxPath(){return Pt.canMultiOutputRawTxPath()},async sendKastleRawTx(e,t){return Pt.sendRawTx(e,t)},async sendKaspium(e,t,s){return Ni.send(e,t,s)},async sendGhost(e,t){return ji.send(e,t)},async sendGhostOutputs(e,t){return ji.sendOutputs(e,t)},async signMessageKasware(e){return Dr.signMessage(e)},async signMessageKastle(e){return Pt.signMessage(e)},async signMessageForgeOS(e){const t=await Li(1500,1200);if(t!=null&&t.isForgeOS)return t.signMessage(e);const s=Tn();if(s!=null&&s.phrase)return tl(s.phrase,e,{mnemonicPassphrase:s.mnemonicPassphrase,derivation:s.derivation});throw new Error("No Forge-OS wallet found for signing.")},supportsNativeMultiOutput(e){return String(e||"").toLowerCase()==="kastle"?Pt.canMultiOutputRawTxPath():!1},async connectHardwareBridge(e,t){return Ii.connect(e,t)},async sendHardwareBridge(e,t,s,i,o){return Ii.send(e,t,s,i,o)}};function ms({tx:e,wallet:t,onSign:s,onReject:i}){const[o,a]=g.useState(!1),[l,c]=g.useState(null),d=Array.isArray(e==null?void 0:e.outputs)?e.outputs:null,u=d&&d.length>1,m=(d==null?void 0:d.find(_=>(_.tag||"").toLowerCase()==="primary"))||{to:e.to,amount_kas:e.amount_kas},h=d==null?void 0:d.find(_=>(_.tag||"").toLowerCase()==="treasury"),v=async()=>{a(!0),c(null);try{let _;(t==null?void 0:t.provider)==="kasware"?_=await ve.sendKasware(e.to,e.amount_kas):(t==null?void 0:t.provider)==="kastle"?u&&d?_=await ve.sendKastleRawTx(d,e.purpose):_=await ve.sendKastle(e.to,e.amount_kas):(t==null?void 0:t.provider)==="ghost"?d&&d.length>0?_=await ve.sendGhostOutputs(d,e.purpose):_=await ve.sendGhost(e.to,e.amount_kas):(t==null?void 0:t.provider)==="tangem"||(t==null?void 0:t.provider)==="onekey"?_=await ve.sendHardwareBridge(t.provider,e.to,e.amount_kas,e.purpose,e.outputs):(t==null?void 0:t.provider)==="kaspium"?_=await ve.sendKaspium(e.to,e.amount_kas,e.purpose):(await new Promise(k=>setTimeout(k,1200)),_=Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join("")),s({...e,txid:_,signed_at:Date.now()})}catch(_){c(Uo(_))}a(!1)},A=[["Type",e.type],["From",ht(e.from)]];return u&&d?(A.push(["Principal",`${m.amount_kas} KAS`,ht(m.to)]),h&&A.push(["Platform Fee",`${h.amount_kas} KAS`,ht(h.to)]),A.push(["Network Fee",`${Tt} KAS`]),A.push(["Total",`${Number(e.amount_kas)+Number((h==null?void 0:h.amount_kas)||0)+Tt} KAS`])):(A.push(["To",ht(e.to)]),A.push(["Amount",`${e.amount_kas} KAS`]),A.push(["Fee",`${Tt} KAS`])),A.push(["Purpose",e.purpose]),r.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},children:r.jsxs(ye,{p:28,style:{maxWidth:520,width:"100%",border:`1px solid ${n.warn}40`},children:[r.jsx("div",{style:{fontSize:14,color:n.warn,fontWeight:700,...f,marginBottom:4},children:"âš  TRANSACTION SIGNING REQUIRED"}),u&&r.jsx("div",{style:{fontSize:11,color:n.accent,...f,marginBottom:12,padding:"6px 10px",background:n.aLow,borderRadius:4},children:"Multi-output transaction â€¢ Principal sent to agent deposit address"}),r.jsx(ye,{p:0,style:{marginBottom:16},children:A.map(([_,k,j],C,R)=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"9px 14px",borderBottom:C<R.length-1?`1px solid ${n.border}`:"none",flexWrap:"wrap",gap:"4px 8px"},children:[r.jsx("span",{style:{fontSize:12,color:n.dim,...f},children:_}),r.jsxs("span",{style:{fontSize:12,color:n.text,...f,textAlign:"right"},children:[k,j&&r.jsx("span",{style:{display:"block",fontSize:10,color:n.dim},children:j})]})]},_))}),l&&r.jsxs("div",{style:{fontSize:12,color:n.danger,...f,marginBottom:12,padding:"8px 12px",background:n.dLow,borderRadius:4},children:["Error: ",l]}),r.jsxs("div",{style:{display:"flex",gap:10},children:[r.jsx(_e,{onClick:i,variant:"ghost",style:{flex:1,padding:"10px 0"},children:"REJECT"}),r.jsx(_e,{onClick:v,disabled:o,style:{flex:2,padding:"10px 0"},children:o?"SIGNING...":"SIGN & BROADCAST"})]}),r.jsx("div",{style:{fontSize:11,color:n.dim,marginTop:10,textAlign:"center",...f},children:"Signing occurs client-side Â· Private key never leaves your wallet"})]})})}const Xl={name:"",kpiTarget:"12",capitalLimit:"5000",risk:"medium",execMode:"manual",autoApproveThreshold:"100",kpiMetric:"ROI %",horizon:30,revenueSource:"momentum",dataSources:["KAS On-Chain","Kaspa DAG"],frequency:"1h",strategyTemplate:"dca_accumulator",strategyLabel:"Steady DCA Builder",strategyClass:"accumulation",riskBudgetWeight:"1.0",portfolioAllocationPct:"25",stopLossPct:"4.0",takeProfitPct:"10.0",minConfidence:"55",positionSizing:"kelly",daaVelocityFilter:"0",maxDailyActions:"8",cooldownCycles:"1",pnlTracking:"kas-native",actionMode:"accumulate_only",pairMode:"accumulation",stableEntryBias:"0.6",stableExitBias:"0.4",usdcSlippageTolerance:"0.5"},gs=[{id:"dca_accumulator",name:"Steady DCA Builder",tag:"ACCUMULATION",tagColor:"#00C2A8",class:"accumulation",purpose:"Core accumulation engine for steady inventory growth with low drawdown behavior.",bestFor:"Range-to-neutral regimes, long accumulation windows, disciplined compounding.",desc:"Frequent small entries, strict downside control, and conservative auto-execution thresholds.",defaults:{risk:"low",kpiTarget:"10",horizon:90,frequency:"4h",revenueSource:"accumulation",execMode:"manual",autoApproveThreshold:"25",stopLossPct:"3.0",takeProfitPct:"8.0",minConfidence:"60",positionSizing:"half-kelly",daaVelocityFilter:"0",maxDailyActions:"6",cooldownCycles:"2",pairMode:"accumulation",actionMode:"accumulate_only"}},{id:"trend",name:"Trend Rider",tag:"MOMENTUM",tagColor:"#7C3AED",class:"momentum",purpose:"Compound into persistent directional moves while protecting against reversals.",bestFor:"Clear momentum regimes with stable liquidity and improving edge score.",desc:"Scales entries with trend persistence and tightens risk when momentum degrades.",defaults:{risk:"medium",kpiTarget:"18",horizon:45,frequency:"1h",revenueSource:"trend",execMode:"manual",autoApproveThreshold:"40",stopLossPct:"5.0",takeProfitPct:"14.0",minConfidence:"58",positionSizing:"kelly",daaVelocityFilter:"2",maxDailyActions:"10",cooldownCycles:"1",pairMode:"accumulation",actionMode:"full"}},{id:"mean_reversion",name:"Dip Harvester",tag:"REVERSION",tagColor:"#F59E0B",class:"reversion",purpose:"Accumulate discounted KAS during temporary weakness without chasing breakouts.",bestFor:"Range regimes, oversold snaps, and volatility normalization after spikes.",desc:"Buys weakness with quant-regime gating and reduced chase behavior.",defaults:{risk:"low",kpiTarget:"14",horizon:30,frequency:"30m",revenueSource:"mean-reversion",execMode:"manual",autoApproveThreshold:"20",stopLossPct:"3.5",takeProfitPct:"9.0",minConfidence:"62",positionSizing:"half-kelly",daaVelocityFilter:"0",maxDailyActions:"8",cooldownCycles:"2",pairMode:"accumulation",actionMode:"full"}},{id:"vol_breakout",name:"Volatility Expansion Hunter",tag:"BREAKOUT",tagColor:"#EF4444",class:"breakout",purpose:"Exploit expansion regimes with tighter automation controls and rapid reviews.",bestFor:"Breakout conditions, elevated DAA activity, and strong regime transitions.",desc:"Responds to volatility expansion while preserving accumulation-only discipline.",defaults:{risk:"medium",kpiTarget:"22",horizon:21,frequency:"15m",revenueSource:"breakout",execMode:"notify",autoApproveThreshold:"15",stopLossPct:"6.0",takeProfitPct:"18.0",minConfidence:"52",positionSizing:"kelly",daaVelocityFilter:"5",maxDailyActions:"12",cooldownCycles:"1",pairMode:"accumulation",actionMode:"full"}},{id:"dca_bot",name:"DCA Accumulation Bot",tag:"AUTO-DCA",tagColor:"#39DDB6",class:"accumulation",purpose:"Set-and-forget KAS accumulation. Buys every qualifying cycle automatically â€” no wallet clicks needed.",bestFor:"Long-term KAS holders who want hands-free accumulation without watching charts.",desc:"Fully autonomous DCA with loose thresholds and maximum auto-approve rate. Deploy once, let it run.",defaults:{risk:"low",kpiTarget:"10",horizon:180,frequency:"4h",revenueSource:"accumulation",execMode:"autonomous",autoApproveThreshold:"500",stopLossPct:"5.0",takeProfitPct:"15.0",minConfidence:"50",positionSizing:"half-kelly",daaVelocityFilter:"0",maxDailyActions:"6",cooldownCycles:"2",pairMode:"accumulation",actionMode:"accumulate_only"}},{id:"kas_usdc_pair",name:"KAS / USDC Pair Trader",tag:"PAIR-READY",tagColor:"#8F7BFF",class:"pair-trading",purpose:"Bi-directional KAS/USDC pair trading â€” accumulates KAS on dips using USDC, exits to USDC on strength.",bestFor:"When Kaspa enables native USDC â€” stable P&L tracking, cleaner buy/sell logic, USDC-denominated risk.",desc:"Stable-entry bias on weakness, stable-exit on peaks. Dual-side execution. Risk measured in USDC terms.",defaults:{risk:"medium",kpiTarget:"20",horizon:30,frequency:"15m",revenueSource:"pair-trading",execMode:"autonomous",autoApproveThreshold:"60",stopLossPct:"4.0",takeProfitPct:"12.0",minConfidence:"65",positionSizing:"kelly",daaVelocityFilter:"0",maxDailyActions:"20",cooldownCycles:"0",pairMode:"kas-usdc",actionMode:"full",stableEntryBias:"0.7",stableExitBias:"0.5",usdcSlippageTolerance:"0.5"}}],Xo=[{id:"market_maker",name:"Market Maker Pro",tag:"MM-PRO",tagColor:"#06B6D4",class:"market-making",purpose:"Professional market-making strategy with tight spreads and high-frequency inventory management.",bestFor:"Liquidity provision, spread capture, and neutral delta positioning.",desc:"Dual-sided quotes, dynamic spread adjustment, inventory skew controls, and maker fee optimization.",defaults:{risk:"low",kpiTarget:"8",horizon:7,frequency:"5m",revenueSource:"market-making",execMode:"autonomous",autoApproveThreshold:"100",stopLossPct:"2.0",takeProfitPct:"4.0",minConfidence:"70",positionSizing:"fixed",daaVelocityFilter:"0",maxDailyActions:"48",cooldownCycles:"0",pairMode:"kas-usdc",actionMode:"full"}},{id:"high_freq_trader",name:"High Frequency Trader",tag:"HFT-PRO",tagColor:"#8B5CF6",class:"institutional",purpose:"High-frequency algorithmic trading that maximizes profit through rapid execution and DAG micro-structure analysis.",bestFor:"Maximum capital efficiency, arbitrage opportunities, and rapid profit capture.",desc:"Ultra-low latency execution, micro-structure pricing, order book dynamics, and real-time delta-neutral positioning.",defaults:{risk:"high",kpiTarget:"50",horizon:1,frequency:"1m",revenueSource:"market-making",execMode:"autonomous",autoApproveThreshold:"500",stopLossPct:"1.5",takeProfitPct:"3.0",minConfidence:"50",positionSizing:"fixed",daaVelocityFilter:"0",maxDailyActions:"100",cooldownCycles:"0",pairMode:"kas-usdc"}},{id:"trader",name:"Pro Trader",tag:"TRADER",tagColor:"#F97316",class:"trading",purpose:"Active trading strategy with technical analysis, momentum capture, and active position management.",bestFor:"Day trading, swing trading, and active regime capture.",desc:"Technical indicators, multi-timeframe analysis, active stops, and quick position rotation.",defaults:{risk:"medium",kpiTarget:"25",horizon:14,frequency:"15m",revenueSource:"momentum",execMode:"autonomous",autoApproveThreshold:"75",stopLossPct:"5.0",takeProfitPct:"15.0",minConfidence:"58",positionSizing:"kelly",daaVelocityFilter:"3",maxDailyActions:"15",cooldownCycles:"1",pairMode:"accumulation"}},{id:"custom",name:"Full Custom",tag:"CUSTOM",tagColor:"#64748B",class:"custom",purpose:"Build your own strategy with complete parameter control.",bestFor:"Advanced users who want full customization over every execution parameter.",desc:"Access all params: sizing method, DAA filters, stop/take-profit, pair mode, confidence gates, and more.",defaults:{risk:"medium",kpiTarget:"12",horizon:30,frequency:"1h",revenueSource:"momentum",execMode:"manual",autoApproveThreshold:"50",stopLossPct:"4.0",takeProfitPct:"10.0",minConfidence:"55",positionSizing:"kelly",daaVelocityFilter:"0",maxDailyActions:"8",cooldownCycles:"1",pairMode:"accumulation"}}],Qo=[{v:"low",l:"Low",desc:"Tight stops Â· max 5â€“8% exposure per action"},{v:"medium",l:"Medium",desc:"Balanced Kelly sizing Â· 10â€“15% max exposure"},{v:"high",l:"High",desc:"Aggressive Â· up to 22% Â· wide targets"}],cn=[{v:"autonomous",l:"Fully Autonomous",desc:"Auto-signs under threshold. Manual above."},{v:"manual",l:"Manual Approval",desc:"Every action requires wallet signature."},{v:"notify",l:"Notify Only",desc:"Decisions generated, no execution."}],Ql=[{v:"kelly",l:"Full Kelly",desc:"Kelly criterion fraction Â· maximizes log-wealth growth"},{v:"half-kelly",l:"Half Kelly",desc:"50% of Kelly Â· lower variance, safer drawdown"},{v:"fixed",l:"Fixed Size",desc:"Fixed % of capital per cycle regardless of edge"}],Jl=[{v:"accumulation",l:"Accumulation Only",desc:"Buy & hold KAS Â· no stable side Â· current mode"},{v:"kas-usdc",l:"KAS / USDC Pairs",desc:"Bi-directional Â· requires native USDC on Kaspa L1"},{v:"dual",l:"Dual Mode",desc:"Accumulate by default Â· flip to pair when available"}],Zl=[{v:"kas-native",l:"KAS-Native",desc:"P&L in KAS Â· accumulation-first baseline"},{v:"usdc-stable",l:"USDC-Stable",desc:"P&L in USDC equivalent Â· stable-denominated reporting"}],lt=({label:e,sub:t})=>r.jsxs("div",{style:{marginBottom:8},children:[r.jsx("div",{style:{fontSize:9,color:n.accent,fontWeight:700,...f,letterSpacing:"0.15em"},children:e}),t&&r.jsx("div",{style:{fontSize:9,color:n.dim,marginTop:1},children:t})]}),mr=({opts:e,value:t,onChange:s,cols:i=3})=>r.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${i},1fr)`,gap:5},children:e.map(o=>{const a=t===o.v;return r.jsxs("div",{onClick:()=>s(o.v),style:{padding:"8px 10px",borderRadius:6,cursor:"pointer",border:`1px solid ${a?n.accent:"rgba(33,48,67,0.7)"}`,background:a?`linear-gradient(135deg, ${n.accent}18 0%, rgba(8,13,20,0.5) 100%)`:"rgba(16,25,35,0.4)",transition:"all 0.15s"},children:[r.jsx("div",{style:{fontSize:10,color:a?n.accent:n.text,fontWeight:700,...f,marginBottom:o.desc?2:0},children:o.l}),o.desc&&r.jsx("div",{style:{fontSize:8,color:n.dim,lineHeight:1.3},children:o.desc})]},o.v)})}),ed=({mode:e})=>e==="kas-usdc"?r.jsx(J,{text:"KAS/USDC PAIR",color:n.purple}):e==="dual"?r.jsx(J,{text:"DUAL MODE",color:n.warn}):r.jsx(J,{text:"ACCUMULATION",color:n.accent}),td=({d:e,set:t,wallet:s})=>{const[i,o]=g.useState(!1),a=e.pairMode==="kas-usdc"||e.pairMode==="dual",l=c=>{t("strategyTemplate",c.id),t("strategyLabel",c.name),t("strategyClass",c.class),Object.entries(c.defaults).forEach(([d,u])=>t(d,u)),c.id==="custom"&&o(!0)};return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:14},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:15,color:n.text,fontWeight:700,...f},children:"Configure Agent"}),r.jsxs("div",{style:{fontSize:10,color:n.dim,marginTop:1},children:["Wallet: ",r.jsx("span",{style:{color:n.accent,...f},children:ht(s==null?void 0:s.address)})]})]}),e.pairMode&&r.jsx(ed,{mode:e.pairMode})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"STRATEGY PROFILE",sub:"Accumulation-first Â· KAS/USDC pair-ready"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:gs.map(c=>{const d=e.strategyTemplate===c.id,u=c.id==="kas_usdc_pair",m=u?n.purple:n.accent;return r.jsxs("div",{onClick:()=>l(c),style:{padding:"10px 12px",borderRadius:8,cursor:"pointer",border:`1px solid ${d?m:u?`${n.purple}30`:"rgba(33,48,67,0.6)"}`,background:d?`linear-gradient(135deg, ${m}18 0%, rgba(8,13,20,0.6) 100%)`:u?`${n.purple}06`:"rgba(16,25,35,0.4)",boxShadow:d?`0 2px 10px ${m}20`:"none",transition:"all 0.18s",position:"relative"},children:[u&&r.jsx("span",{style:{position:"absolute",top:6,right:6,fontSize:7,color:n.purple,fontWeight:700,...f,background:`${n.purple}18`,padding:"1px 5px",borderRadius:3,border:`1px solid ${n.purple}25`},children:"PAIR-READY"}),r.jsx(J,{text:c.tag,color:c.tagColor||n.ok}),r.jsx("div",{style:{fontSize:11,color:d?m:n.text,fontWeight:700,...f,marginTop:5,marginBottom:3},children:c.name}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.35},children:c.desc})]},c.id)})})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"PROFESSIONAL PRESETS"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6},children:Xo.map(c=>{const d=e.strategyTemplate===c.id;return r.jsxs("div",{onClick:()=>l(c),style:{padding:"9px 11px",borderRadius:7,cursor:"pointer",border:`1px solid ${d?n.accent:"rgba(33,48,67,0.6)"}`,background:d?`linear-gradient(135deg, ${n.accent}12 0%, rgba(8,13,20,0.5) 100%)`:"rgba(16,25,35,0.35)",transition:"all 0.15s"},children:[r.jsx(J,{text:c.tag,color:c.tagColor||n.purple}),r.jsx("div",{style:{fontSize:10,color:d?n.accent:n.text,fontWeight:700,...f,marginTop:5,marginBottom:2},children:c.name}),c.id!=="custom"&&r.jsxs("div",{style:{fontSize:8,color:n.dim,...f},children:["Risk: ",c.defaults.risk," Â· ",c.defaults.kpiTarget,"% target"]})]},c.id)})})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"AGENT IDENTITY"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:8},children:[r.jsx(Be,{label:"Agent Name",value:e.name,onChange:c=>t("name",c),placeholder:"KAS-Alpha-01"}),r.jsx(Be,{label:"ROI Target",value:e.kpiTarget,onChange:c=>t("kpiTarget",c),type:"number",suffix:"%"}),r.jsx(Be,{label:"Capital / Cycle",value:e.capitalLimit,onChange:c=>t("capitalLimit",c),type:"number",suffix:"KAS"})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[r.jsxs("div",{children:[r.jsx(lt,{label:"RISK TOLERANCE"}),r.jsx(mr,{opts:Qo,value:e.risk,onChange:c=>t("risk",c),cols:3})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"PAIR MODE",sub:"KAS/USDC activates on Kaspa L1"}),r.jsx(mr,{opts:Jl,value:e.pairMode||"accumulation",onChange:c=>t("pairMode",c),cols:3})]})]}),a&&r.jsxs("div",{style:{padding:"10px 14px",background:`${n.purple}08`,border:`1px solid ${n.purple}25`,borderRadius:8},children:[r.jsx("div",{style:{fontSize:9,color:n.purple,fontWeight:700,...f,marginBottom:8},children:"KAS / USDC PAIR PARAMS"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8},children:[r.jsx(Be,{label:"Stable Entry Bias",value:e.stableEntryBias||"0.6",onChange:c=>t("stableEntryBias",c),type:"number",suffix:"Ã—",hint:"Buy KAS with USDC on dips (0â€“1)"}),r.jsx(Be,{label:"Stable Exit Bias",value:e.stableExitBias||"0.4",onChange:c=>t("stableExitBias",c),type:"number",suffix:"Ã—",hint:"Sell KAS to USDC on strength (0â€“1)"}),r.jsx(Be,{label:"Slippage Tolerance",value:e.usdcSlippageTolerance||"0.5",onChange:c=>t("usdcSlippageTolerance",c),type:"number",suffix:"%",hint:"Max slippage on KAS/USDC trades"})]})]}),r.jsxs("div",{style:{borderTop:"1px solid rgba(33,48,67,0.5)",paddingTop:12},children:[r.jsxs("div",{onClick:()=>o(c=>!c),style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",userSelect:"none",marginBottom:i?12:0},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:10,color:n.accent,fontWeight:700,...f,letterSpacing:"0.1em"},children:[i?"â–²":"â–¼"," ADVANCED STRATEGY CONFIG"]}),r.jsx("div",{style:{fontSize:8,color:n.dim,marginTop:1},children:"Stop/take-profit Â· sizing Â· DAA filters Â· confidence Â· limits"})]}),r.jsx(J,{text:i?"COLLAPSE":"EXPAND",color:n.dim})]}),i&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[r.jsxs("div",{children:[r.jsx(lt,{label:"RISK PARAMS"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:[r.jsx(Be,{label:"Stop Loss",value:e.stopLossPct||"4.0",onChange:c=>t("stopLossPct",c),type:"number",suffix:"%"}),r.jsx(Be,{label:"Take Profit",value:e.takeProfitPct||"10.0",onChange:c=>t("takeProfitPct",c),type:"number",suffix:"%"})]})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"EXECUTION MODE"}),r.jsx(mr,{opts:cn,value:e.execMode,onChange:c=>t("execMode",c),cols:3})]})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"POSITION SIZING"}),r.jsx(mr,{opts:Ql,value:e.positionSizing||"kelly",onChange:c=>t("positionSizing",c),cols:3})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"FILTERS & LIMITS"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:6},children:[r.jsx(Be,{label:"Min Confidence",value:e.minConfidence||"55",onChange:c=>t("minConfidence",c),type:"number",suffix:"%",hint:"Min AI confidence to enter"}),r.jsx(Be,{label:"Min DAA Velocity",value:e.daaVelocityFilter||"0",onChange:c=>t("daaVelocityFilter",c),type:"number",suffix:"blk/s",hint:"DAA speed gate (0 = off)"}),r.jsx(Be,{label:"Auto-Approve â‰¤",value:e.autoApproveThreshold,onChange:c=>t("autoApproveThreshold",c),type:"number",suffix:"KAS",hint:"Auto-sign below this size"}),r.jsx(Be,{label:"Max Daily Actions",value:e.maxDailyActions||"8",onChange:c=>t("maxDailyActions",c),type:"number",hint:"Hard cap per 24h"}),r.jsx(Be,{label:"Cooldown Cycles",value:e.cooldownCycles||"1",onChange:c=>t("cooldownCycles",c),type:"number",hint:"Idle cycles after execution"}),r.jsx(Be,{label:"Horizon (days)",value:e.horizon,onChange:c=>t("horizon",c),type:"number",hint:"KPI evaluation window"})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[r.jsxs("div",{children:[r.jsx(lt,{label:"P&L DENOMINATION"}),r.jsx(mr,{opts:Zl,value:e.pnlTracking||"kas-native",onChange:c=>t("pnlTracking",c),cols:2})]}),r.jsxs("div",{children:[r.jsx(lt,{label:"PORTFOLIO WEIGHT"}),r.jsx(Be,{label:"Allocation %",value:e.portfolioAllocationPct||"25",onChange:c=>t("portfolioAllocationPct",c),type:"number",suffix:"%",hint:"Target % of total portfolio"})]})]}),r.jsxs(ye,{p:10,style:{background:`linear-gradient(135deg, ${n.accent}06 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${n.accent}15`},children:[r.jsx("div",{style:{fontSize:8,color:n.accent,fontWeight:700,...f,letterSpacing:"0.1em",marginBottom:8},children:"PARAM SUMMARY"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:6},children:[{k:"Risk",v:String(e.risk||"â€”").toUpperCase()},{k:"Sizing",v:String(e.positionSizing||"kelly").toUpperCase()},{k:"Pair",v:String(e.pairMode||"accumulation").replace("-","/").toUpperCase()},{k:"Stop",v:`${e.stopLossPct||"4.0"}%`},{k:"TP",v:`${e.takeProfitPct||"10.0"}%`},{k:"Conf",v:`${e.minConfidence||"55"}%`},{k:"DAA",v:`>${e.daaVelocityFilter||"0"}`},{k:"Daily",v:`${e.maxDailyActions||"8"}`},{k:"P&L",v:String(e.pnlTracking||"kas-native").replace("kas-","KAS-").replace("usdc-","USDC-")},{k:"Mode",v:String(e.execMode||"manual").toUpperCase()}].map(c=>r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:7,color:n.dim,...f,marginBottom:1},children:c.k}),r.jsx("div",{style:{fontSize:10,color:n.text,fontWeight:700,...f},children:c.v})]},c.k))})]})]})]})]})},rd=({d:e,set:t})=>r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:17,color:n.text,fontWeight:700,marginBottom:3,...f},children:"Execution & Signing"}),r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:20},children:"Configure how the agent acts and when your wallet signs."}),cn.map(s=>{const i=e.execMode===s.v;return r.jsxs("div",{onClick:()=>t("execMode",s.v),style:{padding:14,borderRadius:6,marginBottom:10,cursor:"pointer",border:`1px solid ${i?n.accent:n.border}`,background:i?n.aLow:n.s2,transition:"all 0.15s"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:4},children:[r.jsx("div",{style:{width:11,height:11,borderRadius:"50%",border:`2px solid ${i?n.accent:n.muted}`,background:i?n.accent:"transparent",flexShrink:0}}),r.jsx("span",{style:{fontSize:13,color:i?n.accent:n.text,fontWeight:700,...f},children:s.l})]}),r.jsx("div",{style:{fontSize:12,color:n.dim,marginLeft:21},children:s.desc})]},s.v)})]}),nd=({d:e,wallet:t,onDeploy:s})=>{const i=e.name&&e.capitalLimit&&e.kpiTarget;return gs.find(o=>o.id===e.strategyTemplate),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:17,color:n.text,fontWeight:700,marginBottom:3,...f},children:"Review & Deploy"}),r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:18},children:"Agent vault will be provisioned. Initial funding requires a wallet signature."}),r.jsx(ye,{p:0,style:{marginBottom:14},children:[["Agent",e.name||"â€”"],["Strategy Template",e.strategyLabel||e.strategyTemplate||"Custom"],["Wallet",ht(t==null?void 0:t.address)],["Network",(t==null?void 0:t.network)||Ie],["ROI Target",`${e.kpiTarget}%`],["Capital / Cycle",`${e.capitalLimit} KAS`],["Portfolio Allocator","AUTO"],["Risk",e.risk.toUpperCase()],["Exec Mode",e.execMode.replace(/_/g," ").toUpperCase()],["Signing","WALLET-NATIVE GUARDRAILS"]].map(([o,a],l,c)=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"9px 16px",borderBottom:l<c.length-1?`1px solid ${n.border}`:"none"},children:[r.jsx("span",{style:{fontSize:12,color:n.dim,...f},children:o}),r.jsx("span",{style:{fontSize:12,color:n.text,...f},children:a})]},o))}),r.jsx(_e,{onClick:s,disabled:!i,style:{width:"100%",padding:"11px 0"},children:"DEPLOY AGENT â€” SIGN WITH WALLET"}),!i&&r.jsx("div",{style:{fontSize:11,color:n.warn,marginTop:6,textAlign:"center",...f},children:"Name, capital, and target required."})]})};function sd(e,t){if(!e||!e.length)return;const s=No.toLowerCase();for(const i of e){const o=i.to.toLowerCase()===s,a=(i.tag||"").toLowerCase()==="primary"||i.amount_kas===t&&t>0;if(o&&a)throw new Error(`SECURITY VALIDATION FAILED: Principal (${i.amount_kas} KAS) cannot be sent to Treasury. Principal must go to agent deposit address. Treasury receives only platform fee.`)}}function ee(e,t=0){const s=Number(e);return Number.isFinite(s)?s:t}function id(e){if(!Array.isArray(e==null?void 0:e.outputs))return;const t=e.outputs.map(s=>({to:ut(String((s==null?void 0:s.to)||(s==null?void 0:s.address)||""),et),amount_kas:Number(ee((s==null?void 0:s.amount_kas)??(s==null?void 0:s.amount),0).toFixed(6)),tag:s!=null&&s.tag?String(s.tag).slice(0,40):void 0})).filter(s=>s.to&&s.amount_kas>0);if(t.length)return t}function od(e,t,s){if(!(e!=null&&e.length))return{to:t,amount_kas:s};const i=e.find(o=>String(o.tag||"").toLowerCase()==="primary")||e[0];return{to:i.to,amount_kas:i.amount_kas}}function hs(e){var h,v;const t=id(e),s=String((e==null?void 0:e.to)||"").trim(),i=Number(ee(e==null?void 0:e.amount_kas,0).toFixed(6)),o=s?ut(s,et):((h=t==null?void 0:t[0])==null?void 0:h.to)||"",a=i>0?i:Number(((v=t==null?void 0:t[0])==null?void 0:v.amount_kas)||0),l=od(t,o,a),c=l.to,d=Number(ee(l.amount_kas,0).toFixed(6));if(!(d>0)||!c)throw new Error("Invalid tx amount_kas/to; must be > 0 and valid address");sd(t,d);const u=String((e==null?void 0:e.status)||"pending").toLowerCase(),m=u==="pending"||u==="signing"||u==="signed"||u==="rejected"||u==="failed"?u:"pending";return{...e,id:String((e==null?void 0:e.id)||"").trim(),type:String((e==null?void 0:e.type)||"TX").trim()||"TX",from:e!=null&&e.from?String(e.from).trim():void 0,to:c,amount_kas:d,outputs:t,purpose:String((e==null?void 0:e.purpose)||"ForgeOS transaction").trim().slice(0,140),status:m,ts:Math.max(0,Math.round(ee(e==null?void 0:e.ts,Date.now()))),receipt_lifecycle:(e==null?void 0:e.receipt_lifecycle)==="broadcasted"||(e==null?void 0:e.receipt_lifecycle)==="pending_confirm"||(e==null?void 0:e.receipt_lifecycle)==="confirmed"||(e==null?void 0:e.receipt_lifecycle)==="failed"||(e==null?void 0:e.receipt_lifecycle)==="timeout"?e.receipt_lifecycle:"submitted",submitted_ts:Math.max(0,Math.round(ee(e==null?void 0:e.submitted_ts,(e==null?void 0:e.ts)??Date.now()))),broadcast_ts:ee(e==null?void 0:e.broadcast_ts,NaN)>0?Math.round(ee(e==null?void 0:e.broadcast_ts,0)):void 0,confirm_ts:ee(e==null?void 0:e.confirm_ts,NaN)>0?Math.round(ee(e==null?void 0:e.confirm_ts,0)):void 0,confirm_detected_ts:ee(e==null?void 0:e.confirm_detected_ts,NaN)>0?Math.round(ee(e==null?void 0:e.confirm_detected_ts,0)):void 0,confirm_ts_source:(e==null?void 0:e.confirm_ts_source)==="chain"||(e==null?void 0:e.confirm_ts_source)==="poll"?e.confirm_ts_source:void 0,receipt_last_checked_ts:ee(e==null?void 0:e.receipt_last_checked_ts,NaN)>0?Math.round(ee(e==null?void 0:e.receipt_last_checked_ts,0)):void 0,receipt_next_check_at:ee(e==null?void 0:e.receipt_next_check_at,NaN)>0?Math.round(ee(e==null?void 0:e.receipt_next_check_at,0)):void 0,receipt_attempts:Math.max(0,Math.round(ee(e==null?void 0:e.receipt_attempts,0))),confirmations:Math.max(0,Math.round(ee(e==null?void 0:e.confirmations,0))),failure_reason:(e==null?void 0:e.failure_reason)==null?null:String(e.failure_reason).slice(0,240),broadcast_price_usd:Number.isFinite(ee(e==null?void 0:e.broadcast_price_usd,NaN))?ee(e==null?void 0:e.broadcast_price_usd,0):void 0,confirm_price_usd:Number.isFinite(ee(e==null?void 0:e.confirm_price_usd,NaN))?ee(e==null?void 0:e.confirm_price_usd,0):void 0,receipt_block_time_ms:ee(e==null?void 0:e.receipt_block_time_ms,NaN)>0?Math.round(ee(e==null?void 0:e.receipt_block_time_ms,0)):void 0,receipt_fee_sompi:Number.isFinite(ee(e==null?void 0:e.receipt_fee_sompi,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.receipt_fee_sompi,0))):void 0,receipt_fee_kas:Number.isFinite(ee(e==null?void 0:e.receipt_fee_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.receipt_fee_kas,0).toFixed(8))):void 0,receipt_mass:Number.isFinite(ee(e==null?void 0:e.receipt_mass,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.receipt_mass,0))):void 0,receipt_source_path:e!=null&&e.receipt_source_path?String(e.receipt_source_path).slice(0,240):void 0,receipt_source:e!=null&&e.receipt_source?String(e.receipt_source).slice(0,120):void 0,receipt_imported_from:(e==null?void 0:e.receipt_imported_from)==="callback_consumer"||(e==null?void 0:e.receipt_imported_from)==="kaspa_api"?e.receipt_imported_from:void 0,receipt_backend_updated_at:ee(e==null?void 0:e.receipt_backend_updated_at,NaN)>0?Math.round(ee(e==null?void 0:e.receipt_backend_updated_at,0)):void 0,receipt_slippage_kas:Number.isFinite(ee(e==null?void 0:e.receipt_slippage_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.receipt_slippage_kas,0).toFixed(8))):void 0,backend_confirm_ts:ee(e==null?void 0:e.backend_confirm_ts,NaN)>0?Math.round(ee(e==null?void 0:e.backend_confirm_ts,0)):void 0,backend_confirmations:Number.isFinite(ee(e==null?void 0:e.backend_confirmations,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.backend_confirmations,0))):void 0,backend_receipt_fee_kas:Number.isFinite(ee(e==null?void 0:e.backend_receipt_fee_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.backend_receipt_fee_kas,0).toFixed(8))):void 0,backend_receipt_fee_sompi:Number.isFinite(ee(e==null?void 0:e.backend_receipt_fee_sompi,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.backend_receipt_fee_sompi,0))):void 0,backend_receipt_slippage_kas:Number.isFinite(ee(e==null?void 0:e.backend_receipt_slippage_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.backend_receipt_slippage_kas,0).toFixed(8))):void 0,chain_confirm_ts:ee(e==null?void 0:e.chain_confirm_ts,NaN)>0?Math.round(ee(e==null?void 0:e.chain_confirm_ts,0)):void 0,chain_confirmations:Number.isFinite(ee(e==null?void 0:e.chain_confirmations,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.chain_confirmations,0))):void 0,chain_receipt_fee_kas:Number.isFinite(ee(e==null?void 0:e.chain_receipt_fee_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.chain_receipt_fee_kas,0).toFixed(8))):void 0,chain_receipt_fee_sompi:Number.isFinite(ee(e==null?void 0:e.chain_receipt_fee_sompi,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.chain_receipt_fee_sompi,0))):void 0,chain_derived_slippage_kas:Number.isFinite(ee(e==null?void 0:e.chain_derived_slippage_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.chain_derived_slippage_kas,0).toFixed(8))):void 0,receipt_consistency_status:(e==null?void 0:e.receipt_consistency_status)==="consistent"||(e==null?void 0:e.receipt_consistency_status)==="mismatch"||(e==null?void 0:e.receipt_consistency_status)==="insufficient"?e.receipt_consistency_status:void 0,receipt_consistency_mismatches:Array.isArray(e==null?void 0:e.receipt_consistency_mismatches)?e.receipt_consistency_mismatches.map(A=>String(A)).filter(Boolean).slice(0,8):void 0,receipt_consistency_checked_ts:ee(e==null?void 0:e.receipt_consistency_checked_ts,NaN)>0?Math.round(ee(e==null?void 0:e.receipt_consistency_checked_ts,0)):void 0,receipt_consistency_confirm_ts_drift_ms:Number.isFinite(ee(e==null?void 0:e.receipt_consistency_confirm_ts_drift_ms,NaN))?Math.max(0,Math.round(ee(e==null?void 0:e.receipt_consistency_confirm_ts_drift_ms,0))):void 0,receipt_consistency_fee_diff_kas:Number.isFinite(ee(e==null?void 0:e.receipt_consistency_fee_diff_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.receipt_consistency_fee_diff_kas,0).toFixed(8))):void 0,receipt_consistency_slippage_diff_kas:Number.isFinite(ee(e==null?void 0:e.receipt_consistency_slippage_diff_kas,NaN))?Math.max(0,Number(ee(e==null?void 0:e.receipt_consistency_slippage_diff_kas,0).toFixed(8))):void 0,metaKind:(e==null?void 0:e.metaKind)==="treasury_fee"?"treasury_fee":(e==null?void 0:e.metaKind)==="deploy"?"deploy":"action"}}function ln(e){const t={id:String((e==null?void 0:e.id)||"").trim(),status:"pending",ts:Date.now(),submitted_ts:Date.now(),receipt_lifecycle:"submitted",receipt_attempts:0,confirmations:0,failure_reason:null,...e};if(!t.id)throw new Error("Queue tx requires id");return hs(t)}async function ad(e,t){const s=hs(t),i=Array.isArray(s.outputs)?s.outputs:[],o=i.length>1;if(o&&!ve.supportsNativeMultiOutput(String((e==null?void 0:e.provider)||"")))throw new Error(`Wallet ${String((e==null?void 0:e.provider)||"unknown")} does not support native multi-output send`);return(e==null?void 0:e.provider)==="kasware"?ve.sendKasware(s.to,s.amount_kas):(e==null?void 0:e.provider)==="kastle"?o&&ve.canKastleSignAndBroadcastRawTx()?ve.sendKastleRawTx(i,s.purpose):ve.sendKastle(s.to,s.amount_kas):(e==null?void 0:e.provider)==="ghost"?i.length?ve.sendGhostOutputs(i,s.purpose):ve.sendGhost(s.to,s.amount_kas):(e==null?void 0:e.provider)==="kaspium"?ve.sendKaspium(s.to,s.amount_kas,s.purpose):(e==null?void 0:e.provider)==="tangem"||(e==null?void 0:e.provider)==="onekey"?ve.sendHardwareBridge(String((e==null?void 0:e.provider)||"hardware"),s.to,s.amount_kas,s.purpose,i):(await new Promise(a=>setTimeout(a,300)),Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join(""))}function cd({wallet:e,onComplete:t,editAgent:s,onCancel:i}){var _;const[o,a]=g.useState(0),[l,c]=g.useState(s?{name:s.name||"",kpiTarget:s.kpiTarget||"12",capitalLimit:s.capitalLimit||"5000",risk:s.risk||"medium",execMode:s.execMode||"manual",autoApproveThreshold:s.autoApproveThreshold||"50",kpiMetric:s.kpiMetric||"ROI %",horizon:s.horizon||30,revenueSource:s.revenueSource||"momentum",dataSources:s.dataSources||["KAS On-Chain","Kaspa DAG"],frequency:s.frequency||"1h",strategyTemplate:s.strategyTemplate||"dca_accumulator",strategyLabel:s.strategyLabel||"Steady DCA Builder",strategyClass:s.strategyClass||"accumulation",riskBudgetWeight:s.riskBudgetWeight||"1.0",portfolioAllocationPct:s.portfolioAllocationPct||"25"}:{...Xl}),d=(k,j)=>c(C=>({...C,[k]:j})),[u,m]=g.useState(!1),h=()=>{m(!0)},v=k=>{m(!1),t(s?{...s,...l,wallet:e,deployTx:k,updatedAt:Date.now()}:{...l,wallet:e,deployTx:k,deployedAt:Date.now(),agentId:`forge_${Jr()}`})},A=ln({id:`deploy_${Jr()}`,type:"AGENT_DEPLOY",metaKind:"deploy",from:e==null?void 0:e.address,to:Io,amount_kas:parseFloat(l.capitalLimit)||5e3,purpose:"Agent vault provisioning + initial capital"});return r.jsxs("div",{style:{maxWidth:1040,margin:"0 auto",padding:"clamp(18px, 2.2vw, 34px)"},children:[u&&r.jsx(ms,{tx:A,wallet:e,onSign:v,onReject:()=>m(!1)}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:22,flexWrap:"wrap"},children:[r.jsxs("span",{style:{fontSize:10,color:n.dim,letterSpacing:"0.12em",...f},children:["Forge-OS / ",s?"EDIT AGENT":"NEW AGENT"]}),r.jsx("span",{style:{width:1,height:12,background:n.border,display:"inline-block"}}),r.jsx(J,{text:((_=e==null?void 0:e.provider)==null?void 0:_.toUpperCase())||"CONNECTED",color:n.ok,dot:!0})]}),r.jsxs(ye,{p:28,style:{maxWidth:680,margin:"0 auto"},children:[r.jsx("div",{style:{display:"flex",gap:5,marginBottom:26},children:[0,1,2].map(k=>r.jsx("div",{style:{height:3,flex:1,borderRadius:2,background:k<=o?n.accent:n.muted,transition:"background 0.3s"}},k))}),o===0&&r.jsx(td,{d:l,set:d,wallet:e}),o===1&&r.jsx(rd,{d:l,set:d}),o===2&&r.jsx(nd,{d:l,wallet:e,onDeploy:h}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:22,paddingTop:16,borderTop:`1px solid ${n.border}`,alignItems:"center"},children:[i?r.jsx(_e,{onClick:i,variant:"ghost",children:"â† Back"}):r.jsx(_e,{onClick:()=>a(k=>k-1),variant:"ghost",disabled:o===0,children:"BACK"}),r.jsxs("span",{style:{fontSize:11,color:n.dim,...f},children:["STEP ",o+1," / 3"]}),o<2&&r.jsx(_e,{onClick:()=>a(k=>k+1),children:"NEXT"}),o===2&&r.jsx("div",{})]})]})]})}function $(e,t=0){const s=Number(e);return Number.isFinite(s)?s:t}function te(e,t,s){return Math.min(s,Math.max(t,e))}function Jo(e){return e.length?e.reduce((t,s)=>t+s,0)/e.length:0}function ld(e){if(e.length<2)return 0;const t=Jo(e);return e.reduce((s,i)=>s+(i-t)**2,0)/(e.length-1)}function xs(e){return Math.sqrt(Math.max(0,ld(e)))}function yr(e){return e[e.length-1]}function dd(e){if(e.length<2)return[];const t=[];for(let s=1;s<e.length;s+=1)t.push(e[s]-e[s-1]);return t}function kn(e,t=1){if(e.length<=t)return 0;const s=yr(e),i=e[e.length-1-t];return!(i>0)||!Number.isFinite(s)?0:(s-i)/i}function ud(e){const t=[];for(let s=1;s<e.length;s+=1){const i=e[s-1],o=e[s];i>0&&o>0&&t.push(Math.log(o/i))}return t}function fd(e,t=.94){if(!e.length)return 0;let s=e[0]**2;for(let i=1;i<e.length;i+=1)s=t*s+(1-t)*e[i]**2;return Math.sqrt(Math.max(0,s))}function Zo(e){if(e.length<2)return 0;const t=e.length;let s=0,i=0,o=0,a=0;for(let c=0;c<t;c+=1)s+=c,i+=e[c],o+=c*e[c],a+=c*c;const l=t*a-s*s;return l===0?0:(t*o-s*i)/l}function pd(e,t){if(!t.length)return 0;const s=xs(t);return s===0?0:(e-Jo(t))/s}function md(e){if(!e.length)return 0;let t=e[0],s=0;for(const i of e)i>t&&(t=i),t>0&&(s=Math.max(s,(t-i)/t));return s}function gd(e){return e>30?1:e<-30?0:1/(1+Math.exp(-e))}function z(e,t=4){const s=10**t;return Math.round(e*s)/s}function Br(e,t){return t<=0?[]:e.slice(Math.max(0,e.length-t))}const hd={"1h":60*60*1e3,"4h":4*60*60*1e3,"24h":24*60*60*1e3},Nn={"1h":.45,"4h":.35,"24h":.2};function xd(e,t){return{candle:{timeframe:e,startTs:t,endTs:t,open:0,high:0,low:0,close:0,samples:0,coverage:0},returnPct:0,slopePct:0,volatilityPct:0,score:0}}function In(e,t,s){const i=hd[e],o=s-i,a=t.filter(K=>K.ts>=o&&K.ts<=s&&K.priceUsd>0);if(a.length<2)return xd(e,s);const l=a[0],c=a[a.length-1];let d=-1/0,u=1/0;const m=[],h=[];for(let K=0;K<a.length;K+=1){const F=Math.max(0,$(a[K].priceUsd,0));if(m.push(F),F>d&&(d=F),F<u&&(u=F),K>0){const H=m[K-1];H>0&&F>0&&h.push(Math.log(F/H))}}const v=Math.max(0,$(l.priceUsd,0)),A=Math.max(0,$(c.priceUsd,0)),_=v>0?(A-v)/v*100:0,k=Zo(m),j=v>0?k/v*100:0,C=xs(h)*100,R=Math.max(0,c.ts-l.ts),I=te(R/i,0,1),p=te(_/2.6,-1.2,1.2),x=te(j/.8,-1,1),E=te(C/2.5,0,.55),w=te(p*.65+x*.35-E,-1,1);return{candle:{timeframe:e,startTs:l.ts,endTs:c.ts,open:z(v,8),high:z(d===-1/0?A:d,8),low:z(u===1/0?A:u,8),close:z(A,8),samples:a.length,coverage:z(I,4)},returnPct:z(_,4),slopePct:z(j,4),volatilityPct:z(C,4),score:z(w,4)}}function yd(e,t=Date.now()){const s=In("1h",e,t),i=In("4h",e,t),o=In("24h",e,t),a={"1h":s,"4h":i,"24h":o},l=Object.entries(a).filter(([,_])=>_.candle.samples>=2&&_.candle.coverage>.05);if(l.length===0)return{signals:a,weightedScore:0,alignment:0,coverage:0,dominantTimeframe:"1h"};let c=0,d=0,u=0,m=0,h={tf:"1h",strength:0};for(const[_,k]of l){const j=Nn[_]*k.candle.coverage;c+=k.score*j,d+=j,u+=k.candle.coverage*Nn[_],m+=Math.sign(k.score)*Math.min(1,Math.abs(k.score));const C=Math.abs(k.score)*k.candle.coverage*Nn[_];C>h.strength&&(h={tf:_,strength:C})}const v=d>0?c/d:0,A=l.length>0?Math.abs(m/l.length):0;return{signals:a,weightedScore:z(te(v,-1,1),4),alignment:z(te(A,0,1),4),coverage:z(te(u,0,1),4),dominantTimeframe:h.tf}}function _d(e){const t=String((e==null?void 0:e.risk)||"medium").toLowerCase(),s=String((e==null?void 0:e.strategyTemplate)||"").toLowerCase();if(t==="low"){const o={label:"low",kellyCap:.08,riskCeiling:.42,exposureCapPct:.12,drawdownPenaltyStart:.03};return s==="dca_accumulator"?{...o,kellyCap:.06,exposureCapPct:.1,drawdownPenaltyStart:.025}:s==="dca_bot"?{...o,kellyCap:.07,exposureCapPct:.11,drawdownPenaltyStart:.028}:s==="mean_reversion"?{...o,riskCeiling:.38,exposureCapPct:.1}:o}if(t==="high"){const o={label:"high",kellyCap:.22,riskCeiling:.82,exposureCapPct:.35,drawdownPenaltyStart:.1};return s==="vol_breakout"?{...o,kellyCap:.2,exposureCapPct:.28,riskCeiling:.76}:o}const i={label:"medium",kellyCap:.14,riskCeiling:.65,exposureCapPct:.22,drawdownPenaltyStart:.06};return s==="trend"?{...i,kellyCap:.16,exposureCapPct:.24}:s==="dca_accumulator"?{...i,kellyCap:.1,riskCeiling:.58,exposureCapPct:.16,drawdownPenaltyStart:.045}:s==="mean_reversion"?{...i,riskCeiling:.56,exposureCapPct:.18}:s==="vol_breakout"?{...i,kellyCap:.12,riskCeiling:.6,drawdownPenaltyStart:.05}:i}function Sd(e){const t=String((e==null?void 0:e.strategyTemplate)||(e==null?void 0:e.strategyLabel)||"custom").toLowerCase();return t.includes("mean")?"mean_reversion":t.includes("trend")?"trend":t.includes("breakout")||t.includes("vol")?"vol_breakout":t.includes("dca")||t.includes("accum")?"dca":"custom"}function bd(e,t,s,i){const o=Sd(e),a=[`template:${o}`,`regime:${t}`];let l={mode:"BASELINE",reason:"",kellyCapMultiplier:1,riskCeilingMultiplier:1,exposureCapMultiplier:1,actionBias:0};return t==="RISK_OFF"?l={mode:"CAPITAL_PRESERVATION",reason:"risk_off",kellyCapMultiplier:.55,riskCeilingMultiplier:.78,exposureCapMultiplier:.62,actionBias:-.14}:o==="trend"?t==="RANGE_VOL"?l={mode:"TREND_TO_RANGE_DEFENSE",reason:"trend_template_range_vol",kellyCapMultiplier:.74,riskCeilingMultiplier:.86,exposureCapMultiplier:.78,actionBias:-.08}:(t==="TREND_UP"||t==="FLOW_ACCUMULATION")&&(l={mode:"TREND_CAPTURE",reason:"trend_template_aligned",kellyCapMultiplier:1.12,riskCeilingMultiplier:1.06,exposureCapMultiplier:1.1,actionBias:.06}):o==="mean_reversion"?t==="RANGE_VOL"?l={mode:"MEAN_REVERSION_ATTACK",reason:"mean_reversion_template_aligned",kellyCapMultiplier:1.1,riskCeilingMultiplier:1.04,exposureCapMultiplier:1.08,actionBias:.04}:t==="TREND_UP"&&(l={mode:"MEAN_REVERSION_TO_TREND_GUARD",reason:"mean_reversion_template_misaligned",kellyCapMultiplier:.86,riskCeilingMultiplier:.92,exposureCapMultiplier:.9,actionBias:-.03}):o==="dca"&&(t==="FLOW_ACCUMULATION"||t==="TREND_UP")?l={mode:"FLOW_DCA_SCALING",reason:"dca_template_flow_alignment",kellyCapMultiplier:1.08,riskCeilingMultiplier:1.02,exposureCapMultiplier:1.16,actionBias:.05}:o==="vol_breakout"&&t==="RANGE_VOL"&&(l={mode:"BREAKOUT_PREP",reason:"vol_breakout_template_aligned",kellyCapMultiplier:1.05,riskCeilingMultiplier:1.03,exposureCapMultiplier:1.03,actionBias:.03}),i.coverage>.2&&i.alignment<.45?(l.kellyCapMultiplier*=.84,l.exposureCapMultiplier*=.88,l.actionBias-=.04,a.push("mtf_alignment_low")):i.weightedScore>.35?(l.actionBias+=.03,a.push("mtf_bullish")):i.weightedScore<-.35&&(l.actionBias-=.06,a.push("mtf_bearish")),s==="HIGH"&&o!=="vol_breakout"&&(l.kellyCapMultiplier*=.9,l.exposureCapMultiplier*=.92,a.push("high_volatility_damping")),l.kellyCapMultiplier=te(l.kellyCapMultiplier,.45,1.22),l.riskCeilingMultiplier=te(l.riskCeilingMultiplier,.7,1.12),l.exposureCapMultiplier=te(l.exposureCapMultiplier,.55,1.28),l.actionBias=te(l.actionBias,-.2,.16),l.reason=[l.reason,...a].filter(Boolean).join(";"),l}function Pi(e){var a,l,c,d,u,m,h,v;if(!e)return null;const t=$(e.ts??e.fetched??((a=e==null?void 0:e.kasData)==null?void 0:a.fetched)??((l=e==null?void 0:e.kasData)==null?void 0:l.ts),NaN),s=$(e.priceUsd??e.price??((c=e==null?void 0:e.kasData)==null?void 0:c.priceUsd),0),i=$(e.daaScore??((d=e==null?void 0:e.dag)==null?void 0:d.daaScore)??((u=e==null?void 0:e.kasData)==null?void 0:u.daaScore)??((h=(m=e==null?void 0:e.kasData)==null?void 0:m.dag)==null?void 0:h.daaScore),0),o=$(e.walletKas??((v=e==null?void 0:e.kasData)==null?void 0:v.walletKas),0);return!Number.isFinite(t)||t<=0?null:{ts:t,priceUsd:Math.max(0,s),daaScore:Math.max(0,i),walletKas:Math.max(0,o)}}function Ed(e,t){const s=[];for(const a of Array.isArray(t==null?void 0:t.history)?t.history:[]){const l=Pi(a);l&&s.push(l)}const i=Pi(e);i&&s.push(i),s.sort((a,l)=>a.ts-l.ts);const o=[];for(const a of s){const l=o[o.length-1];l&&a.ts===l.ts&&a.priceUsd===l.priceUsd&&a.daaScore===l.daaScore&&a.walletKas===l.walletKas||o.push(a)}return o.slice(-240)}function Ad(e){return e<.008?"LOW":e<.02?"MEDIUM":"HIGH"}function vd(e,t){return!(t>0)||e<=t*.06?"MINIMAL":e<=t*.2?"MODERATE":"SIGNIFICANT"}function Td(e,t,s,i,o,a){return e<-.45||s>.12&&t>.02?"RISK_OFF":e>.35&&t<.03&&i>=0&&o>=.1?"TREND_UP":e<-.25&&o<-.18&&a>=.45?"TREND_DOWN":Math.abs(e)<.15&&t>.015&&a<.65?"RANGE_VOL":i>.25&&e>=0&&o>=-.05?"FLOW_ACCUMULATION":"NEUTRAL"}function Cd(e){const t=[];return e.dataQualityScore<.55&&t.push("Limited local sample history"),e.volatilityEstimate==="HIGH"&&t.push("Elevated short-horizon volatility"),e.drawdownPct>.08&&t.push("Recent drawdown pressure"),e.liquidityImpact!=="MINIMAL"&&t.push("Position size may impact wallet liquidity"),e.regime==="RISK_OFF"&&t.push("Risk-off regime detected"),typeof e.mtfAlignment=="number"&&e.mtfAlignment<.45&&t.push("Timeframe trend alignment is weak"),e.strategyMode&&e.strategyMode!=="BASELINE"&&t.push(`Regime-adaptive mode: ${e.strategyMode.toLowerCase().replace(/_/g," ")}`),t.length===0&&t.push("Normal market conditions"),t.slice(0,5)}function wd(e){const t=e.momentumScore>.2?"positive momentum":e.momentumScore<-.2?"negative momentum":"mixed momentum",s=e.regime.toLowerCase().replace(/_/g," "),i=e.mtfScore>.2?"bullish":e.mtfScore<-.2?"bearish":"mixed";return[`${e.action} because the local quant core detects ${s} with ${t}, EWMA volatility ${(e.ewmaVol*100).toFixed(2)}%, and DAA velocity ${z(e.daaVelocity,2)}.`,`Regime-adaptive mode ${e.strategyMode.toLowerCase().replace(/_/g," ")} is active; multi-timeframe (${e.mtfDominant}) signal is ${i}.`,`Model win probability is ${(e.winProbability*100).toFixed(1)}% with expected value ${z(e.expectedValuePct,2)}%; sizing is capped by risk profile and data-quality score ${z(e.dataQualityScore,2)}.`].join(" ")}function kd(e,t,s){const i=Ed(t,s),o=_d(e),a=Math.max(0,$(e==null?void 0:e.capitalLimit,0)),l=i[i.length-1],c=$(s==null?void 0:s.now,Date.now()),d=yd(i,c),u=i.map(ke=>ke.priceUsd).filter(ke=>ke>0),m=i.map(ke=>ke.daaScore).filter(ke=>ke>0),h=i.map(ke=>ke.walletKas).filter(ke=>ke>=0),v=ud(u),A=Br(v,24),_=v.length?yr(v):0,k=fd(A,.92),j=Ad(k),C=kn(u,1),R=kn(u,5),I=kn(u,20),p=C*1.4+R*.9+I*.6+d.weightedScore*.45+d.signals["1h"].score*.2,x=te(p*12,-2,2),E=te(pd(_,A),-4,4),w=dd(m),K=w.length?yr(w):0,F=Zo(Br(m,16)),H=xs(Br(w,16)),G=te(F/Math.max(1,Math.abs(K)||1)*.25+(K>0?.15:-.1),-1,1),B=s==null?void 0:s.dagSignals,P=B?te(B.bpsDeviation/200,-.12,.12)+(B.activitySurge?.08:0):0,Z=te(G+P,-1,1),re=md(Br(u,48)),b=te(u.length/32,0,1),M=te(m.length/32,0,1),ie=te(i.length/48,0,1),D=te(.15+ie*.45+b*.3+M*.1,.15,1),Y=Td(x,k,re,Z,d.weightedScore,d.alignment),ae=bd(e,Y,j,d),fe=te(o.riskCeiling*ae.riskCeilingMultiplier,.18,.94),Ae=te(o.exposureCapPct*ae.exposureCapMultiplier,.04,.55),ce=te(k/.03,0,2),Ke=te((re-o.drawdownPenaltyStart)/Math.max(.01,.2-o.drawdownPenaltyStart),0,1.2),Re=1-D,He=te((x+ae.actionBias)/2,-1,1),Ne=gd(.1+He*1.2+Z*.55+d.weightedScore*.48+ae.actionBias*.45-ce*.55-Ke*.6),$e=te(.5+(Ne-.5)*(.4+D*.6),.35,.82),Je=z($e*100,2),qe=x+ae.actionBias>.35?2.1:x+ae.actionBias<-.35?1.1:j==="HIGH"?1.3:1.7,De=z(te(k*100*2.2+1.4,1.2,12),2),Qe=z(te(De*qe,2.2,22),2),Te=z($e*Qe-(1-$e)*De,2),it=Math.max(.01,qe),tt=Math.max(0,$e-(1-$e)/it),S=te(o.kellyCap*ae.kellyCapMultiplier*(.55+.45*D),.015,Math.max(.02,o.kellyCap*1.25)),N=z(te(tt,0,S),4),le=z(te(.18+ce*.26+Ke*.28+(x<-.35?.16:0)+(j==="HIGH"&&H>15?.1:0)+Re*.18-(x>.35?.06:0)-(d.weightedScore>.25&&d.alignment>.55?.04:0)+(Y==="RISK_OFF"?.08:0),.04,.98),4),T=z(Te/Math.max(1,De),4),X=Math.max(0,$((l==null?void 0:l.walletKas)??(t==null?void 0:t.walletKas),0)),se=X>0?X:Math.max(0,yr(h)||0),he=x+ae.actionBias*1.3+d.weightedScore*.4,je=te(.35-ae.actionBias*.8-d.weightedScore*.1,.16,.52),L=-.2-ae.actionBias*.5;let pe="HOLD";le>fe+.08&&he<L&&se>.5?pe="REDUCE":Te>je&&N>.008&&le<=fe?pe="ACCUMULATE":Math.abs(he)<.12&&j==="HIGH"&&(pe="REBALANCE");const Fe=a*N*(1+te(Te/6,0,.65))*te(1+ae.actionBias,.75,1.25),W=a*Ae,Me=se>0?se*Math.max(.08,Ae):a;let Ve=Math.min(a,Math.max(0,Fe),W,Me);pe==="HOLD"&&(Ve=0),pe==="REDUCE"&&(Ve=Math.min(Math.max(a*.05,Fe),se*.25||a)),pe==="REBALANCE"&&(Ve=Math.min(Math.max(a*.03,Fe*.7),Me)),Ve=z(Math.max(0,Ve),6);const Se=a>0?z(te(Ve/a*100,0,100),2):0,O=vd(Ve,se||a||1),oe=pe==="ACCUMULATE"?Y==="TREND_UP"||Y==="FLOW_ACCUMULATION"?"ENTRY":"SCALING":pe==="REDUCE"?"EXIT":"HOLDING",Ye=z(te(.52+te(Math.abs(Te)/5,0,.2)+D*.14+d.alignment*.06+Math.abs(d.weightedScore)*.05-le*.12+(pe==="HOLD"?.02:0),.45,.97),4),xt=Cd({dataQualityScore:D,volatilityEstimate:j,drawdownPct:re,liquidityImpact:O,regime:Y,mtfAlignment:d.alignment,strategyMode:ae.mode}),yt=wd({action:pe,regime:Y,momentumScore:x,ewmaVol:k,winProbability:$e,expectedValuePct:Te,dataQualityScore:D,daaVelocity:K,strategyMode:ae.mode,mtfScore:d.weightedScore,mtfDominant:d.dominantTimeframe}),Ue=te(Math.round(45+le*120+(j==="HIGH"?45:0)),45,240),Mt=new Date(c+Ue*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),me={regime:Y,sample_count:i.length,data_quality_score:z(D,4),price_usd:z($(yr(u),$(t==null?void 0:t.priceUsd,0)),6),price_return_1_pct:z(C*100,4),price_return_5_pct:z(R*100,4),price_return_20_pct:z(I*100,4),momentum_z:z(E,4),ewma_volatility:z(k,6),daa_velocity:z(K,4),daa_slope:z(F,4),bps_velocity:B?z(B.bpsVelocity,2):void 0,bps_deviation_pct:B?z(B.bpsDeviation,2):void 0,dag_momentum_bias:B?z(B.dagMomentumBias,4):void 0,drawdown_pct:z(re*100,4),win_probability_model:z($e,4),edge_score:z(T,4),kelly_raw:z(tt,4),kelly_cap:z(S,4),risk_ceiling:z(fe,4),risk_profile:o.label,exposure_cap_pct:z(Ae*100,4),strategy_template:String((e==null?void 0:e.strategyTemplate)||"custom"),strategy_mode:ae.mode,strategy_mode_reason:ae.reason,mtf_signal_1h:z(d.signals["1h"].score,4),mtf_signal_4h:z(d.signals["4h"].score,4),mtf_signal_24h:z(d.signals["24h"].score,4),mtf_alignment_score:z(d.alignment,4),mtf_weighted_score:z(d.weightedScore,4),mtf_coverage_score:z(d.coverage,4),mtf_dominant_timeframe:d.dominantTimeframe,adaptive_kelly_cap:z(S,4),adaptive_risk_ceiling:z(fe,4),adaptive_exposure_cap_pct:z(Ae*100,4)};return{action:pe,confidence_score:Ye,risk_score:le,kelly_fraction:N,capital_allocation_kas:Ve,capital_allocation_pct:Se,expected_value_pct:Te,stop_loss_pct:De,take_profit_pct:Qe,monte_carlo_win_pct:Je,volatility_estimate:j,liquidity_impact:O,strategy_phase:oe,rationale:yt,risk_factors:xt,next_review_trigger:`Re-evaluate in ~${Ue}s (around ${Mt}) or on >${z(De/2,2)}% price move / regime change.`,decision_source:"quant-core",decision_source_detail:`regime:${Y};mode:${ae.mode};samples:${i.length};mtf:${z(d.weightedScore,3)}`,quant_metrics:me}}function Nd(e){return{...e||{},risk_factors:Array.isArray(e==null?void 0:e.risk_factors)?[...e.risk_factors]:[],quant_metrics:e!=null&&e.quant_metrics&&typeof e.quant_metrics=="object"?{...e.quant_metrics}:void 0}}function Id(e){const t=new Map;return{get(s){return t.get(s)||null},set(s,i,o){for(t.set(s,{ts:Date.now(),signature:i,decision:Nd(o)});t.size>e;){const a=t.keys().next().value;if(!a)break;t.delete(a)}}}}function jd(e,t){var v,A;const s=String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"default").trim().toLowerCase(),i=String((e==null?void 0:e.risk)||"medium").trim().toLowerCase(),o=String((e==null?void 0:e.strategyTemplate)||(e==null?void 0:e.strategyLabel)||"custom").trim().toLowerCase(),a=String((e==null?void 0:e.execMode)||(e==null?void 0:e.mode)||"default").trim().toLowerCase(),l=z(Math.max(0,$(e==null?void 0:e.capitalLimit,0)),6),c=z(Math.max(0,$(e==null?void 0:e.kpiTarget,0)),4),d=Math.max(0,Math.round($(e==null?void 0:e.horizon,0))),u=z(Math.max(0,$(e==null?void 0:e.autoApproveThreshold,0)),6),m=String((t==null?void 0:t.address)||"").trim().toLowerCase(),h=String(((v=t==null?void 0:t.dag)==null?void 0:v.networkName)||((A=t==null?void 0:t.dag)==null?void 0:A.network)||"").trim().toLowerCase();return[s,i,`tpl:${o}`,`mode:${a}`,`${l}`,`kpi:${c}`,`hz:${d}`,`aa:${u}`,`addr:${m}`,`net:${h}`].join("|")}function Rd(e){const t=(e==null?void 0:e.quant_metrics)||{},s=String(t.regime||"NA"),i=String((e==null?void 0:e.volatility_estimate)||"NA"),o=String((e==null?void 0:e.action)||"HOLD"),a=Math.round(te($(e==null?void 0:e.confidence_score,0)*10,0,10)),l=Math.round(te($(e==null?void 0:e.risk_score,1)*10,0,10)),c=Math.round(te($(t.edge_score,0)*10,-20,20)),d=Math.round(te($(e==null?void 0:e.kelly_fraction,0)*100,0,100)),u=Math.round(te($(t.data_quality_score,0)*10,0,10)),m=Math.round(te($(t.sample_count,0),0,999));return[s,i,o,`c${a}`,`r${l}`,`e${c}`,`k${d}`,`d${u}`,`s${m}`].join("|")}const hn="sha256/canonical-json";function Xn(e){if(e==null)return"null";const t=typeof e;return t==="number"?Number.isFinite(e)?JSON.stringify(e):"null":t==="boolean"?e?"true":"false":t==="string"?JSON.stringify(e):Array.isArray(e)?`[${e.map(s=>Xn(s)).join(",")}]`:t==="object"?`{${Object.entries(e).filter(([i,o])=>typeof o<"u").sort(([i],[o])=>i.localeCompare(o)).map(([i,o])=>`${JSON.stringify(i)}:${Xn(o)}`).join(",")}}`:"null"}async function Md(e){var a;const s=new TextEncoder().encode(e),i=(a=globalThis.crypto)==null?void 0:a.subtle;if(!i||typeof i.digest!="function")throw new Error("SHA-256 hashing requires WebCrypto subtle.digest");const o=await i.digest("SHA-256",s);return Array.from(new Uint8Array(o)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function jn(e){return`${hn}:${await Md(Xn(e))}`}function Ld(e,t){return{audit_record_version:String((e==null?void 0:e.audit_record_version)||t.decisionAuditRecordVersion),hash_algo:String((e==null?void 0:e.hash_algo)||t.auditHashAlgo),prompt_version:String((e==null?void 0:e.prompt_version)||t.aiPromptVersion),ai_response_schema_version:String((e==null?void 0:e.ai_response_schema_version)||t.aiResponseSchemaVersion),quant_feature_snapshot_hash:String((e==null?void 0:e.quant_feature_snapshot_hash)||""),decision_hash:String((e==null?void 0:e.decision_hash)||""),overlay_plan_reason:String((e==null?void 0:e.overlay_plan_reason)||""),engine_path:String((e==null?void 0:e.engine_path)||""),created_ts:Math.max(0,Math.round($(e==null?void 0:e.created_ts,Date.now())))}}function Oi(e){return new Promise(t=>setTimeout(t,e))}function Ki(e){const t=Math.floor(Math.random()*90);return 160*(e+1)+t}function Pd(e){try{return JSON.parse(e)}catch{throw new Error("AI response was not valid JSON")}}function Od(e){const t={"Content-Type":"application/json"};if(e.apiUrl.includes("api.anthropic.com")){if(!e.anthropicApiKey)throw new Error("Anthropic API key missing. Set VITE_ANTHROPIC_API_KEY or configure VITE_AI_API_URL to your secure backend endpoint.");t["x-api-key"]=e.anthropicApiKey,t["anthropic-version"]="2023-06-01"}return t}function Kd(e,t,s){var a,l,c,d,u,m,h;const i={fetched:$(t==null?void 0:t.fetched,0),address:String((t==null?void 0:t.address)||""),walletKas:z($(t==null?void 0:t.walletKas,0),6),priceUsd:z($(t==null?void 0:t.priceUsd,0),8),dag:{daaScore:$((a=t==null?void 0:t.dag)==null?void 0:a.daaScore,0),difficulty:$(((l=t==null?void 0:t.dag)==null?void 0:l.difficulty)??((c=t==null?void 0:t.dag)==null?void 0:c.virtualDaaScore),0),networkName:String(((d=t==null?void 0:t.dag)==null?void 0:d.networkName)||((u=t==null?void 0:t.dag)==null?void 0:u.network)||""),pastMedianTime:$(((m=t==null?void 0:t.dag)==null?void 0:m.pastMedianTime)??((h=t==null?void 0:t.dag)==null?void 0:h.virtualPastMedianTime),0)}},o=(s==null?void 0:s.quant_metrics)||{};return`You are a quant-grade AI risk overlay for a Kaspa-native autonomous trading engine. The local quant core (deterministic math) has already computed features, regime, Kelly cap, and risk limits. Your job is to refine the decision WITHOUT violating the local risk envelope.

Respond ONLY with a valid JSON object â€” no markdown, no prose, no code fences.

AGENT PROFILE:
Name: ${e.name}
Strategy: momentum / on-chain flow / risk-controlled execution
Risk Tolerance: ${e.risk} (low=conservative, high=aggressive)
KPI Target: ${e.kpiTarget}% ROI
Capital per Cycle: ${e.capitalLimit} KAS
Auto-Approve Threshold: ${e.autoApproveThreshold} KAS

KASPA SNAPSHOT:
${JSON.stringify(i)}

LOCAL QUANT CORE PRIOR (trust this as the primary signal unless you have a strong reason):
${JSON.stringify({action:s.action,confidence_score:s.confidence_score,risk_score:s.risk_score,kelly_fraction:s.kelly_fraction,capital_allocation_kas:s.capital_allocation_kas,expected_value_pct:s.expected_value_pct,stop_loss_pct:s.stop_loss_pct,take_profit_pct:s.take_profit_pct,monte_carlo_win_pct:s.monte_carlo_win_pct,quant_metrics:o,rationale:s.rationale,risk_factors:s.risk_factors})}

RULES:
1. Do not exceed quant_metrics.kelly_cap in kelly_fraction.
2. Do not exceed local quant capital_allocation_kas by more than 25%.
3. If quant_metrics.regime is RISK_OFF, avoid ACCUMULATE unless confidence_score >= 0.9 and risk_score <= quant_metrics.risk_ceiling.
4. Preserve strict risk discipline; prefer HOLD over low-quality conviction.
5. Keep rationale concise and reference actual metrics from the snapshot/core prior.

OUTPUT (strict JSON, all fields required):
{
  "action": "ACCUMULATE or REDUCE or HOLD or REBALANCE",
  "confidence_score": 0.00,
  "risk_score": 0.00,
  "kelly_fraction": 0.00,
  "capital_allocation_kas": 0.00,
  "capital_allocation_pct": 0,
  "expected_value_pct": 0.00,
  "stop_loss_pct": 0.00,
  "take_profit_pct": 0.00,
  "monte_carlo_win_pct": 0,
  "volatility_estimate": "LOW or MEDIUM or HIGH",
  "liquidity_impact": "MINIMAL or MODERATE or SIGNIFICANT",
  "strategy_phase": "ENTRY or SCALING or HOLDING or EXIT",
  "rationale": "Two concise sentences citing specific metrics and why this refines the quant-core prior.",
  "risk_factors": ["factor1", "factor2", "factor3"],
  "next_review_trigger": "Describe the specific condition that should trigger next decision cycle"
}`}async function Fd(e){var u;const{agent:t,kasData:s,quantCoreDecision:i,config:o,sanitizeDecision:a}=e,l=Kd(t,s,i),c=o.apiUrl.includes("api.anthropic.com")?{model:o.model,max_tokens:900,messages:[{role:"user",content:l}]}:{prompt:l,agent:t,kasData:s,quantCore:i};let d;for(let m=0;m<o.maxAttempts;m+=1){const h=new AbortController,v=setTimeout(()=>h.abort(),o.timeoutMs);try{const A=await fetch(o.apiUrl,{method:"POST",headers:Od(o),body:JSON.stringify(c),signal:h.signal});if(!A.ok){const _=Number(A.status||0);if(o.retryableStatuses.has(_)&&m+1<o.maxAttempts){await Oi(Ki(m));continue}throw new Error(`AI endpoint ${_||"request_failed"}`)}d=await A.json();break}catch(A){const _=(A==null?void 0:A.name)==="AbortError",k=String((A==null?void 0:A.message)||""),j=(A==null?void 0:A.name)==="TypeError"||/failed to fetch|network|load failed/i.test(k);if(!_&&j&&m+1<o.maxAttempts){await Oi(Ki(m));continue}throw A}finally{clearTimeout(v)}}if((u=d==null?void 0:d.error)!=null&&u.message)throw new Error(d.error.message);if(Array.isArray(d==null?void 0:d.content)){const m=d.content.map(v=>v.text||"").join(""),h=Pd(m.replace(/```json|```/g,"").trim());return a({...h,decision_source:"ai"},t)}return d!=null&&d.decision?a({...d.decision,decision_source:"ai"},t):a({...d,decision_source:"ai"},t)}function $d(e){const{coreDecision:t,cached:s,config:i}=e,o=Date.now(),a=Rd(t),l=(t==null?void 0:t.quant_metrics)||{};if(!i.aiTransportReady)return{kind:"skip",reason:"ai_transport_not_configured",signature:a};if(i.aiOverlayMode==="off")return{kind:"skip",reason:"ai_overlay_mode_off",signature:a};if(i.aiOverlayMode==="always")return{kind:"call",reason:"ai_overlay_mode_always",signature:a};if(s&&s.signature===a){const p=Math.max(0,o-s.ts);if(p<=i.minIntervalMs)return{kind:"reuse",reason:`cache_hit_min_interval_${p}ms`,signature:a};if(i.aiOverlayMode==="adaptive"&&p<=i.cacheTtlMs){const x=$(t==null?void 0:t.confidence_score,0),E=$(t==null?void 0:t.risk_score,1),w=$(l.risk_ceiling,.65),K=String(l.regime||"NEUTRAL"),F=Math.abs($(l.edge_score,0)),H=x<.88&&x>.56,G=Math.abs(E-w)<.06;if(!H&&!G&&!(K==="RISK_OFF"||K==="RANGE_VOL")&&F>.2)return{kind:"reuse",reason:`cache_hit_stable_state_${p}ms`,signature:a}}}const c=$(l.data_quality_score,0),d=$(t==null?void 0:t.confidence_score,0),u=$(t==null?void 0:t.risk_score,1),m=$(l.risk_ceiling,.65),h=String(l.regime||"NEUTRAL"),v=Math.abs($(l.edge_score,0)),A=$(l.sample_count,0),_=$(t==null?void 0:t.kelly_fraction,0);if(c<.4||A<6)return{kind:"skip",reason:"low_data_quality",signature:a};const k=h==="RISK_OFF"||h==="RANGE_VOL",j=Math.abs(u-m)<.08,C=d<.9&&d>.58,R=v<.12;return c>=.72&&d>=.88&&!k&&!j&&v>=.25&&(_===0||_>=.02)?{kind:"skip",reason:"quant_core_high_conviction",signature:a}:k||j||C||R?{kind:"call",reason:"adaptive_uncertain_or_sensitive",signature:a}:{kind:"skip",reason:"adaptive_cost_control",signature:a}}function Dd(e,t,s){const i=[...Array.isArray(e)?e:[],...Array.isArray(t)?t:[]];return s&&i.push(s),Array.from(new Set(i.map(o=>String(o).trim()).filter(Boolean))).slice(0,6)}function Bd(e){var w,K,F;const{agent:t,coreDecision:s,aiDecision:i,aiLatencyMs:o,startedAt:a,sanitizeDecision:l}=e,c=String(((w=s==null?void 0:s.quant_metrics)==null?void 0:w.regime)||"NEUTRAL"),d=$((K=s==null?void 0:s.quant_metrics)==null?void 0:K.risk_ceiling,.65),u=String((i==null?void 0:i.action)||"HOLD");let m=u,h=!1;c==="RISK_OFF"&&u==="ACCUMULATE"&&(m=s.action==="REDUCE"?"REDUCE":"HOLD",h=!0),$(s==null?void 0:s.risk_score,0)>d&&u==="ACCUMULATE"&&(m=s.action==="REDUCE"?"REDUCE":"HOLD",h=!0);const v=z(Math.max($(s==null?void 0:s.risk_score,1),$(i==null?void 0:i.risk_score,1)),4);let A=z(te($(s==null?void 0:s.confidence_score,.5)*.58+$(i==null?void 0:i.confidence_score,.5)*.42-(h?.08:0),0,1),4);m==="HOLD"&&(A=Math.min(A,.86));const _=$((F=s==null?void 0:s.quant_metrics)==null?void 0:F.kelly_cap,$(s==null?void 0:s.kelly_fraction,0)),k=z(te(Math.min(Math.max($(s==null?void 0:s.kelly_fraction,0)*.8,$(i==null?void 0:i.kelly_fraction,0)*.6),_||1),0,1),4);let j=0;const C=$(s==null?void 0:s.capital_allocation_kas,0),R=$(i==null?void 0:i.capital_allocation_kas,0);m==="ACCUMULATE"?j=Math.min(R||C,C*1.25||R||0):(m==="REDUCE"||m==="REBALANCE")&&(j=Math.min(Math.max(C,R*.75),Math.max(C*1.5,R)));const I=Dd(s==null?void 0:s.risk_factors,i==null?void 0:i.risk_factors,h?"AI signal conflict; core risk override applied":void 0),p=String((i==null?void 0:i.rationale)||"AI overlay unavailable.").trim(),E=`${String((s==null?void 0:s.rationale)||"").trim()} AI overlay: ${p}`.slice(0,900);return l({...i,action:m,confidence_score:A,risk_score:v,kelly_fraction:k,capital_allocation_kas:m==="HOLD"?0:j,expected_value_pct:z($(s==null?void 0:s.expected_value_pct,0)*.6+$(i==null?void 0:i.expected_value_pct,0)*.4,2),stop_loss_pct:z(Math.max($(s==null?void 0:s.stop_loss_pct,0),$(i==null?void 0:i.stop_loss_pct,0)),2),take_profit_pct:z($(s==null?void 0:s.take_profit_pct,0)*.6+$(i==null?void 0:i.take_profit_pct,0)*.4,2),monte_carlo_win_pct:z($(s==null?void 0:s.monte_carlo_win_pct,0)*.65+$(i==null?void 0:i.monte_carlo_win_pct,0)*.35,2),volatility_estimate:(s==null?void 0:s.volatility_estimate)||(i==null?void 0:i.volatility_estimate),liquidity_impact:(s==null?void 0:s.liquidity_impact)||(i==null?void 0:i.liquidity_impact),strategy_phase:m==="ACCUMULATE"?(s==null?void 0:s.strategy_phase)||(i==null?void 0:i.strategy_phase):(i==null?void 0:i.strategy_phase)||(s==null?void 0:s.strategy_phase),rationale:E,risk_factors:I,next_review_trigger:(s==null?void 0:s.next_review_trigger)||(i==null?void 0:i.next_review_trigger),decision_source:"hybrid-ai",decision_source_detail:`regime:${c};ai_latency_ms:${o};mode:quant_core_guarded`,quant_metrics:{...(s==null?void 0:s.quant_metrics)||{},ai_overlay_applied:!0,ai_action_raw:u,ai_confidence_raw:$(i==null?void 0:i.confidence_score,0)},engine_latency_ms:Date.now()-a},t)}const zd={},nt=zd;function Ud(e,t=!1){const s=String(e??"").trim();return s?/^(1|true|yes)$/i.test(s):t}function Wd(e){const t=String(e||"always").trim().toLowerCase();return t==="off"||t==="always"||t==="adaptive"?t:"adaptive"}const Rn=nt.VITE_AI_API_URL||"https://api.anthropic.com/v1/messages",Fi=nt.VITE_ANTHROPIC_API_KEY||"",ea=Math.max(0,Number(nt.VITE_AI_OVERLAY_MIN_INTERVAL_MS||15e3)),Hd=Math.max(ea,Number(nt.VITE_AI_OVERLAY_CACHE_TTL_MS||45e3)),Ee={aiApiUrl:Rn,aiModel:nt.VITE_AI_MODEL||"claude-sonnet-4-20250514",anthropicApiKey:Fi,aiTimeoutMs:Math.max(800,Number(nt.VITE_AI_SOFT_TIMEOUT_MS||2200)),aiFallbackEnabled:String(nt.VITE_AI_FALLBACK_ENABLED||"true").toLowerCase()!=="false",aiOverlayMode:Wd(nt.VITE_AI_OVERLAY_MODE),aiOverlayMinIntervalMs:ea,aiOverlayCacheTtlMs:Hd,aiOverlayCacheMaxEntries:512,aiTransportReady:!!Rn&&(!Rn.includes("api.anthropic.com")||!!Fi),aiMaxAttempts:Math.max(1,Math.min(3,Number(nt.VITE_AI_MAX_ATTEMPTS||2))),aiRetryableStatuses:new Set([408,425,429,500,502,503,504]),decisionAuditRecordVersion:"forgeos.decision.audit.v1",aiPromptVersion:"forgeos.quant.overlay.prompt.v1",aiResponseSchemaVersion:"forgeos.ai.decision.schema.v1",auditSignerUrl:String(nt.VITE_DECISION_AUDIT_SIGNER_URL||"").trim(),auditSignerToken:String(nt.VITE_DECISION_AUDIT_SIGNER_TOKEN||"").trim(),auditSignerTimeoutMs:Math.max(500,Number(nt.VITE_DECISION_AUDIT_SIGNER_TIMEOUT_MS||1500)),auditSignerRequired:Ud(nt.VITE_DECISION_AUDIT_SIGNER_REQUIRED,!1)};function ys(e,t){return[String(e||"").trim(),t].filter(Boolean).join(";").slice(0,220)}function $i(e){const{agent:t,coreDecision:s,reason:i,startedAt:o,sanitizeDecision:a}=e;return a({...s,decision_source:"quant-core",decision_source_detail:ys(s==null?void 0:s.decision_source_detail,`fallback_reason:${i}`),engine_latency_ms:Date.now()-o},t)}function Di(e){var l;const{agent:t,cached:s,startedAt:i,reason:o,sanitizeDecision:a}=e;return a({...s.decision||{},decision_source:"hybrid-ai",decision_source_detail:ys((l=s==null?void 0:s.decision)==null?void 0:l.decision_source_detail,o),engine_latency_ms:Date.now()-i},t)}const ta=Id(Ee.aiOverlayCacheMaxEntries);function Vd(){const e={"Content-Type":"application/json"};return Ee.auditSignerToken&&(e.Authorization=`Bearer ${Ee.auditSignerToken}`),e}async function Gd(e){var a;const t=e==null?void 0:e.audit_record;if(!t||!Ee.auditSignerUrl)return e;const s=Ld(t,{decisionAuditRecordVersion:Ee.decisionAuditRecordVersion,auditHashAlgo:hn,aiPromptVersion:Ee.aiPromptVersion,aiResponseSchemaVersion:Ee.aiResponseSchemaVersion}),i=new AbortController,o=setTimeout(()=>i.abort(),Ee.auditSignerTimeoutMs);try{const l=await fetch(Ee.auditSignerUrl,{method:"POST",headers:Vd(),body:JSON.stringify({signingPayload:s}),signal:i.signal}),c=await l.json().catch(()=>({}));if(!l.ok)throw new Error(String(((a=c==null?void 0:c.error)==null?void 0:a.message)||`audit_signer_${l.status||"failed"}`));const d=c!=null&&c.signature&&typeof c.signature=="object"?c.signature:c,u={status:"signed",alg:String((d==null?void 0:d.alg)||(d==null?void 0:d.algorithm)||"unknown").slice(0,80),key_id:String((d==null?void 0:d.keyId)||(d==null?void 0:d.key_id)||"").slice(0,160),sig_b64u:String((d==null?void 0:d.signatureB64u)||(d==null?void 0:d.signature)||(d==null?void 0:d.sig_b64u)||"").slice(0,600),payload_hash_sha256_b64u:String((d==null?void 0:d.payloadHashSha256B64u)||(d==null?void 0:d.payload_hash_sha256_b64u)||"").slice(0,160),signer:String((d==null?void 0:d.signer)||"audit-signer").slice(0,80),signed_ts:Math.max(0,Math.round($((d==null?void 0:d.signedAt)??(d==null?void 0:d.signed_ts),Date.now()))),signing_latency_ms:Math.max(0,Math.round($((d==null?void 0:d.signingLatencyMs)??(d==null?void 0:d.signing_latency_ms),0))),public_key_pem:typeof(d==null?void 0:d.publicKeyPem)=="string"?d.publicKeyPem.slice(0,4e3):typeof(d==null?void 0:d.public_key_pem)=="string"?d.public_key_pem.slice(0,4e3):void 0};return{...e,audit_record:{...t,crypto_signature:u}}}catch(l){const c=(l==null?void 0:l.name)==="AbortError"?`audit_signer_timeout_${Ee.auditSignerTimeoutMs}ms`:String((l==null?void 0:l.message)||"audit_signer_failed");if(Ee.auditSignerRequired)throw new Error(c);return{...e,audit_record:{...t,crypto_signature:{status:"error",signer:"audit-signer",error:c.slice(0,240)}}}}finally{clearTimeout(o)}}function qd(e){if(!e||typeof e!="object"||Array.isArray(e))return;const t={};for(const[s,i]of Object.entries(e))if(s){if(typeof i=="number"){if(!Number.isFinite(i))continue;t[s]=Math.abs(i)>=1e3?Math.round(i):z(i,6);continue}if(typeof i=="string"){t[s]=i.slice(0,80);continue}typeof i=="boolean"&&(t[s]=i)}return Object.keys(t).length>0?t:void 0}function Nt(e,t){const s=String((e==null?void 0:e.action)||"HOLD").toUpperCase(),i=["ACCUMULATE","REDUCE","HOLD","REBALANCE"].includes(s)?s:"HOLD",o=Math.max(0,$(t==null?void 0:t.capitalLimit,0)),a=te($(e==null?void 0:e.capital_allocation_kas,0),0,o),l=o>0?te(a/o*100,0,100):te($(e==null?void 0:e.capital_allocation_pct,0),0,100),c=te($(e==null?void 0:e.confidence_score,0),0,1),d=te($(e==null?void 0:e.risk_score,1),0,1),u=String((e==null?void 0:e.volatility_estimate)||"MEDIUM").toUpperCase(),m=["LOW","MEDIUM","HIGH"].includes(u)?u:"MEDIUM",h=String((e==null?void 0:e.liquidity_impact)||"MODERATE").toUpperCase(),v=["MINIMAL","MODERATE","SIGNIFICANT"].includes(h)?h:"MODERATE",A=String((e==null?void 0:e.strategy_phase)||"HOLDING").toUpperCase(),_=["ENTRY","SCALING","HOLDING","EXIT"].includes(A)?A:"HOLDING",k=Array.isArray(e==null?void 0:e.risk_factors)?e.risk_factors.map(K=>String(K)).filter(Boolean).slice(0,6):[],j=String((e==null?void 0:e.decision_source)||"ai").toLowerCase(),C=["ai","fallback","quant-core","hybrid-ai"].includes(j)?j:"ai",R=String((e==null?void 0:e.decision_source_detail)||"").slice(0,220),I=qd(e==null?void 0:e.quant_metrics),p=Math.max(0,Math.round($(e==null?void 0:e.engine_latency_ms,0))),x=e!=null&&e.audit_record&&typeof e.audit_record=="object"?e.audit_record:null,E=x!=null&&x.crypto_signature&&typeof x.crypto_signature=="object"?x.crypto_signature:null,w=x?{audit_record_version:String(x.audit_record_version||Ee.decisionAuditRecordVersion).slice(0,80),hash_algo:String(x.hash_algo||hn).slice(0,64),prompt_version:String(x.prompt_version||Ee.aiPromptVersion).slice(0,80),ai_response_schema_version:String(x.ai_response_schema_version||Ee.aiResponseSchemaVersion).slice(0,80),quant_feature_snapshot_hash:String(x.quant_feature_snapshot_hash||"").slice(0,120),decision_hash:String(x.decision_hash||"").slice(0,120),audit_sig:String(x.audit_sig||"").slice(0,140),overlay_plan_reason:String(x.overlay_plan_reason||"").slice(0,160),engine_path:String(x.engine_path||"").slice(0,80),prompt_used:!!x.prompt_used,ai_transport_ready:!!x.ai_transport_ready,created_ts:Math.max(0,Math.round($(x.created_ts,0))),crypto_signature:E?{status:String(E.status||"").slice(0,32)||void 0,alg:String(E.alg||"").slice(0,80)||void 0,key_id:String(E.key_id||E.keyId||"").slice(0,160)||void 0,sig_b64u:String(E.sig_b64u||E.signatureB64u||"").slice(0,600)||void 0,payload_hash_sha256_b64u:String(E.payload_hash_sha256_b64u||E.payloadHashSha256B64u||"").slice(0,160)||void 0,signer:String(E.signer||"").slice(0,80)||void 0,signed_ts:Math.max(0,Math.round($(E.signed_ts??E.signedAt,0))),signing_latency_ms:Math.max(0,Math.round($(E.signing_latency_ms??E.signingLatencyMs,0))),public_key_pem:typeof E.public_key_pem=="string"?E.public_key_pem.slice(0,4e3):typeof E.publicKeyPem=="string"?E.publicKeyPem.slice(0,4e3):void 0,error:String(E.error||"").slice(0,240)||void 0}:void 0,quant_feature_snapshot_excerpt:x.quant_feature_snapshot_excerpt&&typeof x.quant_feature_snapshot_excerpt=="object"?{regime:String(x.quant_feature_snapshot_excerpt.regime||"").slice(0,40),sample_count:Math.max(0,Math.round($(x.quant_feature_snapshot_excerpt.sample_count,0))),edge_score:z($(x.quant_feature_snapshot_excerpt.edge_score,0),6),data_quality_score:z($(x.quant_feature_snapshot_excerpt.data_quality_score,0),6),price_usd:z($(x.quant_feature_snapshot_excerpt.price_usd,0),8),wallet_kas:z($(x.quant_feature_snapshot_excerpt.wallet_kas,0),6),daa_score:Math.max(0,Math.round($(x.quant_feature_snapshot_excerpt.daa_score,0)))}:void 0}:void 0;return{action:i,confidence_score:z(c,4),risk_score:z(d,4),kelly_fraction:te($(e==null?void 0:e.kelly_fraction,0),0,1),capital_allocation_kas:Number(a.toFixed(6)),capital_allocation_pct:Number(l.toFixed(2)),expected_value_pct:Number($(e==null?void 0:e.expected_value_pct,0).toFixed(2)),stop_loss_pct:Number(Math.max(0,$(e==null?void 0:e.stop_loss_pct,0)).toFixed(2)),take_profit_pct:Number(Math.max(0,$(e==null?void 0:e.take_profit_pct,0)).toFixed(2)),monte_carlo_win_pct:Number(te($(e==null?void 0:e.monte_carlo_win_pct,0),0,100).toFixed(2)),volatility_estimate:m,liquidity_impact:v,strategy_phase:_,rationale:String((e==null?void 0:e.rationale)||"No rationale returned by engine."),risk_factors:k,next_review_trigger:String((e==null?void 0:e.next_review_trigger)||"On next cycle or major DAA/price movement."),decision_source:C,decision_source_detail:R,quant_metrics:I,engine_latency_ms:p,...w?{audit_record:w}:{}}}function Yd(e,t,s){var o,a,l;const i=(s==null?void 0:s.quant_metrics)||{};return{agent:{id:String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent"),risk:String((e==null?void 0:e.risk)||""),capitalLimit:z(Math.max(0,$(e==null?void 0:e.capitalLimit,0)),6),autoApproveThreshold:z(Math.max(0,$(e==null?void 0:e.autoApproveThreshold,0)),6),strategyTemplate:String((e==null?void 0:e.strategyTemplate)||(e==null?void 0:e.strategyLabel)||"custom")},kaspa:{address:String((t==null?void 0:t.address)||""),walletKas:z(Math.max(0,$(t==null?void 0:t.walletKas,0)),6),priceUsd:z(Math.max(0,$(t==null?void 0:t.priceUsd,0)),8),daaScore:Math.max(0,Math.round($((o=t==null?void 0:t.dag)==null?void 0:o.daaScore,0))),network:String(((a=t==null?void 0:t.dag)==null?void 0:a.networkName)||((l=t==null?void 0:t.dag)==null?void 0:l.network)||"")},quantCore:{action:String((s==null?void 0:s.action)||"HOLD"),confidence_score:z($(s==null?void 0:s.confidence_score,0),4),risk_score:z($(s==null?void 0:s.risk_score,0),4),kelly_fraction:z($(s==null?void 0:s.kelly_fraction,0),6),capital_allocation_kas:z($(s==null?void 0:s.capital_allocation_kas,0),6),expected_value_pct:z($(s==null?void 0:s.expected_value_pct,0),4),quant_metrics:{regime:String((i==null?void 0:i.regime)||""),sample_count:Math.max(0,Math.round($(i==null?void 0:i.sample_count,0))),edge_score:z($(i==null?void 0:i.edge_score,0),6),data_quality_score:z($(i==null?void 0:i.data_quality_score,0),6),ewma_volatility:z($(i==null?void 0:i.ewma_volatility,0),6),risk_ceiling:z($(i==null?void 0:i.risk_ceiling,0),6),kelly_cap:z($(i==null?void 0:i.kelly_cap,0),6)}}}}async function Xd(e){var c,d,u,m,h,v,A,_,k,j,C,R;const t=e.decision||{},s=Yd(e.agent,e.kasData,e.quantCoreDecision),i=await jn(s),o={...t,audit_record:void 0},a=await jn(o),l=await jn({decision_hash:a,quant_feature_snapshot_hash:i,prompt_version:Ee.aiPromptVersion,ai_response_schema_version:Ee.aiResponseSchemaVersion,overlay_plan_reason:e.overlayPlanReason,engine_path:e.enginePath});return Nt({...t,audit_record:{audit_record_version:Ee.decisionAuditRecordVersion,hash_algo:hn,prompt_version:Ee.aiPromptVersion,ai_response_schema_version:Ee.aiResponseSchemaVersion,quant_feature_snapshot_hash:i,decision_hash:a,audit_sig:l,overlay_plan_reason:e.overlayPlanReason,engine_path:e.enginePath,prompt_used:e.enginePath==="hybrid-ai"||e.enginePath==="ai",ai_transport_ready:Ee.aiTransportReady,created_ts:Date.now(),quant_feature_snapshot_excerpt:{regime:String(((d=(c=e.quantCoreDecision)==null?void 0:c.quant_metrics)==null?void 0:d.regime)||""),sample_count:Math.max(0,Math.round($((m=(u=e.quantCoreDecision)==null?void 0:u.quant_metrics)==null?void 0:m.sample_count,0))),edge_score:z($((v=(h=e.quantCoreDecision)==null?void 0:h.quant_metrics)==null?void 0:v.edge_score,0),6),data_quality_score:z($((_=(A=e.quantCoreDecision)==null?void 0:A.quant_metrics)==null?void 0:_.data_quality_score,0),6),price_usd:z($((k=e.kasData)==null?void 0:k.priceUsd,0),8),wallet_kas:z($((j=e.kasData)==null?void 0:j.walletKas,0),6),daa_score:Math.max(0,Math.round($((R=(C=e.kasData)==null?void 0:C.dag)==null?void 0:R.daaScore,0)))}}},e.agent)}async function gr(e){const t=await Xd(e);return Gd(t)}function Qd(e){return ta.get(e)}function Jd(e,t,s){ta.set(e,t,s)}async function Bi(e,t,s){const i=Date.now(),o=Nt({...kd(e,t,s),engine_latency_ms:Date.now()-i},e),a=jd(e,t),l=Qd(a),c=$d({coreDecision:o,cached:l,config:{aiTransportReady:Ee.aiTransportReady,aiOverlayMode:Ee.aiOverlayMode,minIntervalMs:Ee.aiOverlayMinIntervalMs,cacheTtlMs:Ee.aiOverlayCacheTtlMs}});if(c.kind==="skip"&&c.reason==="ai_transport_not_configured"&&!Ee.aiFallbackEnabled&&Ee.aiOverlayMode!=="off")throw new Error("Real AI overlay is required but AI transport is not configured (set VITE_AI_API_URL and credentials/proxy).");if(c.kind==="skip")return gr({decision:$i({agent:e,coreDecision:o,reason:c.reason,startedAt:i,sanitizeDecision:Nt}),agent:e,kasData:t,quantCoreDecision:o,overlayPlanReason:c.reason,enginePath:"quant-core"});if(c.kind==="reuse"&&l)return gr({decision:Di({agent:e,cached:l,startedAt:i,reason:c.reason,sanitizeDecision:Nt}),agent:e,kasData:t,quantCoreDecision:o,overlayPlanReason:c.reason,enginePath:"hybrid-ai"});const d=Date.now();try{const u=await Fd({agent:e,kasData:t,quantCoreDecision:o,config:{apiUrl:Ee.aiApiUrl,model:Ee.aiModel,anthropicApiKey:Ee.anthropicApiKey,timeoutMs:Ee.aiTimeoutMs,maxAttempts:Ee.aiMaxAttempts,retryableStatuses:Ee.aiRetryableStatuses},sanitizeDecision:Nt}),m=Date.now()-d,h=Bd({agent:e,coreDecision:o,aiDecision:u,aiLatencyMs:m,startedAt:i,sanitizeDecision:Nt});return h.decision_source_detail=ys(h==null?void 0:h.decision_source_detail,`overlay_plan:${c.reason}`),Jd(a,c.signature,h),gr({decision:h,agent:e,kasData:t,quantCoreDecision:o,overlayPlanReason:c.reason,enginePath:"hybrid-ai"})}catch(u){if(l){const m=Math.max(0,Date.now()-l.ts);if(m<=Ee.aiOverlayCacheTtlMs)return gr({decision:Di({agent:e,cached:l,startedAt:i,reason:`ai_error_cache_reuse_${m}ms`,sanitizeDecision:Nt}),agent:e,kasData:t,quantCoreDecision:o,overlayPlanReason:`ai_error_cache_reuse_${m}ms`,enginePath:"hybrid-ai"})}if(Ee.aiFallbackEnabled){const m=(u==null?void 0:u.name)==="AbortError"?`ai_timeout_${Ee.aiTimeoutMs}ms`:(u==null?void 0:u.message)||"request failure";return gr({decision:$i({agent:e,coreDecision:o,reason:m,startedAt:i,sanitizeDecision:Nt}),agent:e,kasData:t,quantCoreDecision:o,overlayPlanReason:m,enginePath:"quant-core"})}throw(u==null?void 0:u.name)==="AbortError"?new Error(`AI request timeout (${Ee.aiTimeoutMs}ms)`):u}}const ra="true".toLowerCase()!=="false",zi=Math.max(1e3,8e3),Zd=[/^Quant worker timeout/i,/^Quant worker crashed/i,/^Worker postMessage/i];let vt=null,Yr=!1,Ui=!1,eu=1;const Kt=new Map;function dn(){if(vt)try{vt.terminate()}catch{}vt=null,Yr=!1}function na(){if(!ra||typeof window>"u"||typeof Worker>"u")return null;if(vt&&Yr)return vt;if(Ui&&!Yr)return null;Ui=!0;try{return vt=new Worker(new URL("/assets/quantEngine.worker-Cw0Mx06I.js",import.meta.url),{type:"module"}),vt.onmessage=e=>{const t=e.data,s=Kt.get(Number(t==null?void 0:t.id));s&&(Kt.delete(Number(t.id)),clearTimeout(s.timeoutId),t!=null&&t.ok?s.resolve(t.decision):s.reject(new Error(String((t==null?void 0:t.error)||"Quant worker error"))))},vt.onerror=()=>{for(const[e,t]of Kt.entries())clearTimeout(t.timeoutId),t.reject(new Error("Quant worker crashed")),Kt.delete(e);dn()},Yr=!0,vt}catch{return dn(),null}}async function tu(e,t,s){const i=na();if(!i)return Bi(e,t,s);const o=eu++;return new Promise((a,l)=>{const c=setTimeout(()=>{Kt.delete(o),dn(),l(new Error(`Quant worker timeout (${zi}ms)`))},zi);Kt.set(o,{resolve:a,reject:l,timeoutId:c});try{i.postMessage({id:o,agent:e,kasData:t,context:s})}catch(d){clearTimeout(c),Kt.delete(o),dn(),l(new Error(`Worker postMessage failed: ${String((d==null?void 0:d.message)||d||"unknown_error")}`))}}).catch(a=>{const l=String((a==null?void 0:a.message)||"");if(!Zd.some(d=>d.test(l)))throw a;return Bi(e,t,s).catch(d=>{throw d||a})})}function ru(){return ra&&na()?"worker":"main-thread"}const st=(e,t=0)=>{const s=Number(e);return Number.isFinite(s)?s:t};function nu(e,t){var d,u,m;if(!Array.isArray(e)||e.length===0||!Number.isFinite(t))return-1;let s=0,i=e.length-1;for(;s<=i;){const h=s+i>>1,v=st((d=e[h])==null?void 0:d.ts,0);if(v===t)return h;v<t?s=h+1:i=h-1}const o=Math.max(0,i),a=Math.min(e.length-1,s),l=Math.abs(st((u=e[o])==null?void 0:u.ts,0)-t),c=Math.abs(st((m=e[a])==null?void 0:m.ts,0)-t);return l<=c?o:a}function su(e,t,s=3){var c,d;const i=nu(e,t);if(i<0)return null;const o=st((c=e[i])==null?void 0:c.priceUsd,0);if(!(o>0))return null;const a=Math.min(e.length-1,i+Math.max(1,s)),l=st((d=e[a])==null?void 0:d.priceUsd,0);return l>0?(l-o)/o*100:null}function iu(e){var m;const t=Math.max(1,Math.round(st(e.lookaheadSteps,3))),s=Math.max(4,Math.round(st(e.maxSamples,40))),i=Array.isArray(e.marketHistory)?[...e.marketHistory]:[];i.sort((h,v)=>st(h==null?void 0:h.ts,0)-st(v==null?void 0:v.ts,0));const o=(Array.isArray(e.decisions)?e.decisions:[]).filter(h=>{var A;const v=String(((A=h==null?void 0:h.dec)==null?void 0:A.action)||"").toUpperCase();return v==="ACCUMULATE"||v==="REDUCE"||v==="REBALANCE"}).slice(0,s);let a=0,l=0,c=0;for(const h of o){const v=String(((m=h==null?void 0:h.dec)==null?void 0:m.action)||"").toUpperCase(),A=su(i,st(h==null?void 0:h.ts,0),t);if(Number.isFinite(A)){if(v==="ACCUMULATE"){A>0?a+=1:l+=1;continue}if(v==="REDUCE"){A<0?a+=1:l+=1;continue}Math.abs(A)>=.7?a+=1:c+=1}}const d=a+l+c,u=d>0?a/d*100:0;return{samples:d,wins:a,losses:l,neutral:c,winRatePct:Number(u.toFixed(2))}}function ou(e){const t=Math.max(0,st(e.baseThresholdKas,0)),s=Math.max(4,Math.round(st(e.minimumSamples,10))),i=iu({decisions:e.decisions,marketHistory:e.marketHistory,maxSamples:e.maxSamples}),o=te(st(e.calibrationHealth,1),0,1),a=!!e.truthDegraded;if(t<=0)return{thresholdKas:0,multiplier:0,baseThresholdKas:t,samplesSufficient:!1,tier:"baseline",reason:"base_threshold_zero",rolling:i};if(i.samples<s)return{thresholdKas:Number(t.toFixed(6)),multiplier:1,baseThresholdKas:t,samplesSufficient:!1,tier:"baseline",reason:`insufficient_samples_${i.samples}/${s}`,rolling:i};const l=te((i.winRatePct-50)/50,-1,1);let c=te(1+l*.7,.55,1.45);c*=te(.65+o*.55,.55,1.2),a&&(c*=.78),c=te(c,.35,1.6);const d=Number((t*c).toFixed(6));let u="baseline";c>=1.12?u="boosted":c<.88&&(u="tightened"),(c<.62||a||o<.45)&&(u="restricted");const m=[`rolling_win_rate_${i.winRatePct.toFixed(1)}pct`,`health_${o.toFixed(3)}`];return a&&m.push("truth_degraded"),{thresholdKas:d,multiplier:Number(c.toFixed(4)),baseThresholdKas:t,samplesSufficient:!0,tier:u,reason:m.join(";"),rolling:i}}const au={mainnet:10,"testnet-10":10,"testnet-11":32};function cu(e,t="mainnet"){const s=au[t]??10,i={bpsVelocity:s,bpsDeviation:0,networkHealth:"healthy",activitySurge:!1,dagMomentumBias:1,cycleMultiplier:1,daaScoresSinceLastMove:0,expectedBps:s};if(e.length<3)return i;const o=e.slice(-12),a=o[0],l=o[o.length-1],d=(l.ts-a.ts)/1e3,u=l.daaScore-a.daaScore;if(d<2||u<=0)return i;const m=u/d,h=(m-s)/s*100;let v="healthy";m<s*.65?v="slow":m>s*1.4&&(v="surge");const A=v==="surge",_=o.map(I=>I.priceUsd).filter(I=>I>0);let k=1;if(_.length>=4){const I=Math.floor(_.length/2),p=_.slice(0,I).reduce((E,w)=>E+w,0)/I,x=_.slice(I).reduce((E,w)=>E+w,0)/(_.length-I);p>0&&(k=Math.min(1.3,Math.max(.7,x/p)))}let j=1;A?j=.5:v==="slow"?j=1.5:Math.abs(h)>25&&(j=.7);let C=0;const R=l.priceUsd;for(let I=o.length-2;I>=0;I--){const p=o[I];if(p.priceUsd>0&&R>0&&Math.abs(R-p.priceUsd)/p.priceUsd*100>=.3){C=l.daaScore-p.daaScore;break}}return{bpsVelocity:m,bpsDeviation:h,networkHealth:v,activitySurge:A,dagMomentumBias:k,cycleMultiplier:j,daaScoresSinceLastMove:C,expectedBps:s}}function lu(e){const t=e.bpsVelocity.toFixed(1),s=(e.bpsDeviation>=0?"+":"")+e.bpsDeviation.toFixed(1)+"%",i=e.networkHealth.toUpperCase(),o=e.dagMomentumBias.toFixed(3),a=e.cycleMultiplier!==1?` Â· nextÃ—${e.cycleMultiplier}`:"",l=e.activitySurge?" Â· SURGE":"";return`DAG Â· BPS ${t}/${e.expectedBps} (${i}) Â· dev ${s} Â· momentum ${o}${a}${l}`}const du={SYSTEM:n.dim,DATA:"#6BA3FF",AI:n.accent,VALID:n.warn,EXEC:n.ok,ERROR:n.danger,SIGN:n.purple,TREASURY:n.warn},Qn=e=>{const t=Date.now();return[{ts:t-72e5,type:"SYSTEM",msg:`Agent ${e} provisioned. Vault address mapped to session.`,fee:null},{ts:t-714e4,type:"SIGN",msg:"Deploy transaction signed via Kasware. Vault funded.",fee:null},{ts:t-71e5,type:"TREASURY",msg:"Protocol fee: 0.20 KAS â†’ Treasury 0.06 KAS / Pool 0.14 KAS",fee:.2},{ts:t-36e5,type:"DATA",msg:"Kaspa DAG snapshot ingested. DAA score, hashrate, UTXO set analysed.",fee:null},{ts:t-354e4,type:"AI",msg:"Quant engine invoked. Kelly criterion + Monte Carlo computed.",fee:.12},{ts:t-35e5,type:"VALID",msg:"Risk gate PASSED Â· Conf 0.82 Â· Kelly 0.08 Â· Phase: ENTRY",fee:null},{ts:t-349e4,type:"EXEC",msg:"ACCUMULATE â€” 400 KAS Â· Auto-approved (below threshold)",fee:.08},{ts:t-18e5,type:"AI",msg:"Quant engine invoked.",fee:.12},{ts:t-178e4,type:"VALID",msg:"Conf 0.71 < 0.75 threshold â€” HOLD enforced.",fee:null},{ts:t-177e4,type:"EXEC",msg:"HOLD â€” confidence gate. Position maintained.",fee:.08}]},uu="forgeos.usage.v2",fu="forgeos.usage.v1";function pu(e){return String(e||"global").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,128)||"global"}function sa(e){return`${uu}:${pu(e)}`}function mu(e=new Date){return e.toISOString().slice(0,10)}function gu(e){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(sa(e));if(!t)return null;const s=JSON.parse(t);return!s||typeof s.day!="string"||!Number.isFinite(s.used)?null:{day:s.day,used:Math.max(0,Math.floor(s.used))}}catch{return null}}function Jn(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(sa(t),JSON.stringify(e))}catch{}}function hu(){if(typeof window>"u")return null;try{const e=window.localStorage.getItem(fu);if(!e)return null;const t=JSON.parse(e);return!t||typeof t.day!="string"||!Number.isFinite(t.used)?null:{day:t.day,used:Math.max(0,Math.floor(t.used))}}catch{return null}}function ia(e,t){const s=mu(),i=gu(t)||(t?null:hu());if(!i||i.day!==s){const a={day:s,used:0};return Jn(a,t),a}const o={day:s,used:Math.min(i.used,Math.max(0,Math.floor(e)))};return(o.day!==i.day||o.used!==i.used)&&Jn(o,t),o}function Zn(e,t){const s=Math.max(1,Math.floor(t)),i=Math.min(e.used,s),o=Math.max(0,s-i);return{day:e.day,used:i,limit:s,remaining:o,locked:o<=0}}function xu(e,t){return Zn(ia(e,t),e)}function yu(e,t){const s=ia(e,t),i=Math.max(1,Math.floor(e));if(s.used>=i)return Zn(s,i);const o={...s,used:s.used+1};return Jn(o,t),Zn(o,i)}function Wi(e,t){return xu(e,t)}const xe=(e,t=0)=>{const s=Number(e);return Number.isFinite(s)?s:t},Mn=(e,t,s)=>Math.min(s,Math.max(t,e));function _u(e){var t,s;for(let i=1;i<e.length;i+=1)if(xe((t=e[i-1])==null?void 0:t.ts,0)>xe((s=e[i])==null?void 0:s.ts,0))return!1;return!0}function oa(e,t){var d,u,m;if(!Array.isArray(e)||e.length===0||!Number.isFinite(t))return-1;let s=0,i=e.length-1;for(;s<=i;){const h=s+i>>1,v=xe((d=e[h])==null?void 0:d.ts,0);if(v===t)return h;v<t?s=h+1:i=h-1}const o=Math.max(0,i),a=Math.min(e.length-1,s),l=Math.abs(xe((u=e[o])==null?void 0:u.ts,0)-t),c=Math.abs(xe((m=e[a])==null?void 0:m.ts,0)-t);return l<=c?o:a}function Su(e,t,s=3){var c,d;const i=oa(e,t);if(i<0)return null;const o=xe((c=e[i])==null?void 0:c.priceUsd,0);if(!(o>0))return null;const a=Math.min(e.length-1,i+Math.max(1,s)),l=xe((d=e[a])==null?void 0:d.priceUsd,0);return l>0?(l-o)/o*100:null}function Hi(e,t){var o;const s=oa(e,t);if(s<0)return null;const i=xe((o=e[s])==null?void 0:o.priceUsd,0);return i>0?i:null}function Vi(e){const t=String(e||"MODERATE").toUpperCase();return t==="MINIMAL"?6:t==="SIGNIFICANT"?45:18}function bu(e,t){const s=Math.max(1,Math.round(xe(e==null?void 0:e.base,t))),i={},o={};for(const[l,c]of Object.entries((e==null?void 0:e.byAction)||{})){const d=String(l||"").toUpperCase();d&&(i[d]=Math.max(1,Math.round(xe(c,s))))}for(const[l,c]of Object.entries((e==null?void 0:e.byRisk)||{})){const d=String(l||"").toUpperCase();d&&(o[d]=Math.max(1,Math.round(xe(c,s))))}const a=Array.isArray(e==null?void 0:e.amountTiersKas)?e.amountTiersKas.map(l=>({minAmountKas:Math.max(0,xe(l==null?void 0:l.minAmountKas,0)),minConfirmations:Math.max(1,Math.round(xe(l==null?void 0:l.minConfirmations,s)))})).filter(l=>l.minAmountKas>=0&&l.minConfirmations>=1).sort((l,c)=>l.minAmountKas-c.minAmountKas):[];return{base:s,byAction:i,byRisk:o,amountTiersKas:a}}function Eu(e){var i,o,a,l;const t=String(((i=e==null?void 0:e.dec)==null?void 0:i.risk)||((a=(o=e==null?void 0:e.dec)==null?void 0:o.quant_metrics)==null?void 0:a.risk_profile)||"").toUpperCase();if(t==="LOW"||t==="MEDIUM"||t==="HIGH")return t;const s=xe((l=e==null?void 0:e.dec)==null?void 0:l.risk_score,NaN);return Number.isFinite(s)?s>=.7?"HIGH":s>=.4?"MEDIUM":"LOW":""}function Au(e,t){var l,c,d;let s=Math.max(1,Number((t==null?void 0:t.base)||1));const i=String((e==null?void 0:e.type)||((l=e==null?void 0:e.dec)==null?void 0:l.action)||"").toUpperCase();i&&((c=t==null?void 0:t.byAction)==null?void 0:c[i])!=null&&(s=Math.max(s,Math.max(1,Math.round(xe(t.byAction[i],s)))));const o=Eu(e);o&&((d=t==null?void 0:t.byRisk)==null?void 0:d[o])!=null&&(s=Math.max(s,Math.max(1,Math.round(xe(t.byRisk[o],s)))));const a=Math.max(0,xe(e==null?void 0:e.amount_kas,0));for(const u of(t==null?void 0:t.amountTiersKas)||[])a>=Math.max(0,xe(u==null?void 0:u.minAmountKas,0))&&(s=Math.max(s,Math.max(1,Math.round(xe(u==null?void 0:u.minConfirmations,s)))));return s}function vu(e,t){const s=String(e||"").toUpperCase();if(!s||!Number.isFinite(t))return null;const i=Math.abs(t);return s.includes("TREND_UP")?t>0:s.includes("TREND_DOWN")?t<0:s.includes("RISK_OFF")?t<=0:s.includes("RANGE_LOW")||s==="RANGE"?i<.8:s.includes("RANGE_VOL")?i>=.8:null}function Tu(e){var Me,Ve,Se;const t=Array.isArray(e.decisions)?e.decisions:[],i=(Array.isArray(e.queue)?e.queue:[]).filter(O=>(O==null?void 0:O.metaKind)!=="treasury_fee"),o=Array.isArray(e.log)?e.log:[],a=Array.isArray(e.marketHistory)?_u(e.marketHistory)?e.marketHistory:[...e.marketHistory].sort((O,oe)=>xe(O==null?void 0:O.ts,0)-xe(oe==null?void 0:oe.ts,0)):[],l=Math.max(1,Math.round(xe(e==null?void 0:e.realizedMinConfirmations,1))),c=bu(e==null?void 0:e.confirmationDepthPolicy,l),d=t.filter(O=>{var Ye;return String(((Ye=O==null?void 0:O.dec)==null?void 0:Ye.action)||"HOLD").toUpperCase()!=="HOLD"}),u=i.filter(O=>(O==null?void 0:O.status)==="signed"),m=i.filter(O=>(O==null?void 0:O.status)==="pending"),h=i.filter(O=>(O==null?void 0:O.status)==="rejected"),v=o.reduce((O,oe)=>O+Math.max(0,xe(oe==null?void 0:oe.fee,0)),0);let A=0,_=0,k=0,j=0,C=0,R=0,I=0,p=0,x=0,E=0,w=0,K=0,F=0;for(const O of t){const oe=(O==null?void 0:O.dec)||{},Ye=String((oe==null?void 0:oe.action)||"HOLD").toUpperCase(),xt=Math.max(0,xe(oe==null?void 0:oe.capital_allocation_kas,0)),yt=xe(oe==null?void 0:oe.expected_value_pct,0),Ue=Mn(xe(oe==null?void 0:oe.confidence_score,0),0,1),Mt=String((oe==null?void 0:oe.liquidity_impact)||"MODERATE"),me=String((oe==null?void 0:oe.decision_source)||(O==null?void 0:O.source)||"ai");k+=Ue,j+=yt,Ye!=="HOLD"&&(A+=xt*(yt/100),_+=xt*(Vi(Mt)/1e4));const ke=Su(a,xe(O==null?void 0:O.ts,0),3);if(ke!=null){R+=1;let Le=0;Ye==="ACCUMULATE"?Le=ke:Ye==="REDUCE"?Le=-ke:Le=-Math.abs(ke)*.1,C+=Le,Le>0&&(I+=1);const Ze=(oe==null?void 0:oe.quant_metrics)||{},or=Mn(xe(Ze==null?void 0:Ze.win_probability_model,xe(oe==null?void 0:oe.monte_carlo_win_pct,50)/100),0,1),Oe=Le>0?1:0,ar=1-Math.abs(or-Oe);p+=Mn(ar-(me==="quant-core"||me==="fallback"?.03:0),0,1),x+=1,E+=(Ue-Oe)**2,w+=1;const Lt=vu(Ze==null?void 0:Ze.regime,ke);typeof Lt=="boolean"&&(F+=1,Lt&&(K+=1))}}let H=0,G=0,B=0,P=0,Z=0,re=0,b=0,M=0,ie=0,D=0,Y=0,ae=0,fe=0,Ae=0,ce=0;for(const O of u){const oe=String((O==null?void 0:O.receipt_lifecycle)||""),Ye=String((O==null?void 0:O.receipt_imported_from)||"").toLowerCase(),xt=String((O==null?void 0:O.receipt_source_path)||"").toLowerCase(),yt=String((O==null?void 0:O.confirm_ts_source)||"").toLowerCase(),Ue=Ye==="callback_consumer"||xt.includes("callback-consumer"),Mt=Ye==="kaspa_api"||yt==="chain",me=Math.max(0,xe(O==null?void 0:O.confirmations,0)),ke=Au(O,c);(D===0||ke<D)&&(D=ke),ke>Y&&(Y=ke);const Le=me>=ke;if(oe!=="confirmed"){ie+=1;continue}Ue?M+=1:Mt?b+=1:ie+=1,H+=1;const Ze=Math.max(0,xe(O==null?void 0:O.amount_kas,0)),or=String(((Me=O==null?void 0:O.dec)==null?void 0:Me.liquidity_impact)||"MODERATE");B+=Ze*(Vi(or)/1e4);const Oe=xe(O==null?void 0:O.receipt_fee_kas,NaN);Le&&Number.isFinite(Oe)&&Oe>=0&&(Z+=Oe,re+=1);const ar=xe(O==null?void 0:O.broadcast_ts,0),cr=xe(O==null?void 0:O.confirm_ts,0),Lt=String((O==null?void 0:O.confirm_ts_source)||"")==="chain"&&cr>0,Dt=xe(O==null?void 0:O.broadcast_price_usd,0)>0?xe(O==null?void 0:O.broadcast_price_usd,0):Hi(a,ar)??0,Ce=Lt?Hi(a,cr)??xe(O==null?void 0:O.confirm_price_usd,0):xe(O==null?void 0:O.confirm_price_usd,0),Bt=xe(O==null?void 0:O.receipt_slippage_kas,NaN);if(Number.isFinite(Bt)&&Bt>=0&&Le){G+=1,P+=Bt;continue}if(Le&&Lt&&Dt>0&&Ce>0&&(G+=1),Le&&Dt>0&&Ce>0&&Ze>0){const Ut=String((O==null?void 0:O.type)||((Ve=O==null?void 0:O.dec)==null?void 0:Ve.action)||"").toUpperCase()==="REDUCE"?-1:1,Ir=(Ce-Dt)/Dt;P+=Ze*Math.abs(Ir)*Math.abs(Ut);const Wt=Ir*Ut*100,lr=xe((Se=O==null?void 0:O.dec)==null?void 0:Se.expected_value_pct,0);Ae+=Ze*(Wt/100),ce+=Ze*(lr/100),ae+=Math.abs(Wt-lr),fe+=1}}const Ke=Math.max(0,_-B+P),Re=u.length,He=d.length,Ne=m.length,$e=h.length,Je=He>0?Re/He*100:0,qe=Re>0?H/Re*100:0,De=[...m,...h].reduce((O,oe)=>O+Math.max(0,xe(oe==null?void 0:oe.amount_kas,0)),0),Qe=t.length>0?k/t.length:0,Te=t.length>0?j/t.length:0,it=R>0?C/R:0,tt=x>0?p/x:0,S=w>0?E/w:0,N=F>0?K/F*100:0,le=fe>0?ae/fe:0,T=Ae-ce,X=A-v-_,se=Re>0&&H===Re,he=Re>0?G/Re*100:0,je=H>0?re/H*100:0,L=se&&H>0&&G===H,pe=H===0?"estimated":L?"realized":"hybrid",Fe=v,W=A-Fe-Ke;return{grossEdgeKas:Number(A.toFixed(6)),netPnlKas:Number(W.toFixed(6)),netPnlMode:pe,feesKas:Number(Fe.toFixed(6)),realizedChainFeeKas:Number(Z.toFixed(6)),slippageKas:Number(Ke.toFixed(6)),estimatedSlippageKas:Number(_.toFixed(6)),estimatedNetPnlKas:Number(X.toFixed(6)),realizedExecutionDriftKas:Number(P.toFixed(6)),actionableSignals:He,executedSignals:Re,confirmedSignals:H,pendingSignals:Ne,rejectedSignals:$e,fillRatePct:Number(Je.toFixed(2)),receiptCoveragePct:Number(qe.toFixed(2)),realizedReceiptCoveragePct:Number(he.toFixed(2)),chainFeeCoveragePct:Number(je.toFixed(2)),realizedMinConfirmations:l,confirmationFloorObservedMin:Math.max(0,Math.round(D||c.base)),confirmationFloorObservedMax:Math.max(0,Math.round(Y||c.base)),provenanceChainSignals:b,provenanceBackendSignals:M,provenanceEstimatedSignals:ie,missedFillKas:Number(De.toFixed(6)),avgSignalConfidence:Number(Qe.toFixed(4)),avgExpectedValuePct:Number(Te.toFixed(4)),signalQualityScore:Number(tt.toFixed(4)),confidenceBrierScore:Number(S.toFixed(6)),evCalibrationErrorPct:Number(le.toFixed(6)),realizedVsExpectedEdgeKas:Number(T.toFixed(6)),regimeHitRatePct:Number(N.toFixed(2)),regimeHitSamples:F,timingAlphaPct:Number(it.toFixed(4)),timingWins:I,timingSamples:R,rows:[{label:"Gross Edge",value:Number(A.toFixed(6)),hint:"Expected-value weighted edge from actionable signals"},{label:"Fees",value:Number((-Fe).toFixed(6)),hint:"Protocol + execution fees from runtime logs"},{label:"Chain Fee (receipts)",value:Number((-Z).toFixed(6)),hint:"On-chain network fee parsed from confirmed receipt payloads (coverage may be partial)"},{label:H>0?"Slippage (hybrid)":"Slippage (est)",value:Number((-Ke).toFixed(6)),hint:H>0?"Confirmed receipts use backend slippage when available, otherwise realized execution drift; remaining fills use estimated liquidity impact":"Liquidity-impact estimate from decision liquidity bucket"},{label:(H>0,"Realized Drift (receipts)"),value:Number((-P).toFixed(6)),hint:pe==="realized"?"Backend slippage or observed price drift using chain confirmation timestamps and market snapshots":"Backend slippage or observed price drift between broadcast and confirmation timestamps for confirmed executions"},{label:pe==="realized"?"Net PnL (realized)":H>0?"Net PnL (hybrid)":"Net PnL (est)",value:Number((H>0?W:X).toFixed(6)),hint:pe==="realized"?`All executed signals confirmed with receipt-aware drift at >= ${l} confirmation${l===1?"":"s"}`:H>0?"Gross edge - fees - hybrid slippage (realized where receipts are confirmed)":"Gross edge - fees - estimated slippage"},{label:"Timing Alpha %",value:Number(it.toFixed(6)),hint:"Directionally signed follow-through after signals"},{label:"Missed Fill KAS",value:Number((-De).toFixed(6)),hint:"Pending + rejected queued execution notional"}]}}const Cu=String(pn||"").replace(/\/+$/,""),Xr=Array.from(new Set([Cu,...Zr.map(e=>String(e||"").replace(/\/+$/,""))])).filter(Boolean),Gi=12e3,zr=2,wu=250,qi=new Set([408,425,429,500,502,503,504]),ku=2e4,Nu=3,Iu=2e4;let Ln=0,Pn=0,Ur=null,hr=null;const ju=Ie.startsWith("testnet")?"testnet":"mainnet",Ru=[e=>`/transactions/${e}`,e=>`/txs/${e}`,e=>`/transaction/${e}`];function Mu(e,t){return`${e}${t}`}function Yi(e){return new Promise(t=>setTimeout(t,e))}function Xi(e){const t=Math.floor(Math.random()*120);return wu*(e+1)+t}function Lu(e){const t=String(e||"").toLowerCase();return t.includes("tn10")||t.includes("tn11")||t.includes("tn12")||t.includes("testnet")?"testnet":t.includes("api.kaspa.org")||t.includes("mainnet")?"mainnet":"unknown"}function Pu(e){const t=String(e||"").toLowerCase();if(t.includes("/addresses/kaspatest:")||t.includes("/addresses/kaspatest%3a"))return"testnet";if(t.includes("/addresses/kaspa:")||t.includes("/addresses/kaspa%3a"))return"mainnet";try{const s=decodeURIComponent(t);if(s.includes("/addresses/kaspatest:"))return"testnet";if(s.includes("/addresses/kaspa:"))return"mainnet"}catch{}return"unknown"}function Ou(e){const t=Pu(e),s=t==="unknown"?ju:t;if(s==="unknown")return Xr;const i=Xr.filter(o=>{const a=Lu(o);return a===s||a==="unknown"});return i.length>0?i:Xr}async function Nr(e){if(Xr.length===0)throw new Error("No Kaspa API endpoints configured");const t=Date.now();if(t<Pn)throw rn(new Error(`Kaspa API circuit open â€“ retrying in ${Math.ceil((Pn-t)/1e3)}s`),{path:e});const s=Ou(e),i=[];for(const o of s)for(let a=0;a<zr;a+=1){const l=new AbortController,c=setTimeout(()=>l.abort(),Gi),d=`${a+1}/${zr}`;try{const u=await fetch(Mu(o,e),{method:"GET",headers:{Accept:"application/json"},signal:l.signal});if(!u.ok){const h=Number(u.status||0);if(qi.has(h)&&a+1<zr){await Yi(Xi(a));continue}throw new Error(`${h||"request_failed"}`)}const m=await u.json();return Ln=0,m}catch(u){const m=(u==null?void 0:u.name)==="AbortError",h=String((u==null?void 0:u.message)||""),v=Number(h||0),A=qi.has(v),_=(u==null?void 0:u.name)==="TypeError"||/failed to fetch|network|load failed/i.test(h);if(a+1<zr&&(m||A||_)){await Yi(Xi(a));continue}m?i.push(`${o} timeout (${Gi}ms, attempt ${d})`):_?i.push(`${o} network_error (${h||"request_failed"}, attempt ${d})`):i.push(`${o} ${h||"request_failed"} (attempt ${d})`);break}finally{clearTimeout(c)}}throw Ln+=1,Ln>=Nu&&(Pn=Date.now()+Iu),rn(new Error(`Kaspa API unavailable for ${e}: ${i.join(" | ")}`),{path:e,roots:s})}function aa(e){const t=String(e||"").trim();if(!t)throw new Error("Missing Kaspa address");return encodeURIComponent(t)}function Ku(e){const t=String(e||"").trim();if(!/^[a-fA-F0-9]{64}$/.test(t))throw new Error("Invalid txid format");return t.toLowerCase()}function Fu(e){var i;const t=(e==null?void 0:e.balance)??(e==null?void 0:e.totalBalance)??(e==null?void 0:e.availableSompi)??(e==null?void 0:e.balanceSompi)??((i=e==null?void 0:e.balances)==null?void 0:i.total)??0,s=Number(t);return Number.isFinite(s)?Math.max(0,s):0}function $u(e,t){var i;const s=(e==null?void 0:e.balanceKas)??(e==null?void 0:e.kas)??(e==null?void 0:e.balance_kas)??((i=e==null?void 0:e.balances)==null?void 0:i.kas);if(s!=null){const o=Number(s);if(Number.isFinite(o))return Math.max(0,o)}return t/1e8}function Du(e){return Array.isArray(e)?e:Array.isArray(e==null?void 0:e.utxos)?e.utxos:Array.isArray(e==null?void 0:e.entries)?e.entries:[]}function Wr(...e){for(const t of e){const s=Number(t);if(Number.isFinite(s))return s}return NaN}function Bu(...e){for(const t of e)if(typeof t=="boolean")return t}function zu(e){const t=Number(e);if(!(!Number.isFinite(t)||t<=0))return t<1e12?Math.round(t*1e3):Math.round(t)}function Qi(...e){for(const t of e){const s=Number(t);if(Number.isFinite(s)&&s>=0)return Math.round(s)}}function Uu(e,t,s){var k,j,C,R,I,p,x,E,w,K,F,H,G,B;const i=(t==null?void 0:t.transaction)??(t==null?void 0:t.tx)??t,o=String((i==null?void 0:i.status)??(i==null?void 0:i.transactionStatus)??((k=i==null?void 0:i.verboseData)==null?void 0:k.status)??(i==null?void 0:i.state)??"").toLowerCase(),a=Math.max(0,Math.round(Wr(i==null?void 0:i.confirmations,i==null?void 0:i.numConfirmations,i==null?void 0:i.confirmationCount,(j=i==null?void 0:i.verboseData)==null?void 0:j.confirmations,i!=null&&i.acceptingBlockBlueScore&&(i!=null&&i.blockDaaScore)?Number(i.blockDaaScore)-Number(i.acceptingBlockBlueScore):NaN)||0)),l=Bu(i==null?void 0:i.isAccepted,i==null?void 0:i.accepted,(C=i==null?void 0:i.verboseData)==null?void 0:C.isAccepted,(R=i==null?void 0:i.verboseData)==null?void 0:R.accepted),c=Wr(i==null?void 0:i.blockDaaScore,i==null?void 0:i.acceptingBlockBlueScore,(I=i==null?void 0:i.verboseData)==null?void 0:I.blockDaaScore,(p=i==null?void 0:i.verboseData)==null?void 0:p.acceptingBlockBlueScore),d=Wr(i==null?void 0:i.blockTime,i==null?void 0:i.blockTimestamp,i==null?void 0:i.acceptedTime,(x=i==null?void 0:i.verboseData)==null?void 0:x.blockTime,(E=i==null?void 0:i.verboseData)==null?void 0:E.blockTimestamp),u=Qi(i==null?void 0:i.feeSompi,i==null?void 0:i.fee_sompi,i==null?void 0:i.networkFeeSompi,(w=i==null?void 0:i.verboseData)==null?void 0:w.feeSompi,(K=i==null?void 0:i.verboseData)==null?void 0:K.networkFeeSompi),m=Wr(i==null?void 0:i.feeKas,i==null?void 0:i.fee_kas,i==null?void 0:i.networkFeeKas,(F=i==null?void 0:i.verboseData)==null?void 0:F.feeKas,(H=i==null?void 0:i.verboseData)==null?void 0:H.networkFeeKas),h=Number.isFinite(m)?Number(m):typeof u=="number"?Number((u/1e8).toFixed(8)):void 0,v=Qi(i==null?void 0:i.mass,i==null?void 0:i.transactionMass,(G=i==null?void 0:i.verboseData)==null?void 0:G.mass,(B=i==null?void 0:i.verboseData)==null?void 0:B.transactionMass),A=zu(d);let _="pending";return o.includes("confirm")||o.includes("accept")||a>0||Number.isFinite(c)?_="confirmed":(o.includes("reject")||o.includes("invalid")||o.includes("orphan")||l===!1)&&(_="failed"),{txid:e,found:!!t,status:_,confirmations:a,accepted:l,blockDaaScore:Number.isFinite(c)?Number(c):void 0,blockTime:Number.isFinite(d)?Number(d):void 0,confirmTimeMs:A,feeSompi:u,feeKas:h,mass:v,sourcePath:s,raw:t}}async function Wu(e){try{return await Nr(e)}catch(t){const s=String((t==null?void 0:t.message)||"");if(/(^|\s)404(\s|$)|\b404\b/.test(s))return null;throw t}}async function ca(){const e=Date.now();return Ur&&e-Ur.ts<ku?Ur.value:hr||(hr=(async()=>{const t=await Nr("/info/price"),s=Number((t==null?void 0:t.price)??0);if(!Number.isFinite(s))throw rn(new Error("Invalid price payload from Kaspa API"),{endpoint:"/info/price"});return Ur={value:s,ts:Date.now()},s})().finally(()=>{hr=null}),hr)}async function la(e){const t=await Nr(`/addresses/${aa(e)}/balance`),s=Fu(t),i=$u(t,s);return{kas:Xt(i,4),raw:s}}async function Hu(e){const t=await Nr(`/addresses/${aa(e)}/utxos`);return Du(t)}async function Vu(){const e=await Nr("/info/blockdag");return(e==null?void 0:e.blockdag)??(e==null?void 0:e.blockDag)??e}async function Gu(e){const t=Ku(e),s=[];for(const i of Ru){const o=i(t);try{const a=await Wu(o);if(!a)continue;return Uu(t,a,o)}catch(a){s.push(String((a==null?void 0:a.message)||a||"request_failed"))}}if(s.length===0)return{txid:t,found:!1,status:"pending",confirmations:0};throw rn(new Error(`Kaspa tx receipt lookup failed for ${t}: ${s.join(" | ")}`),{txid:t})}function qu(e){return""}function Yu(e,t){switch(e){case"OFF":return t.type==="START"?"RUNNING":e;case"RUNNING":return t.type==="PAUSE"?"PAUSED":t.type==="KILL"?"SUSPENDED":t.type==="FAIL"?"ERROR":e;case"PAUSED":return t.type==="RESUME"?"RUNNING":t.type==="KILL"?"SUSPENDED":t.type==="FAIL"?"ERROR":e;case"SUSPENDED":return t.type==="RESUME"?"RUNNING":e;case"ERROR":return t.type==="RESET_ERROR"||t.type==="RESUME"?"RUNNING":t.type==="KILL"?"SUSPENDED":e;default:throw ls({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown agent state: ${String(e)}`})}}function Ji(e,t){switch(e){case"pending":return t.type==="BEGIN_SIGN"?"signing":t.type==="SIGN_SUCCESS"?"signed":t.type==="SIGN_REJECT"?"rejected":t.type==="FAIL"?"failed":e;case"signing":return t.type==="SIGN_SUCCESS"?"signed":t.type==="SIGN_REJECT"?"rejected":t.type==="FAIL"?"failed":e;case"failed":return t.type==="REQUEUE"?"pending":t.type==="BEGIN_SIGN"?"signing":e;case"rejected":return t.type==="REQUEUE"?"pending":e;case"signed":return e;default:throw ls({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown tx lifecycle state: ${String(e)}`})}}function Xu(e,t){switch(e){case"submitted":return t.type==="BROADCASTED"?"broadcasted":t.type==="POLL_PENDING"?"pending_confirm":t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"broadcasted":return t.type==="POLL_PENDING"?"pending_confirm":t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"pending_confirm":return t.type==="CONFIRMED"?"confirmed":t.type==="FAILED"?"failed":t.type==="TIMEOUT"?"timeout":e;case"failed":case"timeout":case"confirmed":return t.type==="RESET"?"submitted":e;default:throw ls({domain:"lifecycle",code:"LIFECYCLE_INVALID_TRANSITION",message:`Unknown tx receipt lifecycle state: ${String(e)}`})}}function Qu(e="RUNNING"){const[t,s]=g.useState(e),i=g.useCallback(o=>{s(a=>Yu(String(a||"RUNNING"),o))},[]);return{status:t,setStatus:s,transitionAgentStatus:i}}function Ju(e){const{status:t,runtimeHydrated:s,loading:i,liveConnected:o,kasDataError:a,nextAutoCycleAt:l,cycleIntervalMs:c,cycleLockRef:d,setNextAutoCycleAt:u,runCycle:m}=e,h=g.useRef({loading:i,liveConnected:o,kasDataError:a,nextAutoCycleAt:l,cycleIntervalMs:c,runCycle:m});g.useEffect(()=>{h.current={loading:i,liveConnected:o,kasDataError:a,nextAutoCycleAt:l,cycleIntervalMs:c,runCycle:m}},[i,o,a,l,c,m]),g.useEffect(()=>{if(t!=="RUNNING"||!s)return;const v=setInterval(()=>{const A=h.current;d.current||A.loading||!A.liveConnected||A.kasDataError||Date.now()<A.nextAutoCycleAt||(u(Date.now()+A.cycleIntervalMs),A.runCycle())},1e3);return()=>clearInterval(v)},[t,s,u,d])}function Zu({priceUsd:e,enabled:t,triggerThresholdPct:s=1,onTrigger:i}){const o=g.useRef(null),a=g.useRef(i),l=g.useRef(!1);return g.useEffect(()=>{a.current=i},[i]),g.useEffect(()=>{if(!t||!e||e<=0)return;if(o.current===null){o.current=e;return}if(l.current)return;const d=Math.abs(e-o.current)/o.current*100;if(d>=s){const u=e>(o.current??e)?"UP":"DOWN";o.current=e,l.current=!0,setTimeout(()=>{l.current=!1},1e4),a.current(`price ${u} ${d.toFixed(2)}%`)}},[e,t,s]),{resetPriceTrigger:g.useCallback(()=>{e&&e>0&&(o.current=e),l.current=!1},[e])}}const ef="forgeos.alerts.v1",tf="forgeos.alerts.dedupe.v1",rf=1200,Gt=new Map,Zi=1024,_r={enabled:!1,minIntervalSec:90,discordWebhookUrl:"",telegramBotApiUrl:"",telegramChatId:"",emailWebhookUrl:"",eventToggles:{risk_event:!0,queue_pending:!0,ai_outage:!0,regime_shift:!0,system:!1,tx_failure:!0,confirmation_timeout:!0,low_balance:!0,network_disconnect:!0},queuePendingThreshold:3,lowBalanceThreshold:100};function _s(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function da(e){return`${ef}:${_s(e)||"default"}`}function eo(e,t){return`${tf}:${_s(e)||"default"}:${String(t||"event").slice(0,120)}`}function On(e,t){const s=Number(e);return Number.isFinite(s)?s:t}function Kn(e,t,s){return Math.min(s,Math.max(t,e))}function Fn(e){return String(e||"").trim().slice(0,500)}function xn(e){var s;const t={..._r.eventToggles};for(const i of Object.keys(t))typeof((s=e==null?void 0:e.eventToggles)==null?void 0:s[i])=="boolean"&&(t[i]=e.eventToggles[i]);return{version:1,updatedAt:Date.now(),enabled:!!(e!=null&&e.enabled),minIntervalSec:Kn(On(e==null?void 0:e.minIntervalSec,_r.minIntervalSec),15,3600),discordWebhookUrl:Fn(e==null?void 0:e.discordWebhookUrl),telegramBotApiUrl:Fn(e==null?void 0:e.telegramBotApiUrl),telegramChatId:String((e==null?void 0:e.telegramChatId)||"").trim().slice(0,120),emailWebhookUrl:Fn(e==null?void 0:e.emailWebhookUrl),eventToggles:t,queuePendingThreshold:Kn(On(e==null?void 0:e.queuePendingThreshold,_r.queuePendingThreshold),1,50),lowBalanceThreshold:Kn(On(e==null?void 0:e.lowBalanceThreshold,_r.lowBalanceThreshold),0,1e5)}}function tr(){return xn(_r)}function es(e){if(typeof window>"u")return tr();try{const t=window.localStorage.getItem(da(e));return t?xn(JSON.parse(t)):tr()}catch{return tr()}}function nf(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(da(e),JSON.stringify(xn(t)))}catch{}}function sf(e,t,s){const i=s.key||`${s.type}:${s.title}`,o=Math.max(15,t.minIntervalSec)*1e3,a=Date.now(),l=`${_s(e)}:${i}`,c=Gt.get(l)||0;if(a-c<o)return!0;if(typeof window<"u")try{const d=window.localStorage.getItem(eo(e,i)),u=d?Number(d):0;if(Number.isFinite(u)&&a-u<o)return!0}catch{}if(Gt.set(l,a),Gt.size>Zi){const d=a-o*4;for(const[u,m]of Gt.entries())if(m<d&&Gt.delete(u),Gt.size<=Zi)break}if(typeof window<"u")try{window.localStorage.setItem(eo(e,i),String(a))}catch{}return!1}function Ss(e){const t=String(e.severity||"info").toUpperCase(),s=new Date(e.ts||Date.now()).toISOString();let i="[ForgeOS]["+t+"] "+e.title;e.repeatCount&&e.repeatCount>1&&(i="[ForgeOS]["+t+"] "+e.title+" ("+e.repeatCount+"x)"),e.escalatedFrom&&(i+=" [ESCALATED from "+e.escalatedFrom.toUpperCase()+"]");let o=e.message;if(e.meta){const a=[];for(const[l,c]of Object.entries(e.meta))c!=null&&a.push(l+"="+(typeof c=="object"?JSON.stringify(c):c));a.length>0&&(o+=`
`+a.join(" | "))}return(i+`
`+o+`
`+s).slice(0,rf)}const ts=typeof window<"u"&&window.__forgeosAlertServerUrl||"",of="https://corsproxy.io/?";async function bs(e,t){const s=e.startsWith("http")?of+encodeURIComponent(e):e,i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error("alert_webhook_"+i.status);return!0}async function af(e,t,s){if(!ts)return{sent:!1,failures:["no_server_configured"]};try{const i=await fetch(`${ts}/v1/alerts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:e,type:t.type,key:t.key,title:t.title,message:t.message,severity:t.severity,ts:t.ts,meta:t.meta,repeatCount:t.repeatCount,escalatedFrom:t.escalatedFrom,config:s})});if(!i.ok){const o=await i.json().catch(()=>({error:"unknown"}));throw new Error(o.error||"server_error")}return await i.json()}catch(i){throw new Error("server_"+(i.message||"unknown"))}}async function cf(e,t){return e?(await bs(e,{content:Ss(t)}),!0):!1}async function lf(e,t,s){return!e||!t?!1:(await bs(e,{chat_id:t,text:Ss(s),disable_web_page_preview:!0}),!0)}async function df(e,t){return e?(await bs(e,{subject:"[ForgeOS] "+t.title,message:Ss(t),event:t}),!0):!1}async function uf(e,t,s){const i=xn(s||es(e));if(!i.enabled)return{sent:!1,reason:"disabled"};if(!i.eventToggles[t.type])return{sent:!1,reason:"event_disabled"};if(!(!!i.discordWebhookUrl||!!i.telegramBotApiUrl&&!!i.telegramChatId||!!i.emailWebhookUrl))return{sent:!1,reason:"no_routes_configured"};if(sf(e,i,t))return{sent:!1,reason:"throttled"};if(ts)try{const c=await af(e,t,i);if(c.sent)return{sent:!0,sentCount:c.sentCount||1,failures:c.failures}}catch{}const a=[];let l=0;try{await cf(i.discordWebhookUrl,t)&&(l+=1)}catch(c){a.push("discord:"+((c==null?void 0:c.message)||"send_failed"))}try{await lf(i.telegramBotApiUrl,i.telegramChatId,t)&&(l+=1)}catch(c){a.push("telegram:"+((c==null?void 0:c.message)||"send_failed"))}try{await df(i.emailWebhookUrl,t)&&(l+=1)}catch(c){a.push("email:"+((c==null?void 0:c.message)||"send_failed"))}return l===0&&a.length?{sent:!1,reason:"delivery_failed",failures:a}:{sent:l>0,sentCount:l,failures:a}}function ff(e){const{alertScope:t,agentName:s,agentId:i,activeStrategyLabel:o}=e,[a,l]=g.useState(()=>es(t)),[c,d]=g.useState(!1),[u,m]=g.useState(null);g.useEffect(()=>{l(es(t))},[t]);const h=g.useCallback(async j=>{try{const C=await uf(t,j,a);return(C!=null&&C.sent||C!=null&&C.reason)&&m(C),C}catch(C){const R={sent:!1,reason:(C==null?void 0:C.message)||"alert_error"};return m(R),R}},[a,t]),v=g.useCallback(j=>{l(C=>({...C||tr(),...j,updatedAt:Date.now()}))},[]),A=g.useCallback((j,C)=>{l(R=>({...R||tr(),eventToggles:{...(R||tr()).eventToggles||{},[j]:C},updatedAt:Date.now()}))},[]),_=g.useCallback(async()=>{d(!0);try{nf(t,a),m({sent:!0,reason:"saved",sentCount:0})}catch(j){m({sent:!1,reason:(j==null?void 0:j.message)||"save_failed"})}finally{d(!1)}},[a,t]),k=g.useCallback(async()=>{const j=await h({type:"system",key:`test_alert:${String(i||s||"agent")}`,title:`${s||"Agent"} test alert`,message:`Test alert from Forge-OS (${Ie}) Â· strategy=${String(o||"Custom")}`,severity:"info",meta:{network:Ie,strategy:o}});m(j)},[o,i,s,h]);return{alertConfig:a,setAlertConfig:l,alertSaveBusy:c,lastAlertResult:u,setLastAlertResult:m,sendAlertEvent:h,patchAlertConfig:v,toggleAlertType:A,saveAlertConfig:_,sendTestAlert:k}}const pf="forgeos.dashboard.v1",mf=160,gf=320,hf=120,xf=240;function yf(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function ua(e){const t=yf(e);return`${pf}:${t||"default"}`}function $n(e,t){return Array.isArray(e)?e.slice(0,t):[]}function _f(e,t){return Array.isArray(e)?e.slice(Math.max(0,e.length-t)):[]}function fa(e){const t=e.attributionSummary&&typeof e.attributionSummary=="object"?{netPnlMode:String(e.attributionSummary.netPnlMode||"").slice(0,24)||void 0,truthDegraded:!!e.attributionSummary.truthDegraded,truthMismatchRatePct:Number.isFinite(Number(e.attributionSummary.truthMismatchRatePct))?Number(e.attributionSummary.truthMismatchRatePct):void 0,receiptCoveragePct:Number.isFinite(Number(e.attributionSummary.receiptCoveragePct))?Number(e.attributionSummary.receiptCoveragePct):void 0,realizedReceiptCoveragePct:Number.isFinite(Number(e.attributionSummary.realizedReceiptCoveragePct))?Number(e.attributionSummary.realizedReceiptCoveragePct):void 0,confidenceBrierScore:Number.isFinite(Number(e.attributionSummary.confidenceBrierScore))?Number(e.attributionSummary.confidenceBrierScore):void 0,evCalibrationErrorPct:Number.isFinite(Number(e.attributionSummary.evCalibrationErrorPct))?Number(e.attributionSummary.evCalibrationErrorPct):void 0,regimeHitRatePct:Number.isFinite(Number(e.attributionSummary.regimeHitRatePct))?Number(e.attributionSummary.regimeHitRatePct):void 0,regimeHitSamples:Number.isFinite(Number(e.attributionSummary.regimeHitSamples))?Number(e.attributionSummary.regimeHitSamples):void 0,realizedVsExpectedEdgeKas:Number.isFinite(Number(e.attributionSummary.realizedVsExpectedEdgeKas))?Number(e.attributionSummary.realizedVsExpectedEdgeKas):void 0,updatedAt:Date.now()}:void 0;return{version:1,updatedAt:Date.now(),status:e.status==="RUNNING"||e.status==="PAUSED"||e.status==="SUSPENDED"?e.status:"RUNNING",execMode:e.execMode==="autonomous"||e.execMode==="manual"||e.execMode==="notify"?e.execMode:"manual",liveExecutionArmed:!!e.liveExecutionArmed,nextAutoCycleAt:Number.isFinite(e.nextAutoCycleAt)&&Number(e.nextAutoCycleAt)>0?Number(e.nextAutoCycleAt):void 0,queue:$n(e.queue,mf),log:$n(e.log,gf),decisions:$n(e.decisions,hf),marketHistory:_f(e.marketHistory,xf),attributionSummary:t}}function pa(e){if(typeof window>"u")return null;try{const t=window.localStorage.getItem(ua(e));if(!t)return null;const s=JSON.parse(t);return fa(s)}catch{return null}}function Sf(e,t){if(!(typeof window>"u"))try{const s=fa(t);window.localStorage.setItem(ua(e),JSON.stringify(s))}catch{}}function bf(e){const{agent:t,cycleIntervalMs:s,runtimeScope:i,maxDecisionEntries:o,maxLogEntries:a,maxQueueEntries:l,maxMarketSnapshots:c,runtimeHydrated:d,setRuntimeHydrated:u,status:m,execMode:h,liveExecutionArmed:v,queue:A,log:_,decisions:k,marketHistory:j,attributionSummary:C,nextAutoCycleAt:R,setStatus:I,setExecMode:p,setLiveExecutionArmed:x,setQueue:E,setLog:w,setDecisions:K,setMarketHistory:F,setNextAutoCycleAt:H,liveExecutionDefault:G,writeDelayMs:B=250}=e;g.useEffect(()=>{u(!1);const P=pa(i);P?(P.status&&(t!=null&&t.name)&&I(P.status),P.execMode&&["autonomous","manual","notify"].includes(String(P.execMode))?p(P.execMode):p(t.execMode||"manual"),typeof P.liveExecutionArmed=="boolean"?x(P.liveExecutionArmed):x(G),E(Array.isArray(P.queue)?P.queue.slice(0,l):[]),w(Array.isArray(P.log)&&P.log.length>0?P.log.slice(0,a):Qn(t.name)),K(Array.isArray(P.decisions)?P.decisions.slice(0,o):[]),F(Array.isArray(P.marketHistory)?P.marketHistory.slice(-c):[]),H(Number.isFinite(P.nextAutoCycleAt)?Math.max(Date.now()+1e3,Number(P.nextAutoCycleAt)):Date.now()+s)):(t!=null&&t.name&&I("RUNNING"),p(t.execMode||"manual"),x(G),E([]),K([]),F([]),w(Qn(t.name)),H(Date.now()+s)),u(!0)},[t.execMode,t.name,s,G,o,a,c,l,i,K,p,x,w,F,H,E,u,I]),g.useEffect(()=>{if(!d)return;const P=setTimeout(()=>{Sf(i,{status:m,execMode:h,liveExecutionArmed:v,queue:A,log:_,decisions:k,marketHistory:j,attributionSummary:C,nextAutoCycleAt:R})},B);return()=>clearTimeout(P)},[k,h,v,_,j,C,R,A,d,i,m,B])}function Ef(e){var b,M;const{viewportWidth:t,nextAutoCycleAt:s,status:i,totalFees:o,queue:a,decisions:l,liveConnected:c,kasDataError:d,wallet:u,kasData:m,reserveKas:h,netFeeKas:v,treasuryReserveKas:A,wsUrl:_,streamConnected:k,streamRetryCount:j}=e,C=t<760,R=t<1024,I=g.useMemo(()=>C?"1fr":R?"repeat(2,1fr)":"repeat(4,1fr)",[C,R]),p=R?"1fr":"2fr 1fr",x=R?"1fr":"1fr 1fr",E=Array.isArray(a)?a.filter(ie=>(ie==null?void 0:ie.status)==="pending").length:0,w=Number((m==null?void 0:m.walletKas)||0),K=Math.max(0,w-h-v-A),F=c&&!d&&(u==null?void 0:u.provider)!=="demo",H=Math.max(0,Math.ceil((s-Date.now())/1e3)),G=`${Math.floor(H/60).toString().padStart(2,"0")}:${(H%60).toString().padStart(2,"0")}`,B=(b=l==null?void 0:l[0])==null?void 0:b.dec,P=String((B==null?void 0:B.decision_source)||((M=l==null?void 0:l[0])==null?void 0:M.source)||"ai"),Z=_?k?"STREAM LIVE":j>0?`STREAM RETRY ${j}`:"STREAM DOWN":"STREAM OFF",re=_?k?n.ok:n.warn:n.dim;return{isMobile:C,isTablet:R,summaryGridCols:I,splitGridCols:p,controlsGridCols:x,pendingCount:E,liveKasNum:w,spendableKas:K,liveExecutionReady:F,autoCycleCountdownLabel:G,lastDecision:B,lastDecisionSource:P,streamBadgeText:Z,streamBadgeColor:re,totalFees:o,status:i}}function Af(e){const t=Number(e);return Number.isFinite(t)?t:0}function qt(e){const t=Number(e);return Number.isFinite(t)?t:0}function vf(e){const{pnlAttribution:t,receiptConsistencyMetrics:s}=e,i=Math.max(0,qt(s==null?void 0:s.checked)),o=Math.max(0,qt(s==null?void 0:s.mismatch)),a=i>0?o/i*100:0,l=Math.max(0,qt(s==null?void 0:s.repeatedMismatchItems)),c=i>=Fc&&a>=hi,d=[];c&&d.push(`receipt_mismatch_rate_${a.toFixed(1)}pct>=${hi.toFixed(1)}pct`);const u={degraded:c,checked:i,mismatches:o,mismatchRatePct:Number(a.toFixed(2)),repeatedMismatchItems:l,autoApproveDisabled:c&&$c,reasons:d},m=Math.max(0,qt(t==null?void 0:t.confidenceBrierScore)),h=Math.max(0,qt(t==null?void 0:t.evCalibrationErrorPct)),v=Math.max(0,Af(t==null?void 0:t.regimeHitRatePct)),A=Math.max(0,qt(t==null?void 0:t.regimeHitSamples));let _=1;const k=[],j=A>=xi;Vt&&j?(m>=yi?(_-=.4,k.push(`brier_${m.toFixed(4)}>=${yi}`)):m>=Wn&&(_-=.18,k.push(`brier_${m.toFixed(4)}>=${Wn}`)),h>=_i?(_-=.35,k.push(`ev_cal_${h.toFixed(3)}>=${_i}`)):h>=Hn&&(_-=.15,k.push(`ev_cal_${h.toFixed(3)}>=${Hn}`)),v<=Si?(_-=.35,k.push(`regime_hit_${v.toFixed(1)}<=${Si}`)):v<=Vn&&(_-=.15,k.push(`regime_hit_${v.toFixed(1)}<=${Vn}`))):Vt&&k.push(`insufficient_calibration_samples_${A}/${xi}`),_=Math.max(0,Math.min(1,Number(_.toFixed(3))));let C="healthy",R=1;Vt&&j&&(_<.35?(C="critical",R=Dc):_<.6?(C="degraded",R=Ro):_<.85&&(C="warn",R=jo));const I=Number(Math.max(0,Math.min(1,R)).toFixed(4)),p=Number((1-I).toFixed(4)),x=I<.9999,E=Number(Math.max(0,Math.min(.95,Bc)).toFixed(4)),w=x&&p>=E,K=Vt&&j&&_<=bi&&w,F={enabled:Vt,samplesSufficient:j,health:_,tier:C,sizeMultiplier:I,sizeReductionPct:p,sizingThrottleApplied:x,minSizeReductionRequired:E,autoApproveDisabled:K,autoApproveDisableDeferred:Vt&&j&&_<=bi&&!w,reasons:k,metrics:{brier:m,evCalErrorPct:h,regimeHitRatePct:v,regimeHitSamples:A}},H=F.autoApproveDisabled||u.autoApproveDisabled,G=[...F.autoApproveDisabled?["calibration_guardrail"]:[],...u.autoApproveDisabled?["truth_degraded"]:[]];return{calibration:F,truth:u,effectiveSizingMultiplier:F.sizeMultiplier,autoApproveDisabled:H,autoApproveDisableReasons:G}}function Tf(e){return g.useMemo(()=>vf(e),[e.pnlAttribution,e.receiptConsistencyMetrics])}var vo;const Rt=((vo=import.meta)==null?void 0:vo.env)||{},$t=String(Rt.VITE_EXECUTION_RECEIPT_API_URL||"").trim().replace(/\/+$/,""),rr=String(Rt.VITE_EXECUTION_RECEIPT_API_TOKEN||"").trim(),ma=Math.max(500,Number(Rt.VITE_EXECUTION_RECEIPT_API_TIMEOUT_MS||4e3)),ga=String(Rt.VITE_EXECUTION_RECEIPT_IMPORT_ENABLED||"true").toLowerCase()!=="false",Cf=String(Rt.VITE_EXECUTION_RECEIPT_SSE_ENABLED||"true").toLowerCase()!=="false",ha=String(Rt.VITE_EXECUTION_RECEIPT_SSE_URL||"").trim().replace(/\/+$/,""),wf=String(Rt.VITE_EXECUTION_RECEIPT_SSE_REPLAY||"true").toLowerCase()!=="false",to=Math.max(0,Number(Rt.VITE_EXECUTION_RECEIPT_SSE_REPLAY_LIMIT||100));function Es(e){const t=String(e||"").trim().toLowerCase();if(!/^[a-f0-9]{64}$/.test(t))throw new Error("invalid_txid");return t}function rs(e){const t=e!=null&&e.receipt&&typeof e.receipt=="object"?e.receipt:null;if(!t)return null;const s=Es(String(t.txid||""));return{...t,txid:s}}function As(){return ga&&!!$t}function xa(){const e=ha||($t?`${$t}/v1/execution-receipts/stream`:"");return ga&&Cf&&!!e&&typeof EventSource<"u"}function ya(){return As()}function kf(e){return!e||typeof e!="object"?null:e.receipt&&typeof e.receipt=="object"?rs(e):e.txid?rs({receipt:e}):null}function Nf(){const e=ha||($t?`${$t}/v1/execution-receipts/stream`:"");if(!e)return"";const t=new URL(e,typeof window<"u"?window.location.origin:"http://localhost");return wf&&t.searchParams.set("replay","1"),to>0&&t.searchParams.set("limit",String(to)),rr&&t.searchParams.set("token",rr),t.toString()}const If=1500,jf=3e4,Rf=8;function Mf(e){if(!xa())return null;const t=Nf();if(!t)return null;const s=e==null?void 0:e.onReceipt,i=e==null?void 0:e.onStatus;let o=!1,a=0,l=null,c=null;function d(){if(o)return;const u=new EventSource(t);l=u,i==null||i("connecting");const m=()=>{a=0,i==null||i("open")},h=()=>{if(o)return;i==null||i("error");try{u.close()}catch{}if(l===u&&(l=null),a>=Rf){i==null||i("closed");return}const A=Math.min(jf,If*2**a);a+=1,c=setTimeout(()=>{c=null,d()},A)},v=A=>{try{const _=A!=null&&A.data?JSON.parse(String(A.data)):null,k=kf(_);k&&typeof s=="function"&&s(k)}catch{}};u.addEventListener("open",m),u.addEventListener("error",h),u.addEventListener("receipt",v)}return d(),{close(){o=!0,c&&(clearTimeout(c),c=null);try{l==null||l.close()}catch{}l=null,i==null||i("closed")},url:t}}async function Lf(e){if(!As())return null;const t=Es(e);if(typeof fetch!="function")throw new Error("backend_receipt_fetch_unavailable");const s=typeof AbortController<"u"?new AbortController:null,i=s?setTimeout(()=>s.abort(),ma):null;try{const o=await fetch(`${$t}/v1/execution-receipts?txid=${encodeURIComponent(t)}`,{method:"GET",headers:{Accept:"application/json",...rr?{Authorization:`Bearer ${rr}`}:{}},...s?{signal:s.signal}:{}});if(o.status===404)return null;const a=await o.text();if(!o.ok)throw new Error(`backend_receipt_${o.status}:${String(a||"").slice(0,180)}`);const l=a?JSON.parse(a):{};return rs(l)}finally{i&&clearTimeout(i)}}async function Pf(e){if(!ya())return!1;if(typeof fetch!="function")throw new Error("backend_receipt_metrics_fetch_unavailable");const t=String((e==null?void 0:e.status)||"").toLowerCase();if(!["consistent","mismatch","insufficient"].includes(t))throw new Error("invalid_consistency_status");const s=typeof AbortController<"u"?new AbortController:null,i=s?setTimeout(()=>s.abort(),ma):null;try{return!!(await fetch(`${$t}/v1/receipt-consistency`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...rr?{Authorization:`Bearer ${rr}`}:{}},body:JSON.stringify({txid:e!=null&&e.txid?Es(String(e.txid)):void 0,queueId:e!=null&&e.queueId?String(e.queueId).slice(0,120):void 0,agentId:e!=null&&e.agentId?String(e.agentId).slice(0,120):void 0,agentName:e!=null&&e.agentName?String(e.agentName).slice(0,120):void 0,status:t,mismatches:Array.isArray(e==null?void 0:e.mismatches)?e.mismatches.map(a=>String(a).trim()).filter(Boolean).slice(0,8):[],provenance:e!=null&&e.provenance?String(e.provenance).slice(0,24):void 0,truthLabel:e!=null&&e.truthLabel?String(e.truthLabel).slice(0,48):void 0,checkedTs:Number.isFinite(Number(e==null?void 0:e.checkedTs))?Math.max(0,Math.round(Number(e==null?void 0:e.checkedTs))):void 0,confirmTsDriftMs:Number.isFinite(Number(e==null?void 0:e.confirmTsDriftMs))?Math.max(0,Math.round(Number(e==null?void 0:e.confirmTsDriftMs))):void 0,feeDiffKas:Number.isFinite(Number(e==null?void 0:e.feeDiffKas))?Math.max(0,Number(Number(e==null?void 0:e.feeDiffKas).toFixed(8))):void 0,slippageDiffKas:Number.isFinite(Number(e==null?void 0:e.slippageDiffKas))?Math.max(0,Number(Number(e==null?void 0:e.slippageDiffKas).toFixed(8))):void 0}),...s?{signal:s.signal}:{}})).ok}finally{i&&clearTimeout(i)}}const ot=(e,t=0)=>{const s=Number(e);return Number.isFinite(s)?s:t};function Of(e){const t=Math.max(0,ot(e==null?void 0:e.amount_kas,0)),s=ot(e==null?void 0:e.broadcast_price_usd,0),i=ot(e==null?void 0:e.confirm_price_usd,0);if(!(t>0)||!(s>0)||!(i>0))return null;const o=Math.abs((i-s)/s);return Number((t*o).toFixed(8))}function Kf(e,t){const s=Date.now(),i=[],o=Math.max(0,ot((e==null?void 0:e.chain_confirm_ts)??(e==null?void 0:e.confirm_ts),0)),a=Math.max(0,ot(e==null?void 0:e.backend_confirm_ts,0)),l=o>0&&a>0,c=l?Math.abs(o-a):void 0;typeof c=="number"&&c>Math.max(0,ot(t==null?void 0:t.confirmTsDriftMs,0))&&i.push("confirm_ts");const d=ot((e==null?void 0:e.chain_receipt_fee_kas)??(e==null?void 0:e.receipt_fee_kas),NaN),u=ot(e==null?void 0:e.backend_receipt_fee_kas,NaN),m=Number.isFinite(d)&&Number.isFinite(u),h=m?Number(Math.abs(d-u).toFixed(8)):void 0;typeof h=="number"&&h>Math.max(0,ot(t==null?void 0:t.feeKasTolerance,0))&&i.push("fee_kas");const v=ot((e==null?void 0:e.backend_receipt_slippage_kas)??(e==null?void 0:e.receipt_slippage_kas),NaN),A=ot(e==null?void 0:e.chain_derived_slippage_kas,NaN),_=Number.isFinite(A)?A:Of(e),k=Number.isFinite(v)&&Number.isFinite(_),j=k?Number(Math.abs(v-Number(_)).toFixed(8)):void 0;return typeof j=="number"&&j>Math.max(0,ot(t==null?void 0:t.slippageKasTolerance,0))&&i.push("slippage_kas"),{status:l||m||k?i.length>0?"mismatch":"consistent":"insufficient",mismatches:i,...typeof c=="number"?{confirmTsDriftMs:c}:{},...typeof h=="number"?{feeDiffKas:h}:{},...typeof j=="number"?{slippageDiffKas:j}:{},checkedTs:s}}function Ff(e){const{wallet:t,maxQueueEntries:s,addLog:i,kasPriceUsd:o=0,setTab:a,onSignedAction:l,receiptRetryBaseMs:c=2e3,receiptRetryMaxMs:d=3e4,receiptTimeoutMs:u=8*60*1e3,receiptMaxAttempts:m=18,receiptPollIntervalMs:h=1200,receiptPollBatchSize:v=2,sendAlertEvent:A,agentName:_,agentId:k}=e,[j,C]=g.useState([]),[R,I]=g.useState(null),[p,x]=g.useState(0),E=g.useRef(new Set),w=g.useRef([]),K=g.useRef(!1),F=g.useRef(new Map),H=g.useRef(new Map),G=g.useRef(new Map),B=As(),P=xa(),Z=ya(),re=12,b=g.useMemo(()=>({confirmTsDriftMs:Pc,feeKasTolerance:Oc,slippageKasTolerance:Kc}),[]),M=g.useCallback(S=>{if(!S||String((S==null?void 0:S.status)||"")!=="signed")return S;const N=Kf(S,b);return{...S,receipt_consistency_status:N.status,receipt_consistency_mismatches:N.mismatches,receipt_consistency_checked_ts:N.checkedTs,receipt_consistency_confirm_ts_drift_ms:typeof N.confirmTsDriftMs=="number"?N.confirmTsDriftMs:void 0,receipt_consistency_fee_diff_kas:typeof N.feeDiffKas=="number"?N.feeDiffKas:void 0,receipt_consistency_slippage_diff_kas:typeof N.slippageDiffKas=="number"?N.slippageDiffKas:void 0}},[b]),ie=g.useCallback((S,N,le={})=>{C(T=>T.map(X=>{if((X==null?void 0:X.id)!==S)return X;const se=Ji(String((X==null?void 0:X.status)||"pending"),N);return{...X,status:se,...le}}))},[]),D=g.useCallback((S,N,le={})=>{C(T=>T.map(X=>{if((X==null?void 0:X.id)!==S)return X;const se=Xu(String((X==null?void 0:X.receipt_lifecycle)||"submitted"),N),he={...X,receipt_lifecycle:se,...le};return M(he)}))},[M]),Y=g.useCallback(S=>{const N=Math.max(0,Math.min(6,Number(S||0))),le=Math.floor(Math.random()*250);return Math.min(d,c*2**N+le)},[c,d]),ae=g.useCallback((S,N,le={})=>{const T=Date.now(),X=Number(o||0);return{...S,status:"signed",txid:N,receipt_lifecycle:"broadcasted",broadcast_ts:T,receipt_attempts:0,confirmations:0,receipt_next_check_at:T+Y(0),receipt_last_checked_ts:void 0,failure_reason:null,...X>0?{broadcast_price_usd:X}:{},...le}},[o,Y]),fe=g.useCallback((S,N,le={})=>{const T=Date.now(),X=Number(o||0);D(S,{type:"BROADCASTED"},{txid:N,broadcast_ts:T,receipt_last_checked_ts:void 0,receipt_next_check_at:T+Y(0),receipt_attempts:0,confirmations:0,failure_reason:null,...X>0?{broadcast_price_usd:X}:{},...le})},[o,Y,D]),Ae=g.useCallback(async(S,N)=>{const le=String((S==null?void 0:S.id)||""),T=String((S==null?void 0:S.txid)||(N==null?void 0:N.txid)||"").trim().toLowerCase();if(!le||!T)return!1;const X=Date.now(),se=String((N==null?void 0:N.status)||"confirmed").toLowerCase(),he=Number((N==null?void 0:N.confirmTs)||0),je=he>0?he<1e12?Math.round(he*1e3):Math.round(he):0,L=Number((N==null?void 0:N.broadcastTs)||0),pe=L>0?L<1e12?Math.round(L*1e3):Math.round(L):0,Fe=String((N==null?void 0:N.confirmTsSource)||"").toLowerCase(),W=Fe==="chain"||Fe==="poll"?Fe:je>0?"chain":void 0,Me={txid:T,receipt_last_checked_ts:X,confirmations:Math.max(0,Number((N==null?void 0:N.confirmations)||0)),backend_confirmations:Math.max(0,Number((N==null?void 0:N.confirmations)||0)),failure_reason:null,receipt_source_path:"callback-consumer:/v1/execution-receipts",receipt_source:N!=null&&N.source?String(N.source).slice(0,120):"callback-consumer",receipt_imported_from:"callback_consumer",receipt_backend_updated_at:Number.isFinite(Number(N==null?void 0:N.updatedAt))&&Number(N.updatedAt)>0?Math.round(Number(N.updatedAt)):X,receipt_backend_last_checked_ts:X,receipt_backend_next_check_at:void 0,receipt_backend_attempts:Math.max(0,Number((S==null?void 0:S.receipt_backend_attempts)||0))+1,backend_receipt_slippage_kas:Number.isFinite(Number(N==null?void 0:N.slippageKas))?Math.max(0,Number(Number(N.slippageKas).toFixed(8))):void 0,receipt_slippage_kas:Number.isFinite(Number(N==null?void 0:N.slippageKas))?Math.max(0,Number(Number(N.slippageKas).toFixed(8))):void 0,backend_receipt_fee_sompi:Number.isFinite(Number(N==null?void 0:N.feeSompi))?Math.max(0,Math.round(Number(N.feeSompi))):void 0,receipt_fee_sompi:Number.isFinite(Number(N==null?void 0:N.feeSompi))?Math.max(0,Math.round(Number(N.feeSompi))):void 0,backend_receipt_fee_kas:Number.isFinite(Number(N==null?void 0:N.feeKas))?Math.max(0,Number(Number(N.feeKas).toFixed(8))):void 0,receipt_fee_kas:Number.isFinite(Number(N==null?void 0:N.feeKas))?Math.max(0,Number(Number(N.feeKas).toFixed(8))):void 0,...pe>0?{broadcast_ts:pe}:{},...je>0?{backend_confirm_ts:je}:{},...je>0?{confirm_ts:je}:{},...je>0?{confirm_detected_ts:X}:{},...W?{confirm_ts_source:W}:{},...je>0&&W==="chain"?{receipt_block_time_ms:je}:{},...Number.isFinite(Number(N==null?void 0:N.priceAtBroadcastUsd))&&Number(N.priceAtBroadcastUsd)>0?{broadcast_price_usd:Number(Number(N.priceAtBroadcastUsd).toFixed(8))}:{},...Number.isFinite(Number(N==null?void 0:N.priceAtConfirmUsd))&&Number(N.priceAtConfirmUsd)>0?{confirm_price_usd:Number(Number(N.priceAtConfirmUsd).toFixed(8))}:{}};return se==="failed"||se==="rejected"?(D(le,{type:"FAILED"},{...Me,receipt_next_check_at:void 0,failure_reason:"backend_receipt_failed"}),String((S==null?void 0:S.receipt_lifecycle)||"")!=="failed"&&i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"ERROR",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} failed via backend receipt Â· txid: ${T.slice(0,16)}...`,fee:null,truthLabel:"ESTIMATED",receiptProvenance:"BACKEND"}),!0):se==="confirmed"||Number((N==null?void 0:N.confirmations)||0)>0||je>0?(D(le,{type:"CONFIRMED"},{...Me,receipt_next_check_at:void 0}),String((S==null?void 0:S.receipt_lifecycle)||"")!=="confirmed"&&i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmed via backend receipt Â· ${Math.max(0,Number((N==null?void 0:N.confirmations)||0))} conf Â· txid: ${T.slice(0,16)}...`,fee:null,truthLabel:"BACKEND CONFIRMED",receiptProvenance:"BACKEND"}),!0):(D(le,{type:"POLL_PENDING"},{...Me,receipt_attempts:Math.max(0,Number((S==null?void 0:S.receipt_attempts)||0)),receipt_next_check_at:X+Y(Math.max(0,Number((S==null?void 0:S.receipt_attempts)||0)))}),!0)},[i,Y,D]),ce=g.useCallback(async S=>{const N=String((S==null?void 0:S.id)||""),le=String((S==null?void 0:S.txid)||"");if(!N||!le)return;const T=String((S==null?void 0:S.receipt_lifecycle)||"submitted"),X=K.current;if(B&&!X)try{const Se=await Lf(le);if(Se){if(await Ae(S,Se),String((Se==null?void 0:Se.status)||"").toLowerCase()==="confirmed"||String((Se==null?void 0:Se.status)||"").toLowerCase()==="failed"||String((Se==null?void 0:Se.status)||"").toLowerCase()==="rejected"||Number((Se==null?void 0:Se.confirmations)||0)>0||Number((Se==null?void 0:Se.confirmTs)||0)>0||T==="confirmed")return}else if(T==="confirmed"){const O=Math.max(0,Number((S==null?void 0:S.receipt_backend_attempts)||0))+1;if(O>=re){D(N,{type:"CONFIRMED"},{receipt_backend_last_checked_ts:Date.now(),receipt_backend_attempts:O,receipt_backend_next_check_at:void 0,receipt_backend_backfill_exhausted:!0});return}D(N,{type:"CONFIRMED"},{receipt_backend_last_checked_ts:Date.now(),receipt_backend_attempts:O,receipt_backend_next_check_at:Date.now()+Math.min(6e4,Math.max(5e3,c*2**Math.min(5,O)))});return}}catch{if(T==="confirmed"){const Se=Math.max(0,Number((S==null?void 0:S.receipt_backend_attempts)||0))+1;if(Se>=re){D(N,{type:"CONFIRMED"},{receipt_backend_last_checked_ts:Date.now(),receipt_backend_attempts:Se,receipt_backend_next_check_at:void 0,receipt_backend_backfill_exhausted:!0});return}D(N,{type:"CONFIRMED"},{receipt_backend_last_checked_ts:Date.now(),receipt_backend_attempts:Se,receipt_backend_next_check_at:Date.now()+Math.min(6e4,Math.max(5e3,c*2**Math.min(5,Se)))});return}}else if(T==="confirmed")return;const se=Date.now(),he=Math.max(0,Number((S==null?void 0:S.receipt_attempts)||0)),je=Math.max(0,Number((S==null?void 0:S.broadcast_ts)||(S==null?void 0:S.submitted_ts)||(S==null?void 0:S.ts)||se));if(T!=="confirmed"&&(he>=m||se-je>=u)){D(N,{type:"TIMEOUT"},{receipt_last_checked_ts:se,receipt_next_check_at:void 0,receipt_attempts:he,failure_reason:"confirmation_timeout"}),i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmation timeout Â· txid: ${le.slice(0,16)}...`,fee:null,truthLabel:"ESTIMATED",receiptProvenance:"CHAIN"});return}let L;try{L=await Gu(le)}catch(Se){const O=he+1;D(N,{type:"POLL_PENDING"},{receipt_last_checked_ts:Date.now(),receipt_next_check_at:Date.now()+Y(O),receipt_attempts:O,failure_reason:String((Se==null?void 0:Se.message)||"receipt_lookup_failed").slice(0,240)});return}const pe=Date.now();if(!(L!=null&&L.found)||L.status==="pending"){const Se=he+1;Se>=m||pe-je>=u?(D(N,{type:"TIMEOUT"},{receipt_last_checked_ts:pe,receipt_next_check_at:void 0,receipt_attempts:Se,confirmations:Math.max(0,Number((L==null?void 0:L.confirmations)||0)),failure_reason:"confirmation_timeout"}),i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmation timeout Â· txid: ${le.slice(0,16)}...`,fee:null,truthLabel:"ESTIMATED",receiptProvenance:"CHAIN"})):D(N,{type:"POLL_PENDING"},{receipt_last_checked_ts:pe,receipt_next_check_at:pe+Y(Se),receipt_attempts:Se,confirmations:Math.max(0,Number((L==null?void 0:L.confirmations)||0)),failure_reason:null});return}if(L.status==="failed"){D(N,{type:"FAILED"},{receipt_last_checked_ts:pe,receipt_next_check_at:void 0,receipt_attempts:he+1,confirmations:Math.max(0,Number((L==null?void 0:L.confirmations)||0)),failure_reason:"chain_rejected"}),i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"ERROR",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} failed on-chain Â· txid: ${le.slice(0,16)}...`,fee:null,truthLabel:"ESTIMATED",receiptProvenance:"CHAIN"});return}const Fe=Number(o||0),W=Fe>0?Fe:Number(await ca().catch(()=>0))||void 0,Me=Number((L==null?void 0:L.confirmTimeMs)||(L==null?void 0:L.blockTime)||0),Ve=Me>0?Me<1e12?Math.round(Me*1e3):Math.round(Me):pe;D(N,{type:"CONFIRMED"},{receipt_last_checked_ts:pe,receipt_next_check_at:void 0,receipt_attempts:he+1,confirmations:Math.max(0,Number((L==null?void 0:L.confirmations)||0)),chain_confirmations:Math.max(0,Number((L==null?void 0:L.confirmations)||0)),chain_confirm_ts:Ve,confirm_ts:Ve,confirm_detected_ts:pe,confirm_ts_source:Me>0?"chain":"poll",receipt_block_time_ms:Me>0?Ve:void 0,chain_receipt_fee_sompi:Number.isFinite(Number(L==null?void 0:L.feeSompi))?Math.max(0,Math.round(Number(L==null?void 0:L.feeSompi))):void 0,receipt_fee_sompi:Number.isFinite(Number(L==null?void 0:L.feeSompi))?Math.max(0,Math.round(Number(L==null?void 0:L.feeSompi))):void 0,chain_receipt_fee_kas:Number.isFinite(Number(L==null?void 0:L.feeKas))?Math.max(0,Number(Number(L==null?void 0:L.feeKas).toFixed(8))):void 0,receipt_fee_kas:Number.isFinite(Number(L==null?void 0:L.feeKas))?Math.max(0,Number(Number(L==null?void 0:L.feeKas).toFixed(8))):void 0,receipt_mass:Number.isFinite(Number(L==null?void 0:L.mass))?Math.max(0,Math.round(Number(L==null?void 0:L.mass))):void 0,receipt_source_path:L!=null&&L.sourcePath?String(L.sourcePath).slice(0,240):void 0,failure_reason:null,...W?{confirm_price_usd:W}:{},...Number.isFinite(Number(S==null?void 0:S.amount_kas))&&Number.isFinite(Number(S==null?void 0:S.broadcast_price_usd))&&Number.isFinite(Number(W))&&Number(S==null?void 0:S.amount_kas)>0&&Number(S==null?void 0:S.broadcast_price_usd)>0&&Number(W)>0?{chain_derived_slippage_kas:Number((Math.max(0,Number((S==null?void 0:S.amount_kas)||0))*Math.abs((Number(W)-Number((S==null?void 0:S.broadcast_price_usd)||0))/Number((S==null?void 0:S.broadcast_price_usd)||1))).toFixed(8))}:{}}),i({type:(S==null?void 0:S.metaKind)==="treasury_fee"?"TREASURY":"EXEC",msg:`${(S==null?void 0:S.metaKind)==="treasury_fee"?"Treasury payout":"Transaction"} confirmed Â· ${Math.max(0,Number((L==null?void 0:L.confirmations)||0))} conf Â· txid: ${le.slice(0,16)}...`,fee:null,truthLabel:"CHAIN CONFIRMED",receiptProvenance:"CHAIN"})},[i,Ae,B,o,Y,m,c,u,D]),Ke=g.useCallback(async S=>ad(t,hs(S)),[t]),Re=g.useCallback(S=>{C(N=>[S,...N].slice(0,s))},[s]),He=g.useCallback((S,N)=>{const le=ae(S,N);return C(T=>[le,...T].slice(0,s)),le},[ae,s]),Ne=g.useCallback(S=>{S!=null&&S.id&&ie(S.id,{type:"BEGIN_SIGN"}),I(S)},[ie]),$e=g.useCallback(S=>{const N=j.find(le=>le.id===S);if(ie(S,{type:"SIGN_REJECT"}),(N==null?void 0:N.metaKind)==="treasury_fee"){i({type:"TREASURY",msg:`Treasury fee payout rejected by operator: ${S}`,fee:null});return}i({type:"SIGN",msg:`Transaction rejected by operator: ${S}`,fee:null})},[i,j,ie]),Je=g.useCallback(()=>{R!=null&&R.id&&$e(R.id),I(null)},[$e,R]),qe=g.useCallback(async S=>{var le,T;const N=R?{...R,status:"signed",txid:S.txid}:S;if(R!=null&&R.id&&(ie(R.id,{type:"SIGN_SUCCESS",txid:S.txid},{txid:S.txid}),fe(R.id,S.txid)),(R==null?void 0:R.metaKind)==="treasury_fee"){i({type:"TREASURY",msg:`Treasury fee payout signed: ${R==null?void 0:R.amount_kas} KAS Â· txid: ${(le=S.txid)==null?void 0:le.slice(0,16)}...`,fee:null,truthLabel:"BROADCASTED",receiptProvenance:"ESTIMATED"}),I(null);return}i({type:"EXEC",msg:`SIGNED: ${R==null?void 0:R.type} Â· ${R==null?void 0:R.amount_kas} KAS Â· txid: ${(T=S.txid)==null?void 0:T.slice(0,16)}...`,fee:.08,truthLabel:"BROADCASTED",receiptProvenance:"ESTIMATED"}),i({type:"TREASURY",msg:`Fee split â†’ Pool: ${(dt*os).toFixed(4)} KAS / Treasury: ${(dt*It).toFixed(4)} KAS`,fee:dt}),I(null),typeof l=="function"&&await l(N)},[i,fe,l,R,ie]),De=g.useCallback(()=>{C(S=>S.map(N=>N.status==="pending"?{...N,status:Ji("pending",{type:"SIGN_REJECT"})}:N)),I(null)},[]),Qe=g.useRef(ce),Te=g.useRef({backendReceiptImportActive:B,receiptPollBatchSize:v,backendReceiptBackfillMaxAttempts:re});g.useEffect(()=>{Qe.current=ce},[ce]),g.useEffect(()=>{Te.current={backendReceiptImportActive:B,receiptPollBatchSize:v,backendReceiptBackfillMaxAttempts:re}},[B,v,re]),g.useEffect(()=>{w.current=Array.isArray(j)?j:[]},[j]),g.useEffect(()=>{if(!Array.isArray(j)||j.length===0)return;const S=F.current,N=H.current,le=G.current;for(const T of j){if(!(T!=null&&T.id))continue;const X=String(T.id),se=String((T==null?void 0:T.receipt_consistency_status)||""),he=Math.max(0,Number((T==null?void 0:T.receipt_consistency_checked_ts)||0));if(Z&&he>0){const je=Math.max(0,Number(le.get(X)||0));he!==je&&(se==="consistent"||se==="mismatch"||se==="insufficient")&&(le.set(X,he),Pf({txid:T==null?void 0:T.txid,queueId:X,agentId:k,agentName:_,status:se,mismatches:Array.isArray(T==null?void 0:T.receipt_consistency_mismatches)?T.receipt_consistency_mismatches:[],provenance:String((T==null?void 0:T.receipt_imported_from)||"").toLowerCase()==="callback_consumer"?"BACKEND":"CHAIN",truthLabel:String((T==null?void 0:T.receipt_imported_from)||"").toLowerCase()==="callback_consumer"&&String((T==null?void 0:T.receipt_lifecycle)||"")==="confirmed"?"BACKEND CONFIRMED":String((T==null?void 0:T.receipt_lifecycle)||"")==="confirmed"?"CHAIN CONFIRMED":"ESTIMATED",checkedTs:he,confirmTsDriftMs:T==null?void 0:T.receipt_consistency_confirm_ts_drift_ms,feeDiffKas:T==null?void 0:T.receipt_consistency_fee_diff_kas,slippageDiffKas:T==null?void 0:T.receipt_consistency_slippage_diff_kas}).catch(()=>{}))}if(se==="mismatch"){const je=Math.max(0,Number(N.get(X)||0));if(he>0&&he!==je){N.set(X,he);const L=Math.max(0,Number(S.get(X)||0))+1;S.set(X,L),x(pe=>pe+1),i({type:(T==null?void 0:T.metaKind)==="treasury_fee"?"TREASURY":"WARN",msg:`Receipt consistency mismatch (${(Array.isArray(T==null?void 0:T.receipt_consistency_mismatches)?T.receipt_consistency_mismatches:[]).join(",")||"unknown"}) Â· txid: ${String((T==null?void 0:T.txid)||"").slice(0,16)}...`,fee:null,truthLabel:String((T==null?void 0:T.receipt_imported_from)||"").toLowerCase()==="callback_consumer"&&String((T==null?void 0:T.receipt_lifecycle)||"")==="confirmed"?"BACKEND CONFIRMED":String((T==null?void 0:T.receipt_lifecycle)||"")==="confirmed"?"CHAIN CONFIRMED":"ESTIMATED",receiptProvenance:String((T==null?void 0:T.receipt_imported_from)||"").toLowerCase()==="callback_consumer"?"BACKEND":"CHAIN"}),typeof A=="function"&&L>=vn&&L%vn===0&&A({type:"risk_event",key:`receipt_consistency:${String(k||_||"agent")}:${String((T==null?void 0:T.txid)||X)}`,title:`${_||"Agent"} receipt consistency mismatch`,message:`Repeated backend/chain receipt mismatch (${L}x) for tx ${String((T==null?void 0:T.txid)||"").slice(0,16)}... mismatch=${(Array.isArray(T==null?void 0:T.receipt_consistency_mismatches)?T.receipt_consistency_mismatches:[]).join(",")||"unknown"}`,severity:"warn",meta:{agentId:k,agentName:_,txid:T==null?void 0:T.txid,queueId:X,mismatches:(T==null?void 0:T.receipt_consistency_mismatches)||[],confirmTsDriftMs:T==null?void 0:T.receipt_consistency_confirm_ts_drift_ms,feeDiffKas:T==null?void 0:T.receipt_consistency_fee_diff_kas,slippageDiffKas:T==null?void 0:T.receipt_consistency_slippage_diff_kas}})}}else se==="consistent"&&N.set(X,he)}},[i,k,_,Z,j,A]),g.useEffect(()=>{if(K.current=!1,!B||!P)return;const S=Mf({onStatus:N=>{K.current=N==="open"},onReceipt:N=>{const le=String((N==null?void 0:N.txid)||"").trim().toLowerCase();if(!/^[a-f0-9]{64}$/.test(le))return;const T=w.current;if(!Array.isArray(T)||T.length===0)return;const X=T.filter(se=>String((se==null?void 0:se.txid)||"").trim().toLowerCase()===le);for(const se of X)Ae(se,N)}});return()=>{var N;K.current=!1;try{(N=S==null?void 0:S.close)==null||N.call(S)}catch{}}},[Ae,B,P]),g.useEffect(()=>{let S=!1;const N=()=>{if(S)return;const T=Date.now(),X=E.current,se=Te.current,he=w.current,je=(Array.isArray(he)?he:[]).filter(L=>(L==null?void 0:L.status)==="signed"&&/^[a-f0-9]{64}$/i.test(String((L==null?void 0:L.txid)||""))).filter(L=>{const pe=String((L==null?void 0:L.receipt_lifecycle)||"submitted");if(pe==="failed"||pe==="timeout")return!1;if(pe==="confirmed"){if(!se.backendReceiptImportActive||L!=null&&L.receipt_backend_updated_at||K.current||L!=null&&L.receipt_backend_backfill_exhausted||Number((L==null?void 0:L.receipt_backend_attempts)||0)>=se.backendReceiptBackfillMaxAttempts)return!1;const Fe=Number((L==null?void 0:L.receipt_backend_next_check_at)||0);return!(Fe>0)||Fe<=T}return!0}).filter(L=>{const pe=String((L==null?void 0:L.receipt_lifecycle)||"submitted"),Fe=Number(pe==="confirmed"&&se.backendReceiptImportActive&&!K.current?(L==null?void 0:L.receipt_backend_next_check_at)||0:(L==null?void 0:L.receipt_next_check_at)||0);return!(Fe>0)||Fe<=T}).filter(L=>!X.has(String((L==null?void 0:L.id)||""))).slice(0,se.receiptPollBatchSize);for(const L of je){const pe=String((L==null?void 0:L.id)||"");pe&&(X.add(pe),Qe.current(L).finally(()=>{X.delete(pe)}))}};N();const le=setInterval(N,h);return()=>{S=!0,clearInterval(le)}},[h]),g.useEffect(()=>{},[s,j,a,t==null?void 0:t.address]);const it=j.filter(S=>S.status==="pending").length,tt=g.useMemo(()=>{const S={checked:0,consistent:0,mismatch:0,insufficient:0,repeatedMismatchItems:0,mismatchRatePct:0};for(const N of j){if(String((N==null?void 0:N.status)||"")!=="signed")continue;const le=String((N==null?void 0:N.receipt_consistency_status)||"insufficient");le==="consistent"?(S.checked+=1,S.consistent+=1):le==="mismatch"?(S.checked+=1,S.mismatch+=1):S.insufficient+=1,Math.max(0,Number(F.current.get(String((N==null?void 0:N.id)||""))||0))>=vn&&(S.repeatedMismatchItems+=1)}return S.mismatchRatePct=S.checked>0?Number((S.mismatch/S.checked*100).toFixed(2)):0,S},[j,p]);return{queue:j,setQueue:C,signingItem:R,setSigningItem:I,pendingCount:it,sendWalletTransfer:Ke,updateQueueItemLifecycle:ie,updateQueueItemReceiptLifecycle:D,receiptBackoffMs:Y,decorateBroadcastedSignedItem:ae,markQueueItemBroadcasted:fe,prependQueueItem:Re,prependSignedBroadcastedQueueItem:He,handleQueueSign:Ne,handleQueueReject:$e,handleSigningReject:Je,handleSigned:qe,rejectAllPending:De,receiptConsistencyMetrics:tt}}function $f(e){const t=String(e||"").trim().toLowerCase();return t.includes(":")?t:""}function un(e,t,s=0){if(!(s>4||e==null)){if(typeof e=="string"){t.push(e.toLowerCase());return}if(Array.isArray(e)){for(const i of e.slice(0,24))un(i,t,s+1);return}if(typeof e=="object")for(const[i,o]of Object.entries(e))typeof i=="string"&&t.push(i.toLowerCase()),un(o,t,s+1)}}function Df(...e){for(const t of e){const s=Number(t);if(Number.isFinite(s)&&s>0)return s}return NaN}function Bf(e){if(typeof e=="string"){const t=e.trim();if(!t)return null;try{return JSON.parse(t)}catch{return{type:"raw",payload:t}}}if(e instanceof ArrayBuffer){const t=new TextDecoder().decode(e).trim();if(!t)return null;try{return JSON.parse(t)}catch{return{type:"raw",payload:t}}}return typeof e=="object"&&e!=null?e:null}function zf(e,t){var h,v,A,_,k,j,C,R,I;const s=Date.now(),i=Bf(e);if(!i)return{kind:"unknown",ts:s,affectsWallet:!1,source:"empty"};const o=[];un({type:i==null?void 0:i.type,event:i==null?void 0:i.event,eventType:i==null?void 0:i.eventType,topic:i==null?void 0:i.topic,method:i==null?void 0:i.method,name:i==null?void 0:i.name},o);const a=o.slice(0,4).join("|")||"message",l=Df(i==null?void 0:i.virtualDaaScore,i==null?void 0:i.daaScore,(h=i==null?void 0:i.blockdag)==null?void 0:h.daaScore,(v=i==null?void 0:i.data)==null?void 0:v.virtualDaaScore,(A=i==null?void 0:i.data)==null?void 0:A.daaScore,(k=(_=i==null?void 0:i.params)==null?void 0:_.result)==null?void 0:k.virtualDaaScore,(C=(j=i==null?void 0:i.params)==null?void 0:j.result)==null?void 0:C.daaScore,(R=i==null?void 0:i.payload)==null?void 0:R.virtualDaaScore,(I=i==null?void 0:i.payload)==null?void 0:I.daaScore);if(Number.isFinite(l))return{kind:"daa",ts:s,daaScore:Math.round(l),affectsWallet:!1,source:a};const c=[];un(i,c);const d=c.join(" "),u=$f(t);if(/\butxo\b/.test(d)||/\butxos-changed\b/.test(d)||/\badded\b/.test(d)||/\bremoved\b/.test(d)){const p=u?d.includes(u):!0;return{kind:"utxo",ts:s,affectsWallet:p,source:a}}return{kind:"unknown",ts:s,affectsWallet:!1,source:a}}function Uf(e){const t=e.walletAddress,s=e.wsUrl||"",i=Math.max(1e3,Number(e.livePollMs)),o=Math.max(2e3,Number(e.streamReconnectMaxDelayMs)),a=Math.max(32,Number(e.maxMarketSnapshots)),l=g.useRef(!1),c=g.useRef(null),[d,u]=g.useState(null),[m,h]=g.useState([]),[v,A]=g.useState(!0),[_,k]=g.useState(null),[j,C]=g.useState(!1),[R,I]=g.useState(!1),[p,x]=g.useState(0),[E,w]=g.useState(0),[K,F]=g.useState(null);g.useEffect(()=>{c.current=d},[d]);const H=g.useCallback(B=>{h(P=>{const Z=P[P.length-1],re={ts:Number((B==null?void 0:B.ts)||Date.now()),priceUsd:Number((B==null?void 0:B.priceUsd)||0),daaScore:Number((B==null?void 0:B.daaScore)||0),walletKas:Number((B==null?void 0:B.walletKas)||0)};return Z&&Z.priceUsd===re.priceUsd&&Z.daaScore===re.daaScore&&Z.walletKas===re.walletKas?P:[...P,re].slice(-a)})},[a]),G=g.useCallback(async()=>{var B;if(t&&!l.current){l.current=!0,A(!0),k(null);try{const[P,Z,re]=await Promise.all([Vu(),la(t),ca().catch(()=>null)]),b=Date.now(),M={dag:P,priceUsd:Number(re||0),walletKas:Number(Z.kas||0),address:t,fetched:b};u(M),H({ts:b,priceUsd:M.priceUsd,daaScore:(B=M==null?void 0:M.dag)==null?void 0:B.daaScore,walletKas:M.walletKas}),C(!0)}catch(P){C(!1),k((P==null?void 0:P.message)||"Kaspa live feed disconnected")}finally{A(!1),l.current=!1}}},[H,t]);return g.useEffect(()=>{if(!t)return;G();const B=setInterval(G,i);let P=null,Z=null,re=null,b=!1,M=0;const ie=()=>{if(b||!s)return;const Y=Math.min(o,1200*2**M);M+=1,x(M),re=setTimeout(()=>{re=null,D()},Y)},D=()=>{!s||b||(P=new WebSocket(s),P.onopen=()=>{M=0,x(0),I(!0)},P.onmessage=Y=>{if(!Y||Y.data!==null&&Y.data!==void 0&&typeof Y.data!="string"&&!(Y.data instanceof ArrayBuffer)&&!(Y.data instanceof Blob))return;const ae=zf(Y.data,t);if(F(ae),ae.kind!=="unknown"&&w(ae.ts),ae.kind==="daa"&&Number.isFinite(ae.daaScore)){const ce=c.current;if(ce){const Ke=Date.now(),Re={...ce,fetched:Ke,dag:{...(ce==null?void 0:ce.dag)||{},daaScore:ae.daaScore}};u(Re),H({ts:Ke,priceUsd:Number(Re.priceUsd||0),daaScore:Number(ae.daaScore||0),walletKas:Number(Re.walletKas||0)})}}if(Z)return;const Ae=ae.kind==="utxo"&&ae.affectsWallet||ae.kind==="daa"?250:1200;Z=setTimeout(()=>{Z=null,G()},Ae)},P.onerror=()=>{b||I(!1)},P.onclose=()=>{I(!1),b||ie()})};return s&&D(),()=>{b=!0,clearInterval(B),Z&&clearTimeout(Z),re&&clearTimeout(re),P&&P.close()}},[i,G,o,t,s]),{kasData:d,setKasData:u,marketHistory:m,setMarketHistory:h,kasDataLoading:v,setKasDataLoading:A,kasDataError:_,setKasDataError:k,liveConnected:j,setLiveConnected:C,streamConnected:R,streamRetryCount:p,streamPulse:E,lastStreamEvent:K,refreshKasData:G}}const we=(e,t,s)=>Math.min(s,Math.max(t,e)),Pe=(e,t=0)=>{const s=Number(e);return Number.isFinite(s)?s:t};function Wf(e){const t=String(e||"HOLD").toUpperCase();return t==="ACCUMULATE"?1:t==="REBALANCE"?.75:t==="REDUCE"?.35:.5}function Hf(e){const t=String(e||"NEUTRAL").toUpperCase();return t==="RISK_OFF"?.2:t==="RANGE_VOL"?.6:t==="TREND_UP"||t==="FLOW_ACCUMULATION"?1.1:.85}function Vf(e,t,s){const i=String(e||t||"custom").toLowerCase(),o=String(s||"NEUTRAL").toUpperCase(),a=/trend|momentum/.test(i),l=/mean[_ -]?reversion|reversion|range/.test(i),c=/breakout|volatility/.test(i),d=/\bdca\b|accumulator|accumulation/.test(i);return a?o==="TREND_UP"||o==="FLOW_ACCUMULATION"?1.16:o==="RISK_OFF"?.72:o==="RANGE_VOL"?.9:1:l?o==="RANGE_VOL"?1.14:o==="TREND_UP"?.86:o==="RISK_OFF"?.76:1:c?o==="TREND_UP"?1.08:o==="RANGE_VOL"?1.05:o==="RISK_OFF"?.74:1:d?o==="RISK_OFF"?.92:o==="FLOW_ACCUMULATION"||o==="TREND_UP"?1.08:1.02:1}function Gf(e){const{calibrationRouting:t,templateRegimeBoost:s,regime:i,action:o}=e;let a=1;return t.samplesSufficient||(a*=.92),t.tier==="watch"&&(a*=.88),t.tier==="degraded"&&(a*=.68),t.tier==="critical"&&(a*=.45),t.truthDegraded&&(a*=we(1-t.truthMismatchRatePct/140,.55,.9)),s<1&&(a*=we(.65+s*.35,.58,.95)),String(i||"").toUpperCase()==="RISK_OFF"&&(a*=.72),String(o||"").toUpperCase()==="REDUCE"&&(a*=.65),we(a,.2,1)}function qf(e){const t=we(Pe(e==null?void 0:e.confidenceBrierScore,0),0,1),s=we(Pe(e==null?void 0:e.evCalibrationErrorPct,0),0,100),i=we(Pe(e==null?void 0:e.regimeHitRatePct,0),0,100),o=Math.max(0,Pe(e==null?void 0:e.regimeHitSamples,0)),a=!!(e!=null&&e.truthDegraded),l=we(Pe(e==null?void 0:e.truthMismatchRatePct,0),0,100),c=we(Pe((e==null?void 0:e.realizedReceiptCoveragePct)??(e==null?void 0:e.receiptCoveragePct),0),0,100),d=o>=8,u=we(1-t/.35,0,1.1),m=we(1-s/20,0,1.1),h=we(i/100,0,1.1),v=d?u*.4+m*.35+h*.25:.88,A=a?we(1-l/120,.35,.92):1,_=we(.7+c/100*.35,.7,1.05),k=we(v*A*_,.2,1.1),j=d?we(.35+k*.85,.3,1.2):.9,C=k<.42?"critical":k<.62?"degraded":k<.82?"watch":"healthy";return{samplesSufficient:d,brier:t,evCalErr:s,regimeHitRatePct:i,regimeHitSamples:o,truthDegraded:a,truthMismatchRatePct:l,receiptCoveragePct:c,health:k,sizeMultiplier:j,truthQualityScore:we((a?.5:.9)*_*A,.2,1.1),tier:C}}function Yf(e){const t=[];return e.enabled||t.push("disabled in allocator"),e.regime==="RISK_OFF"&&t.push("risk-off regime throttle"),e.queuePressurePct>20&&t.push("queue pressure high"),e.risk>.7&&t.push("elevated risk score"),e.confidence<.7&&t.push("low confidence"),e.dataQuality<.5&&t.push("limited data quality"),(e.calibrationTier==="critical"||e.calibrationTier==="degraded")&&t.push("calibration routing throttle"),e.truthDegraded&&t.push("truth quality degraded"),e.action==="REDUCE"&&t.push("reduce signal active"),e.strategyTemplate&&t.push(`template:${String(e.strategyTemplate).slice(0,24)}`),t.length||t.push("within shared budget guardrails"),t.slice(0,4)}function Xf(e){var j,C,R,I;const t=Math.max(0,Pe(e.walletKas,0)),s=Math.max(0,Pe((j=e.config)==null?void 0:j.reserveKas,5)),i=Math.max(0,t-s),o=we(Pe((C=e.config)==null?void 0:C.totalBudgetPct,.85),.05,1),a=we(Pe((R=e.config)==null?void 0:R.maxAgentAllocationPct,.5),.05,1),l=we(Pe((I=e.config)==null?void 0:I.rebalanceThresholdPct,.08),.01,.5),c=i*o,u=(Array.isArray(e.agents)?e.agents:[]).map(p=>{const x=(p==null?void 0:p.lastDecision)||{},E=(x==null?void 0:x.quant_metrics)||{},w=we(Pe(x==null?void 0:x.risk_score,.75),0,1),K=we(Pe(x==null?void 0:x.confidence_score,.55),0,1),F=we(Pe(E==null?void 0:E.data_quality_score,.45),0,1),H=String((x==null?void 0:x.action)||"HOLD").toUpperCase(),G=String((E==null?void 0:E.regime)||"NEUTRAL").toUpperCase(),B=Math.max(.1,Pe(E==null?void 0:E.risk_ceiling,.65)),P=we((B-w)/B,-1,1),Z=Math.max(0,Pe(p==null?void 0:p.pendingKas,0)),re=Math.max(0,Pe(p==null?void 0:p.capitalLimitKas,0)),b=we(Pe(p==null?void 0:p.targetAllocationPct,0),0,100),M=we(Pe(p==null?void 0:p.riskBudgetWeight,1),0,10),ie=(p==null?void 0:p.enabled)!==!1,D=re>0?we(Z/re*100,0,500):0,Y=String((p==null?void 0:p.strategyTemplate)||(p==null?void 0:p.strategyClass)||"custom"),ae=String((p==null?void 0:p.strategyClass)||""),fe=qf(p==null?void 0:p.attributionSummary),Ae=Vf(Y,ae,G),ce=p==null?void 0:p.attributionSummary,Ke=String((ce==null?void 0:ce.netPnlMode)||"estimated"),Re=Pe(ce==null?void 0:ce.netPnlKas,0),He=Pe(ce==null?void 0:ce.netPnlKas,0),Ne=Pe((ce==null?void 0:ce.estimatedNetPnlKas)||(ce==null?void 0:ce.netPnlKas),0),$e=Pe(p==null?void 0:p.balanceKas,0)||Pe(p==null?void 0:p.capitalLimitKas,0),Je=b>0?b/100:0,qe=we(.25+K*.45+Math.max(0,P)*.2+F*.1,.05,1.1),De=we(1-D/160,.2,1),Qe=ie?Math.max(0,(Je>0?Je:M*.2)*qe*Wf(H)*Hf(G)*Ae*fe.sizeMultiplier*De):0;return{agentId:String((p==null?void 0:p.agentId)||(p==null?void 0:p.name)||"agent"),name:String((p==null?void 0:p.name)||(p==null?void 0:p.agentId)||"Agent"),enabled:ie,targetPct:b,riskWeight:M,capitalLimitKas:re,pendingKas:Z,strategyTemplate:Y,strategyClass:ae,templateRegimeBoost:Ae,action:H,regime:G,confidence:K,risk:w,dataQuality:F,calibrationRouting:fe,score:Qe,queuePressurePct:D,balanceKas:$e,pnlKas:Re,pnlMode:Ke,realizedPnlKas:He,estimatedPnlKas:Ne}}),m=u.reduce((p,x)=>p+x.score,0),h=u.reduce((p,x)=>p+(x.enabled?Math.max(.1,x.riskWeight):0),0),v=u.map(p=>{const x=m>0?p.score/m:p.enabled?Math.max(.1,p.riskWeight)/Math.max(.1,h):0,E=Gf({calibrationRouting:p.calibrationRouting,templateRegimeBoost:p.templateRegimeBoost,regime:p.regime,action:p.action}),w=we(a*E,.02,1),K=c*x,F=Math.min(K,c*w),H=c>0?we(F/c*100,0,100):0,G=Math.min(F,p.capitalLimitKas>0?p.capitalLimitKas:F,Math.max(0,c*w)),B=F-p.pendingKas;return{agentId:p.agentId,name:p.name,enabled:p.enabled,targetPct:p.targetPct,riskWeight:p.riskWeight,score:Number(p.score.toFixed(6)),routingCapMultiplier:Number(E.toFixed(4)),maxShareCapPct:Number((w*100).toFixed(2)),templateRegimeMultiplier:Number(p.templateRegimeBoost.toFixed(4)),budgetPct:Number(H.toFixed(2)),budgetKas:Number(F.toFixed(6)),cycleCapKas:Number(Math.max(0,G).toFixed(6)),queuePressurePct:Number(p.queuePressurePct.toFixed(2)),strategyTemplate:p.strategyTemplate,calibrationHealth:Number(p.calibrationRouting.health.toFixed(4)),calibrationTier:p.calibrationRouting.tier,truthQualityScore:Number(p.calibrationRouting.truthQualityScore.toFixed(4)),regime:p.regime,action:p.action,confidence:Number(p.confidence.toFixed(4)),risk:Number(p.risk.toFixed(4)),dataQuality:Number(p.dataQuality.toFixed(4)),rebalanceDeltaKas:Math.abs(B)>=c*l?Number(B.toFixed(6)):0,notes:Yf({enabled:p.enabled,action:p.action,regime:p.regime,strategyTemplate:p.strategyTemplate,queuePressurePct:p.queuePressurePct,risk:p.risk,confidence:p.confidence,dataQuality:p.dataQuality,calibrationTier:p.calibrationRouting.tier,truthDegraded:p.calibrationRouting.truthDegraded}).concat(E<.999||K>F+1e-9?["dynamic concentration cap"]:[]).slice(0,5),balanceKas:Number(p.balanceKas.toFixed(6)),pnlKas:Number(p.pnlKas.toFixed(6)),pnlMode:p.pnlMode,realizedPnlKas:Number(p.realizedPnlKas.toFixed(6)),estimatedPnlKas:Number(p.estimatedPnlKas.toFixed(6))}}),A=v.reduce((p,x)=>p+x.budgetKas,0),_=v.length?Math.max(...v.map(p=>c>0?p.budgetKas/c*100:0)):0,k=v.length?v.reduce((p,x)=>p+x.budgetPct*x.risk,0)/100:0;return v.sort((p,x)=>x.budgetKas-p.budgetKas||p.name.localeCompare(x.name)),{walletKas:Number(t.toFixed(6)),reserveKas:Number(s.toFixed(6)),allocatableKas:Number(i.toFixed(6)),targetBudgetKas:Number(c.toFixed(6)),allocatedKas:Number(A.toFixed(6)),utilizationPct:Number((c>0?A/c*100:0).toFixed(2)),concentrationPct:Number(_.toFixed(2)),riskWeightedExposurePct:Number(k.toFixed(4)),rows:v}}const Qf="forgeos.portfolio.v1",Sr={version:1,updatedAt:0,totalBudgetPct:.85,reserveKas:5,maxAgentAllocationPct:.5,rebalanceThresholdPct:.08,agentOverrides:{}};function Jf(e){return String(e||"default").trim().toLowerCase().replace(/[^a-z0-9:_-]/g,"_").slice(0,180)}function _a(e){return`${Qf}:${Jf(e)||"default"}`}function Zt(e,t,s){return Math.min(s,Math.max(t,e))}function Hr(e,t){const s=Number(e);return Number.isFinite(s)?s:t}function Zf(e){if(!e||typeof e!="object")return{};const t={};return typeof e.enabled=="boolean"&&(t.enabled=e.enabled),Number.isFinite(Number(e.targetAllocationPct))&&(t.targetAllocationPct=Zt(Number(e.targetAllocationPct),0,100)),Number.isFinite(Number(e.riskWeight))&&(t.riskWeight=Zt(Number(e.riskWeight),0,10)),t}function Sa(e){const t={};if(e!=null&&e.agentOverrides&&typeof e.agentOverrides=="object")for(const[s,i]of Object.entries(e.agentOverrides)){const o=String(s||"").trim().toLowerCase().slice(0,120);o&&(t[o]=Zf(i))}return{version:1,updatedAt:Date.now(),totalBudgetPct:Zt(Hr(e==null?void 0:e.totalBudgetPct,Sr.totalBudgetPct),.05,1),reserveKas:Zt(Hr(e==null?void 0:e.reserveKas,Sr.reserveKas),0,1e6),maxAgentAllocationPct:Zt(Hr(e==null?void 0:e.maxAgentAllocationPct,Sr.maxAgentAllocationPct),.05,1),rebalanceThresholdPct:Zt(Hr(e==null?void 0:e.rebalanceThresholdPct,Sr.rebalanceThresholdPct),.01,.5),agentOverrides:t}}function Dn(){return{...Sr,updatedAt:Date.now(),agentOverrides:{}}}function ro(e){if(typeof window>"u")return Dn();try{const t=window.localStorage.getItem(_a(e));return t?Sa(JSON.parse(t)):Dn()}catch{return Dn()}}function ep(e,t){if(!(typeof window>"u"))try{window.localStorage.setItem(_a(e),JSON.stringify(Sa(t)))}catch{}}function tp(e){const{portfolioScope:t,allAgents:s,activeAgentId:i,walletAddress:o,walletKas:a,activeDecisions:l,activeQueue:c,activeAttributionSummary:d}=e,[u,m]=g.useState(()=>ro(t)),[h,v]=g.useState(0),[A,_]=g.useState(()=>({}));g.useEffect(()=>{m(ro(t))},[t]),g.useEffect(()=>{const p=setTimeout(()=>{ep(t,u)},200);return()=>clearTimeout(p)},[u,t]),g.useEffect(()=>{if(s.length<=1)return;const p=String(i||""),x=()=>{const w={};for(const K of s){const F=String((K==null?void 0:K.agentId)||(K==null?void 0:K.name)||"");if(!F||F===p)continue;const H=`${Ie}:${String(o||"unknown").toLowerCase()}:${F.toLowerCase()}`;w[F]=pa(H)||{}}_(w)};x();const E=setInterval(x,8e3);return()=>clearInterval(E)},[i,s,h,o]);const k=g.useMemo(()=>{const p=s.map(x=>{var M;const E=String((x==null?void 0:x.agentId)||(x==null?void 0:x.name)||""),K=E===String(i||"")?{queue:c,decisions:l,attributionSummary:d}:A[E]||{},F=Array.isArray(K.decisions)?(M=K.decisions[0])==null?void 0:M.dec:void 0,H=Array.isArray(K.queue)?K.queue.filter(ie=>(ie==null?void 0:ie.status)==="pending"&&(ie==null?void 0:ie.metaKind)!=="treasury_fee").reduce((ie,D)=>ie+Number((D==null?void 0:D.amount_kas)||0),0):0,G=E.toLowerCase(),B=((u==null?void 0:u.agentOverrides)||{})[G]||{},P=Number((x==null?void 0:x.capitalLimitKas)||(x==null?void 0:x.capitalLimit)||0),Z=K.attributionSummary,re=Number((Z==null?void 0:Z.netPnlKas)||0),b=(Z==null?void 0:Z.netPnlMode)||"estimated";return{agentId:E,name:String((x==null?void 0:x.name)||E),enabled:B.enabled!==!1,capitalLimitKas:Number((x==null?void 0:x.capitalLimit)||0),targetAllocationPct:Number(B.targetAllocationPct??(x==null?void 0:x.portfolioAllocationPct)??Math.round(100/Math.max(1,s.length))),riskBudgetWeight:Number(B.riskWeight??(x==null?void 0:x.riskBudgetWeight)??1),strategyTemplate:String((x==null?void 0:x.strategyTemplate)||(x==null?void 0:x.strategyLabel)||(x==null?void 0:x.strategyClass)||"custom"),strategyClass:String((x==null?void 0:x.strategyClass)||""),attributionSummary:Z,pendingKas:H,lastDecision:F,balanceKas:P,pnlKas:re,pnlMode:b}});return Xf({walletKas:Number(a||0),agents:p,config:u})},[i,d,l,c,s,A,u,a]),j=g.useMemo(()=>{var p;return((p=k==null?void 0:k.rows)==null?void 0:p.find(x=>String(x==null?void 0:x.agentId)===String(i)))||null},[i,k]);return{portfolioConfig:u,setPortfolioConfig:m,peerRuntimeCache:A,portfolioSummary:k,activePortfolioRow:j,patchPortfolioConfig:p=>{m(x=>({...x,...p,updatedAt:Date.now()}))},patchPortfolioAgentOverride:(p,x)=>{const E=String(p||"").toLowerCase();E&&(m(w=>({...w,updatedAt:Date.now(),agentOverrides:{...(w==null?void 0:w.agentOverrides)||{},[E]:{...((w==null?void 0:w.agentOverrides)||{})[E]||{},...x}}})),v(w=>w+1))},refreshPortfolioPeers:()=>{v(p=>p+1)}}}function rp(e){const{enabled:t,treasuryFeeKas:s,treasuryAddress:i,walletAddress:o,walletProvider:a,kasPriceUsd:l=0,maxQueueEntries:c,addLog:d,setQueue:u,sendWalletTransfer:m,receiptBackoffMs:h}=e,v=g.useCallback(C=>ln({id:Jr(),type:"TREASURY_FEE",metaKind:"treasury_fee",from:o,to:i,amount_kas:Number(Number(s||0).toFixed(6)),purpose:`Protocol treasury fee${C!=null&&C.txid?` Â· parent ${String(C.txid).slice(0,12)}`:""}`,status:"pending",ts:Date.now(),parentActionId:(C==null?void 0:C.id)||null,parentTxid:(C==null?void 0:C.txid)||null}),[i,s,o]),A=g.useCallback(C=>!t||!(s>0)||!C||(C==null?void 0:C.metaKind)==="treasury_fee"||String((C==null?void 0:C.type)||"").toUpperCase()!=="ACCUMULATE"?!1:ve.supportsNativeMultiOutput(String(a||"")),[t,s,a]),_=g.useCallback(C=>{if(!A(C))return C;const p=[...(Array.isArray(C==null?void 0:C.outputs)&&C.outputs.length?C.outputs:[{to:C.to,amount_kas:C.amount_kas,tag:"primary"}]).filter(x=>String((x==null?void 0:x.tag)||"").toLowerCase()!=="treasury").map(x=>({...x,tag:x.tag||"primary"})),{to:i,amount_kas:Number(Number(s||0).toFixed(6)),tag:"treasury"}];return ln({...C,outputs:p,treasuryCombined:!0,treasuryCombinedWalletProvider:a||null,treasuryCombinedFeeKas:Number(Number(s||0).toFixed(6)),treasuryCombinedAddress:i})},[A,i,s,a]),k=g.useCallback((C,R)=>{if(!t||!(s>0))return null;const I=v(C);return u(p=>p.some(E=>(E==null?void 0:E.metaKind)==="treasury_fee"&&(E==null?void 0:E.parentActionId)&&E.parentActionId===I.parentActionId&&(E.status==="pending"||E.status==="signed"||E.status==="signing"))?p:[I,...p].slice(0,c)),d({type:"TREASURY",msg:`Treasury fee payout queued${R?` (${R})`:""}: ${I.amount_kas} KAS â†’ ${i.slice(0,18)}...`,fee:null}),I},[d,v,t,c,u,i,s]),j=g.useCallback(async(C,R)=>{if(!t||!(s>0)||!C||C.metaKind==="treasury_fee")return null;if(C!=null&&C.treasuryCombined)return d({type:"TREASURY",msg:`Treasury fee combined in primary transaction (${String((C==null?void 0:C.treasuryCombinedWalletProvider)||"wallet")}) Â· ${Number((C==null?void 0:C.treasuryCombinedFeeKas)||s).toFixed(6)} KAS`,fee:null}),(C==null?void 0:C.txid)||null;const I=v(C);try{const p=await m(I),x=Date.now(),E=Number(l||0);return u(w=>{const K=w.filter(F=>!((F==null?void 0:F.metaKind)==="treasury_fee"&&(F!=null&&F.parentActionId)&&F.parentActionId===I.parentActionId));return[{...I,status:"signed",txid:p,receipt_lifecycle:"broadcasted",broadcast_ts:x,receipt_attempts:0,confirmations:0,receipt_next_check_at:x+h(0),receipt_last_checked_ts:void 0,failure_reason:null,...E>0?{broadcast_price_usd:E}:{}},...K].slice(0,c)}),d({type:"TREASURY",msg:`Treasury fee payout sent (${R}): ${I.amount_kas} KAS â†’ ${i.slice(0,18)}... Â· txid: ${String(p).slice(0,16)}...`,fee:null}),p}catch(p){return k(C,(p==null?void 0:p.message)||"wallet rejected"),null}},[d,v,t,k,l,c,h,m,u,i,s]);return{canCombineTreasuryWithAction:A,attachCombinedTreasuryOutput:_,enqueueTreasuryFeeTx:k,settleTreasuryFeePayout:j}}function np({queue:e,wallet:t,onSign:s,onReject:i,receiptConsistencyMetrics:o}){const a=u=>u==="confirmed"?n.ok:u==="failed"||u==="timeout"?n.danger:u==="pending_confirm"||u==="broadcasted"?n.warn:n.dim,l=u=>{if(String((u==null?void 0:u.status)||"")!=="signed")return null;const m=String((u==null?void 0:u.receipt_imported_from)||"").toLowerCase(),h=String((u==null?void 0:u.receipt_source_path)||"").toLowerCase(),v=String((u==null?void 0:u.confirm_ts_source)||"").toLowerCase();return m==="callback_consumer"||h.includes("callback-consumer")?{text:"BACKEND",color:n.purple}:m==="kaspa_api"||v==="chain"?{text:"CHAIN",color:n.ok}:{text:"ESTIMATED",color:n.warn}},c=u=>{if(String((u==null?void 0:u.status)||"")!=="signed")return{text:"ESTIMATED",color:n.warn};const m=l(u),h=String((u==null?void 0:u.receipt_lifecycle)||"submitted");return h==="confirmed"?m.text==="BACKEND"?{text:"BACKEND CONFIRMED",color:n.purple}:m.text==="CHAIN"?{text:"CHAIN CONFIRMED",color:n.ok}:{text:"ESTIMATED",color:n.warn}:h==="broadcasted"||h==="pending_confirm"||h==="submitted"?{text:"BROADCASTED",color:n.warn}:{text:"ESTIMATED",color:n.warn}},d=u=>{if(String((u==null?void 0:u.status)||"")!=="signed")return null;const m=String((u==null?void 0:u.receipt_consistency_status)||"insufficient");return m==="consistent"?{text:"CONSISTENT",color:n.ok}:m==="mismatch"?{text:"MISMATCH",color:n.danger}:{text:"CHECKING",color:n.dim}};return r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,color:n.text,fontWeight:700,...f,marginBottom:4},children:"Action Queue"}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",marginBottom:16},children:[r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Transactions pending wallet signature. Auto-approved items processed immediately."}),o&&r.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[r.jsx(J,{text:`RC ${Number(o.checked||0)} checked`,color:n.dim}),r.jsx(J,{text:`OK ${Number(o.consistent||0)}`,color:n.ok}),r.jsx(J,{text:`MM ${Number(o.mismatch||0)}`,color:n.danger}),Number(o.repeatedMismatchItems||0)>0&&r.jsx(J,{text:`REPEAT ${Number(o.repeatedMismatchItems||0)}`,color:n.warn})]})]}),e.length===0&&r.jsxs(ye,{p:32,style:{textAlign:"center"},children:[r.jsx("div",{style:{fontSize:13,color:n.dim,...f,marginBottom:4},children:"Queue empty"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Pending transactions will appear here awaiting your wallet signature."})]}),e.map(u=>r.jsxs(ye,{p:18,"data-testid":`queue-item-${String(u.id)}`,style:{marginBottom:10,border:`1px solid ${u.status==="pending"?n.warn:u.status==="signed"?n.ok:n.border}25`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:4},children:[r.jsx(J,{"data-testid":`queue-item-type-${String(u.id)}`,text:u.type,color:n.purple}),r.jsx(J,{"data-testid":`queue-item-status-${String(u.id)}`,text:u.status.toUpperCase(),color:u.status==="pending"?n.warn:u.status==="signed"?n.ok:n.dim,dot:!0}),u.status==="signed"&&r.jsx(J,{"data-testid":`queue-item-receipt-${String(u.id)}`,text:String(u.receipt_lifecycle||"submitted").toUpperCase().replace(/_/g," "),color:a(String(u.receipt_lifecycle||"submitted")),dot:!0}),u.status==="signed"&&r.jsx(J,{"data-testid":`queue-item-truth-${String(u.id)}`,text:c(u).text,color:c(u).color}),u.status==="signed"&&(()=>{const m=l(u);return m?r.jsx(J,{"data-testid":`queue-item-provenance-${String(u.id)}`,text:m.text,color:m.color}):null})(),u.status==="signed"&&(()=>{const m=d(u);return m?r.jsx(J,{"data-testid":`queue-item-consistency-${String(u.id)}`,text:m.text,color:m.color}):null})()]}),r.jsx("div",{style:{fontSize:11,color:n.dim,...f},children:Co(u.ts)})]}),r.jsxs("div",{style:{fontSize:18,color:u.amount_kas>0?n.accent:n.danger,fontWeight:700,...f},children:[u.amount_kas," KAS"]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:u.status==="pending"?12:0,fontSize:12,color:n.dim,...f},children:[r.jsxs("div",{children:["To: ",r.jsx("span",{style:{color:n.text},children:ht(u.to)})]}),r.jsx("div",{children:u.metaKind==="treasury_fee"?r.jsxs(r.Fragment,{children:["Routing: ",r.jsx("span",{style:{color:n.warn},children:"Treasury payout transfer"})]}):u!=null&&u.treasuryCombined?r.jsxs(r.Fragment,{children:["Routing: ",r.jsxs("span",{style:{color:n.ok},children:["Combined treasury output (",Array.isArray(u==null?void 0:u.outputs)?u.outputs.length:2," outputs)"]})]}):r.jsxs(r.Fragment,{children:["Fee split: ",r.jsxs("span",{style:{color:n.text},children:["Pool ",(dt*os).toFixed(4)," / Treasury ",(dt*It).toFixed(4)]})]})})]}),u.status==="pending"&&r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(_e,{onClick:()=>i(u.id),variant:"danger",size:"sm",children:"REJECT"}),r.jsx(_e,{"data-testid":`queue-item-sign-${String(u.id)}`,onClick:()=>s(u),size:"sm",children:"SIGN & BROADCAST"})]}),u.status==="signed"&&u.txid&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"},children:[r.jsxs("span",{style:{fontSize:11,color:n.ok,...f},children:["âœ“ ",u.txid.slice(0,32),"..."]}),typeof u.confirmations=="number"&&r.jsxs("span",{style:{fontSize:11,color:n.dim,...f},children:["conf: ",Math.max(0,Number(u.confirmations||0))]}),r.jsx(as,{href:`${en}/txs/${u.txid}`,label:"EXPLORER â†—"})]}),(u.receipt_lifecycle==="failed"||u.receipt_lifecycle==="timeout")&&u.failure_reason&&r.jsxs("div",{style:{fontSize:11,color:n.danger,...f,marginTop:6},children:["receipt: ",String(u.failure_reason)]})]})]},u.id))]})}function sp(e){var m,h,v,A;const{kasDataError:t,refreshKasData:s,kasDataLoading:i,liveExecutionArmed:o,liveExecutionReady:a,executionGuardrails:l,pendingCount:c,isMobile:d,setTab:u}=e;return r.jsxs(r.Fragment,{children:[!!t&&r.jsxs("div",{style:{background:n.dLow,border:`1px solid ${n.danger}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[r.jsxs("span",{style:{fontSize:12,color:n.danger,...f},children:["Kaspa live feed error (poll fallback): ",t]}),r.jsx(_e,{onClick:s,disabled:i,size:"sm",variant:"ghost",children:i?"RECONNECTING...":"RECONNECT FEED"})]}),((m=l==null?void 0:l.truth)==null?void 0:m.degraded)&&r.jsxs("div",{style:{background:n.dLow,border:`1px solid ${n.danger}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[r.jsxs("span",{style:{fontSize:12,color:n.danger,...f},children:["Truth degraded: backend vs chain receipt mismatch rate ",l.truth.mismatchRatePct,"% (",l.truth.mismatches,"/",l.truth.checked," checks). Realized PnL is downgraded to hybrid while mismatch rate exceeds policy."]}),l.truth.autoApproveDisabled&&r.jsx(J,{text:"AUTO-APPROVE BLOCKED (TRUTH)",color:n.danger})]}),((h=l==null?void 0:l.calibration)==null?void 0:h.enabled)&&((v=l==null?void 0:l.calibration)==null?void 0:v.samplesSufficient)&&((A=l==null?void 0:l.calibration)==null?void 0:A.tier)!=="healthy"&&r.jsxs("div",{style:{background:n.wLow,border:`1px solid ${l.calibration.tier==="critical"?n.danger:n.warn}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",justifyContent:"space-between",gap:10,flexWrap:"wrap"},children:[r.jsxs("span",{style:{fontSize:12,color:l.calibration.tier==="critical"?n.danger:n.warn,...f},children:["Calibration guardrail ",String(l.calibration.tier).toUpperCase()," Â· health ",l.calibration.health.toFixed(3)," Â· size multiplier ",l.calibration.sizeMultiplier.toFixed(2),l.calibration.autoApproveDisabled?" Â· auto-approve disabled":"",l.calibration.autoApproveDisableDeferred?" Â· size-first throttle (auto-approve still enabled)":""]}),r.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[r.jsx(J,{text:`BRIER ${Number(l.calibration.metrics.brier||0).toFixed(4)}`,color:n.dim}),r.jsx(J,{text:`EV CAL ${Number(l.calibration.metrics.evCalErrorPct||0).toFixed(2)}%`,color:n.dim}),r.jsx(J,{text:`REGIME ${Number(l.calibration.metrics.regimeHitRatePct||0).toFixed(1)}%`,color:n.dim})]})]}),c>0&&r.jsxs("div",{style:{background:n.wLow,border:`1px solid ${n.warn}40`,borderRadius:6,padding:"11px 16px",marginBottom:14,display:"flex",alignItems:d?"flex-start":"center",justifyContent:"space-between",flexDirection:d?"column":"row",gap:d?8:0},children:[r.jsxs("span",{style:{fontSize:12,color:n.warn,...f},children:["âš  ",c," transaction",c>1?"s":""," awaiting wallet signature"]}),r.jsx(_e,{onClick:()=>u("queue"),size:"sm",variant:"warn",children:"VIEW QUEUE"})]})]})}const ip=e=>e?`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`:"â€”",Vr=e=>e===null?"â€”":e>=1?`$${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${e.toFixed(4)}`,op={TREND_UP:{color:"#39DDB6",label:"TREND UP",desc:"Strong upward price momentum"},FLOW_ACCUMULATION:{color:"#39DDB6",label:"ACCUMULATING",desc:"DAG inflow detected"},NEUTRAL:{color:"#8FA0B5",label:"NEUTRAL",desc:"No strong signal"},RANGE_VOL:{color:"#F7B267",label:"RANGING VOL",desc:"High volatility, no trend"},RISK_OFF:{color:"#FF5D7A",label:"RISK OFF",desc:"Drawdown pressure"}},ap={ACCUMULATE:{color:"#39DDB6",label:"â¬† ACCUMULATE"},HOLD:{color:"#8FA0B5",label:"â—† HOLD"},REDUCE:{color:"#FF5D7A",label:"â¬‡ REDUCE"},REBALANCE:{color:"#F7B267",label:"â†” REBALANCE"}};function cp({agent:e,wallet:t,kasData:s,marketHistory:i=[],lastDecision:o}){var tt,S,N,le;const[a,l]=g.useState(null),[c,d]=g.useState([]),[u,m]=g.useState(!1),[h,v]=g.useState(null),[A,_]=g.useState(null),[k,j]=g.useState(null),[C,R]=g.useState(""),[I,p]=g.useState(""),[x,E]=g.useState(""),w=Number((s==null?void 0:s.priceUsd)||0),K=(tt=s==null?void 0:s.dag)==null?void 0:tt.daaScore,F=((S=s==null?void 0:s.dag)==null?void 0:S.blockCount)||((N=s==null?void 0:s.dag)==null?void 0:N.headerCount),H=((le=s==null?void 0:s.dag)==null?void 0:le.networkName)||Ct,G=(t==null?void 0:t.provider)==="kasware"?"KasWare":(t==null?void 0:t.provider)==="demo"?"Demo Mode":(t==null?void 0:t.provider)==="kasware-wasm"?"KasWare (WASM)":(t==null?void 0:t.provider)||"External",B=o==null?void 0:o.dec,P=B==null?void 0:B.quant_metrics,Z=String((P==null?void 0:P.regime)||""),re=op[Z]||{color:n.dim,label:"AWAITING DATA",desc:"Run a cycle to generate signal"},b=ap[(B==null?void 0:B.action)||""]||null,M=Number((P==null?void 0:P.daa_velocity)||0),ie=Number((P==null?void 0:P.ewma_volatility)||0),D=Number((P==null?void 0:P.momentum_z)||0),Y=Number((P==null?void 0:P.edge_score)||0),ae=g.useMemo(()=>(Array.isArray(i)?i:[]).filter(X=>X.priceUsd>0).slice(-80),[i]),fe=ae.map((T,X)=>({i:X,price:Number(T.priceUsd||0)})),Ae=ae.length>1?Number(ae[0].priceUsd||0):0,ce=Ae>0&&w>0?(w-Ae)/Ae*100:null,Ke=ce!==null&&ce>=0,Re=g.useCallback(async()=>{m(!0),v(null);try{let T;(t==null?void 0:t.provider)==="kasware"?T=await ve.getKaswareBalance():T=(await la((t==null?void 0:t.address)||e.wallet)).kas;const X=await Hu((t==null?void 0:t.address)||e.wallet);l(T),d(Array.isArray(X)?X.slice(0,12):[]),_(new Date)}catch(T){v(T.message)}m(!1)},[t,e]);g.useEffect(()=>{Re()},[Re]),g.useEffect(()=>{const T=setInterval(()=>Re(),3e4);return()=>clearInterval(T)},[Re]);const He=parseFloat(a??e.capitalLimit??0),Ne=Math.max(0,He-xr-Tt),$e=Ne.toFixed(4),Je=w>0?He*w:null,qe=Number((e==null?void 0:e.capitalLimit)||0),De=qe>0?Math.min(100,He/qe*100):0,Qe=De>90?n.danger:De>60?n.warn:n.ok,Te=()=>{const T=Number(I);!er(C,et)||!(T>0)||T>Ne||j({type:"WITHDRAW",from:t==null?void 0:t.address,to:C,amount_kas:Number(T.toFixed(6)),purpose:x||"Withdrawal"})},it=()=>{j(null),R(""),p(""),E("")};return r.jsxs("div",{children:[k&&r.jsx(ms,{tx:k,wallet:t,onSign:it,onReject:()=>j(null)}),r.jsxs(ye,{p:0,style:{marginBottom:12,border:`1px solid ${n.accent}28`,overflow:"hidden"},children:[r.jsx("div",{style:{height:2,background:`linear-gradient(90deg, ${n.accent}, ${n.purple}, ${n.accent})`}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"9px 16px",borderBottom:"1px solid rgba(33,48,67,0.5)",background:"rgba(8,13,20,0.6)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("img",{src:"/kaspa-logo.png",alt:"KAS",width:16,height:16,style:{borderRadius:"50%"}}),r.jsx("span",{style:{fontSize:11,color:n.accent,fontWeight:700,...f},children:"KAS / USDC"}),r.jsx("span",{style:{fontSize:9,color:n.dim,...f,background:"rgba(33,48,67,0.5)",padding:"2px 6px",borderRadius:3},children:H}),K&&r.jsxs("span",{style:{fontSize:9,color:n.dim,...f},children:["DAA ",r.jsx("span",{style:{color:n.text},children:Number(K).toLocaleString()})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("span",{style:{fontSize:9,...f,color:n.purple,background:`${n.purple}15`,padding:"3px 8px",borderRadius:3},children:G}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,background:`${u?n.warn:n.accent}15`,padding:"3px 8px",borderRadius:3},children:[r.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:u?n.warn:n.accent,boxShadow:`0 0 6px ${u?n.warn:n.accent}`}}),r.jsx("span",{style:{fontSize:9,color:u?n.warn:n.accent,fontWeight:600,...f},children:u?"SYNCâ€¦":"LIVE"})]})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:16,padding:"14px 16px 0"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em",marginBottom:4},children:"KASPA BALANCE"}),r.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[r.jsx("span",{style:{fontSize:26,color:n.accent,fontWeight:700,...f},children:He>0?`${Xt(He,2)} KAS`:"â€”"}),Je!==null&&r.jsxs("span",{style:{fontSize:12,color:n.dim,fontWeight:400,...f},children:["â‰ˆ ",Vr(Je)]})]}),ce!==null&&r.jsxs("div",{style:{fontSize:9,color:n.dim,...f,marginTop:2},children:[Ke?"â–² +":"â–¼ ",ce.toFixed(2),"% session Â· ",ae.length," samples"]})]}),r.jsxs("div",{style:{width:120,paddingBottom:8,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[r.jsxs("div",{style:{textAlign:"right",marginBottom:4},children:[r.jsx("div",{style:{fontSize:8,color:n.dim,...f,letterSpacing:"0.1em"},children:"KAS / USDC"}),r.jsx("div",{style:{fontSize:14,color:n.text,fontWeight:700,...f},children:w>0?`$${w.toFixed(4)}`:"â€”"})]}),fe.length>3&&r.jsx(ci,{width:"100%",height:40,children:r.jsxs(li,{data:fe,children:[r.jsx(di,{type:"monotone",dataKey:"price",stroke:Ke?n.ok:n.danger,strokeWidth:1.5,dot:!1,isAnimationActive:!1}),r.jsx(ui,{formatter:T=>[`$${T.toFixed(4)}`,"KAS/USDC"],contentStyle:{background:"rgba(8,13,20,0.95)",border:`1px solid ${n.border}`,borderRadius:4,fontSize:9}})]})})]})]}),r.jsxs("div",{style:{padding:"12px 16px 14px"},children:[r.jsxs("div",{style:{marginBottom:14},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em"},children:"STABLECOIN BALANCE"}),r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:4,background:`${n.warn}15`,border:`1px solid ${n.warn}40`,borderRadius:4,padding:"3px 8px"},children:[r.jsx("span",{style:{width:5,height:5,borderRadius:"50%",background:n.warn,display:"inline-block"}}),r.jsx("span",{style:{fontSize:7,color:n.warn,fontWeight:700,...f,letterSpacing:"0.1em"},children:"DEMO"})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("img",{src:"/usdc_white.png",alt:"USDC",width:32,height:32,style:{flexShrink:0,borderRadius:"50%",boxShadow:"0 0 10px rgba(39,117,202,0.4)"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,fontWeight:700,color:n.text,...f},children:"USDC"}),r.jsx("div",{style:{fontSize:8,color:n.dim},children:"USD Coin"})]})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsx("div",{style:{fontSize:22,fontWeight:700,color:n.text,...f,lineHeight:1},children:"0.00"}),r.jsx("div",{style:{fontSize:9,color:n.dim,...f},children:"â‰ˆ $0.00"})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingTop:10,borderTop:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("img",{src:"/usdt-logo.svg",alt:"USDT",width:32,height:32,style:{flexShrink:0,boxShadow:"0 0 10px rgba(38,161,123,0.4)",borderRadius:"50%"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,fontWeight:700,color:n.text,...f},children:"USDT"}),r.jsx("div",{style:{fontSize:8,color:n.dim},children:"Tether USD"})]})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsx("div",{style:{fontSize:22,fontWeight:700,color:n.text,...f,lineHeight:1},children:"0.00"}),r.jsx("div",{style:{fontSize:9,color:n.dim,...f},children:"â‰ˆ $0.00"})]})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:9,color:n.muted,...f},children:["Updated ",ip(A)]}),r.jsx("button",{onClick:Re,disabled:u,style:{background:`${n.accent}08`,border:`1px solid ${n.accent}25`,color:n.accent,borderRadius:4,padding:"4px 10px",cursor:"pointer",fontSize:10,...f},children:u?"Syncingâ€¦":"â†º Refresh"})]})]}),h&&r.jsxs("div",{style:{padding:"8px 16px",background:`${n.danger}12`,borderTop:`1px solid ${n.danger}30`,fontSize:11,color:n.danger,...f},children:["âš  ",h]})]}),r.jsxs(ye,{p:12,style:{marginBottom:10},children:[r.jsxs("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em",marginBottom:8},children:["DEPOSIT ADDRESS ",r.jsx("span",{style:{color:n.ok},children:"â†“ INCOMING"})]}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsxs("div",{style:{flex:1,background:"rgba(8,13,20,0.65)",borderRadius:6,padding:"9px 12px",border:"1px solid rgba(33,48,67,0.6)",overflow:"hidden"},children:[r.jsx("div",{style:{fontSize:8,color:n.dim,...f,marginBottom:2,letterSpacing:"0.1em"},children:"KASPA ADDRESS"}),r.jsx("div",{style:{fontSize:10,color:n.accent,...f,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(t==null?void 0:t.address)||"â€”"})]}),r.jsx(_e,{onClick:()=>{var T;return(T=navigator.clipboard)==null?void 0:T.writeText((t==null?void 0:t.address)||"")},variant:"primary",style:{padding:"8px 14px",fontSize:11},children:"ðŸ“‹"})]}),(t==null?void 0:t.address)&&r.jsx(as,{href:`${en}/addresses/${t.address}`,style:{fontSize:9,color:n.dim,...f,marginTop:6,display:"block"},children:"â†— View on Kaspa Explorer"})]}),r.jsxs(ye,{p:12,style:{marginBottom:12,border:`1px solid ${n.danger}20`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsxs("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em"},children:["SEND KAS ",r.jsx("span",{style:{color:n.danger},children:"â†‘ OUTGOING"})]}),r.jsxs("span",{style:{fontSize:9,color:n.dim,...f},children:["MAX: ",$e," KAS"]})]}),r.jsx("div",{style:{display:"flex",gap:5,marginBottom:8},children:[{l:"25%",v:Ne*.25},{l:"50%",v:Ne*.5},{l:"75%",v:Ne*.75},{l:"MAX",v:Ne}].map(T=>r.jsx("button",{onClick:()=>p(T.v.toFixed(4)),disabled:Ne<=0,style:{flex:1,padding:"5px",borderRadius:4,border:"1px solid rgba(33,48,67,0.7)",background:"rgba(8,13,20,0.55)",color:n.dim,fontSize:10,cursor:"pointer",...f},children:T.l},T.l))}),r.jsx(Be,{label:"Recipient",value:C,onChange:R,placeholder:"kaspa:..."}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:6,alignItems:"end",marginBottom:6},children:[r.jsx(Be,{label:"Amount (KAS)",value:I,onChange:p,type:"number",suffix:"KAS",placeholder:"0"}),r.jsx(_e,{onClick:()=>p($e),variant:"ghost",size:"sm",children:"MAX"})]}),I&&Number(I)>0&&w>0&&r.jsxs("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:6,textAlign:"right"},children:["â‰ˆ ",Vr(Number(I)*w)," USDC"]}),r.jsxs(_e,{onClick:Te,disabled:!er(C,et)||!Number(I)||Number(I)>Ne,style:{width:"100%",padding:"9px",fontSize:11},children:["â†— SEND ",I||"0"," KAS",I&&Number(I)>0&&w>0?` (${Vr(Number(I)*w)})`:""]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12},children:[r.jsxs(ye,{p:12,style:{background:`linear-gradient(135deg, ${n.purple}06 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${n.purple}20`},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em",marginBottom:10},children:"DAG NETWORK"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:7},children:[{k:"DAA Score",v:K?Number(K).toLocaleString():"â€”",c:n.accent},{k:"Block Count",v:F?Number(F).toLocaleString():"â€”",c:n.dim},{k:"DAA Velocity",v:P?`${M>=0?"+":""}${M.toFixed(1)} blk/s`:"â€”",c:M>0?n.ok:M<0?n.danger:n.dim},{k:"EWMA Volatility",v:P?`${(ie*100).toFixed(3)}%`:"â€”",c:ie>.02?n.warn:n.ok}].map(T=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:9,color:n.dim,...f},children:T.k}),r.jsx("span",{style:{fontSize:11,color:T.c,fontWeight:600,...f},children:T.v})]},T.k))})]}),r.jsxs(ye,{p:12,style:{background:`linear-gradient(135deg, ${re.color}10 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${re.color}28`},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em",marginBottom:10},children:"AGENT SIGNAL"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:14,color:re.color,fontWeight:700,...f,marginBottom:2},children:re.label}),r.jsx("div",{style:{fontSize:9,color:n.dim,marginBottom:8},children:re.desc})]}),b&&r.jsx("div",{style:{background:`${b.color}14`,border:`1px solid ${b.color}30`,borderRadius:4,padding:"5px 10px",marginBottom:8},children:r.jsx("span",{style:{fontSize:11,color:b.color,fontWeight:700,...f},children:b.label})}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[{k:"Confidence",v:B?`${(B.confidence_score*100).toFixed(1)}%`:"â€”",c:n.dim},{k:"Momentum Z",v:P?`${D>=0?"+":""}${D.toFixed(2)}`:"â€”",c:D>.5?n.ok:D<-.5?n.danger:n.dim},{k:"Edge Score",v:P?Y.toFixed(3):"â€”",c:Y>.1?n.ok:n.dim}].map(T=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:9,color:n.dim,...f},children:T.k}),r.jsx("span",{style:{fontSize:11,color:T.c,fontWeight:600,...f},children:T.v})]},T.k))})]})]}),r.jsxs(ye,{p:14,style:{marginBottom:12,background:`linear-gradient(135deg, ${n.accent}06 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${n.accent}20`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em",marginBottom:4},children:"AGENT VAULT ALLOCATION"}),r.jsx("div",{style:{fontSize:13,color:n.text,fontWeight:700,...f},children:(e==null?void 0:e.name)||"â€”"}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:1},children:(e==null?void 0:e.strategyLabel)||(e==null?void 0:e.strategyTemplate)||"Accumulation Strategy"})]}),r.jsx(J,{text:`Risk: ${String((e==null?void 0:e.risk)||"â€”").toUpperCase()}`,color:(e==null?void 0:e.risk)==="low"?n.ok:(e==null?void 0:e.risk)==="medium"?n.warn:n.danger})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:10},children:[{k:"CAPITAL LIMIT",v:qe>0?`${Xt(qe,2)} KAS`:"â€”",c:n.ok},{k:"LIVE BALANCE",v:a!==null?`${Xt(He,2)} KAS`:"â€”",c:n.accent},{k:"UTILIZATION",v:qe>0?`${De.toFixed(1)}%`:"â€”",c:Qe}].map(T=>r.jsxs("div",{style:{background:`linear-gradient(135deg, ${T.c}08 0%, rgba(8,13,20,0.5) 100%)`,borderRadius:6,padding:"8px 10px",border:`1px solid ${T.c}18`},children:[r.jsx("div",{style:{fontSize:8,color:n.dim,...f,letterSpacing:"0.1em"},children:T.k}),r.jsx("div",{style:{fontSize:12,color:T.c,fontWeight:700,...f,marginTop:2},children:T.v})]},T.k))}),qe>0&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[r.jsx("span",{style:{fontSize:9,color:n.dim,...f},children:"Vault utilization"}),r.jsxs("span",{style:{fontSize:9,color:Qe,...f},children:[De.toFixed(1),"%"]})]}),r.jsx("div",{style:{width:"100%",height:4,background:"rgba(16,25,35,0.7)",borderRadius:2,overflow:"hidden"},children:r.jsx("div",{style:{width:`${De}%`,height:"100%",background:`linear-gradient(90deg, ${n.accent}, ${Qe})`,borderRadius:2,transition:"width 0.5s ease"}})})]})]}),fe.length>6&&r.jsxs(ye,{p:14,style:{marginBottom:12},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[r.jsx("div",{style:{fontSize:9,color:n.accent,fontWeight:700,...f,letterSpacing:"0.1em"},children:"KAS / USDC PRICE HISTORY"}),r.jsxs("div",{style:{fontSize:9,color:n.dim,...f},children:[fe.length," ticks Â· session"]})]}),r.jsx(ci,{width:"100%",height:100,children:r.jsxs(li,{data:fe,margin:{top:4,right:4,left:0,bottom:4},children:[r.jsx(di,{type:"monotone",dataKey:"price",stroke:Ke?n.ok:n.danger,strokeWidth:2,dot:!1,isAnimationActive:!1}),w>0&&Ae>0&&r.jsx(lc,{y:Ae,stroke:n.dim,strokeDasharray:"3 3"}),r.jsx(ui,{formatter:T=>[`$${T.toFixed(4)}`,"KAS/USDC"],contentStyle:{background:"rgba(8,13,20,0.95)",border:`1px solid ${n.border}`,borderRadius:4,fontSize:9}})]})}),ce!==null&&r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8},children:[r.jsxs("span",{style:{fontSize:9,color:n.dim,...f},children:["Open: $",Ae.toFixed(4)]}),r.jsxs("span",{style:{fontSize:9,color:Ke?n.ok:n.danger,fontWeight:600,...f},children:[Ke?"â–² +":"â–¼ ",ce.toFixed(2),"% session"]}),r.jsxs("span",{style:{fontSize:9,color:n.dim,...f},children:["Last: $",w.toFixed(4)]})]})]}),c.length>0&&r.jsxs(ye,{p:12,children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,letterSpacing:"0.12em"},children:"UNSPENT OUTPUTS"}),r.jsxs("span",{style:{fontSize:9,color:n.dim,...f,background:"rgba(16,25,35,0.6)",padding:"2px 8px",borderRadius:3},children:[c.length," UTXOs"]})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:c.slice(0,6).map((T,X)=>{var je,L,pe;const se=(((je=T.utxoEntry)==null?void 0:je.amount)||0)/1e8,he=w>0?se*w:null;return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",background:`linear-gradient(135deg, ${n.accent}06 0%, rgba(8,13,20,0.5) 100%)`,borderRadius:6,border:"1px solid rgba(33,48,67,0.4)"},children:[r.jsxs("span",{style:{color:n.dim,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"54%",fontSize:9,...f},children:["#",X+1," ",(pe=(L=T.outpoint)==null?void 0:L.transactionId)==null?void 0:pe.slice(0,16),"â€¦"]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{fontSize:11,color:n.accent,fontWeight:600,...f},children:[Xt(se,2)," KAS"]}),he!==null&&r.jsx("div",{style:{fontSize:9,color:n.dim,...f},children:Vr(he)})]})]},X)})})]})]})}const Yt=[{id:"KAS",symbol:"KAS",name:"Kaspa",decimals:8,enabled:!0},{id:"USDC",symbol:"USDC",name:"USD Coin",decimals:6,enabled:!1},{id:"USDT",symbol:"USDT",name:"Tether USD",decimals:6,enabled:!1}],ba={KAS:"/kaspa-logo.png",USDC:"/usdc_white.png",USDT:"/usdt-logo.svg"};function Gr({symbol:e,logoUri:t,size:s=24}){const i=t??ba[e];return i?r.jsx("img",{src:i,alt:e,style:{width:s,height:s,borderRadius:"50%",objectFit:"contain",flexShrink:0,background:"rgba(57,221,182,0.08)"},onError:o=>{o.currentTarget.style.display="none"}}):r.jsx("div",{style:{width:s,height:s,borderRadius:"50%",background:"rgba(57,221,182,0.18)",border:"1px solid rgba(57,221,182,0.35)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:r.jsx("span",{style:{color:n.accent,fontSize:s*.42,fontWeight:800},children:e.slice(0,1)})})}function no(e){return 34}function lp(e){const s=`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='#39DDB6'/><stop offset='100%' stop-color='#2D7BFF'/></linearGradient></defs><rect width='120' height='120' rx='24' fill='url(#g)'/><text x='60' y='66' text-anchor='middle' font-family='IBM Plex Mono, monospace' font-size='16' fill='white'>${String(e||"").trim().slice(0,6).toUpperCase()||"KRC"}</text></svg>`;return`data:image/svg+xml;utf8,${encodeURIComponent(s)}`}function dp(){const[e,t]=g.useState("KAS"),[s,i]=g.useState("USDC"),[o,a]=g.useState(""),[l,c]=g.useState(50),[d,u]=g.useState(""),[m,h]=g.useState("krc20"),[v,A]=g.useState(null),[_,k]=g.useState(!1),[j,C]=g.useState(null),[R,I]=g.useState(null),[p,x]=g.useState(null),E=Yt.find(b=>b.id===e)??Yt[0],w=Yt.find(b=>b.id===s)??null,K=d.trim().toLowerCase(),F=K?Yt.filter(b=>`${b.symbol} ${b.name} ${b.id}`.toLowerCase().includes(K)):Yt,H=()=>{A(null),u(""),C(null),I(null)},G=b=>{v==="from"?t(b):i(b),H()},B=()=>{t(s),i(e)},P=async()=>{var b;if(C(null),!((b=navigator==null?void 0:navigator.clipboard)!=null&&b.readText)){C("Clipboard unavailable.");return}k(!0);try{const M=(await navigator.clipboard.readText()).trim();if(!M){C("Clipboard is empty.");return}u(M),I(M);const ie=M.toLowerCase(),D=Yt.find(Y=>Y.id.toLowerCase()===ie||Y.symbol.toLowerCase()===ie||Y.name.toLowerCase()===ie);x(D?{symbol:D.symbol,logoUri:ba[D.symbol]}:{symbol:M.slice(0,6).toUpperCase(),logoUri:lp(M)})}catch{C("Failed to read clipboard.")}finally{k(!1)}},Z={background:"linear-gradient(155deg, rgba(14,20,29,0.97) 0%, rgba(10,15,22,0.94) 100%)",border:"1px solid rgba(28,42,58,0.9)",borderRadius:18,padding:"18px 20px 16px",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 10px 28px rgba(0,0,0,0.3)"},re=b=>({display:"flex",alignItems:"center",gap:8,background:b?"rgba(24,34,48,0.95)":"linear-gradient(90deg, rgba(57,221,182,0.12), rgba(57,221,182,0.06))",border:`1px solid ${b?"rgba(28,42,58,0.9)":"rgba(57,221,182,0.3)"}`,borderRadius:999,padding:b?"8px 14px 8px 10px":"8px 16px",color:b?n.text:n.accent,fontSize:14,fontWeight:700,cursor:"pointer",flexShrink:0,whiteSpace:"nowrap",...f});return v!==null?r.jsxs("div",{style:{maxWidth:480,margin:"0 auto",display:"flex",flexDirection:"column",gap:0},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:18},children:[r.jsx("button",{onClick:H,style:{background:"none",border:"none",color:n.dim,cursor:"pointer",fontSize:20,padding:0},children:"â†"}),r.jsx("span",{style:{fontSize:15,fontWeight:700,color:n.text,letterSpacing:"0.02em"},children:"Select a Token"}),r.jsx("span",{style:{marginLeft:"auto",fontSize:9,fontWeight:700,letterSpacing:"0.1em",color:n.accent,background:`${n.accent}15`,border:`1px solid ${n.accent}30`,borderRadius:4,padding:"2px 8px",...f},children:v.toUpperCase()})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:0,background:"rgba(10,15,22,0.9)",border:"1px solid rgba(28,42,58,0.9)",borderRadius:14,overflow:"hidden",marginBottom:12},children:[r.jsx("span",{style:{padding:"0 12px",color:n.dim,fontSize:16,flexShrink:0},children:"ðŸ”"}),r.jsx("input",{autoFocus:!0,value:d,onChange:b=>{u(b.target.value),C(null),I(null),x(null)},onKeyDown:b=>{if(b.key==="Enter"){b.preventDefault();const M=F[0];M&&G(M.id)}},placeholder:"Search name, symbol, or paste addressâ€¦",style:{flex:1,background:"none",border:"none",outline:"none",color:n.text,fontSize:12,padding:"13px 0",...f}}),r.jsx("button",{onClick:P,disabled:_,style:{background:"rgba(57,221,182,0.1)",border:"none",borderLeft:"1px solid rgba(28,42,58,0.9)",color:_?n.dim:n.accent,fontSize:10,fontWeight:700,letterSpacing:"0.1em",padding:"0 18px",height:"100%",cursor:_?"wait":"pointer",...f},children:_?"â€¦":"PASTE"})]}),r.jsx("div",{style:{display:"flex",gap:8,marginBottom:16},children:["krc20","krc721"].map(b=>{const M=m===b;return r.jsx("button",{onClick:()=>h(b),style:{flex:1,padding:"6px 0",fontSize:10,fontWeight:700,letterSpacing:"0.1em",borderRadius:8,cursor:"pointer",background:M?`${n.accent}15`:"rgba(16,25,35,0.5)",border:`1px solid ${M?`${n.accent}40`:"rgba(28,42,58,0.8)"}`,color:M?n.accent:n.dim,...f},children:b.toUpperCase()},b)})}),j&&r.jsx("div",{style:{fontSize:10,color:n.danger,marginBottom:10,padding:"8px 12px",background:`${n.danger}0D`,border:`1px solid ${n.danger}25`,borderRadius:8},children:j}),R&&r.jsxs("div",{style:{marginBottom:12,background:`${n.accent}0A`,border:`1px solid ${n.accent}30`,borderRadius:12,padding:"12px 14px"},children:[r.jsx("div",{style:{fontSize:9,color:n.accent,letterSpacing:"0.1em",marginBottom:6,...f},children:"PASTED ADDRESS"}),p&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:[r.jsx(Gr,{symbol:p.symbol,logoUri:p.logoUri,size:30}),r.jsx("div",{style:{fontSize:11,color:n.text,fontWeight:700,...f},children:p.symbol})]}),r.jsx("div",{style:{fontSize:11,color:n.dim,wordBreak:"break-all"},children:R}),r.jsx("div",{style:{fontSize:9,color:n.muted,marginTop:6},children:"Token resolution available when swap goes live."})]}),!K&&r.jsx("div",{style:{fontSize:9,color:n.dim,letterSpacing:"0.1em",marginBottom:10,...f},children:"POPULAR TOKENS"}),F.map((b,M)=>r.jsxs("button",{onClick:()=>G(b.id),style:{width:"100%",background:"none",border:"none",display:"flex",alignItems:"center",gap:14,padding:"11px 6px",borderBottom:M<F.length-1?"1px solid rgba(28,42,58,0.5)":"none",cursor:b.enabled?"pointer":"default",borderRadius:0},children:[r.jsx(Gr,{symbol:b.symbol,size:38}),r.jsxs("div",{style:{flex:1,textAlign:"left"},children:[r.jsx("div",{style:{fontSize:14,color:b.enabled?n.text:n.dim,fontWeight:700,...f},children:b.symbol}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:2},children:b.name})]}),b.enabled?e===b.id&&v==="from"||s===b.id&&v==="to"?r.jsx("span",{style:{fontSize:14,color:n.accent},children:"âœ“"}):null:r.jsx("span",{style:{fontSize:9,fontWeight:700,letterSpacing:"0.08em",color:n.warn,background:`${n.warn}12`,border:`1px solid ${n.warn}30`,borderRadius:4,padding:"2px 8px",...f},children:"SOON"})]},b.id)),K&&F.length===0&&r.jsxs("div",{style:{textAlign:"center",padding:"32px 0",color:n.dim,fontSize:11},children:[r.jsx("div",{style:{marginBottom:8},children:"No token found."}),r.jsx("div",{style:{fontSize:10,color:n.muted},children:"Paste a KRC20 contract address to add a custom token."})]})]}):r.jsxs("div",{style:{maxWidth:480,margin:"0 auto",display:"flex",flexDirection:"column",gap:10},children:[r.jsxs("div",{style:{background:"rgba(143,123,255,0.08)",border:"1px solid rgba(143,123,255,0.2)",borderRadius:12,padding:"10px 16px",display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:16,flexShrink:0},children:"â³"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,color:"#8F7BFF",fontWeight:700,letterSpacing:"0.1em",marginBottom:2,...f},children:"SWAP COMING SOON"}),r.jsx("div",{style:{fontSize:10,color:n.dim},children:"KRC20 token swaps activate with Kaspa native asset layer. UI is live for preview."})]})]}),r.jsxs("div",{style:Z,children:[r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:14,letterSpacing:"0.04em"},children:"from"}),r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:r.jsxs("button",{onClick:()=>A("from"),style:re(!0),children:[r.jsx(Gr,{symbol:E.symbol,size:no(E.symbol)}),r.jsx("span",{children:E.symbol}),r.jsx("span",{style:{color:n.dim,fontSize:12},children:"â–¾"})]})}),r.jsx("input",{type:"number",min:"0",value:o,onChange:b=>a(b.target.value),placeholder:"0.00",style:{width:"100%",marginTop:12,background:"none",border:"none",outline:"none",color:n.text,fontSize:30,fontWeight:600,textAlign:"center",...f}}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12},children:[r.jsx("div",{style:{fontSize:11,color:n.dim,display:"flex",alignItems:"center",gap:5},children:r.jsxs("span",{children:["Balance: 0 ",E.symbol]})}),r.jsx("button",{style:{background:`${n.accent}12`,border:`1px solid ${n.accent}30`,borderRadius:6,color:n.accent,fontSize:10,fontWeight:700,padding:"3px 10px",cursor:"pointer",letterSpacing:"0.06em",...f},children:"MAX"})]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"-6px 0",zIndex:1},children:r.jsx("button",{onClick:B,style:{background:"rgba(14,20,29,0.98)",border:"1px solid rgba(28,42,58,0.9)",borderRadius:"50%",width:36,height:36,color:n.text,fontSize:18,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 16px rgba(0,0,0,0.4)"},children:"â‡…"})}),r.jsxs("div",{style:Z,children:[r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:14,letterSpacing:"0.04em"},children:"to"}),r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:w?r.jsxs("button",{onClick:()=>A("to"),style:re(!0),children:[r.jsx(Gr,{symbol:w.symbol,size:no(w.symbol)}),r.jsx("span",{children:w.symbol}),r.jsx("span",{style:{color:n.dim,fontSize:12},children:"â–¾"})]}):r.jsxs("button",{onClick:()=>A("to"),style:re(!1),children:[r.jsx("span",{children:"Select Token"}),r.jsx("span",{style:{fontSize:12},children:"â–¾"})]})}),r.jsx("div",{style:{width:"100%",marginTop:12,textAlign:"center",color:n.dim,fontSize:30,fontWeight:600,...f},children:"0.00"}),r.jsx("div",{style:{fontSize:11,color:n.dim,marginTop:12,display:"flex",alignItems:"center",gap:5},children:r.jsxs("span",{children:["Balance: 0 ",(w==null?void 0:w.symbol)??""]})})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 2px"},children:[r.jsxs("div",{style:{fontSize:11,color:n.dim},children:["Rate: ",r.jsxs("span",{style:{color:n.text},children:["1 ",E.symbol," â‰ˆ â€” ",(w==null?void 0:w.symbol)??"â€”"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim},children:"Slippage"}),r.jsx("div",{style:{display:"flex",gap:4},children:[25,50,100].map(b=>{const M=l===b;return r.jsxs("button",{onClick:()=>c(b),style:{padding:"4px 9px",borderRadius:7,fontSize:10,fontWeight:700,background:M?`${n.accent}20`:"rgba(22,32,45,0.8)",border:`1px solid ${M?`${n.accent}50`:"rgba(28,42,58,0.8)"}`,color:M?n.accent:n.dim,cursor:"pointer",...f},children:[(b/100).toFixed(1),"%"]},b)})})]})]}),r.jsx("button",{disabled:!0,style:{width:"100%",padding:"16px 0",background:"rgba(33,48,67,0.55)",color:n.dim,border:"none",borderRadius:16,fontSize:13,fontWeight:700,letterSpacing:"0.08em",cursor:"not-allowed",...f},children:"SWAP COMING SOON"}),r.jsxs("div",{style:{background:"rgba(10,15,22,0.7)",border:"1px solid rgba(28,42,58,0.8)",borderRadius:12,padding:"12px 14px"},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,letterSpacing:"0.1em",marginBottom:8,...f},children:"HOW IT WORKS"}),["KRC20 token swaps activate with the Kaspa native asset layer.","Paste any KRC20/KRC721 contract address in the token picker.","Non-custodial â€” keys never leave your device or the extension vault.","AES-256-GCM encrypted vault, Argon2id KDF (legacy PBKDF2 vaults auto-migrate)."].map((b,M)=>r.jsxs("div",{style:{display:"flex",gap:8,marginBottom:M<3?5:0},children:[r.jsx("span",{style:{color:n.accent,fontSize:10,flexShrink:0},children:"â€º"}),r.jsx("span",{style:{fontSize:10,color:n.muted,lineHeight:1.5},children:b})]},M))]})]})}const up=g.lazy(()=>jt(()=>import("./PerfChart-Cilx-QcO.js"),__vite__mapDeps([2,1,3,4,5])).then(e=>({default:e.PerfChart}))),fp=g.lazy(()=>jt(()=>import("./AgentOverviewPanel--lUCogPt.js"),__vite__mapDeps([6,1,3,4,5])).then(e=>({default:e.AgentOverviewPanel}))),pp=g.lazy(()=>jt(()=>import("./IntelligencePanel-B4h2_Z87.js"),__vite__mapDeps([7,1,3,4,5])).then(e=>({default:e.IntelligencePanel}))),mp=g.lazy(()=>jt(()=>import("./PortfolioPanel-DN_uDEIu.js"),__vite__mapDeps([8,1,3,4,5])).then(e=>({default:e.PortfolioPanel}))),gp=g.lazy(()=>jt(()=>import("./PnlAttributionPanel-CgGgsQt2.js"),__vite__mapDeps([9,1,3,4,5])).then(e=>({default:e.PnlAttributionPanel}))),hp=g.lazy(()=>jt(()=>import("./AlertsPanel-6uGSHxG5.js"),__vite__mapDeps([10,1,3,4,5])).then(e=>({default:e.AlertsPanel}))),xp=g.lazy(()=>jt(()=>import("./QuantAnalyticsPanel-ETxmzSwJ.js"),__vite__mapDeps([11,1,3,4,5])).then(e=>({default:e.QuantAnalyticsPanel})));function so({agent:e,wallet:t,agents:s=[],activeAgentId:i,onSelectAgent:o,onDeleteAgent:a,onEditAgent:l}){var Fs,$s,Ds,Bs,zs,Us,Ws,Hs,Vs,Gs,qs,Ys,Xs,Qs,Js,Zs,ei,ti,ri;const I=Er*1e3,p=`${Ie}:${String((t==null?void 0:t.address)||"unknown").toLowerCase()}`,x=p,E=p,w=`${Ie}:${String((t==null?void 0:t.address)||"unknown").toLowerCase()}:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"default").toLowerCase()}`,K=g.useRef(!1),F=g.useRef(""),H=g.useRef(""),[G,B]=g.useState(!1),[P,Z]=g.useState("overview"),b=w?(y=>{if(typeof window>"u")return null;try{const U=`forgeos_dashboard_${y}`,V=window.localStorage.getItem(U);return V?JSON.parse(V):null}catch{return null}})(w):null,{status:M,setStatus:ie,transitionAgentStatus:D}=Qu((b==null?void 0:b.status)||(e!=null&&e.name?"RUNNING":"PAUSED")),[Y,ae]=g.useState(()=>Qn(e.name)),[fe,Ae]=g.useState([]),[ce,Ke]=g.useState(!1),Re=["autonomous","manual","notify"],He=b!=null&&b.execMode&&Re.includes(b.execMode)?b.execMode:e.execMode||"manual",[Ne,$e]=g.useState(He),Je=g.useMemo(()=>parseFloat(e.autoApproveThreshold)||50,[e.autoApproveThreshold]),[qe,De]=g.useState(()=>Wi(br,p)),Qe=(b==null?void 0:b.liveExecutionArmed)!==void 0?b.liveExecutionArmed:gi,[Te,it]=g.useState(Qe),[tt,S]=g.useState(()=>Date.now()+I),[N,le]=g.useState(typeof window<"u"?window.innerWidth:1200),[T,X]=g.useState(!1),[se,he]=g.useState({strategyTemplate:e.strategyTemplate||"dca_accumulator",strategyLabel:e.strategyLabel||"Steady DCA Builder",risk:e.risk||"medium",kpiTarget:e.kpiTarget||"12",capitalLimit:e.capitalLimit||"5000",horizon:e.horizon||30,autoApproveThreshold:e.autoApproveThreshold||"100",execMode:e.execMode||"manual"}),je=[...gs,...Xo.filter(y=>y.id!=="custom")],L=y=>{he({...se,strategyTemplate:y.id,strategyLabel:y.name,risk:y.defaults.risk||"medium",kpiTarget:y.defaults.kpiTarget||"12",capitalLimit:e.capitalLimit||"5000",horizon:y.defaults.horizon||30,autoApproveThreshold:y.defaults.autoApproveThreshold||"50",execMode:y.defaults.execMode||"manual"})},pe=()=>{X(!1),me({type:"SYSTEM",msg:`Strategy updated to ${se.strategyLabel}`,fee:null})},Fe=g.useMemo(()=>ru(),[]),{kasData:W,marketHistory:Me,setMarketHistory:Ve,kasDataLoading:Se,kasDataError:O,liveConnected:oe,streamConnected:Ye,streamRetryCount:xt,streamPulse:yt,lastStreamEvent:Ue,refreshKasData:Mt}=Uf({walletAddress:t==null?void 0:t.address,wsUrl:En,livePollMs:2e3,streamReconnectMaxDelayMs:8e3,maxMarketSnapshots:240}),me=g.useCallback(y=>ae(U=>[{ts:Date.now(),...y},...U].slice(0,320)),[320]),ke=String((e==null?void 0:e.strategyLabel)||(e==null?void 0:e.strategyTemplate)||"Custom"),{alertConfig:Le,alertSaveBusy:Ze,lastAlertResult:or,sendAlertEvent:Oe,patchAlertConfig:ar,toggleAlertType:cr,saveAlertConfig:Lt,sendTestAlert:Dt}=ff({alertScope:E,agentName:e==null?void 0:e.name,agentId:e==null?void 0:e.agentId,activeStrategyLabel:ke}),{queue:Ce,setQueue:Bt,signingItem:zt,pendingCount:at,sendWalletTransfer:Ut,receiptBackoffMs:Ir,prependQueueItem:Wt,prependSignedBroadcastedQueueItem:lr,handleQueueSign:Ca,handleQueueReject:wa,handleSigningReject:ka,handleSigned:Ts,rejectAllPending:Na,receiptConsistencyMetrics:Cs}=Ff({wallet:t,maxQueueEntries:160,addLog:me,kasPriceUsd:Number((W==null?void 0:W.priceUsd)||0),setTab:Z,receiptRetryBaseMs:2e3,receiptRetryMaxMs:3e4,receiptTimeoutMs:48e4,receiptMaxAttempts:18,receiptPollIntervalMs:1200,receiptPollBatchSize:3,sendAlertEvent:Oe,agentName:e==null?void 0:e.name,agentId:e==null?void 0:e.agentId}),{settleTreasuryFeePayout:jr,attachCombinedTreasuryOutput:Ia}=rp({enabled:ur,treasuryFeeKas:mt,treasuryAddress:No,walletAddress:t==null?void 0:t.address,walletProvider:t==null?void 0:t.provider,kasPriceUsd:Number((W==null?void 0:W.priceUsd)||0),maxQueueEntries:160,addLog:me,setQueue:Bt,sendWalletTransfer:Ut,receiptBackoffMs:Ir});g.useEffect(()=>{De(Wi(br,p))},[p]),g.useEffect(()=>{if(typeof window>"u")return;const y=()=>le(window.innerWidth);return window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]),g.useEffect(()=>{M==="RUNNING"&&S(Date.now()+I)},[M,I]),g.useEffect(()=>{P==="billing"&&Z("treasury")},[P]);const dr=(e==null?void 0:e.risk)==="low"?.4:(e==null?void 0:e.risk)==="medium"?.65:.85,ws=g.useMemo(()=>{const y=Array.isArray(s)&&s.length>0?s:[e],U=new Map;for(const V of y){const be=String((V==null?void 0:V.agentId)||(V==null?void 0:V.name)||"").trim();be&&U.set(be,V)}return Array.from(U.values())},[e,s]),yn=g.useMemo(()=>Tu({decisions:fe,queue:Ce,log:Y,marketHistory:Me,realizedMinConfirmations:gt,confirmationDepthPolicy:Lc}),[fe,Ce,Y,Me]),ge=Tf({pnlAttribution:yn,receiptConsistencyMetrics:Cs}),We=g.useMemo(()=>{var y,U;return ou({baseThresholdKas:Je,decisions:fe,marketHistory:Me,calibrationHealth:(y=ge==null?void 0:ge.calibration)==null?void 0:y.health,truthDegraded:(U=ge==null?void 0:ge.truth)==null?void 0:U.degraded,minimumSamples:10,maxSamples:48})},[Je,fe,(Fs=ge==null?void 0:ge.calibration)==null?void 0:Fs.health,($s=ge==null?void 0:ge.truth)==null?void 0:$s.degraded,Me]),ue=g.useMemo(()=>{var be;const y=ge.truth,U=yn,V=y.degraded&&String((U==null?void 0:U.netPnlMode)||"")==="realized"?"hybrid":U==null?void 0:U.netPnlMode;return{...U,netPnlMode:V,truthDegraded:y.degraded,truthDegradedReason:((be=y.reasons)==null?void 0:be[0])||"",truthMismatchRatePct:y.mismatchRatePct,truthCheckedSignals:y.checked,truthMismatchSignals:y.mismatches}},[ge.truth,yn]);bf({agent:e,cycleIntervalMs:I,runtimeScope:w,maxDecisionEntries:120,maxLogEntries:320,maxQueueEntries:160,maxMarketSnapshots:240,runtimeHydrated:G,setRuntimeHydrated:B,status:M,execMode:Ne,liveExecutionArmed:Te,queue:Ce,log:Y,decisions:fe,marketHistory:Me,attributionSummary:ue,nextAutoCycleAt:tt,setStatus:ie,setExecMode:$e,setLiveExecutionArmed:it,setQueue:Bt,setLog:ae,setDecisions:Ae,setMarketHistory:Ve,setNextAutoCycleAt:S,liveExecutionDefault:gi});const{portfolioConfig:ja,portfolioSummary:Ra,activePortfolioRow:ct,patchPortfolioConfig:Ma,patchPortfolioAgentOverride:La,refreshPortfolioPeers:Pa}=tp({portfolioScope:x,allAgents:ws,activeAgentId:e==null?void 0:e.agentId,walletAddress:t==null?void 0:t.address,walletKas:Number((W==null?void 0:W.walletKas)||0),activeDecisions:fe,activeQueue:Ce,activeAttributionSummary:ue}),ks=g.useRef(()=>{}),{resetPriceTrigger:Ns}=Zu({priceUsd:W==null?void 0:W.priceUsd,enabled:M==="RUNNING"&&Te&&oe&&G,triggerThresholdPct:1,onTrigger:y=>{me({type:"DATA",msg:`Price trigger fired (${y}) â€” accelerating next cycle.`,fee:null}),S(Date.now()-1)}});g.useEffect(()=>{ks.current=Ns},[Ns]);const Ht=g.useCallback(async()=>{var y,U,V,be;if(!(K.current||M!=="RUNNING"||!G)){K.current=!0,Ke(!0);try{if(!W){me({type:"ERROR",msg:"No live Kaspa data available. Reconnect feed before running cycle.",fee:null});return}const ze=cu(Me,Ie);S(Date.now()+Math.round(I*ze.cycleMultiplier)),me({type:"DATA",msg:`Kaspa DAG snapshot: DAA ${((y=W==null?void 0:W.dag)==null?void 0:y.daaScore)||"â€”"} Â· Wallet ${(W==null?void 0:W.walletKas)||"â€”"} KAS`,fee:null}),me({type:"DATA",msg:lu(ze),fee:null}),De(yu(br,p));const q=await tu(e,W||{},{history:Me,dagSignals:ze}),St=String((q==null?void 0:q.decision_source)||"ai"),Lr=String(((U=q==null?void 0:q.quant_metrics)==null?void 0:U.regime)||"NA");An&&!["ACCUMULATE","HOLD"].includes(q.action)&&(q.action="HOLD",q.rationale=`${String(q.rationale||"")} Execution constrained by accumulate-only mode.`.trim());const Ga=Date.now();Ae(wt=>[{ts:Ga,dec:q,kasData:W,source:St},...wt].slice(0,120)),me({type:"AI",msg:`${q.action} Â· Conf ${q.confidence_score} Â· Kelly ${(q.kelly_fraction*100).toFixed(1)}% Â· Monte Carlo ${q.monte_carlo_win_pct}% win Â· regime:${Lr} Â· source:${St} Â· ${(q==null?void 0:q.engine_latency_ms)||0}ms`,fee:.12}),q!=null&&q.quant_metrics&&me({type:"DATA",msg:`Quant core â†’ samples ${q.quant_metrics.sample_count??"â€”"} Â· edge ${q.quant_metrics.edge_score??"â€”"} Â· vol ${q.quant_metrics.ewma_volatility??"â€”"} Â· dataQ ${q.quant_metrics.data_quality_score??"â€”"}`,fee:null}),(St==="fallback"||St==="quant-core")&&(me({type:"SYSTEM",msg:`Local quant decision active (${(q==null?void 0:q.decision_source_detail)||"ai endpoint unavailable"}). Auto-approve uses same guardrails; AI overlay unavailable or bypassed.`,fee:null}),/ai_|timeout|endpoint|transport|request/i.test(String((q==null?void 0:q.decision_source_detail)||""))&&Oe({type:"ai_outage",key:`ai_outage:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} AI overlay unavailable`,message:`Quant core fallback active. detail=${String((q==null?void 0:q.decision_source_detail)||"n/a")}`,severity:"warn",meta:{decision_source:St,regime:Lr}}));const qa=q.confidence_score>=mi,Ya=q.risk_score<=dr,Xa=Math.max(0,Math.min(1,Number((ge==null?void 0:ge.effectiveSizingMultiplier)||1))),Qa=!!(ge!=null&&ge.autoApproveDisabled),Ja=Array.isArray(ge==null?void 0:ge.autoApproveDisableReasons)?ge.autoApproveDisableReasons:[],Za=Number((W==null?void 0:W.walletKas)||0),ec=ur&&(t==null?void 0:t.provider)!=="demo"&&mt>0&&ve.supportsNativeMultiOutput(String((t==null?void 0:t.provider)||"")),ni=ur&&(t==null?void 0:t.provider)!=="demo"&&mt>0?ec?mt:mt+Tt:0,si=Math.max(0,Za-xr-Tt-ni),tc=oe&&!O&&(t==null?void 0:t.provider)!=="demo";if(!Ya)me({type:"VALID",msg:`Risk gate FAILED â€” score ${q.risk_score} > ${dr} ceiling`,fee:null}),me({type:"EXEC",msg:"BLOCKED by risk gate",fee:.03}),Oe({type:"risk_event",key:`risk_gate:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} risk gate blocked cycle`,message:`Risk score ${q.risk_score} exceeded ceiling ${dr}. action=${q.action} regime=${Lr}`,severity:"warn",meta:{risk_score:q.risk_score,risk_ceiling:dr,regime:Lr}});else if(!qa)me({type:"VALID",msg:`Confidence ${q.confidence_score} < ${mi} threshold`,fee:null}),me({type:"EXEC",msg:"HOLD â€” confidence gate enforced",fee:.08});else if(q.action==="ACCUMULATE"&&si<=0)me({type:"VALID",msg:`Insufficient spendable balance after reserve (${xr} KAS), network fee (${Tt} KAS), and treasury payout reserve (${ni.toFixed(4)} KAS).`,fee:null}),me({type:"EXEC",msg:"HOLD â€” waiting for available balance",fee:.03});else if(me({type:"VALID",msg:`Risk OK (${q.risk_score}) Â· Conf OK (${q.confidence_score}) Â· Kelly ${(q.kelly_fraction*100).toFixed(1)}%`,fee:null}),Ne==="notify")me({type:"EXEC",msg:`NOTIFY mode active â€” ${q.action} signal recorded, no transaction broadcast.`,fee:.01});else if(!Te||!tc){const wt=Te?"network feed or wallet provider is not execution-ready":"live execution is disarmed";me({type:"EXEC",msg:`Signal generated (${q.action}) but no transaction broadcast because ${wt}.`,fee:.01})}else if(q.action==="REDUCE")me({type:"EXEC",msg:"REDUCE signal â€” take-profit opportunity. Move KAS from your accumulation address to an exchange to realise gains. Agent will hold accumulation until signal clears.",fee:.01});else if(q.action!=="HOLD"){const wt=Number(q.capital_allocation_kas||0),bt=q.action==="ACCUMULATE"?Number((Math.max(0,wt)*Xa).toFixed(6)):wt;q.action==="ACCUMULATE"&&bt<wt&&me({type:"SYSTEM",msg:`Calibration guardrail scaled execution from ${wt} to ${bt.toFixed(6)} KAS (health ${Number(((V=ge==null?void 0:ge.calibration)==null?void 0:V.health)||1).toFixed(3)} Â· tier ${String(((be=ge==null?void 0:ge.calibration)==null?void 0:be.tier)||"healthy").toUpperCase()}).`,fee:null});const Sn=Number((ct==null?void 0:ct.cycleCapKas)||0),bn=q.action==="ACCUMULATE"&&Sn>0?Math.min(bt,Sn):bt,Pr=q.action==="ACCUMULATE"?Math.min(bn,si):bt;if(q.action==="ACCUMULATE"&&Sn>0&&bt>bn&&me({type:"SYSTEM",msg:`Shared portfolio allocator capped ${e.name} cycle from ${bt} to ${bn.toFixed(4)} KAS.`,fee:null}),bt>Pr&&me({type:"SYSTEM",msg:`Clamped execution amount from ${bt} to ${Pr.toFixed(4)} KAS (available balance guardrail).`,fee:null}),!(Pr>0)){me({type:"EXEC",msg:"HOLD â€” computed execution amount is zero",fee:.03});return}const ii=qu(t==null?void 0:t.address),rc=ln({id:Jr(),type:q.action,metaKind:"action",from:t==null?void 0:t.address,to:ii||Io,amount_kas:Number(Pr.toFixed(6)),purpose:q.rationale.slice(0,60),status:"pending",ts:Date.now(),dec:q,agentDepositAddress:ii}),rt=Ia(rc);rt!=null&&rt.treasuryCombined&&me({type:"TREASURY",msg:`Using combined treasury routing in primary transaction (${String((t==null?void 0:t.provider)||"wallet")}) Â· treasury ${Number((rt==null?void 0:rt.treasuryCombinedFeeKas)||mt).toFixed(6)} KAS`,fee:null});const nc=ze.activitySurge&&q.action==="ACCUMULATE"?1.5:1,sc=We.thresholdKas*nc;if(We.samplesSufficient&&Math.abs(We.multiplier-1)>=.08){const Et=`${We.tier}|${We.reason}|${We.thresholdKas.toFixed(4)}`;H.current!==Et&&(me({type:"SYSTEM",msg:`Adaptive auto-threshold ${We.tier.toUpperCase()} (${We.rolling.wins}/${We.rolling.samples} wins) â†’ ${We.thresholdKas.toFixed(4)} KAS base (${We.reason}).`,fee:null}),H.current=Et)}const oi=Ne==="autonomous"&&rt.amount_kas<=sc,ai=oi&&!Qa;if(oi&&!ai&&me({type:"SIGN",msg:`Auto-approve blocked by guardrail (${Ja.join(",")||"policy"}). Action routed to manual queue.`,fee:null}),ai)try{const Et=await Ut(rt);me({type:"EXEC",msg:`AUTO-APPROVED: ${q.action} Â· ${rt.amount_kas} KAS Â· txid: ${Et.slice(0,16)}...`,fee:.08,truthLabel:"BROADCASTED",receiptProvenance:"ESTIMATED"}),me({type:"TREASURY",msg:`Fee split â†’ Pool: ${(dt*os).toFixed(4)} KAS / Treasury: ${(dt*It).toFixed(4)} KAS`,fee:dt});const ic=lr(rt,Et);await jr(ic,"auto")}catch(Et){Wt(rt),me({type:"SIGN",msg:`Auto-approve fallback to manual queue: ${(Et==null?void 0:Et.message)||"wallet broadcast failed"}`,fee:null})}else me({type:"SIGN",msg:`Action queued for wallet signature: ${q.action} Â· ${rt.amount_kas} KAS`,fee:null}),Wt(rt)}else me({type:"EXEC",msg:"HOLD â€” no action taken",fee:.08})}catch(ze){const q=gn(ze,{domain:"system"});me({type:"ERROR",msg:Uo(q),fee:null}),q.domain==="tx"&&q.code==="TX_BROADCAST_FAILED"&&D({type:"FAIL",reason:q.message})}finally{Ke(!1),K.current=!1,ks.current()}}},[An,120,ct,me,e,We,I,Ne,W,Te,oe,Me,O,Wt,lr,dr,G,Ut,jr,Oe,M,D,p,t]);Ju({status:M,runtimeHydrated:G,loading:ce,liveConnected:oe,kasDataError:O,nextAutoCycleAt:tt,cycleIntervalMs:I,cycleLockRef:K,setNextAutoCycleAt:S,runCycle:Ht});const Is=g.useRef(0),js=g.useRef(0);g.useEffect(()=>{if(!yt||M!=="RUNNING"||!G||!Te)return;const y=Ue;if(!y||y.kind==="unknown")return;const U=Date.now(),V=y.kind==="utxo"?1500:2500;if(!(U-Is.current<V)&&(Is.current=U,S(be=>Math.min(Number(be||U),U-1)),U-js.current>=15e3)){const be=y.kind==="daa"?`DAA push detected (${y.daaScore||"n/a"}) â€” accelerating quant cycle.`:`UTXO push detected${y.affectsWallet?" for active wallet":""} â€” accelerating quant cycle.`;me({type:"DATA",msg:be,fee:null}),js.current=U}},[me,Ue,Te,G,M,yt]),g.useEffect(()=>{var V,be,ze;const y=String(((ze=(be=(V=fe[0])==null?void 0:V.dec)==null?void 0:be.quant_metrics)==null?void 0:ze.regime)||"");if(!y)return;if(!F.current){F.current=y;return}if(F.current===y)return;const U=F.current;F.current=y,Oe({type:"regime_shift",key:`regime_shift:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${U}->${y}`,title:`${(e==null?void 0:e.name)||"Agent"} regime shift`,message:`Regime changed from ${U} to ${y}.`,severity:y==="RISK_OFF"?"warn":"info",meta:{previous_regime:U,regime:y}})},[e==null?void 0:e.agentId,e==null?void 0:e.name,fe,Oe]);const Oa=g.useCallback(async y=>{const U=zt?{...zt}:null;if(await Ts(y),!U||(U==null?void 0:U.metaKind)==="treasury_fee")return;const V={...U,status:"signed",txid:y==null?void 0:y.txid};await jr(V,"post-sign")},[Ts,jr,zt]),Rs=()=>{try{const y={exportedAt:new Date().toISOString(),forgeosVersion:"1",agent:{...e,_runtimeSnapshot:{execMode:Ne,liveExecutionArmed:Te,status:M,totalDecisions:fe.length,totalQueueEntries:Ce.length}}},U=new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),V=URL.createObjectURL(U),be=document.createElement("a");be.href=V,be.download=`forgeos-agent-${String((e==null?void 0:e.name)||"config").replace(/\s+/g,"-").toLowerCase()}-${Date.now()}.json`,be.click(),URL.revokeObjectURL(V),me({type:"SYSTEM",msg:"Agent config exported to JSON backup.",fee:null})}catch{me({type:"ERROR",msg:"Export failed â€” could not create download.",fee:null})}},Ms=()=>{D({type:"KILL"}),me({type:"SYSTEM",msg:"KILL-SWITCH activated â€” agent suspended. All pending actions cancelled.",fee:null}),Oe({type:"risk_event",key:`kill_switch:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} kill-switch activated`,message:"Agent suspended and pending queue rejected.",severity:"danger",meta:{pending_rejected:Ce.filter(y=>y.status==="pending").length}}),Na()},_t=parseFloat(Y.filter(y=>y.fee).reduce((y,U)=>y+(U.fee||0),0).toFixed(4));Number((W==null?void 0:W.walletKas)||0);const Ka=ur&&(t==null?void 0:t.provider)!=="demo"&&mt>0&&ve.supportsNativeMultiOutput(String((t==null?void 0:t.provider)||"")),Fa=ur&&(t==null?void 0:t.provider)!=="demo"&&mt>0?Ka?mt:mt+Tt:0,$a=Ef({viewportWidth:N,nextAutoCycleAt:tt,status:M,totalFees:_t,queue:Ce,decisions:fe,liveConnected:oe,kasDataError:O,wallet:t,kasData:W,reserveKas:xr,netFeeKas:Tt,treasuryReserveKas:Fa,wsUrl:En,streamConnected:Ye,streamRetryCount:xt}),{isMobile:ne,isTablet:Da,summaryGridCols:Ba,splitGridCols:za,controlsGridCols:Ls,spendableKas:Ua,liveExecutionReady:Wa,autoCycleCountdownLabel:_n,lastDecision:Q,lastDecisionSource:ft,streamBadgeText:Ps,streamBadgeColor:Ha}=$a,Xe=ne&&N<430,Va=[{k:"overview",l:"OVERVIEW"},{k:"portfolio",l:"PORTFOLIO"},{k:"wallet",l:"WALLET"},{k:"swap",l:"SWAP"},{k:"intelligence",l:"INTELLIGENCE"},{k:"analytics",l:"ANALYTICS"},{k:"attribution",l:"ATTRIBUTION"},{k:"alerts",l:"ALERTS"},{k:"queue",l:`QUEUE${at>0?` (${at})`:""}`},{k:"log",l:"LOG"},{k:"network",l:"NETWORK"},{k:"controls",l:"CONTROLS"}],Os=g.useRef(0);g.useEffect(()=>{const y=(Le==null?void 0:Le.queuePendingThreshold)||3,U=Os.current,V=at,be=U<y,ze=V>=y,q=V>U&&V-U>=Math.max(1,Math.floor(y/2));Os.current=V,!(!ze||V<=U)&&(be||q)&&Oe({type:"queue_pending",key:`queue_pending_count:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${String(y)}`,title:`${(e==null?void 0:e.name)||"Agent"} queue backlog alert`,message:`${V} transaction${V>1?"s":""} awaiting wallet approval (threshold: ${y}).`,severity:V>=y*2?"danger":V>=y?"warn":"info",meta:{pending_count:V,threshold:y,prev_count:U}})},[e==null?void 0:e.agentId,e==null?void 0:e.name,at,Le==null?void 0:Le.queuePendingThreshold,Oe]);const Ks=g.useRef(0);g.useEffect(()=>{const y=(Le==null?void 0:Le.lowBalanceThreshold)||100,U=Number((W==null?void 0:W.walletKas)||0),V=Date.now();U>=y||U<=0||V-Ks.current<36e5||(Ks.current=V,Oe({type:"low_balance",key:`low_balance:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${String(y)}`,title:`${(e==null?void 0:e.name)||"Agent"} low balance warning`,message:`Wallet balance ${U.toFixed(2)} KAS is below threshold ${y} KAS.`,severity:U<y*.5?"danger":"warn",meta:{balance_kas:U,threshold_kas:y}}))},[e==null?void 0:e.agentId,e==null?void 0:e.name,W==null?void 0:W.walletKas,Le==null?void 0:Le.lowBalanceThreshold,Oe]);const Rr=g.useRef({});g.useEffect(()=>{if(!Ce||!Array.isArray(Ce))return;const y=Date.now(),U=3e5;for(const V of Ce){if(!(V!=null&&V.txid))continue;const be=String(V.txid),ze=V==null?void 0:V.failure_reason,q=V==null?void 0:V.receipt_lifecycle;if(q==="timeout"&&ze==="confirmation_timeout"){const St=Rr.current[`${be}:timeout`]||0;if(y-St<U)continue;Rr.current[`${be}:timeout`]=y,Oe({type:"confirmation_timeout",key:`confirmation_timeout:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${be}`,title:`${(e==null?void 0:e.name)||"Agent"} transaction confirmation timeout`,message:`Transaction ${be.slice(0,16)}... failed to confirm within expected time (${(V==null?void 0:V.receipt_attempts)||0} attempts).`,severity:"warn",meta:{txid:be,attempts:(V==null?void 0:V.receipt_attempts)||0,amount_kas:V==null?void 0:V.amount_kas}})}if(q==="failed"&&(ze==="chain_rejected"||ze==="backend_receipt_failed")){const St=Rr.current[`${be}:failed`]||0;if(y-St<U)continue;Rr.current[`${be}:failed`]=y,Oe({type:"tx_failure",key:`tx_failure:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}:${be}`,title:`${(e==null?void 0:e.name)||"Agent"} transaction failed`,message:`Transaction ${be.slice(0,16)}... was rejected (reason: ${ze||"unknown"}).`,severity:"danger",meta:{txid:be,failure_reason:ze,amount_kas:V==null?void 0:V.amount_kas,metaKind:V==null?void 0:V.metaKind}})}}},[e==null?void 0:e.agentId,e==null?void 0:e.name,Ce,Oe]);const Mr=g.useRef(0);return g.useEffect(()=>{if(Mr.current>0&&!oe){const V=Date.now();if(V-Mr.current<6e4)return;Mr.current=V,Oe({type:"system",key:`network_disconnect:${String((e==null?void 0:e.agentId)||(e==null?void 0:e.name)||"agent")}`,title:`${(e==null?void 0:e.name)||"Agent"} network disconnected`,message:"Kaspa DAG feed disconnected. Live execution may be affected.",severity:"warn",meta:{network:Ie,wasConnected:!0}})}else oe&&(Mr.current=1)},[e==null?void 0:e.agentId,e==null?void 0:e.name,oe,Oe]),r.jsxs("div",{style:{maxWidth:1460,margin:"0 auto",padding:ne?"14px 14px 22px":"22px 24px 34px"},children:[zt&&r.jsx(ms,{tx:zt,wallet:t,onSign:Oa,onReject:ka}),r.jsxs("div",{style:{display:"flex",flexDirection:ne?"column":"row",justifyContent:"space-between",alignItems:ne?"stretch":"flex-start",marginBottom:16,gap:ne?10:0},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:11,color:n.dim,letterSpacing:"0.1em",...f,marginBottom:2},children:["Forge-OS / AGENT / ",e.name]}),r.jsx("div",{style:{fontSize:18,color:n.text,fontWeight:700,...f},children:e.name})]}),r.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:ne?"flex-start":"flex-end"},children:[M&&M!=="PAUSED"&&r.jsx(J,{text:M,color:M==="RUNNING"?n.ok:M==="PAUSED"?n.warn:n.dim,dot:!0}),Ne==="autonomous"&&r.jsx(J,{text:"AUTONOMOUS",color:n.accent}),Ne&&Ne!=="autonomous"&&r.jsx(J,{text:Ne.toUpperCase(),color:n.dim}),ke&&ke!=="Custom"&&r.jsx(J,{text:String(ke).toUpperCase(),color:n.text}),Te===!0&&r.jsx(J,{text:"LIVE EXEC ON",color:n.ok,dot:!0}),An&&r.jsx(J,{text:"ACCUMULATE-ONLY",color:n.ok}),(t==null?void 0:t.provider)&&r.jsx(J,{text:(Ds=t==null?void 0:t.provider)==null?void 0:Ds.toUpperCase(),color:n.purple,dot:!0}),Fe==="worker"&&r.jsx(J,{text:"ENGINE WORKER",color:n.ok}),We.samplesSufficient&&r.jsx(J,{text:`AUTO THR ${We.thresholdKas.toFixed(2)}K`,color:We.tier==="boosted"?n.ok:We.tier==="restricted"?n.danger:We.tier==="tightened"?n.warn:n.dim}),_n&&r.jsx(J,{text:`AUTO ${_n}`,color:M==="RUNNING"?n.text:n.dim}),oe&&r.jsx(J,{text:"DAG LIVE",color:n.ok,dot:!0}),Ye&&Ps&&r.jsx(J,{text:Ps,color:Ha,dot:!0}),(Ue==null?void 0:Ue.kind)==="daa"&&r.jsx(J,{text:"WS DAA PUSH",color:n.ok,dot:!0}),(Ue==null?void 0:Ue.kind)==="utxo"&&(Ue==null?void 0:Ue.affectsWallet)&&r.jsx(J,{text:"WS UTXO PUSH",color:n.warn,dot:!0})]})]}),r.jsx(sp,{kasDataError:O,refreshKasData:Mt,kasDataLoading:Se,liveExecutionArmed:Te,liveExecutionReady:Wa,executionGuardrails:ge,pendingCount:at,isMobile:ne,setTab:Z}),r.jsx("div",{style:{display:"flex",borderBottom:`1px solid ${n.border}`,marginBottom:18,overflowX:"auto"},children:Va.map(y=>r.jsx("button",{"data-testid":`dashboard-tab-${y.k}`,onClick:()=>Z(y.k),style:{background:"none",border:"none",borderBottom:`2px solid ${P===y.k?n.accent:"transparent"}`,color:P===y.k?n.accent:n.dim,padding:"7px 14px",fontSize:11,cursor:"pointer",letterSpacing:"0.08em",...f,marginBottom:-1,whiteSpace:"nowrap",transition:"color 0.15s"},children:y.l},y.k))}),P==="overview"&&r.jsxs("div",{children:[r.jsxs(ye,{"data-testid":"overview-portfolio-header",p:0,style:{marginBottom:12,background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",border:`1px solid ${n.accent}40`,boxShadow:`0 4px 24px ${n.accent}15`},children:[r.jsxs("div",{style:{padding:Xe?"12px 10px 10px":ne?"14px 14px 12px":"18px 24px",display:"flex",flexDirection:ne?"column":"row",justifyContent:"space-between",alignItems:ne?"stretch":"center",gap:ne?12:0,borderBottom:`1px solid ${n.border}`,background:`linear-gradient(90deg, ${n.accent}15 0%, transparent 100%)`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Xe?8:ne?10:14,minWidth:0},children:[r.jsx("div",{style:{width:Xe?40:ne?44:52,height:Xe?40:ne?44:52,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",flexShrink:0},children:r.jsx("img",{src:"/kaspa-logo.png",alt:"KAS",width:Xe?42:ne?48:56,height:Xe?42:ne?48:56,style:{objectFit:"cover",marginTop:1}})}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",minWidth:0},children:[r.jsx("div",{style:{fontSize:10,color:n.accent,...f,marginBottom:1,letterSpacing:"0.15em",fontWeight:700},children:"â—† TOTAL PORTFOLIO VALUE"}),r.jsxs("div",{style:{fontSize:Xe?24:ne?28:36,color:n.accent,fontWeight:700,...f,textShadow:`0 0 30px ${n.accent}60`,lineHeight:1,wordBreak:"break-word"},children:[(W==null?void 0:W.walletKas)||e.capitalLimit," ",r.jsx("span",{style:{fontSize:Xe?12:ne?14:18,color:n.dim},children:"KAS"})]}),Number((W==null?void 0:W.priceUsd)||0)>0&&r.jsxs("div",{style:{fontSize:Xe?13:ne?14:18,color:n.text,...f,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:["$",(Number((W==null?void 0:W.walletKas)||0)*Number(W==null?void 0:W.priceUsd)).toFixed(2),r.jsx("span",{style:{color:n.ok,fontSize:Xe?9:ne?10:12,background:n.ok+"20",padding:"2px 8px",borderRadius:4},children:"USD"})]})]})]}),r.jsx("div",{style:{display:"flex",flexDirection:ne?"row":"column",gap:10,alignItems:ne?"stretch":"flex-end",width:ne?"100%":"auto"},children:r.jsx("div",{style:{display:"flex",gap:10,alignItems:"center",justifyContent:ne?"space-between":"flex-start",background:`${n.s2}90`,padding:Xe?"7px 8px":ne?"8px 10px":"10px 16px",borderRadius:10,border:`1px solid ${n.border}`,width:ne?"100%":"auto"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[r.jsx("span",{style:{fontSize:Xe?9:ne?10:11,color:n.dim,...f},children:"KAS/USD"}),r.jsxs("span",{style:{fontSize:Xe?14:ne?16:18,color:n.text,fontWeight:700,...f},children:["$",Number((W==null?void 0:W.priceUsd)||0).toFixed(4)]})]})})})]}),r.jsxs("div",{"data-testid":"overview-quick-stats",style:{padding:Xe?"10px":ne?"12px 14px":"16px 24px",display:"grid",gridTemplateColumns:Xe?"1fr":ne?"repeat(2, minmax(0, 1fr))":"repeat(6, 1fr)",gap:ne?10:16,background:`${n.border}15`},children:[r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${n.ok}30`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"SPENDABLE"}),r.jsx("div",{style:{fontSize:ne?16:18,color:n.ok,fontWeight:700,...f},children:Ua.toFixed(2)}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"KAS"})]}),r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${n.warn}30`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"RESERVE"}),r.jsx("div",{style:{fontSize:ne?16:18,color:n.warn,fontWeight:700,...f},children:xr}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"KAS"})]}),r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"DAA HEIGHT"}),r.jsx("div",{style:{fontSize:ne?16:18,color:n.text,fontWeight:700,...f},children:((Us=(zs=(Bs=W==null?void 0:W.dag)==null?void 0:Bs.daaScore)==null?void 0:zs.toLocaleString())==null?void 0:Us.slice(-6))||"â€”"}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"BLOCK"})]}),r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${at>0?n.warn:n.border}`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"PENDING"}),r.jsx("div",{style:{fontSize:ne?16:18,color:at>0?n.warn:n.dim,fontWeight:700,...f},children:at}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"TXS"})]}),r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"FEES PAID"}),r.jsx("div",{style:{fontSize:ne?16:18,color:n.text,fontWeight:700,...f},children:_t.toFixed(3)}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"KAS"})]}),r.jsxs("div",{style:{textAlign:"center",background:n.s2+"60",padding:"12px 8px",borderRadius:8,border:`1px solid ${n.accent}30`},children:[r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f,marginBottom:6,letterSpacing:"0.1em"},children:"CYCLE SIZE"}),r.jsx("div",{style:{fontSize:ne?16:18,color:n.accent,fontWeight:700,...f},children:e.capitalLimit}),r.jsx("div",{style:{fontSize:ne?8:9,color:n.dim,...f},children:"KAS"})]})]}),r.jsxs("div",{style:{padding:Xe?"12px 10px":ne?"12px 14px":"14px 24px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:10,flexWrap:"wrap",borderTop:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[r.jsxs(_e,{onClick:Ht,disabled:ce||M!=="RUNNING",size:"sm",children:[ce?"â³":"ðŸš€"," ",ce?"RUNNING":"RUN CYCLE"]}),r.jsx(_e,{onClick:()=>it(y=>!y),variant:Te?"warn":"primary",size:"sm",children:Te?"ðŸŸ¢ AUTO-TRADE ON":"ðŸ”´ AUTO-TRADE OFF"}),r.jsx(_e,{onClick:()=>D({type:M==="RUNNING"?"PAUSE":"RESUME"}),variant:"ghost",size:"sm",children:M==="RUNNING"?"â¸ PAUSE AGENT":"â–¶ï¸ RESUME AGENT"}),r.jsx(_e,{onClick:Rs,variant:"ghost",size:"sm",title:"Download agent config as JSON backup",children:"EXPORT"}),r.jsx(_e,{onClick:Ms,variant:"danger",size:"sm",children:"ðŸ›‘ KILL-SWITCH"})]}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:6},children:r.jsx("span",{style:{fontSize:11,color:Te?n.ok:n.warn,fontWeight:700,...f},children:Te?"LIVE EXEC ON":"LIVE EXEC OFF"})})]})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:Ba,gap:10,marginBottom:12},children:[{l:"Pending Signatures",v:at,s:"In action queue",c:at>0?n.warn:n.dim},{l:"Total Protocol Fees",v:`${_t} KAS`,s:"",c:n.text},{l:"Capital / Cycle",v:`${e.capitalLimit} KAS`,s:"Per execution cycle",c:n.text},{l:"Portfolio Cap",v:ct!=null&&ct.cycleCapKas?`${ct.cycleCapKas} KAS`:"â€”",s:"Shared allocator",c:ct!=null&&ct.cycleCapKas?n.ok:n.dim}].map(y=>r.jsxs(ye,{p:14,children:[r.jsx(Ge,{children:y.l}),r.jsx("div",{style:{fontSize:18,color:y.c,fontWeight:700,...f,marginBottom:2},children:y.v}),r.jsx("div",{style:{fontSize:11,color:n.dim},children:y.s})]},y.l))}),r.jsxs(ye,{p:0,style:{marginBottom:12,background:`linear-gradient(135deg, ${n.s2} 0%, ${Q?n.s1:n.s2} 100%)`,border:`1px solid ${Q?n.accent+"40":n.border}`,boxShadow:Q?`0 4px 24px ${n.accent}20`:"none"},children:[r.jsxs("div",{style:{padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${n.border}`,background:`linear-gradient(90deg, ${n.accent}10 0%, transparent 100%)`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsx("span",{style:{fontSize:16},children:M==="RUNNING"&&Q?"ðŸŸ¢":M==="RUNNING"||M==="PAUSED"?"ðŸŸ¡":"âš«"}),r.jsx("span",{style:{fontSize:14,color:n.text,fontWeight:700,...f},children:"ðŸ¤– AI TRADING ENGINE"})]}),r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,background:`${n.s2}90`,padding:"6px 12px",borderRadius:20,border:`1px solid ${n.border}`},children:[r.jsx("span",{style:{fontSize:12},children:"âš¡"}),r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Engine Latency"}),r.jsxs("span",{style:{fontSize:12,color:n.accent,fontWeight:700,...f},children:[((Ws=Q==null?void 0:Q.dec)==null?void 0:Ws.engine_latency_ms)||0,"ms"]})]}),r.jsx(J,{text:M==="RUNNING"?"â— ACTIVE":M==="PAUSED"?"â—‰ PAUSED":"â—‹ OFF",color:M==="RUNNING"?n.ok:M==="PAUSED"?n.warn:n.dim}),r.jsx(J,{text:(Q==null?void 0:Q.action)||"WAITING",color:(Q==null?void 0:Q.action)==="ACCUMULATE"?n.ok:(Q==null?void 0:Q.action)==="REDUCE"?n.danger:(Q==null?void 0:Q.action)==="HOLD"?n.warn:n.dim})]})]}),Q?r.jsxs("div",{style:{padding:"20px"},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr 1fr":"repeat(4, 1fr)",gap:12,marginBottom:16},children:[r.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",borderRadius:10,padding:14,border:`1px solid ${ft==="hybrid-ai"?n.accent+"40":n.border}`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[r.jsx("span",{style:{fontSize:16},children:ft==="hybrid-ai"?"ðŸ§ ":ft==="ai"?"ðŸ¤–":"ðŸ“Š"}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f,letterSpacing:"0.1em"},children:"DECISION SOURCE"})]}),r.jsx("div",{style:{fontSize:18,color:ft==="hybrid-ai"?n.accent:ft==="ai"?n.ok:n.text,fontWeight:700,...f},children:ft==="hybrid-ai"?"HYBRID AI":ft==="ai"?"PURE AI":ft==="quant-core"?"QUANT CORE":"FALLBACK"}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:ft==="hybrid-ai"?"AI + Quant combined":ft==="ai"?"OpenAI powered":"Local quant engine"})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",borderRadius:10,padding:14,border:`1px solid ${Q.confidence_score>=.8?n.ok+"40":Q.confidence_score>=.5?n.warn+"40":n.danger+"40"}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,letterSpacing:"0.1em"},children:"CONFIDENCE"}),r.jsx("span",{style:{fontSize:14},children:Q.confidence_score>=.8?"ðŸŸ¢":Q.confidence_score>=.5?"ðŸŸ¡":"ðŸ”´"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[r.jsx("span",{style:{fontSize:28,color:Q.confidence_score>=.8?n.ok:Q.confidence_score>=.5?n.warn:n.danger,fontWeight:700,...f},children:(Q.confidence_score*100).toFixed(0)}),r.jsx("span",{style:{fontSize:14,color:n.dim,...f},children:"%"})]}),r.jsx("div",{style:{marginTop:8,height:4,background:n.s1,borderRadius:2,overflow:"hidden"},children:r.jsx("div",{style:{width:`${Q.confidence_score*100}%`,height:"100%",background:Q.confidence_score>=.8?n.ok:Q.confidence_score>=.5?n.warn:n.danger,borderRadius:2,transition:"width 0.5s ease"}})})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",borderRadius:10,padding:14,border:`1px solid ${n.accent}40`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,letterSpacing:"0.1em"},children:"KELLY SIZING"}),r.jsx("span",{style:{fontSize:14},children:"ðŸ“ˆ"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[r.jsx("span",{style:{fontSize:28,color:n.accent,fontWeight:700,...f},children:(Q.kelly_fraction*100).toFixed(1)}),r.jsx("span",{style:{fontSize:14,color:n.dim,...f},children:"%"})]}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:"Position size multiplier"})]}),r.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",borderRadius:10,padding:14,border:`1px solid ${n.ok}40`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,letterSpacing:"0.1em"},children:"MONTE CARLO"}),r.jsx("span",{style:{fontSize:14},children:"ðŸŽ¯"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:4},children:[r.jsx("span",{style:{fontSize:28,color:n.ok,fontWeight:700,...f},children:Q.monte_carlo_win_pct}),r.jsx("span",{style:{fontSize:14,color:n.dim,...f},children:"%"})]}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:"Win probability"})]})]}),Q.quant_metrics&&r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:16,marginBottom:16,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:11,color:n.accent,fontWeight:700,...f,marginBottom:12,letterSpacing:"0.1em"},children:"ðŸ“Š QUANT CORE METRICS"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr 1fr":"repeat(5, 1fr)",gap:12},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:4},children:"SAMPLES"}),r.jsx("div",{style:{fontSize:16,color:n.text,fontWeight:700,...f},children:Q.quant_metrics.sample_count??"â€”"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:4},children:"EDGE SCORE"}),r.jsx("div",{style:{fontSize:16,color:Number(Q.quant_metrics.edge_score)>0?n.ok:n.warn,fontWeight:700,...f},children:Number(Q.quant_metrics.edge_score||0).toFixed(4)??"â€”"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:4},children:"VOLATILITY"}),r.jsx("div",{style:{fontSize:16,color:n.text,fontWeight:700,...f},children:Number(Q.quant_metrics.ewma_volatility||0).toFixed(4)??"â€”"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:4},children:"DATA QUALITY"}),r.jsxs("div",{style:{fontSize:16,color:(Q.quant_metrics.data_quality_score||0)>=.7?n.ok:n.warn,fontWeight:700,...f},children:[((Q.quant_metrics.data_quality_score||0)*100).toFixed(0),"%"]})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:9,color:n.dim,...f,marginBottom:4},children:"REGIME"}),r.jsx("div",{style:{fontSize:14,color:Q.quant_metrics.regime==="RISK_ON"?n.ok:Q.quant_metrics.regime==="RISK_OFF"?n.danger:n.warn,fontWeight:700,...f},children:String(Q.quant_metrics.regime||"NA").replace(/_/g," ")})]})]})]}),r.jsxs("div",{style:{display:"flex",gap:12,marginBottom:16,flexWrap:"wrap"},children:[r.jsxs("div",{style:{flex:"1 1 200px",background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${Q.risk_score<=.4?n.ok+"40":Q.risk_score<=.7?n.warn+"40":n.danger+"40"}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"RISK SCORE"}),r.jsx("span",{style:{fontSize:14},children:Q.risk_score<=.4?"ðŸ›¡ï¸":Q.risk_score<=.7?"âš ï¸":"ðŸš¨"})]}),r.jsx("div",{style:{fontSize:24,color:Q.risk_score<=.4?n.ok:Q.risk_score<=.7?n.warn:n.danger,fontWeight:700,...f},children:(Hs=Q.risk_score)==null?void 0:Hs.toFixed(3)}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:Q.risk_score<=.4?"Low risk - Safe to execute":Q.risk_score<=.7?"Medium risk - Caution advised":"High risk - Blocked"})]}),r.jsxs("div",{style:{flex:"1 1 200px",background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.accent}40`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"CAPITAL ALLOCATION"}),r.jsx("span",{style:{fontSize:14},children:"ðŸ’°"})]}),r.jsxs("div",{style:{fontSize:24,color:n.accent,fontWeight:700,...f},children:[Q.capital_allocation_kas," ",r.jsx("span",{style:{fontSize:12,color:n.dim},children:"KAS"})]}),r.jsxs("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:["~$",(Number(Q.capital_allocation_kas)*Number((W==null?void 0:W.priceUsd)||0)).toFixed(2)," USD"]})]}),r.jsxs("div",{style:{flex:"1 1 200px",background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"NETWORK STATUS"}),r.jsx("span",{style:{fontSize:14},children:oe?"ðŸŸ¢":"ðŸ”´"})]}),r.jsx("div",{style:{fontSize:18,color:oe?n.ok:n.danger,fontWeight:700,...f},children:oe?"CONNECTED":"OFFLINE"}),r.jsx("div",{style:{fontSize:10,color:n.dim,marginTop:4},children:(Vs=W==null?void 0:W.dag)!=null&&Vs.daaScore?`DAA: ${W.dag.daaScore.toLocaleString()}`:"Waiting for sync"})]})]}),r.jsxs("div",{style:{background:`linear-gradient(135deg, ${n.accent}08 0%, ${n.s2} 100%)`,borderRadius:10,padding:16,marginBottom:16,border:`1px solid ${n.accent}30`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("span",{style:{fontSize:14},children:"ðŸ§ "}),r.jsx("div",{style:{fontSize:11,color:n.accent,fontWeight:700,...f,letterSpacing:"0.1em"},children:"AI RATIONALE"})]}),((Gs=Q.quant_metrics)==null?void 0:Gs.ai_overlay_applied)&&r.jsx(J,{text:"ðŸ§  AI OVERLAY ACTIVE",color:n.accent})]}),r.jsx("div",{style:{fontSize:13,color:n.text,...f,lineHeight:1.6},children:Q.rationale})]}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[((qs=Q.quant_metrics)==null?void 0:qs.regime)&&r.jsx(J,{text:`ðŸ“Š ${String(Q.quant_metrics.regime).replace(/_/g," ")}`,color:Q.quant_metrics.regime==="RISK_ON"?n.ok:Q.quant_metrics.regime==="RISK_OFF"?n.danger:n.warn}),r.jsx(J,{text:`âš ï¸ RISK: ${(Ys=Q.risk_score)==null?void 0:Ys.toFixed(2)}`,color:Q.risk_score<=.4?n.ok:Q.risk_score<=.7?n.warn:n.danger}),r.jsx(J,{text:`ðŸ’° ${Q.capital_allocation_kas} KAS`,color:n.text}),((Xs=ge==null?void 0:ge.calibration)==null?void 0:Xs.tier)&&r.jsx(J,{text:`ðŸŽ¯ CAL: ${ge.calibration.tier.toUpperCase()}`,color:ge.calibration.tier==="healthy"?n.ok:n.warn}),((Qs=ge==null?void 0:ge.truth)==null?void 0:Qs.degraded)&&r.jsx(J,{text:"âš ï¸ TRUTH DEGRADED",color:n.danger}),!((Js=ge==null?void 0:ge.truth)!=null&&Js.degraded)&&r.jsx(J,{text:"âœ… VERIFIED",color:n.ok})]})]}):r.jsxs("div",{style:{padding:"32px 20px",textAlign:"center",background:`linear-gradient(180deg, ${n.s2} 0%, ${n.s1} 100%)`},children:[r.jsx("div",{style:{fontSize:48,marginBottom:16},children:"ðŸ¤–"}),r.jsx("div",{style:{fontSize:16,color:n.text,fontWeight:700,...f,marginBottom:8},children:"AI Agent Ready"}),r.jsx("div",{style:{fontSize:12,color:n.dim,marginBottom:16},children:"Run a quant cycle to generate AI trading signals"}),r.jsx(_e,{onClick:Ht,disabled:ce||M!=="RUNNING",style:{padding:"12px 32px",fontSize:14},children:ce?"âš¡ PROCESSING...":"ðŸš€ RUN QUANT CYCLE"})]})]}),Ce&&Ce.length>0&&r.jsxs(ye,{p:0,style:{marginBottom:12,border:`1px solid ${n.ok}30`},children:[r.jsxs("div",{style:{padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${n.border}`,background:`${n.ok}08`},children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:10},children:r.jsx("span",{style:{fontSize:13,color:n.ok,fontWeight:700,...f},children:"â›“ï¸ ON-CHAIN ACTIVITY"})}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsx(J,{text:`${Ce.filter(y=>y.status==="confirmed").length} CONFIRMED`,color:n.ok}),r.jsx(J,{text:`${Ce.filter(y=>y.status==="signed"||y.status==="broadcasted").length} PENDING`,color:n.warn})]})]}),r.jsx("div",{style:{maxHeight:200,overflowY:"auto"},children:Ce.slice(0,5).map((y,U)=>{var ze;const V=y.receipt_lifecycle==="confirmed",be=y.status==="signed"||y.status==="broadcasted"||y.status==="pending";return r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr":"80px 80px 1fr 100px 80px",gap:8,padding:"12px 20px",borderBottom:`1px solid ${n.border}`,background:V?`${n.ok}08`:be?`${n.warn}08`:n.s1},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"ACTION"}),r.jsx("div",{style:{fontSize:12,color:y.type==="ACCUMULATE"?n.ok:y.type==="REDUCE"?n.danger:n.text,fontWeight:700,...f},children:y.type})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"AMOUNT"}),r.jsxs("div",{style:{fontSize:12,color:n.text,fontWeight:700,...f},children:[y.amount_kas," KAS"]})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"TXID"}),r.jsx("div",{style:{fontSize:11,color:n.accent,...f,wordBreak:"break-all"},children:y.txid?`${y.txid.slice(0,20)}...`:"â€”"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"STATUS"}),r.jsx(J,{text:V?"CONFIRMED âœ“":be?"PENDING":((ze=y.status)==null?void 0:ze.toUpperCase())||"â€”",color:V?n.ok:be?n.warn:n.dim})]}),r.jsx("div",{children:y.txid&&r.jsx(as,{href:`${en}/txs/${y.txid}`,label:"VERIFY â†—"})})]},U)})}),r.jsxs("div",{style:{padding:"10px 20px",borderTop:`1px solid ${n.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:'Click "VERIFY â†—" to view transaction on Kaspa Explorer'}),r.jsx(_e,{onClick:()=>Z("queue"),variant:"ghost",size:"sm",children:"VIEW ALL TRANSACTIONS â†’"})]})]}),r.jsxs(ye,{p:0,style:{marginBottom:12,background:"linear-gradient(135deg, rgba(16,25,35,0.48) 0%, rgba(11,17,24,0.32) 100%)",border:`1px solid ${n.ok}30`,boxShadow:`0 4px 20px ${n.ok}10`},children:[r.jsxs("div",{style:{padding:"16px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:`1px solid ${n.border}`,background:`linear-gradient(90deg, ${n.ok}10 0%, transparent 100%)`},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:16},children:"ðŸ“ˆ"}),r.jsx("span",{style:{fontSize:14,color:n.text,fontWeight:700,...f},children:"PERFORMANCE TRACKER"})]}),r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,background:`${n.s2}90`,padding:"4px 10px",borderRadius:20,border:`1px solid ${n.border}`},children:[r.jsx("span",{style:{fontSize:10,color:n.dim,...f},children:"TODAY'S P&L"}),r.jsxs("span",{style:{fontSize:12,color:(ue==null?void 0:ue.netPnlKas)>0?n.ok:n.danger,fontWeight:700,...f},children:[(ue==null?void 0:ue.netPnlKas)>0?"+":"",Number((ue==null?void 0:ue.netPnlKas)||0).toFixed(4)," KAS"]})]}),r.jsx(J,{text:`${Ce==null?void 0:Ce.filter(y=>y.status==="confirmed").length} TXS`,color:n.accent})]})]}),r.jsxs("div",{style:{padding:"16px 20px"},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr 1fr":"repeat(5, 1fr)",gap:12,marginBottom:16},children:[r.jsxs("div",{style:{background:`linear-gradient(135deg, ${(ue==null?void 0:ue.netPnlKas)>0?n.ok:n.danger}15 0%, ${n.s2} 100%)`,borderRadius:10,padding:14,border:`1px solid ${(ue==null?void 0:ue.netPnlKas)>0?n.ok:n.danger}40`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"TOTAL P&L"}),r.jsx("span",{style:{fontSize:14},children:(ue==null?void 0:ue.netPnlKas)>0?"ðŸ“ˆ":"ðŸ“‰"})]}),r.jsxs("div",{style:{fontSize:24,color:(ue==null?void 0:ue.netPnlKas)>0?n.ok:n.danger,fontWeight:700,...f},children:[(ue==null?void 0:ue.netPnlKas)>0?"+":"",Number((ue==null?void 0:ue.netPnlKas)||0).toFixed(4)]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"KAS"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"TRADES"}),r.jsx("span",{style:{fontSize:14},children:"ðŸ”¢"})]}),r.jsx("div",{style:{fontSize:24,color:n.accent,fontWeight:700,...f},children:(Ce==null?void 0:Ce.filter(y=>y.status==="confirmed"||y.status==="broadcasted").length)||0}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"executions"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"WIN RATE"}),r.jsx("span",{style:{fontSize:14},children:"ðŸŽ¯"})]}),r.jsxs("div",{style:{fontSize:24,color:n.ok,fontWeight:700,...f},children:[(ue==null?void 0:ue.winRatePct)||0,"%"]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"profit rate"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"AVG PROFIT"}),r.jsx("span",{style:{fontSize:14},children:"ðŸ’Ž"})]}),r.jsxs("div",{style:{fontSize:24,color:n.ok,fontWeight:700,...f},children:["+",Number((ue==null?void 0:ue.avgProfitKas)||0).toFixed(4)]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"KAS per win"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.ok}40`},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"BEST TRADE"}),r.jsx("span",{style:{fontSize:14},children:"ðŸ†"})]}),r.jsxs("div",{style:{fontSize:24,color:n.ok,fontWeight:700,...f},children:["+",Number((ue==null?void 0:ue.bestTradeKas)||0).toFixed(4)]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"KAS all-time"})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr 1fr":"repeat(4, 1fr)",gap:12,marginBottom:16},children:[r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,marginBottom:4},children:"TOTAL FEES"}),r.jsxs("div",{style:{fontSize:18,color:n.warn,fontWeight:700,...f},children:["-",_t.toFixed(4)]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"KAS paid"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${(ue==null?void 0:ue.netPnlKas)-_t>0?n.ok:n.danger}40`},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,marginBottom:4},children:"NET PROFIT"}),r.jsxs("div",{style:{fontSize:18,color:(ue==null?void 0:ue.netPnlKas)-_t>0?n.ok:n.danger,fontWeight:700,...f},children:[(ue==null?void 0:ue.netPnlKas)-_t>0?"+":"",((ue==null?void 0:ue.netPnlKas)-_t||0).toFixed(4)]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"KAS after fees"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,marginBottom:4},children:"DECISIONS"}),r.jsx("div",{style:{fontSize:18,color:n.text,fontWeight:700,...f},children:fe.length}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"AI signals"})]}),r.jsxs("div",{style:{background:"rgba(16,25,35,0.45)",borderRadius:10,padding:14,border:`1px solid ${n.border}`},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,marginBottom:4},children:"ACCURACY"}),r.jsxs("div",{style:{fontSize:18,color:n.accent,fontWeight:700,...f},children:[fe.length>0?Math.round(fe.filter(y=>{var U,V;return((U=y==null?void 0:y.dec)==null?void 0:U.action)==="ACCUMULATE"||((V=y==null?void 0:y.dec)==null?void 0:V.action)==="HOLD"}).length/fe.length*100):0,"%"]}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"signal accuracy"})]})]}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx(J,{text:`ðŸ’° Budget: ${e.capitalLimit} KAS/cycle`,color:n.accent}),r.jsx(J,{text:`ðŸŽ¯ Target: ${e.kpiTarget}% ROI`,color:n.ok}),r.jsx(J,{text:`â±ï¸ Cycle: ${Er}s`,color:n.text})]}),r.jsx("div",{style:{display:"flex",gap:8},children:r.jsx(_e,{onClick:()=>Z("analytics"),variant:"ghost",size:"sm",children:"ðŸ“Š FULL ANALYTICS â†’"})})]})]})]}),r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Agent Overview"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading agent overview..."})]}),children:r.jsx(fp,{decisions:fe,queue:Ce,agent:e,onNavigate:y=>Z(y)})}),r.jsx("div",{style:{marginBottom:12},children:r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Performance"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading performance chart..."})]}),children:r.jsx(up,{decisions:fe,kpiTarget:e.kpiTarget})})}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:za,gap:12},children:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Agent Configuration"}),[["Strategy",ke],["Strategy Class",String((e==null?void 0:e.strategyClass)||"custom").toUpperCase()],["Risk",e.risk.toUpperCase()],["Capital / Cycle",`${e.capitalLimit} KAS`],["Portfolio Allocator","AUTO"],["Exec Mode",Ne.toUpperCase()],["Auto-Approve â‰¤",`${We.thresholdKas.toFixed(2)} KAS`],["Horizon",`${e.horizon} days`],["KPI Target",`${e.kpiTarget}% ROI`]].map(([y,U])=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${n.border}`},children:[r.jsx("span",{style:{fontSize:12,color:n.dim,...f},children:y}),r.jsx("span",{style:{fontSize:12,color:n.text,...f},children:U})]},y)),r.jsxs("div",{style:{fontSize:11,color:n.dim,marginTop:8},children:["Shared portfolio weighting and allocator caps are managed automatically. Operator funding is set with ",r.jsx("span",{style:{color:n.text,...f},children:"Capital / Cycle"}),"."]})]})})]}),P==="portfolio"&&r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Portfolio"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading portfolio allocator..."})]}),children:r.jsx(mp,{agents:ws,activeAgentId:i||(e==null?void 0:e.agentId),walletKas:(W==null?void 0:W.walletKas)||0,kasPriceUsd:(W==null?void 0:W.priceUsd)||0,lastDecision:fe[0]||null,summary:Ra,config:ja,onConfigPatch:Ma,onAgentOverridePatch:La,onSelectAgent:o,onRefresh:Pa,onDeleteAgent:a,onEditAgent:l})}),P==="intelligence"&&r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Intelligence"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading intelligence panel..."})]}),children:r.jsx(pp,{decisions:fe,queue:Ce,loading:ce,onRun:Ht})}),P==="analytics"&&r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Analytics"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading analytics panel..."})]}),children:r.jsx(xp,{decisions:fe,queue:Ce})}),P==="attribution"&&r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Attribution"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading attribution panel..."})]}),children:r.jsx(gp,{summary:ue})}),P==="alerts"&&r.jsx(g.Suspense,{fallback:r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Alerts"}),r.jsx("div",{style:{fontSize:12,color:n.dim},children:"Loading alerts panel..."})]}),children:r.jsx(hp,{config:Le,onPatch:ar,onToggleType:cr,onSave:Lt,onTest:Dt,saving:Ze,lastResult:or})}),P==="queue"&&r.jsx(np,{queue:Ce,wallet:t,onSign:Ca,onReject:wa,receiptConsistencyMetrics:Cs}),P==="wallet"&&r.jsx(cp,{agent:e,wallet:t,kasData:W,marketHistory:Me,lastDecision:fe[0]||null}),P==="swap"&&r.jsx("div",{style:{padding:"clamp(12px, 2vw, 22px) 0 0"},children:r.jsx(dp,{})}),P==="log"&&r.jsxs(ye,{p:0,children:[r.jsxs("div",{style:{padding:"12px 18px",borderBottom:`1px solid ${n.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{fontSize:11,color:n.dim,...f},children:[Y.length," entries Â· ",_t," KAS fees"]}),r.jsx(_e,{onClick:Ht,disabled:ce||M!=="RUNNING",size:"sm",children:ce?"...":"RUN CYCLE"})]}),r.jsx("div",{style:{maxHeight:520,overflowY:"auto"},children:Y.map((y,U)=>r.jsxs("div",{style:{display:"grid",gridTemplateColumns:ne?"74px 58px 1fr":"92px 72px 1fr 80px",gap:10,padding:"8px 18px",borderBottom:`1px solid ${n.border}`,alignItems:"center"},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:Co(y.ts)}),r.jsx("span",{style:{fontSize:11,color:du[y.type]||n.dim,fontWeight:700,...f},children:y.type}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:5},children:[r.jsx("div",{style:{fontSize:12,color:n.text,...f,lineHeight:1.4},children:y.msg}),((y==null?void 0:y.truthLabel)||(y==null?void 0:y.receiptProvenance))&&r.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[(y==null?void 0:y.truthLabel)&&r.jsx(J,{text:String(y.truthLabel),color:String(y.truthLabel).includes("CHAIN CONFIRMED")?n.ok:String(y.truthLabel).includes("BACKEND CONFIRMED")?n.purple:String(y.truthLabel).includes("BROADCASTED")?n.warn:n.dim}),(y==null?void 0:y.receiptProvenance)&&r.jsx(J,{text:String(y.receiptProvenance),color:String(y.receiptProvenance).toUpperCase()==="CHAIN"?n.ok:String(y.receiptProvenance).toUpperCase()==="BACKEND"?n.purple:n.warn})]})]}),!ne&&r.jsx("span",{style:{fontSize:11,color:n.dim,textAlign:"right",...f},children:y.fee!=null?`${y.fee} KAS`:"â€”"})]},U))})]}),P==="network"&&r.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ls,gap:14},children:[r.jsxs(ye,{p:18,style:{gridColumn:"1 / -1"},children:[r.jsx(Ge,{children:"Kaspa RPC Endpoint Policy"}),r.jsx("div",{style:{fontSize:11,color:n.dim,marginTop:8,marginBottom:10,...f},children:"Frontend runtime is env-driven for deterministic builds."}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:Da?"1fr":"1fr 1fr",gap:12},children:[r.jsxs("div",{style:{background:n.s2,border:`1px solid ${n.border}`,borderRadius:8,padding:"10px 12px"},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,marginBottom:4,...f},children:"PRIMARY RPC"}),r.jsx("div",{style:{fontSize:12,color:n.text,lineHeight:1.5,...f},children:pn?"Configured (hidden)":"UNSET"})]}),r.jsxs("div",{style:{background:n.s2,border:`1px solid ${n.border}`,borderRadius:8,padding:"10px 12px"},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,marginBottom:4,...f},children:"FALLBACK RPCS"}),Zr.length>0?r.jsxs("div",{style:{fontSize:11,color:n.text,lineHeight:1.4,...f},children:[Zr.length," configured (hidden)"]}):r.jsx("div",{style:{fontSize:11,color:n.dim,...f},children:"None configured"})]})]})]}),r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Live Kaspa Feed"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,marginTop:10},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${n.border}`,paddingBottom:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"REST Polling"}),r.jsx("span",{style:{fontSize:11,color:oe?n.ok:n.warn,fontWeight:700,...f},children:oe?"LIVE":"DEGRADED"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${n.border}`,paddingBottom:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"WS Stream"}),r.jsx("span",{style:{fontSize:11,color:Ye?n.ok:n.warn,fontWeight:700,...f},children:En?Ye?"CONNECTED":`RETRYING (${xt})`:"DISABLED"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Latest DAA"}),r.jsx("span",{style:{fontSize:11,color:n.text,fontWeight:700,...f},children:((Zs=W==null?void 0:W.dag)==null?void 0:Zs.daaScore)||"â€”"})]}),O&&r.jsx("div",{style:{fontSize:11,color:n.danger,lineHeight:1.4,marginTop:2,...f},children:String(O)})]})]}),r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Security Network Guardrails"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,marginTop:10},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${n.border}`,paddingBottom:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Active Network"}),r.jsx("span",{style:{fontSize:11,color:n.text,fontWeight:700,...f},children:Ct.toUpperCase()})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${n.border}`,paddingBottom:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Wallet Network Enforcement"}),r.jsx("span",{style:{fontSize:11,color:vr?n.ok:n.warn,fontWeight:700,...f},children:vr?"ON":"OFF"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${n.border}`,paddingBottom:6},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Accepted Prefixes"}),r.jsx("span",{style:{fontSize:11,color:n.text,fontWeight:700,...f},children:et.join(", ")})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{style:{fontSize:11,color:n.dim,...f},children:"Explorer"}),r.jsx("a",{href:en,target:"_blank",rel:"noreferrer",style:{fontSize:11,color:n.accent,...f},children:"open â†—"})]})]})]}),r.jsxs(ye,{p:18,style:{gridColumn:"1 / -1"},children:[r.jsx(Ge,{children:"Operator Notes"}),r.jsx("div",{style:{fontSize:11,color:n.dim,marginTop:8,lineHeight:1.5},children:"Configure network/RPC via env vars (`VITE_KAS_API_*`, `VITE_KAS_WS_URL_*`, `VITE_KAS_NETWORK*`) to keep rollout deterministic. For extension-level per-network custom RPC presets, use the extension Security tab."})]})]}),P==="controls"&&r.jsxs("div",{style:{display:"grid",gridTemplateColumns:Ls,gap:14},children:[r.jsxs(ye,{p:20,style:{gridColumn:"1 / -1"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsx(Ge,{children:"Strategy Configuration"}),r.jsx(_e,{onClick:()=>X(!T),variant:T?"warn":"primary",size:"sm",children:T?"Cancel":"Edit Strategy"})]}),!T&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:[r.jsx(J,{text:(e==null?void 0:e.strategyLabel)||"Custom",color:n.accent}),r.jsx(J,{text:((ei=e==null?void 0:e.strategyClass)==null?void 0:ei.toUpperCase())||"CUSTOM",color:n.text}),r.jsx(J,{text:`RISK: ${((ti=e==null?void 0:e.risk)==null?void 0:ti.toUpperCase())||"MEDIUM"}`,color:(e==null?void 0:e.risk)==="low"?n.ok:(e==null?void 0:e.risk)==="medium"?n.warn:n.danger})]}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:12},children:[["ROI Target",`${(e==null?void 0:e.kpiTarget)||12}%`],["Capital / Cycle",`${(e==null?void 0:e.capitalLimit)||5e3} KAS`],["Horizon",`${(e==null?void 0:e.horizon)||30} days`],["Auto-Approve â‰¤",`${(e==null?void 0:e.autoApproveThreshold)||50} KAS`]].map(([y,U])=>r.jsxs("div",{style:{background:n.s2,padding:"10px 14px",borderRadius:6},children:[r.jsx("div",{style:{fontSize:10,color:n.dim,...f,marginBottom:4},children:y}),r.jsx("div",{style:{fontSize:14,color:n.text,fontWeight:600,...f},children:U})]},y))})]}),T&&r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:n.dim,...f,marginBottom:10},children:"SELECT STRATEGY PRESET"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:ne?"1fr":"repeat(2, 1fr)",gap:12,marginBottom:16},children:je.map(y=>{var V;const U=se.strategyTemplate===y.id;return r.jsxs("div",{onClick:()=>L(y),style:{padding:"16px 18px",borderRadius:10,cursor:"pointer",border:`2px solid ${U?n.accent:n.border}`,background:U?`${n.accent}15`:n.s2,transition:"all 0.2s",boxShadow:U?`0 4px 12px ${n.accent}30`:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("span",{style:{fontSize:14,color:U?n.accent:n.text,fontWeight:700,...f},children:y.name}),r.jsx(J,{text:y.tag,color:y.tagColor||n.purple,size:"sm"})]}),r.jsxs("div",{style:{fontSize:11,color:n.dim,lineHeight:1.4},children:[(V=y.purpose)==null?void 0:V.slice(0,80),"..."]})]},y.id)})}),r.jsx("div",{style:{fontSize:11,color:n.dim,...f,marginBottom:10,marginTop:16},children:"CONFIGURE PARAMETERS"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:12,marginBottom:16},children:[r.jsx(Be,{label:"ROI Target",value:se.kpiTarget,onChange:y=>he({...se,kpiTarget:y}),type:"number",suffix:"%"}),r.jsx(Be,{label:"Capital / Cycle",value:se.capitalLimit,onChange:y=>he({...se,capitalLimit:y}),type:"number",suffix:"KAS"}),r.jsx(Be,{label:"Horizon (days)",value:se.horizon,onChange:y=>he({...se,horizon:Number(y)}),type:"number"}),r.jsx(Be,{label:"Auto-Approve â‰¤",value:se.autoApproveThreshold,onChange:y=>he({...se,autoApproveThreshold:y}),type:"number",suffix:"KAS"})]}),r.jsx("div",{style:{fontSize:11,color:n.dim,...f,marginBottom:10},children:"RISK TOLERANCE"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:16},children:Qo.map(y=>{const U=se.risk===y.v;return r.jsx("div",{onClick:()=>he({...se,risk:y.v}),style:{padding:"12px 10px",borderRadius:4,cursor:"pointer",border:`1px solid ${U?n.accent:n.border}`,background:U?n.aLow:n.s2,textAlign:"center",transition:"all 0.15s"},children:r.jsx("div",{style:{fontSize:12,color:U?n.accent:n.text,fontWeight:600,...f},children:y.l})},y.v)})}),r.jsx("div",{style:{fontSize:11,color:n.dim,...f,marginBottom:10},children:"EXECUTION MODE"}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:16},children:cn.map(y=>{const U=se.execMode===y.v;return r.jsx("div",{onClick:()=>he({...se,execMode:y.v}),style:{padding:"12px 10px",borderRadius:4,cursor:"pointer",border:`1px solid ${U?n.accent:n.border}`,background:U?n.aLow:n.s2,textAlign:"center",transition:"all 0.15s"},children:r.jsx("div",{style:{fontSize:11,color:U?n.accent:n.text,fontWeight:600,...f},children:y.l})},y.v)})}),r.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[r.jsx(_e,{onClick:()=>X(!1),variant:"ghost",children:"Cancel"}),r.jsx(_e,{onClick:pe,children:"Save Changes"})]})]})]}),r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"Execution Mode"}),cn.map(y=>{const U=Ne===y.v;return r.jsxs("div",{onClick:()=>$e(y.v),style:{padding:"12px 14px",borderRadius:4,marginBottom:8,cursor:"pointer",border:`1px solid ${U?n.accent:n.border}`,background:U?n.aLow:n.s2,transition:"all 0.15s"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:3},children:[r.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:U?n.accent:n.muted,flexShrink:0}}),r.jsx("span",{style:{fontSize:12,color:U?n.accent:n.text,fontWeight:700,...f},children:y.l})]}),r.jsx("div",{style:{fontSize:11,color:n.dim,marginLeft:20},children:y.desc})]},y.v)})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsxs(ye,{p:18,children:[r.jsx(Ge,{children:"âš¡ Quick Actions"}),r.jsxs("div",{style:{fontSize:11,color:n.dim,...f,marginBottom:10},children:["Auto cycle cadence: every ",Er,"s Â· Next cycle in ",_n]}),r.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[r.jsxs(_e,{onClick:Ht,disabled:ce||M!=="RUNNING",size:"sm",children:[ce?"â³":"ðŸš€"," ",ce?"RUNNING":"RUN CYCLE"]}),r.jsx(_e,{onClick:()=>it(y=>!y),variant:Te?"warn":"primary",size:"sm",children:Te?"ðŸŸ¢ AUTO-TRADE ON":"ðŸ”´ AUTO-TRADE OFF"}),r.jsx(_e,{onClick:()=>D({type:M==="RUNNING"?"PAUSE":"RESUME"}),variant:"ghost",size:"sm",children:M==="RUNNING"?"â¸ PAUSE AGENT":"â–¶ï¸ RESUME AGENT"}),r.jsx(_e,{onClick:Rs,variant:"ghost",size:"sm",title:"Download agent config as JSON backup",children:"EXPORT"}),r.jsx(_e,{onClick:Ms,variant:"danger",size:"sm",children:"ðŸ›‘ KILL-SWITCH"})]})]}),r.jsxs(ye,{p:18,children:[r.jsxs(Ge,{children:["Active Risk Limits â€” ",((ri=e==null?void 0:e.risk)==null?void 0:ri.toUpperCase())||"MEDIUM"]}),[["Max Single Exposure",(e==null?void 0:e.risk)==="low"?"5%":(e==null?void 0:e.risk)==="medium"?"10%":"20%",n.warn],["Drawdown Halt",(e==null?void 0:e.risk)==="low"?"-8%":(e==null?void 0:e.risk)==="medium"?"-15%":"-25%",n.danger],["Confidence Floor","0.75",n.dim],["Kelly Cap",(e==null?void 0:e.risk)==="low"?"10%":(e==null?void 0:e.risk)==="medium"?"20%":"40%",n.warn],["Auto-Approve â‰¤",`${We.thresholdKas.toFixed(2)} KAS`,n.accent]].map(([y,U,V])=>r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"7px 0",borderBottom:`1px solid ${n.border}`},children:[r.jsx("span",{style:{fontSize:12,color:n.dim,...f},children:y}),r.jsx("span",{style:{fontSize:12,color:V,fontWeight:700,...f},children:U})]},y))]})]})]})]})}const vs="forgeos.signin.session.v1",Ea=24*60*60*1e3;function Qr(){const e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e,t=>t.toString(16).padStart(2,"0")).join("")}function io(e,t,s){const i=new Date,o=new Date(i.getTime()+Ea);return["Sign in to Forge.OS","","Domain: forge-os.xyz",`Address: ${e}`,`Nonce: ${s}`,`Issued At: ${i.toISOString()}`,`Expires At: ${o.toISOString()}`,`Network: ${t}`,"","This request will not trigger a blockchain transaction or cost any fees."].join(`
`)}function Aa(e,t,s,i,o=!1){const a=Date.now();return{address:e,network:t,provider:s,nonce:i,signedAt:a,expiresAt:a+Ea,skipSigning:o}}function va(e){try{localStorage.setItem(vs,JSON.stringify(e))}catch{}}function yp(){try{const e=localStorage.getItem(vs);if(!e)return null;const t=JSON.parse(e);return!(t!=null&&t.address)||!(t!=null&&t.nonce)||!(t!=null&&t.expiresAt)?null:Date.now()>t.expiresAt?(Ta(),null):t}catch{return null}}function Ta(){try{localStorage.removeItem(vs)}catch{}}const ir={width:28,height:28,borderRadius:6,display:"block",objectFit:"cover"};function _p(){return r.jsx("img",{src:"/forge-os-icon3.png",style:ir,alt:""})}function Sp(){return r.jsx("img",{src:"/wallets/kasware.png",style:ir,alt:""})}function bp(){return r.jsx("img",{src:"/wallets/kastle.svg",style:{...ir,objectFit:"contain"},alt:""})}function Ep(){return r.jsx("img",{src:"/wallets/kaspium.png",style:ir,alt:""})}function Ap(){return r.jsx("img",{src:"/wallets/tangem.webp",style:ir,alt:""})}function vp(){return r.jsx("img",{src:"/wallets/onekey.png",style:ir,alt:""})}const Tp={forgeos:_p,kasware:Sp,kastle:bp,kaspium:Ep,tangem:Ap,onekey:vp};function Cp(e){var t,s;return[{id:"forgeos",label:"Forge-OS",icon:"âš¡",desc:"Your Forge-OS wallet â€” connect approval proves ownership",detected:!0,supportsSign:!1},{id:"kasware",label:"Kasware",icon:"â¬¡",desc:"Browser extension â€” direct signing",detected:e.kasware,supportsSign:!!((t=e.kaswareMethods)!=null&&t.signMessage),installUrl:"https://kasware.xyz"},{id:"kastle",label:"Kastle",icon:"â—†",desc:"Browser extension â€” direct signing",detected:e.kastle,supportsSign:!!((s=e.kastleMethods)!=null&&s.signMessage),installUrl:"https://kastle.xyz"},{id:"kaspium",label:"Kaspium",icon:"ðŸ“±",desc:"Mobile wallet â€” paste your address",detected:!0,supportsSign:!1,needsAddressInput:!0},{id:"tangem",label:"Tangem",icon:"ðŸ’³",desc:"Hardware card â€” paste your address",detected:!0,supportsSign:!1,needsAddressInput:!0},{id:"onekey",label:"OneKey",icon:"ðŸ”‘",desc:"Hardware wallet â€” paste your address",detected:!0,supportsSign:!1,needsAddressInput:!0}]}function wp({onSignIn:e,onClose:t}){const s=ve.detect(),i=Cp(s),[o,a]=g.useState("wallet_list"),[l,c]=g.useState(null),[d,u]=g.useState(""),[m,h]=g.useState(null),[v,A]=g.useState(!1),[_,k]=g.useState(null),j=async E=>{if(c(E),h(null),A(!1),E.needsAddressInput){a("address_input");return}a("connecting");try{let w="";if(E.id==="forgeos"){const F=await ve.connectForgeOS();w=(F==null?void 0:F.address)??""}else if(E.id==="kasware"){const F=await ve.connectKasware();w=(F==null?void 0:F.address)??""}else if(E.id==="kastle"){const F=await ve.connectKastle();w=(F==null?void 0:F.address)??""}if(!w)throw new Error("No address returned from wallet.");const K=Qr();k({address:w,provider:E.id,nonce:K}),E.supportsSign?(a("signing"),await R(w,E.id,K,!1)):I(w,E.id,K,!0)}catch(w){const K=String((w==null?void 0:w.message)??w);K.toLowerCase().includes("cancel")||K.toLowerCase().includes("denied")||K.toLowerCase().includes("reject")?h("Wallet connection cancelled."):K.toLowerCase().includes("network")?h(`Wrong network. Please switch your wallet to ${Ie}.`):h(`Connection failed: ${K}`),a("wallet_list")}},C=async()=>{if(!l)return;const E=d.trim();if(!er(E,et)){h("Please enter a valid Kaspa address.");return}a("connecting"),h(null);try{let w;l.id==="kaspium"?w=ve.connectKaspium(E):w=await ve.connectHardwareBridge(l.id,E);const K=(w==null?void 0:w.address)??E,F=Qr();I(K,l.id,F,!0)}catch(w){h(`Connection failed: ${String((w==null?void 0:w.message)??w)}`),a("address_input")}},R=async(E,w,K,F)=>{try{const H=io(E,Ie,K);w==="kasware"?await ve.signMessageKasware(H):w==="kastle"?await ve.signMessageKastle(H):w==="forgeos"&&await ve.signMessageForgeOS(H),I(E,w,K,!1)}catch(H){const G=String((H==null?void 0:H.message)??H);G.toLowerCase().includes("cancel")||G.toLowerCase().includes("reject")||G.toLowerCase().includes("denied")?(A(!0),a("signing")):(h(`Signature failed: ${G}`),a("wallet_list"))}},I=(E,w,K,F)=>{const H=Aa(E,Ie,w,K,F);va(H),e(H,{address:E,network:Ie,provider:w})},p=E=>{const w=Qr();I(E.address,E.provider??"managed",w,!0)},x={position:"fixed",inset:0,background:"rgba(0,0,0,0.82)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:500,padding:20};return o==="creating"?r.jsx(zo,{onConnect:p,onClose:t}):r.jsx("div",{"data-testid":"signin-modal",style:x,onClick:E=>E.target===E.currentTarget&&t(),children:r.jsxs(ye,{p:0,style:{maxWidth:480,width:"100%",position:"relative",overflow:"hidden"},children:[r.jsxs("div",{style:{padding:"18px 20px 14px",borderBottom:`1px solid ${n.border}`,display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:700,color:n.text,...f,marginBottom:3},children:o==="address_input"?`Connect ${(l==null?void 0:l.label)??"Wallet"}`:o==="connecting"||o==="signing"?"Connectingâ€¦":"Sign In to Forge.OS"}),r.jsx("div",{style:{fontSize:9,color:n.dim},children:o==="wallet_list"?"Connect your Kaspa wallet to authenticate. No email, no password.":o==="address_input"?"Paste your wallet address to connect.":o==="signing"?"Confirm the sign-in message in your wallet.":""})]}),r.jsx("button",{"data-testid":"signin-modal-close",onClick:t,style:{background:"none",border:"none",color:n.dim,fontSize:18,cursor:"pointer",lineHeight:1,padding:"0 0 0 12px",flexShrink:0},children:"Ã—"})]}),r.jsxs("div",{style:{padding:"16px 20px 20px"},children:[o==="wallet_list"&&r.jsxs("div",{"data-testid":"signin-wallet-list",style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsx(Bn,{option:i[0],onSelect:()=>j(i[0]),primary:!0},"forgeos"),r.jsx("div",{style:{fontSize:7,color:n.dim,...f,letterSpacing:"0.1em",marginTop:4,marginBottom:2},children:"OTHER BROWSER WALLETS"}),i.slice(1,3).map(E=>r.jsx(Bn,{option:E,onSelect:()=>j(E)},E.id)),r.jsx("div",{style:{fontSize:7,color:n.dim,...f,letterSpacing:"0.1em",marginTop:4,marginBottom:2},children:"HARDWARE & MOBILE"}),i.slice(3).map(E=>r.jsx(Bn,{option:E,onSelect:()=>j(E)},E.id)),r.jsx("div",{style:{height:1,background:n.border,margin:"6px 0"}}),r.jsxs("button",{"data-testid":"signin-create-wallet",onClick:()=>a("creating"),style:{background:`linear-gradient(145deg, ${n.accent}12 0%, rgba(8,13,20,0.5) 100%)`,border:`1px solid ${n.accent}30`,borderRadius:10,padding:"12px 14px",cursor:"pointer",textAlign:"left",color:n.text,display:"flex",alignItems:"center",gap:12,transition:"border-color 0.15s"},onMouseEnter:E=>E.currentTarget.style.borderColor=`${n.accent}60`,onMouseLeave:E=>E.currentTarget.style.borderColor=`${n.accent}30`,children:[r.jsx("span",{style:{fontSize:20,flexShrink:0},children:"âœ¦"}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:10,fontWeight:700,color:n.accent,...f,marginBottom:2},children:"CREATE NEW WALLET"}),r.jsx("div",{style:{fontSize:9,color:n.dim},children:"Generate a new 12 or 24-word Kaspa wallet â€” compatible with all Kaspa wallets."})]})]}),m&&r.jsx(oo,{message:m}),r.jsx("div",{style:{fontSize:8,color:n.muted,lineHeight:1.5,marginTop:4},children:"Your wallet signs a one-time message to prove ownership of your address. No keys are shared. No transactions are made."})]}),o==="address_input"&&l&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.6},children:l.id==="kaspium"?"Open Kaspium on your phone, copy your Kaspa address, then paste it below.":`Open your ${l.label} app, find your Kaspa address, and paste it below.`}),r.jsx("textarea",{"data-testid":"signin-manual-address-input",value:d,onChange:E=>{u(E.target.value),h(null)},placeholder:"kaspa:qqe...",rows:3,style:{width:"100%",boxSizing:"border-box",background:"rgba(8,13,20,0.7)",border:`1px solid ${m?n.danger:n.border}`,borderRadius:8,padding:"10px 12px",color:n.text,fontSize:10,...f,resize:"none",lineHeight:1.5,outline:"none"}}),m&&r.jsx(oo,{message:m}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx("button",{"data-testid":"signin-manual-address-back",onClick:()=>{a("wallet_list"),h(null)},style:ao,children:"â† BACK"}),r.jsx("button",{"data-testid":"signin-manual-address-connect",onClick:C,disabled:!er(d.trim(),et),style:co(er(d.trim(),et)),children:"CONNECT â†’"})]})]}),o==="connecting"&&r.jsxs("div",{style:{textAlign:"center",padding:"28px 0"},children:[r.jsx("div",{style:{width:36,height:36,borderRadius:"50%",border:`2px solid ${n.border}`,borderTopColor:n.accent,animation:"spin 0.8s linear infinite",margin:"0 auto 14px"}}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"Connecting to walletâ€¦"}),r.jsx("div",{style:{fontSize:8,color:n.muted,marginTop:6},children:"Check your wallet extension for a connection prompt."}),r.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),o==="signing"&&_&&r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:14},children:v?r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsxs("div",{style:{background:`${n.warn}12`,border:`1px solid ${n.warn}40`,borderRadius:8,padding:"10px 14px"},children:[r.jsx("div",{style:{fontSize:9,color:n.warn,fontWeight:700,...f,marginBottom:4},children:"âš  Signature Declined"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.5},children:"You rejected the sign-in message. You can connect without signing, but ownership cannot be cryptographically verified."})]}),r.jsxs("div",{style:{display:"flex",gap:8},children:[r.jsx("button",{"data-testid":"signin-signature-back",onClick:()=>{a("wallet_list"),A(!1)},style:ao,children:"â† BACK"}),r.jsx("button",{"data-testid":"signin-connect-anyway",onClick:()=>I(_.address,_.provider,_.nonce,!0),style:co(!0),children:"CONNECT ANYWAY â†’"})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{textAlign:"center",padding:"14px 0"},children:[r.jsx("div",{style:{width:36,height:36,borderRadius:"50%",border:`2px solid ${n.border}`,borderTopColor:n.accent,animation:"spin 0.8s linear infinite",margin:"0 auto 14px"}}),r.jsx("div",{style:{fontSize:10,color:n.dim,...f},children:"Waiting for signatureâ€¦"}),r.jsx("div",{style:{fontSize:8,color:n.muted,marginTop:6},children:"Approve the sign-in message in your wallet. No transaction will be sent."}),r.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),r.jsxs("div",{style:{background:"rgba(8,13,20,0.7)",border:`1px solid ${n.border}`,borderRadius:8,padding:"10px 12px"},children:[r.jsx("div",{style:{fontSize:7,color:n.dim,...f,letterSpacing:"0.1em",marginBottom:6},children:"MESSAGE BEING SIGNED"}),r.jsx("pre",{style:{fontSize:8,color:n.text,...f,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,wordBreak:"break-all"},children:io(_.address,Ie,_.nonce)})]}),r.jsxs("div",{style:{fontSize:8,color:n.muted,lineHeight:1.5},children:["âœ“ Domain-bound â€” this message only works on forge-os.xyz.",r.jsx("br",{}),"âœ“ No transaction â€” signing a message has no gas fee.",r.jsx("br",{}),"âœ“ One-time nonce â€” prevents replay attacks."]})]})})]})]})})}function Bn({option:e,onSelect:t,primary:s=!1}){const i=!e.detected,o=Tp[e.id],a=s?`${n.accent}50`:n.border,l=s?`linear-gradient(145deg, ${n.accent}10 0%, rgba(8,13,20,0.7) 100%)`:"rgba(11,17,24,0.7)";return r.jsxs("button",{"data-testid":`signin-wallet-option-${e.id}`,onClick:i?()=>window.open(e.installUrl,"_blank"):t,style:{background:l,border:`1px solid ${a}`,borderRadius:s?10:8,padding:s?"12px 14px":"9px 12px",cursor:i?"default":"pointer",textAlign:"left",color:n.text,display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,transition:"border-color 0.15s, background 0.15s",width:"100%"},onMouseEnter:c=>{i||(c.currentTarget.style.borderColor=`${n.accent}70`)},onMouseLeave:c=>{c.currentTarget.style.borderColor=a},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:28,height:28,flexShrink:0,opacity:i?.45:1},children:o?r.jsx(o,{}):r.jsx("span",{style:{fontSize:20,lineHeight:"28px",display:"block",textAlign:"center"},children:e.icon})}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:s?11:10,fontWeight:700,color:i?n.dim:n.text,...f,marginBottom:2},children:[e.label,s&&!i&&r.jsx("span",{style:{fontSize:7,color:n.accent,marginLeft:7,background:`${n.accent}15`,border:`1px solid ${n.accent}35`,borderRadius:3,padding:"1px 5px",letterSpacing:"0.08em"},children:"NATIVE"}),!s&&e.supportsSign&&!i&&r.jsx("span",{style:{fontSize:7,color:n.ok,marginLeft:6,border:`1px solid ${n.ok}40`,borderRadius:3,padding:"1px 4px",letterSpacing:"0.08em"},children:"SIGN"})]}),r.jsx("div",{style:{fontSize:8,color:n.muted},children:e.desc})]})]}),i?r.jsx("span",{style:{fontSize:8,color:n.accent,...f,letterSpacing:"0.06em",flexShrink:0},children:"INSTALL â†—"}):r.jsx("span",{style:{fontSize:s?14:12,color:s?n.accent:n.dim,flexShrink:0},children:"â€º"})]})}function oo({message:e}){return r.jsx("div",{style:{background:`${n.danger}12`,border:`1px solid ${n.danger}40`,borderRadius:8,padding:"8px 12px",fontSize:9,color:n.danger,lineHeight:1.5},children:e})}const ao={flex:1,background:"rgba(33,48,67,0.4)",border:`1px solid ${n.border}`,borderRadius:6,padding:"8px 0",color:n.dim,fontSize:9,cursor:"pointer",fontFamily:"inherit",letterSpacing:"0.08em"},co=e=>({flex:2,background:e?`linear-gradient(90deg, ${n.accent}, #7BE9CF)`:`${n.accent}30`,border:"none",borderRadius:6,padding:"8px 0",color:e?"#04110E":n.dim,fontSize:9,fontWeight:700,cursor:e?"pointer":"not-allowed",fontFamily:"inherit",letterSpacing:"0.08em"});function kp({onSignIn:e,onOpenFullModal:t,onClose:s}){const[i,o]=g.useState("connecting"),[a,l]=g.useState(null),[c,d]=g.useState(null),[u,m]=g.useState(!0);g.useEffect(()=>{let _=!1,k,j,C=!1;const R=async p=>{if(C)return;C=!0,p&&m(!0);const x=await ve.probeForgeOSBridgeStatus(900).catch(()=>null);_||(x&&d(x),p&&m(!1),C=!1)},I=async()=>{o("connecting"),l(null);const p=window.setTimeout(()=>{_||o("waiting_extension")},420);k=p;try{const x=await ve.connectForgeOS();if(clearTimeout(p),_)return;x!=null&&x.address?h(x.address,x.network??Ie):(l("No Forge-OS wallet found."),o("not_found"))}catch(x){if(clearTimeout(p),_)return;const E=String((x==null?void 0:x.message)??x??"Auto-connect failed."),w=E.toLowerCase();if(w.includes("cancel")||w.includes("reject")){s();return}w.includes("extension-auth connect is required")||w.includes("no forge-os wallet")||w.includes("wallet bridge detected")||w.includes("bridge detected")||w.includes("bridge unavailable")||w.includes("not found")||w.includes("timed out")?l("Forge-OS extension bridge was not detected on this tab. Reload the extension, refresh forge-os.xyz, and set Site access to allow this domain."):l(E),o("not_found")}};return(async()=>(await R(!0),!_&&(j=setInterval(()=>{R(!1).catch(()=>{})},2500),I())))(),()=>{_=!0,k&&clearTimeout(k),j&&clearInterval(j)}},[]);const h=(_,k)=>{const j=Qr(),C=Aa(_,k,"forgeos",j,!0);va(C),e(C,{address:_,network:k,provider:"forgeos"})},v={position:"fixed",inset:0,background:"rgba(0,0,0,0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:500,padding:20},A={background:"linear-gradient(160deg, rgba(14,22,32,0.98) 0%, rgba(8,13,20,0.98) 100%)",border:`1px solid ${n.accent}22`,borderRadius:14,padding:"28px 28px 24px",maxWidth:360,width:"100%",boxShadow:"0 0 48px rgba(57,221,182,0.08), 0 16px 48px rgba(0,0,0,0.6)",position:"relative"};return r.jsx("div",{style:v,onClick:_=>_.target===_.currentTarget&&s(),children:r.jsxs("div",{style:A,children:[r.jsx("button",{onClick:s,style:{position:"absolute",top:12,right:14,background:"none",border:"none",color:n.dim,fontSize:18,cursor:"pointer",lineHeight:1},children:"Ã—"}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:20},children:[r.jsx("img",{src:"/forge-os-icon3.png",width:36,height:36,style:{objectFit:"contain",filter:"drop-shadow(0 0 8px rgba(57,221,182,0.5))"},alt:""}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:12,fontWeight:700,...f,letterSpacing:"0.1em"},children:[r.jsx("span",{style:{color:n.accent},children:"FORGE"}),r.jsx("span",{style:{color:n.text},children:"-OS"})]}),r.jsx("div",{style:{fontSize:8,color:n.dim,letterSpacing:"0.06em"},children:"Wallet Authentication"})]})]}),r.jsxs("div",{style:{marginBottom:14,border:`1px solid ${n.border}`,borderRadius:8,background:"rgba(6,10,16,0.66)",padding:"9px 10px"},children:[r.jsx("div",{style:{fontSize:8,color:n.dim,letterSpacing:"0.08em",...f,marginBottom:8},children:"EXTENSION BRIDGE STATUS"}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,marginBottom:6},children:[r.jsx("span",{style:{fontSize:8,color:n.dim,letterSpacing:"0.06em",...f},children:"Provider Injected"}),r.jsx("span",{style:{fontSize:8,color:c!=null&&c.providerInjected?n.ok:n.dim,...f},children:c!=null&&c.providerInjected?"READY":u?"CHECKING":"NOT FOUND"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,marginBottom:6},children:[r.jsx("span",{style:{fontSize:8,color:n.dim,letterSpacing:"0.06em",...f},children:"Content Bridge"}),r.jsx("span",{style:{fontSize:8,color:c!=null&&c.bridgeReachable?n.ok:n.dim,...f},children:c!=null&&c.bridgeReachable?"READY":u?"CHECKING":"NOT REACHABLE"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[r.jsx("span",{style:{fontSize:8,color:n.dim,letterSpacing:"0.06em",...f},children:"Managed Wallet Cache"}),r.jsx("span",{style:{fontSize:8,color:c!=null&&c.managedWalletPresent?n.ok:n.dim,...f},children:c!=null&&c.managedWalletPresent?"FOUND":u?"CHECKING":"EMPTY"})]}),!u&&(c==null?void 0:c.transport)==="none"&&r.jsx("div",{style:{marginTop:8,fontSize:8,color:n.warn,lineHeight:1.4},children:"No active extension transport on this tab. Check Chrome extension site access for `forge-os.xyz`."})]}),(i==="connecting"||i==="waiting_extension")&&r.jsxs("div",{style:{textAlign:"center",padding:"8px 0 16px"},children:[r.jsx("div",{style:{width:38,height:38,borderRadius:"50%",border:`2px solid ${n.border}`,borderTopColor:n.accent,animation:"spin 0.8s linear infinite",margin:"0 auto 16px"}}),r.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),r.jsx("div",{style:{fontSize:11,color:n.text,fontWeight:700,...f,marginBottom:6},children:i==="waiting_extension"?"Waiting for extension":"Connectingâ€¦"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.6},children:i==="waiting_extension"?"If popup appears, enter your password to continue.":"Detecting your Forge-OS walletâ€¦"})]}),i==="not_found"&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a?r.jsx("div",{style:{background:`${n.danger}10`,border:`1px solid ${n.danger}35`,borderRadius:8,padding:"10px 12px",fontSize:9,color:n.danger,lineHeight:1.5},children:a}):r.jsxs("div",{style:{background:`${n.accent}08`,border:`1px solid ${n.accent}20`,borderRadius:8,padding:"12px 14px"},children:[r.jsx("div",{style:{fontSize:10,color:n.text,fontWeight:700,...f,marginBottom:4},children:"No Forge-OS wallet found"}),r.jsx("div",{style:{fontSize:9,color:n.dim,lineHeight:1.6},children:"Reload the extension, refresh forge-os.xyz, and ensure extension site access is enabled for this domain."})]}),r.jsx("button",{onClick:t,style:{width:"100%",background:`linear-gradient(90deg, ${n.accent}, #7BE9CF)`,border:"none",borderRadius:8,padding:"11px 0",cursor:"pointer",color:"#04110E",fontSize:11,fontWeight:700,...f,letterSpacing:"0.08em",boxShadow:"0 4px 16px rgba(57,221,182,0.25)"},children:"CREATE / IMPORT WALLET â†’"}),r.jsx("button",{onClick:t,style:{width:"100%",background:"transparent",border:`1px solid ${n.border}`,borderRadius:8,padding:"9px 0",cursor:"pointer",color:n.dim,fontSize:9,...f,letterSpacing:"0.06em"},children:"Use another wallet"})]})]})})}const zn="forgeos.session.agents.v2",lo="forgeos.session.activeAgent.v2";function Np(){const[e,t]=g.useState(null),[s,i]=g.useState(()=>yp()),[o,a]=g.useState(!1),[l,c]=g.useState(!1),[d,u]=g.useState(!1),[m,h]=g.useState(()=>{try{if(typeof window>"u")return[];const b=window.localStorage.getItem(zn);if(b){const M=JSON.parse(b);if(Array.isArray(M))return M.slice(0,24)}}catch{}return[]}),[v,A]=g.useState(()=>{try{return typeof window>"u"?"":window.localStorage.getItem(lo)||""}catch{return""}}),[_,k]=g.useState(()=>{try{if(typeof window>"u")return"dashboard";const b=window.localStorage.getItem(zn);if(b){const M=JSON.parse(b);if(Array.isArray(M)&&M.length>0)return"dashboard"}}catch{}return"dashboard"}),[j,C]=g.useState(null),[R,I]=g.useState(!1),[p,x]=g.useState(typeof window<"u"?window.innerWidth:1280),E=b=>{t(b),k("dashboard")},w=(b,M)=>{i(b),t(M),a(!1),k("dashboard")},K=()=>{window.confirm(`Disconnect wallet?

Your agent configurations will be preserved and restored on next connect.`)&&(Ta(),i(null),t(null))},F=b=>{h(M=>[...M.filter(Y=>(Y==null?void 0:Y.agentId)!==(b==null?void 0:b.agentId)),b].slice(-24)),A(String((b==null?void 0:b.agentId)||"")),C(null),k("dashboard")},H=g.useMemo(()=>m.find(b=>String(b==null?void 0:b.agentId)===String(v))||m[m.length-1]||null,[v,m]),G=Ie==="mainnet",B=g.useMemo(()=>dc.filter(b=>b.id==="mainnet"||b.id.startsWith("testnet")),[]),P=p<860,Z=p<640,re=b=>{if(!(typeof window>"u"||R||b===Ie||(e||m.length>0)&&!window.confirm("Switching networks will reset the current wallet session and agent state. Continue?"))){I(!0);try{window.localStorage.setItem("forgeos.network",b);const ie=new URL(window.location.href);ie.searchParams.set("network",b),window.location.assign(ie.toString())}catch{I(!1)}}};return g.useEffect(()=>{if(typeof window>"u")return;const b=()=>x(window.innerWidth);return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),g.useEffect(()=>{try{window.localStorage.setItem(zn,JSON.stringify(m)),window.postMessage({__forgeos__:!0,type:"FORGEOS_AGENT_SNAPSHOT",agents:m,activeAgentId:v,network:Ie,updatedAt:Date.now()},"*")}catch{}},[m,v]),g.useEffect(()=>{try{window.localStorage.setItem(lo,v)}catch{}},[v]),g.useEffect(()=>{if(e||d||o||l)return;let b=!1;return u(!0),(async()=>{const M=await ve.probeForgeOSBridgeStatus(900).catch(()=>null);b||!M||M.transport!=="none"&&c(!0)})(),()=>{b=!0}},[e,d,o,l]),e?r.jsxs("div",{className:P?"forge-shell":"forge-shell forge-ui-scale",style:{color:n.text},children:[r.jsx(Mo,{}),r.jsxs("div",{className:"forge-content",style:{minHeight:"100vh"},children:[P?r.jsx(ol,{networkLabel:Ct,networkProfileId:Ar.id,networkOptions:B,isMainnet:G,isCompactMobile:Z,switchingNetwork:R,view:_,activeAgent:H,agents:m,wallet:e,onSwitchNetwork:re,onOpenCreate:()=>k("create"),onSelectAgent:b=>{A(b),k("dashboard")},onDisconnect:K}):r.jsxs("div",{className:"forge-topbar",style:{borderBottom:`1px solid ${n.border}`,padding:"10px clamp(12px, 2vw, 20px)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:0},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,justifyContent:"flex-start"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,flexShrink:0},children:[r.jsx("img",{src:"/forge-os-icon3.png",alt:"Forge-OS",style:{width:22,height:22,objectFit:"contain",filter:"drop-shadow(0 0 8px rgba(57,221,182,0.5))"}}),r.jsxs("div",{style:{fontSize:12,fontWeight:700,letterSpacing:"0.12em",...f},children:[r.jsx("span",{style:{color:n.accent},children:"FORGE"}),r.jsx("span",{style:{color:n.text},children:"-OS"})]})]}),r.jsx("div",{style:{width:1,height:14,background:"transparent",margin:"0 4px"}})]}),r.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",maxWidth:"100%",overflowX:"visible",paddingBottom:0},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,border:`1px solid ${G?n.warn:n.ok}50`,background:G?n.wLow:n.oLow,borderRadius:6,padding:"4px 6px"},children:[r.jsx("span",{style:{fontSize:10,color:G?n.warn:n.ok,letterSpacing:"0.08em",...f},children:Ct.toUpperCase()}),r.jsx("select",{"data-testid":"network-select",value:Ar.id,onChange:b=>re(b.target.value),disabled:R,style:{background:"transparent",color:n.text,border:`1px solid ${n.border}`,borderRadius:4,padding:"4px 8px",fontSize:10,letterSpacing:"0.05em",...f},title:"Switch runtime Kaspa network profile",children:B.map(b=>r.jsx("option",{value:b.id,style:{background:n.s1,color:n.text},children:b.label},b.id))})]}),r.jsx("button",{onClick:()=>k("create"),style:{background:_==="create"?n.s2:"none",border:`1px solid ${_==="create"?n.border:"transparent"}`,color:_==="create"?n.text:n.dim,padding:"5px 14px",borderRadius:4,fontSize:11,cursor:"pointer",...f},children:"NEW AGENT"}),m.map(b=>{const M=String((H==null?void 0:H.agentId)||"")===String((b==null?void 0:b.agentId)||"");return r.jsx("button",{onClick:()=>{A(String((b==null?void 0:b.agentId)||"")),k("dashboard")},style:{background:M&&_==="dashboard"?n.s2:"none",border:`1px solid ${M&&_==="dashboard"?n.accent:"transparent"}`,color:M?n.accent:n.dim,padding:"5px 10px",borderRadius:4,fontSize:11,cursor:"pointer",maxWidth:140,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",...f},title:String((b==null?void 0:b.name)||"Agent"),children:String((b==null?void 0:b.name)||"AGENT")},String((b==null?void 0:b.agentId)||(b==null?void 0:b.name)||Math.random()))}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"5px 12px",border:`1px solid ${n.border}`,borderRadius:4},children:[r.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:(e==null?void 0:e.provider)==="demo"?n.warn:n.ok}}),r.jsx("span",{style:{fontSize:10,color:n.dim,letterSpacing:"0.08em",...f},children:ht(e==null?void 0:e.address)})]}),r.jsx(_e,{onClick:K,variant:"ghost",size:"sm",children:"DISCONNECT"})]})]}),_==="create"?r.jsx(cd,{wallet:e,onComplete:F,editAgent:j,onCancel:()=>{C(null),k("dashboard")}}):!H&&m.length===0?r.jsx(so,{agent:{name:"",agentId:"",capitalLimit:"0",risk:"",strategyLabel:"",strategyTemplate:"",strategyClass:"",horizon:0,kpiTarget:"",autoApproveThreshold:"",execMode:"manual"},agents:[],activeAgentId:"",onSelectAgent:()=>{},onDeleteAgent:()=>{},onEditAgent:()=>{},wallet:e}):r.jsx(so,{agent:H,agents:m,activeAgentId:v,onSelectAgent:b=>{A(b),k("dashboard")},onDeleteAgent:b=>{h(M=>M.filter(ie=>String(ie==null?void 0:ie.agentId)!==String(b))),String(v)===String(b)&&(A(""),k("dashboard"))},onEditAgent:b=>{C(b),A(String((b==null?void 0:b.agentId)||"")),k("create")},wallet:e})]})]}):r.jsxs("div",{className:P?"":"forge-ui-scale",style:P?{minHeight:"100dvh",overflowX:"hidden"}:void 0,children:[r.jsx(il,{onConnect:E,onSignInClick:()=>{c(!1),a(!0)}}),l&&r.jsx(kp,{onSignIn:(b,M)=>{c(!1),w(b,M)},onOpenFullModal:()=>{c(!1),a(!0)},onClose:()=>c(!1)}),o&&r.jsx(wp,{onSignIn:w,onClose:()=>a(!1)})]})}class Ip extends To.Component{constructor(s){super(s);kt(this,"resetApp",()=>{if(typeof window>"u")return;const s=new URL(window.location.href);s.searchParams.set("_recover",Date.now().toString()),window.location.replace(s.toString())});kt(this,"clearLocalStateAndReload",()=>{if(!(typeof window>"u")){try{const s=Object.keys(window.localStorage);for(const i of s)i.startsWith("forgeos.")&&window.localStorage.removeItem(i)}catch{}this.resetApp()}});this.state={hasError:!1,message:""}}static getDerivedStateFromError(s){return{hasError:!0,message:(s==null?void 0:s.message)||"Unknown runtime error"}}componentDidCatch(s){console.error("ForgeOS runtime crash:",s)}render(){return this.state.hasError?r.jsxs("div",{style:{minHeight:"100vh",background:"#0a0a0a",color:"#f5f5f5",padding:24,fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace"},children:[r.jsx("div",{style:{fontSize:16,fontWeight:700,marginBottom:8},children:"ForgeOS runtime error"}),r.jsx("div",{style:{fontSize:12,opacity:.8,marginBottom:12},children:"The app encountered an unexpected error. Reload, then check console/network config if this continues."}),r.jsx("pre",{style:{whiteSpace:"pre-wrap",background:"#111",border:"1px solid #222",padding:12,borderRadius:6},children:this.state.message}),r.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,flexWrap:"wrap"},children:[r.jsx("button",{type:"button",onClick:this.resetApp,style:{border:"1px solid #3a4e66",background:"#111826",color:"#d7e4f7",borderRadius:8,padding:"8px 12px",cursor:"pointer"},children:"Retry App"}),r.jsx("button",{type:"button",onClick:this.clearLocalStateAndReload,style:{border:"1px solid #5a3340",background:"#241018",color:"#ffd5dc",borderRadius:8,padding:"8px 12px",cursor:"pointer"},children:"Clear ForgeOS Session"})]})]}):this.props.children}}window.__FORGEOS_BOOTED__=!0;document.documentElement.setAttribute("data-forgeos-booted","1");window.__FORGEOS_RENDERED__||(window.__FORGEOS_RENDERED__=!0,cc.createRoot(document.getElementById("root")).render(r.jsx(To.StrictMode,{children:r.jsx(Ip,{children:r.jsx(Np,{})})})));export{J as B,ye as C,Be as I,Ge as L,n as a,_e as b,Kp as c,Co as d,Op as f,f as m};
