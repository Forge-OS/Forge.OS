<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ForgeOS</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      const isLocal = ["localhost", "127.0.0.1"].includes(window.location.hostname);
      const repoBase = "/Forge.OS";

      async function boot() {
        if(isLocal) {
          await import("/src/main.tsx");
          return;
        }

        // Branch-mode GitHub Pages fallback: resolve the current built entry from Vite manifest.
        const manifestRes = await fetch(`${repoBase}/dist/manifest.json`, { cache: "no-store" });
        if(!manifestRes.ok) throw new Error(`Manifest fetch failed: ${manifestRes.status}`);

        const manifest = await manifestRes.json();
        const entry = manifest?.["index.html"]?.file || Object.values(manifest || {}).find((v) => v && v.isEntry)?.file;
        if(!entry) throw new Error("Could not resolve app entry from manifest");

        await import(`${repoBase}/dist/${entry}`);
      }

      boot().catch((err) => {
        console.error("ForgeOS bootstrap failed", err);
        document.body.innerHTML = "<div style='padding:24px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;color:#eee;background:#0a0a0a;min-height:100vh'>ForgeOS failed to load. Check GitHub Pages source and build artifact paths.</div>";
      });
    </script>
  </body>
</html>
